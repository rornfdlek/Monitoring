"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.BaseClass = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_cdk_lib_1 = require("aws-cdk-lib");
const appsync = require("aws-cdk-lib/aws-appsync");
const lambda = require("aws-cdk-lib/aws-lambda");
const logs = require("aws-cdk-lib/aws-logs");
const constructs_1 = require("constructs");
const construct_name_enum_1 = require("./construct-name-enum");
const utils_1 = require("../helpers/utils");
class BaseClass extends constructs_1.Construct {
    constructor(scope, id) {
        super(scope, id);
        /**
         * construct usage metric , added in template description
         */
        this.constructUsageMetric = 'uksb-1tupboc45';
        /**
         * enable disable lambda tracing
         *
         * @default - Active
         */
        this.lambdaTracing = lambda.Tracing.ACTIVE;
        /**
         * enable disable xray tracing
         *
         * @default - True
         */
        this.enablexray = true;
        /**
         * Default  log config for all constructs
         */
        this.fieldLogLevel = appsync.FieldLogLevel.ALL;
        /**
         * Default  log retention config for all constructs
         */
        this.retention = logs.RetentionDays.TEN_YEARS;
    }
    //overwrite default env suffix
    updateEnvSuffix(props) {
        let stage = '-dev';
        if (props?.stage) {
            stage = props.stage;
        }
        this.stage = stage;
    }
    /*
    * update template description with construct usage metric and
    * add AWS_SDK_UA_APP_ID to user agent on aws sdk.
    */
    updateConstructUsageMetricCode(props, scope, lambdaFunctions) {
        const solutionId = `genai_cdk_${utils_1.version}/${props.constructName}/${props.constructId}`;
        if (lambdaFunctions
            && lambdaFunctions.length > 0) {
            for (let lambdaFunction of lambdaFunctions) {
                lambdaFunction.addEnvironment('AWS_SDK_UA_APP_ID', solutionId);
            }
        }
        if (props && BaseClass.usageMetricMap.hasOwnProperty(props.constructName)) {
            BaseClass.usageMetricMap[props.constructName] = BaseClass.usageMetricMap[props.constructName] + 1;
        }
        else {
            throw Error('construct name is not present in usageMetricMap ');
        }
        const usageMetricMapSerialized = JSON.stringify(BaseClass.usageMetricMap).replace(/[{}]/g, '').replace(/"/g, '');
        // Description format :(usage id :uksb-1tupboc45)(version:0.0.0) (constructs :::{\"C1\":1,\"C2\":5,\"C3\":3,\"C4\":0,\"C5\":0,\"C6\":0,\"C7\":0,\"C8\":0}) ",
        // where C1,C2, etc are mapped with construct-name-enum and the values shows the number of time stack created/deleted.
        aws_cdk_lib_1.Stack.of(scope).templateOptions.description =
            `Description: (${this.constructUsageMetric}) (version:${utils_1.version}) (tag:${usageMetricMapSerialized}) `;
    }
    // observability
    addObservabilityToConstruct(props) {
        if (props.observability == false) {
            this.enablexray = false;
            this.lambdaTracing = lambda.Tracing.DISABLED;
            this.fieldLogLevel = appsync.FieldLogLevel.NONE;
            this.retention = logs.RetentionDays.TEN_YEARS;
        }
        ;
    }
}
exports.BaseClass = BaseClass;
_a = JSII_RTTI_SYMBOL_1;
BaseClass[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.BaseClass", version: "0.1.285" };
/**
 * Record<string, number> , maps construct name with number of deployments
 */
BaseClass.usageMetricMap = {
    [construct_name_enum_1.ConstructName.AWSRAGAPPSYNCSTEPFNOPENSEARCH]: 0,
    [construct_name_enum_1.ConstructName.AWSQAAPPSYNCOPENSEARCH]: 0,
    [construct_name_enum_1.ConstructName.AWSSUMMARIZATIONAPPSYNCSTEPFN]: 0,
    [construct_name_enum_1.ConstructName.AWSMODELDEPLOYMENTSAGEMAKER]: 0,
    [construct_name_enum_1.ConstructName.CUSTOMSAGEMAKERENDPOINT]: 0,
    [construct_name_enum_1.ConstructName.HUGGINGFACESAGEMAKERENDPOINT]: 0,
    [construct_name_enum_1.ConstructName.JUMPSTARTSAGEMAKERENDPOINT]: 0,
    [construct_name_enum_1.ConstructName.AWSCONTENTGENAPPSYNCLAMBDA]: 0,
    [construct_name_enum_1.ConstructName.AWSLLAMAINDEXDATALOADER]: 0,
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS1jbGFzcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21tb24vYmFzZS1jbGFzcy9iYXNlLWNsYXNzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7QUFDSCw2Q0FBb0M7QUFDcEMsbURBQW1EO0FBQ25ELGlEQUFpRDtBQUNqRCw2Q0FBNkM7QUFDN0MsMkNBQXVDO0FBQ3ZDLCtEQUFzRDtBQUN0RCw0Q0FBMkM7QUFnQzNDLE1BQWEsU0FBVSxTQUFRLHNCQUFTO0lBdUR0QyxZQUFZLEtBQWdCLEVBQUUsRUFBVTtRQUN0QyxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBdENuQjs7V0FFRztRQUNNLHlCQUFvQixHQUFHLGdCQUFnQixDQUFDO1FBU2pEOzs7O1dBSUc7UUFDSCxrQkFBYSxHQUFtQixNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQztRQUV0RDs7OztXQUlHO1FBQ0gsZUFBVSxHQUFZLElBQUksQ0FBQztRQUUzQjs7V0FFRztRQUNILGtCQUFhLEdBQXlCLE9BQU8sQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDO1FBRWhFOztXQUVHO1FBQ0gsY0FBUyxHQUF1QixJQUFJLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQztJQU03RCxDQUFDO0lBRUQsOEJBQThCO0lBQ3BCLGVBQWUsQ0FBQyxLQUFxQjtRQUM3QyxJQUFJLEtBQUssR0FBRyxNQUFNLENBQUM7UUFDbkIsSUFBSSxLQUFLLEVBQUUsS0FBSyxFQUFFLENBQUM7WUFDakIsS0FBSyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUM7UUFDdEIsQ0FBQztRQUNELElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBQ3JCLENBQUM7SUFFRDs7O01BR0U7SUFDUSw4QkFBOEIsQ0FBQyxLQUFxQixFQUFFLEtBQWdCLEVBQUUsZUFBNkM7UUFFN0gsTUFBTSxVQUFVLEdBQUcsYUFBYSxlQUFPLElBQUksS0FBSyxDQUFDLGFBQWEsSUFBSSxLQUFLLENBQUMsV0FBVyxFQUFFLENBQUM7UUFFdEYsSUFBSSxlQUFlO2VBQ1osZUFBZSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUNsQyxLQUFLLElBQUksY0FBYyxJQUFJLGVBQWUsRUFBRSxDQUFDO2dCQUMzQyxjQUFjLENBQUMsY0FBYyxDQUMzQixtQkFBbUIsRUFBRSxVQUFVLENBQ2hDLENBQUM7WUFDSixDQUFDO1FBQ0gsQ0FBQztRQUVELElBQUksS0FBSyxJQUFJLFNBQVMsQ0FBQyxjQUFjLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDO1lBQzFFLFNBQVMsQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNwRyxDQUFDO2FBQU0sQ0FBQztZQUNOLE1BQU0sS0FBSyxDQUFDLGtEQUFrRCxDQUFDLENBQUM7UUFDbEUsQ0FBQztRQUVELE1BQU0sd0JBQXdCLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRWpILDZKQUE2SjtRQUM3SixzSEFBc0g7UUFDdEgsbUJBQUssQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsZUFBZSxDQUFDLFdBQVc7WUFDM0MsaUJBQWlCLElBQUksQ0FBQyxvQkFBb0IsY0FBYyxlQUFPLFVBQVcsd0JBQXdCLElBQUksQ0FBQztJQUV6RyxDQUFDO0lBRUQsZ0JBQWdCO0lBQ04sMkJBQTJCLENBQUMsS0FBcUI7UUFDekQsSUFBSSxLQUFLLENBQUMsYUFBYSxJQUFJLEtBQUssRUFBRSxDQUFDO1lBQ2pDLElBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFDO1lBQ3hCLElBQUksQ0FBQyxhQUFhLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUM7WUFDN0MsSUFBSSxDQUFDLGFBQWEsR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQztZQUNoRCxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDO1FBQ2hELENBQUM7UUFBQSxDQUFDO0lBQ0osQ0FBQzs7QUE3R0gsOEJBOEdDOzs7QUE1R0M7O0dBRUc7QUFDYyx3QkFBYyxHQUE0QjtJQUN6RCxDQUFDLG1DQUFhLENBQUMsNkJBQTZCLENBQUMsRUFBRSxDQUFDO0lBQ2hELENBQUMsbUNBQWEsQ0FBQyxzQkFBc0IsQ0FBQyxFQUFFLENBQUM7SUFDekMsQ0FBQyxtQ0FBYSxDQUFDLDZCQUE2QixDQUFDLEVBQUUsQ0FBQztJQUNoRCxDQUFDLG1DQUFhLENBQUMsMkJBQTJCLENBQUMsRUFBRSxDQUFDO0lBQzlDLENBQUMsbUNBQWEsQ0FBQyx1QkFBdUIsQ0FBQyxFQUFFLENBQUM7SUFDMUMsQ0FBQyxtQ0FBYSxDQUFDLDRCQUE0QixDQUFDLEVBQUUsQ0FBQztJQUMvQyxDQUFDLG1DQUFhLENBQUMsMEJBQTBCLENBQUMsRUFBRSxDQUFDO0lBQzdDLENBQUMsbUNBQWEsQ0FBQywwQkFBMEIsQ0FBQyxFQUFFLENBQUM7SUFDN0MsQ0FBQyxtQ0FBYSxDQUFDLHVCQUF1QixDQUFDLEVBQUUsQ0FBQztDQUMzQyxBQVY4QixDQVU3QiIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogIENvcHlyaWdodCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiAgd2l0aCB0aGUgTGljZW5zZS4gQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqICBvciBpbiB0aGUgJ2xpY2Vuc2UnIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICdBUyBJUycgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFU1xuICogIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXG4gKiAgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5pbXBvcnQgeyBTdGFjayB9IGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCAqIGFzIGFwcHN5bmMgZnJvbSAnYXdzLWNkay1saWIvYXdzLWFwcHN5bmMnO1xuaW1wb3J0ICogYXMgbGFtYmRhIGZyb20gJ2F3cy1jZGstbGliL2F3cy1sYW1iZGEnO1xuaW1wb3J0ICogYXMgbG9ncyBmcm9tICdhd3MtY2RrLWxpYi9hd3MtbG9ncyc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCB7IENvbnN0cnVjdE5hbWUgfSBmcm9tICcuL2NvbnN0cnVjdC1uYW1lLWVudW0nO1xuaW1wb3J0IHsgdmVyc2lvbiB9IGZyb20gJy4uL2hlbHBlcnMvdXRpbHMnO1xuXG5cbmV4cG9ydCBpbnRlcmZhY2UgQmFzZUNsYXNzUHJvcHMge1xuICAvKipcbiAgICogVmFsdWUgd2lsbCBiZSBhcHBlbmRlZCB0byByZXNvdXJjZXMgbmFtZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBfZGV2XG4gICAqL1xuICByZWFkb25seSBzdGFnZT86IHN0cmluZztcblxuICAvKipcbiAgICogbmFtZSBvZiB0aGUgY29uc3RydWN0LlxuICAgKlxuICAgKi9cbiAgcmVhZG9ubHkgY29uc3RydWN0TmFtZTogQ29uc3RydWN0TmFtZTtcblxuICAvKipcbiAgICogY29uc3RydWN0IGlkLlxuICAgKlxuICAgKi9cbiAgcmVhZG9ubHkgY29uc3RydWN0SWQ6IHN0cmluZztcblxuICAvKipcbiAgICogRW5hYmxlIG9ic2VydmFiaWxpdHkuIFdhcm5pbmc6IGFzc29jaWF0ZWQgY29zdCB3aXRoIHRoZSBzZXJ2aWNlc1xuICAgKiB1c2VkLiBCZXN0IHByYWN0aWNlIHRvIGVuYWJsZSBieSBkZWZhdWx0LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIHRydWVcbiAgICovXG4gIHJlYWRvbmx5IG9ic2VydmFiaWxpdHk/OiBib29sZWFuO1xufVxuXG5leHBvcnQgY2xhc3MgQmFzZUNsYXNzIGV4dGVuZHMgQ29uc3RydWN0IHtcblxuICAvKipcbiAgICogUmVjb3JkPHN0cmluZywgbnVtYmVyPiAsIG1hcHMgY29uc3RydWN0IG5hbWUgd2l0aCBudW1iZXIgb2YgZGVwbG95bWVudHNcbiAgICovXG4gIHByb3RlY3RlZCBzdGF0aWMgdXNhZ2VNZXRyaWNNYXAgOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge1xuICAgIFtDb25zdHJ1Y3ROYW1lLkFXU1JBR0FQUFNZTkNTVEVQRk5PUEVOU0VBUkNIXTogMCxcbiAgICBbQ29uc3RydWN0TmFtZS5BV1NRQUFQUFNZTkNPUEVOU0VBUkNIXTogMCxcbiAgICBbQ29uc3RydWN0TmFtZS5BV1NTVU1NQVJJWkFUSU9OQVBQU1lOQ1NURVBGTl06IDAsXG4gICAgW0NvbnN0cnVjdE5hbWUuQVdTTU9ERUxERVBMT1lNRU5UU0FHRU1BS0VSXTogMCxcbiAgICBbQ29uc3RydWN0TmFtZS5DVVNUT01TQUdFTUFLRVJFTkRQT0lOVF06IDAsXG4gICAgW0NvbnN0cnVjdE5hbWUuSFVHR0lOR0ZBQ0VTQUdFTUFLRVJFTkRQT0lOVF06IDAsXG4gICAgW0NvbnN0cnVjdE5hbWUuSlVNUFNUQVJUU0FHRU1BS0VSRU5EUE9JTlRdOiAwLFxuICAgIFtDb25zdHJ1Y3ROYW1lLkFXU0NPTlRFTlRHRU5BUFBTWU5DTEFNQkRBXTogMCxcbiAgICBbQ29uc3RydWN0TmFtZS5BV1NMTEFNQUlOREVYREFUQUxPQURFUl06IDAsXG4gIH07XG5cblxuICAvKipcbiAgICogY29uc3RydWN0IHVzYWdlIG1ldHJpYyAsIGFkZGVkIGluIHRlbXBsYXRlIGRlc2NyaXB0aW9uXG4gICAqL1xuICByZWFkb25seSBjb25zdHJ1Y3RVc2FnZU1ldHJpYyA9ICd1a3NiLTF0dXBib2M0NSc7XG5cbiAgLyoqXG4gICAqIFZhbHVlIHdpbGwgYmUgYXBwZW5kZWQgdG8gcmVzb3VyY2VzIG5hbWUuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gX2RldlxuICAgKi9cbiAgc3RhZ2UhOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIGVuYWJsZSBkaXNhYmxlIGxhbWJkYSB0cmFjaW5nXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gQWN0aXZlXG4gICAqL1xuICBsYW1iZGFUcmFjaW5nOiBsYW1iZGEuVHJhY2luZyA9IGxhbWJkYS5UcmFjaW5nLkFDVElWRTtcblxuICAvKipcbiAgICogZW5hYmxlIGRpc2FibGUgeHJheSB0cmFjaW5nXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gVHJ1ZVxuICAgKi9cbiAgZW5hYmxleHJheTogYm9vbGVhbiA9IHRydWU7XG5cbiAgLyoqXG4gICAqIERlZmF1bHQgIGxvZyBjb25maWcgZm9yIGFsbCBjb25zdHJ1Y3RzXG4gICAqL1xuICBmaWVsZExvZ0xldmVsOmFwcHN5bmMuRmllbGRMb2dMZXZlbCA9IGFwcHN5bmMuRmllbGRMb2dMZXZlbC5BTEw7XG5cbiAgLyoqXG4gICAqIERlZmF1bHQgIGxvZyByZXRlbnRpb24gY29uZmlnIGZvciBhbGwgY29uc3RydWN0c1xuICAgKi9cbiAgcmV0ZW50aW9uOiBsb2dzLlJldGVudGlvbkRheXMgPSBsb2dzLlJldGVudGlvbkRheXMuVEVOX1lFQVJTO1xuXG5cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG5cbiAgfVxuXG4gIC8vb3ZlcndyaXRlIGRlZmF1bHQgZW52IHN1ZmZpeFxuICBwcm90ZWN0ZWQgdXBkYXRlRW52U3VmZml4KHByb3BzOiBCYXNlQ2xhc3NQcm9wcykge1xuICAgIGxldCBzdGFnZSA9ICctZGV2JztcbiAgICBpZiAocHJvcHM/LnN0YWdlKSB7XG4gICAgICBzdGFnZSA9IHByb3BzLnN0YWdlO1xuICAgIH1cbiAgICB0aGlzLnN0YWdlID0gc3RhZ2U7XG4gIH1cblxuICAvKlxuICAqIHVwZGF0ZSB0ZW1wbGF0ZSBkZXNjcmlwdGlvbiB3aXRoIGNvbnN0cnVjdCB1c2FnZSBtZXRyaWMgYW5kXG4gICogYWRkIEFXU19TREtfVUFfQVBQX0lEIHRvIHVzZXIgYWdlbnQgb24gYXdzIHNkay5cbiAgKi9cbiAgcHJvdGVjdGVkIHVwZGF0ZUNvbnN0cnVjdFVzYWdlTWV0cmljQ29kZShwcm9wczogQmFzZUNsYXNzUHJvcHMsIHNjb3BlOiBDb25zdHJ1Y3QsIGxhbWJkYUZ1bmN0aW9uczogbGFtYmRhLkRvY2tlckltYWdlRnVuY3Rpb25bXSxcbiAgKSB7XG4gICAgY29uc3Qgc29sdXRpb25JZCA9IGBnZW5haV9jZGtfJHt2ZXJzaW9ufS8ke3Byb3BzLmNvbnN0cnVjdE5hbWV9LyR7cHJvcHMuY29uc3RydWN0SWR9YDtcblxuICAgIGlmIChsYW1iZGFGdW5jdGlvbnNcbiAgICAgICAgJiYgbGFtYmRhRnVuY3Rpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgIGZvciAobGV0IGxhbWJkYUZ1bmN0aW9uIG9mIGxhbWJkYUZ1bmN0aW9ucykge1xuICAgICAgICBsYW1iZGFGdW5jdGlvbi5hZGRFbnZpcm9ubWVudChcbiAgICAgICAgICAnQVdTX1NES19VQV9BUFBfSUQnLCBzb2x1dGlvbklkLFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChwcm9wcyAmJiBCYXNlQ2xhc3MudXNhZ2VNZXRyaWNNYXAuaGFzT3duUHJvcGVydHkocHJvcHMuY29uc3RydWN0TmFtZSkpIHtcbiAgICAgIEJhc2VDbGFzcy51c2FnZU1ldHJpY01hcFtwcm9wcy5jb25zdHJ1Y3ROYW1lXSA9IEJhc2VDbGFzcy51c2FnZU1ldHJpY01hcFtwcm9wcy5jb25zdHJ1Y3ROYW1lXSArIDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IEVycm9yKCdjb25zdHJ1Y3QgbmFtZSBpcyBub3QgcHJlc2VudCBpbiB1c2FnZU1ldHJpY01hcCAnKTtcbiAgICB9XG5cbiAgICBjb25zdCB1c2FnZU1ldHJpY01hcFNlcmlhbGl6ZWQgPSBKU09OLnN0cmluZ2lmeShCYXNlQ2xhc3MudXNhZ2VNZXRyaWNNYXApLnJlcGxhY2UoL1t7fV0vZywgJycpLnJlcGxhY2UoL1wiL2csICcnKTtcblxuICAgIC8vIERlc2NyaXB0aW9uIGZvcm1hdCA6KHVzYWdlIGlkIDp1a3NiLTF0dXBib2M0NSkodmVyc2lvbjowLjAuMCkgKGNvbnN0cnVjdHMgOjo6e1xcXCJDMVxcXCI6MSxcXFwiQzJcXFwiOjUsXFxcIkMzXFxcIjozLFxcXCJDNFxcXCI6MCxcXFwiQzVcXFwiOjAsXFxcIkM2XFxcIjowLFxcXCJDN1xcXCI6MCxcXFwiQzhcXFwiOjB9KSBcIixcbiAgICAvLyB3aGVyZSBDMSxDMiwgZXRjIGFyZSBtYXBwZWQgd2l0aCBjb25zdHJ1Y3QtbmFtZS1lbnVtIGFuZCB0aGUgdmFsdWVzIHNob3dzIHRoZSBudW1iZXIgb2YgdGltZSBzdGFjayBjcmVhdGVkL2RlbGV0ZWQuXG4gICAgU3RhY2sub2Yoc2NvcGUpLnRlbXBsYXRlT3B0aW9ucy5kZXNjcmlwdGlvbiA9XG4gICAgYERlc2NyaXB0aW9uOiAoJHt0aGlzLmNvbnN0cnVjdFVzYWdlTWV0cmljfSkgKHZlcnNpb246JHt2ZXJzaW9ufSkgKHRhZzokeyB1c2FnZU1ldHJpY01hcFNlcmlhbGl6ZWR9KSBgO1xuXG4gIH1cblxuICAvLyBvYnNlcnZhYmlsaXR5XG4gIHByb3RlY3RlZCBhZGRPYnNlcnZhYmlsaXR5VG9Db25zdHJ1Y3QocHJvcHM6IEJhc2VDbGFzc1Byb3BzKSB7XG4gICAgaWYgKHByb3BzLm9ic2VydmFiaWxpdHkgPT0gZmFsc2UpIHtcbiAgICAgIHRoaXMuZW5hYmxleHJheSA9IGZhbHNlO1xuICAgICAgdGhpcy5sYW1iZGFUcmFjaW5nID0gbGFtYmRhLlRyYWNpbmcuRElTQUJMRUQ7XG4gICAgICB0aGlzLmZpZWxkTG9nTGV2ZWwgPSBhcHBzeW5jLkZpZWxkTG9nTGV2ZWwuTk9ORTtcbiAgICAgIHRoaXMucmV0ZW50aW9uID0gbG9ncy5SZXRlbnRpb25EYXlzLlRFTl9ZRUFSUztcbiAgICB9O1xuICB9XG59XG4iXX0=