"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.BedrockCwDashboard = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_cdk_lib_1 = require("aws-cdk-lib");
const aws_cloudwatch_1 = require("aws-cdk-lib/aws-cloudwatch");
const constructs_1 = require("constructs");
/**
 * The BedrockCwDashboard class.
 */
class BedrockCwDashboard extends constructs_1.Construct {
    /**
     * Constructs a new instance of the BedrockCwDashboard class.
     * @param {cdk.App} scope - represents the scope for all the resources.
     * @param {string} id - this is a a scope-unique id.
     * @param {BedrockCwDashboardProps} props - user provided props for the construct.
     * @since 0.0.0
     * @public
     */
    constructor(scope, id, props) {
        super(scope, id);
        this.dashboard = props.existingDashboard ?? new aws_cloudwatch_1.Dashboard(this, 'BedrockMetricsDashboard', {
            dashboardName: props.dashboardName ?? 'BedrockMetricsDashboard',
        });
    }
    /* Provide metrics for a specific model id in Bedrock
     * @param {string} modelName - Model name as it will appear in the dashboard row widget.
     * @param {string} modelId - Bedrock model id as defined in https://docs.aws.amazon.com/bedrock/latest/userguide/model-ids.html
     * @param {ModelMonitoringProps} props - user provided props for the monitoring.
    */
    addModelMonitoring(modelName, modelId, props) {
        const period = props.period ?? aws_cdk_lib_1.Duration.hours(1);
        const modelInputTokensMetric = new aws_cloudwatch_1.Metric({
            namespace: 'AWS/Bedrock',
            metricName: 'InputTokenCount',
            dimensionsMap: {
                ModelId: modelId,
            },
            statistic: aws_cloudwatch_1.Stats.SUM,
            period: period,
        });
        const modelOutputTokensMetric = new aws_cloudwatch_1.Metric({
            namespace: 'AWS/Bedrock',
            metricName: 'OutputTokenCount',
            dimensionsMap: {
                ModelId: modelId,
            },
            statistic: aws_cloudwatch_1.Stats.SUM,
            period: period,
        });
        const modelLatencyAvgMetric = new aws_cloudwatch_1.Metric({
            namespace: 'AWS/Bedrock',
            metricName: 'InvocationLatency',
            dimensionsMap: {
                ModelId: modelId,
            },
            statistic: aws_cloudwatch_1.Stats.AVERAGE,
            period: period,
        });
        const modelLatencyMinMetric = new aws_cloudwatch_1.Metric({
            namespace: 'AWS/Bedrock',
            metricName: 'InvocationLatency',
            dimensionsMap: {
                ModelId: modelId,
            },
            statistic: aws_cloudwatch_1.Stats.MINIMUM,
            period: period,
        });
        const modelLatencyMaxMetric = new aws_cloudwatch_1.Metric({
            namespace: 'AWS/Bedrock',
            metricName: 'InvocationLatency',
            dimensionsMap: {
                ModelId: modelId,
            },
            statistic: aws_cloudwatch_1.Stats.MAXIMUM,
            period: period,
        });
        const modelInvocationsCountMetric = new aws_cloudwatch_1.Metric({
            namespace: 'AWS/Bedrock',
            metricName: 'Invocations',
            dimensionsMap: {
                ModelId: modelId,
            },
            statistic: aws_cloudwatch_1.Stats.SAMPLE_COUNT,
            period: period,
        });
        const modelInvocationsClientErrorsMetric = new aws_cloudwatch_1.Metric({
            namespace: 'AWS/Bedrock',
            metricName: 'InvocationClientErrors',
            dimensionsMap: {
                ModelId: modelId,
            },
            statistic: aws_cloudwatch_1.Stats.SAMPLE_COUNT,
            period: period,
        });
        this.dashboard.addWidgets(new aws_cloudwatch_1.Row(new aws_cloudwatch_1.TextWidget({
            markdown: `# ${modelName}`,
            width: 24,
        })));
        this.dashboard.addWidgets(new aws_cloudwatch_1.Row(new aws_cloudwatch_1.SingleValueWidget({
            title: 'Average Latency',
            metrics: [modelLatencyAvgMetric],
            width: 8,
        }), new aws_cloudwatch_1.SingleValueWidget({
            title: 'Min Latency',
            metrics: [modelLatencyMinMetric],
            width: 8,
        }), new aws_cloudwatch_1.SingleValueWidget({
            title: 'Max Latency',
            metrics: [modelLatencyMaxMetric],
            width: 8,
        })));
        this.dashboard.addWidgets(new aws_cloudwatch_1.Row(new aws_cloudwatch_1.GraphWidget({
            title: 'Input and Output Token Counts',
            left: [modelInputTokensMetric],
            right: [modelOutputTokensMetric],
            period: period,
            width: 12,
            height: 10,
        })));
        this.dashboard.addWidgets(new aws_cloudwatch_1.Row(new aws_cloudwatch_1.SingleValueWidget({
            title: 'Invocations',
            metrics: [modelInvocationsCountMetric],
            width: 12,
        }), new aws_cloudwatch_1.SingleValueWidget({
            title: 'Client Errors',
            metrics: [modelInvocationsClientErrorsMetric],
            width: 12,
        })));
    }
    /* Add a new row to the dashboard providing metrics across all model ids in Bedrock
    * @param {ModelMonitoringProps} props - user provided props for the monitoring.
    */
    addAllModelsMonitoring(props) {
        const period = props.period ?? aws_cdk_lib_1.Duration.hours(1);
        // Metrics across all Model Ids
        const inputTokensAllModelsMetric = new aws_cloudwatch_1.Metric({
            namespace: 'AWS/Bedrock',
            metricName: 'InputTokenCount',
            statistic: aws_cloudwatch_1.Stats.SUM,
            period: period,
        });
        const outputTokensAllModelsMetric = new aws_cloudwatch_1.Metric({
            namespace: 'AWS/Bedrock',
            metricName: 'OutputTokenCount',
            statistic: aws_cloudwatch_1.Stats.SUM,
            period: period,
        });
        const latencyAvgAllModelsMetric = new aws_cloudwatch_1.Metric({
            namespace: 'AWS/Bedrock',
            metricName: 'InvocationLatency',
            statistic: aws_cloudwatch_1.Stats.AVERAGE,
            period: period,
        });
        const latencyMinAllModelsMetric = new aws_cloudwatch_1.Metric({
            namespace: 'AWS/Bedrock',
            metricName: 'InvocationLatency',
            statistic: aws_cloudwatch_1.Stats.MINIMUM,
            period: period,
        });
        const latencyMaxAllModelsMetric = new aws_cloudwatch_1.Metric({
            namespace: 'AWS/Bedrock',
            metricName: 'InvocationLatency',
            statistic: aws_cloudwatch_1.Stats.MAXIMUM,
            period: period,
        });
        const invocationsCountAllModelsMetric = new aws_cloudwatch_1.Metric({
            namespace: 'AWS/Bedrock',
            metricName: 'Invocations',
            statistic: aws_cloudwatch_1.Stats.SAMPLE_COUNT,
            period: period,
        });
        const invocationsClientErrorsAllModelsMetric = new aws_cloudwatch_1.Metric({
            namespace: 'AWS/Bedrock',
            metricName: 'InvocationClientErrors',
            statistic: aws_cloudwatch_1.Stats.SAMPLE_COUNT,
            period: period,
        });
        this.dashboard.addWidgets(new aws_cloudwatch_1.Row(new aws_cloudwatch_1.TextWidget({
            markdown: '# Metrics Across All Models',
            width: 24,
        })));
        this.dashboard.addWidgets(new aws_cloudwatch_1.Row(new aws_cloudwatch_1.SingleValueWidget({
            title: 'Average Latency (All Models)',
            metrics: [latencyAvgAllModelsMetric],
            width: 8,
        }), new aws_cloudwatch_1.SingleValueWidget({
            title: 'Min Latency (All Models)',
            metrics: [latencyMinAllModelsMetric],
            width: 8,
        }), new aws_cloudwatch_1.SingleValueWidget({
            title: 'Max Latency (All Models)',
            metrics: [latencyMaxAllModelsMetric],
            width: 8,
        })));
        this.dashboard.addWidgets(new aws_cloudwatch_1.Row(new aws_cloudwatch_1.Column(new aws_cloudwatch_1.GraphWidget({
            title: 'Input and Output Tokens (All Models)',
            left: [inputTokensAllModelsMetric],
            right: [outputTokensAllModelsMetric],
            period: period,
            width: 12,
        })), new aws_cloudwatch_1.Column(new aws_cloudwatch_1.Row(new aws_cloudwatch_1.SingleValueWidget({
            title: 'Invocations (All Models)',
            metrics: [invocationsCountAllModelsMetric],
            width: 12,
        })), new aws_cloudwatch_1.Row(new aws_cloudwatch_1.SingleValueWidget({
            title: 'Client Errors (All Models)',
            metrics: [invocationsClientErrorsAllModelsMetric],
            width: 12,
        })))));
    }
}
exports.BedrockCwDashboard = BedrockCwDashboard;
_a = JSII_RTTI_SYMBOL_1;
BedrockCwDashboard[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.BedrockCwDashboard", version: "0.1.285" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvcGF0dGVybnMvZ2VuLWFpL2F3cy1iZWRyb2NrLWN3LWRhc2hib2FyZC9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBOzs7Ozs7Ozs7OztHQVdHO0FBQ0gsNkNBQXVDO0FBQ3ZDLCtEQVNvQztBQUNwQywyQ0FBdUM7QUFvQ3ZDOztHQUVHO0FBQ0gsTUFBYSxrQkFBbUIsU0FBUSxzQkFBUztJQU8vQzs7Ozs7OztPQU9HO0lBQ0gsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUE4QjtRQUN0RSxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRWpCLElBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFDLGlCQUFpQixJQUFJLElBQUksMEJBQVMsQ0FBQyxJQUFJLEVBQUUseUJBQXlCLEVBQUU7WUFDekYsYUFBYSxFQUFFLEtBQUssQ0FBQyxhQUFhLElBQUkseUJBQXlCO1NBQ2hFLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRDs7OztNQUlFO0lBQ0ssa0JBQWtCLENBQUMsU0FBaUIsRUFBRSxPQUFlLEVBQUUsS0FBMkI7UUFFdkYsTUFBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sSUFBSSxzQkFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVqRCxNQUFNLHNCQUFzQixHQUFHLElBQUksdUJBQU0sQ0FBQztZQUN4QyxTQUFTLEVBQUUsYUFBYTtZQUN4QixVQUFVLEVBQUUsaUJBQWlCO1lBQzdCLGFBQWEsRUFBRTtnQkFDYixPQUFPLEVBQUUsT0FBTzthQUNqQjtZQUNELFNBQVMsRUFBRSxzQkFBSyxDQUFDLEdBQUc7WUFDcEIsTUFBTSxFQUFFLE1BQU07U0FDZixDQUFDLENBQUM7UUFFSCxNQUFNLHVCQUF1QixHQUFHLElBQUksdUJBQU0sQ0FBQztZQUN6QyxTQUFTLEVBQUUsYUFBYTtZQUN4QixVQUFV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QUMsRUFDRixJQUFJLGtDQUFpQixDQUFDO1lBQ3BCLEtBQUssRUFBRSwwQkFBMEI7WUFDakMsT0FBTyxFQUFFLENBQUMseUJBQXlCLENBQUM7WUFDcEMsS0FBSyxFQUFFLENBQUM7U0FDVCxDQUFDLEVBQ0YsSUFBSSxrQ0FBaUIsQ0FBQztZQUNwQixLQUFLLEVBQUUsMEJBQTBCO1lBQ2pDLE9BQU8sRUFBRSxDQUFDLHlCQUF5QixDQUFDO1lBQ3BDLEtBQUssRUFBRSxDQUFDO1NBQ1QsQ0FBQyxDQUNILENBQ0YsQ0FBQztRQUNGLElBQUksQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUN2QixJQUFJLG9CQUFHLENBQ0wsSUFBSSx1QkFBTSxDQUNSLElBQUksNEJBQVcsQ0FBQztZQUNkLEtBQUssRUFBRSxzQ0FBc0M7WUFDN0MsSUFBSSxFQUFFLENBQUMsMEJBQTBCLENBQUM7WUFDbEMsS0FBSyxFQUFFLENBQUMsMkJBQTJCLENBQUM7WUFDcEMsTUFBTSxFQUFFLE1BQU07WUFDZCxLQUFLLEVBQUUsRUFBRTtTQUNWLENBQUMsQ0FDSCxFQUNELElBQUksdUJBQU0sQ0FDUixJQUFJLG9CQUFHLENBQ0wsSUFBSSxrQ0FBaUIsQ0FBQztZQUNwQixLQUFLLEVBQUUsMEJBQTBCO1lBQ2pDLE9BQU8sRUFBRSxDQUFDLCtCQUErQixDQUFDO1lBQzFDLEtBQUssRUFBRSxFQUFFO1NBQ1YsQ0FBQyxDQUNILEVBQ0QsSUFBSSxvQkFBRyxDQUNMLElBQUksa0NBQWlCLENBQUM7WUFDcEIsS0FBSyxFQUFFLDRCQUE0QjtZQUNuQyxPQUFPLEVBQUUsQ0FBQyxzQ0FBc0MsQ0FBQztZQUNqRCxLQUFLLEVBQUUsRUFBRTtTQUNWLENBQUMsQ0FDSCxDQUNGLENBQ0YsQ0FDRixDQUFDO0lBQ0osQ0FBQzs7QUFqUkgsZ0RBa1JDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiAgQ29weXJpZ2h0IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqICB3aXRoIHRoZSBMaWNlbnNlLiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICpcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogIG9yIGluIHRoZSAnbGljZW5zZScgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWQgb24gYW4gJ0FTIElTJyBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTXG4gKiAgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnNcbiAqICBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCB7IER1cmF0aW9uIH0gZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0IHtcbiAgTWV0cmljLFxuICBEYXNoYm9hcmQsXG4gIEdyYXBoV2lkZ2V0LFxuICBTaW5nbGVWYWx1ZVdpZGdldCxcbiAgUm93LFxuICBTdGF0cyxcbiAgVGV4dFdpZGdldCxcbiAgQ29sdW1uLFxufSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtY2xvdWR3YXRjaCc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcblxuLyoqXG4gKiBUaGUgcHJvcGVydGllcyBmb3IgdGhlIE1vZGVsTW9uaXRvcmluZ1Byb3BzIGNsYXNzLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIE1vZGVsTW9uaXRvcmluZ1Byb3BzIHtcbiAgLypcbiAgICAqIE9wdGlvbmFsIC0gVGhlIHBlcmlvZCBvdmVyIHdoaWNoIHRoZSBzcGVjaWZpZWQgc3RhdGlzdGljIGlzIGFwcGxpZWQuXG4gICAgKiBAZGVmYXVsdCAtIDEgaG91clxuICAgICovXG4gIHJlYWRvbmx5IHBlcmlvZD86IER1cmF0aW9uO1xufVxuXG4vKipcbiAqIFRoZSBwcm9wZXJ0aWVzIGZvciB0aGUgQmVkcm9ja0N3RGFzaGJvYXJkUHJvcHMgY2xhc3MuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQmVkcm9ja0N3RGFzaGJvYXJkUHJvcHMge1xuXG4gIC8qKlxuICAgKiBPcHRpb25hbCBBbiBleGlzdGluZyBkYXNoYm9hcmQgd2hlcmUgbWV0cmljcyB3aWxsIGJlIGFkZGVkIHRvLlxuICAgKiBJZiBub3QgcHJvdmlkZWQsIHRoZSBjb25zdHJ1Y3Qgd2lsbCBjcmVhdGUgYSBuZXcgZGFzaGJvYXJkXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gbm9uZVxuICAgKi9cbiAgcmVhZG9ubHkgZXhpc3RpbmdEYXNoYm9hcmQ/OiBEYXNoYm9hcmQ7XG5cbiAgLyoqXG4gICAqIE9wdGlvbmFsIEEgbmFtZSBmb3IgdGhlIGRhc2hib2FyZCB3aGljaCB3aWxsIGJlIGNyZWF0ZWQuXG4gICAqIElmIGV4aXN0aW5nRGFzaGJvYXJkIGlzIGRlZmluZWQsIHRoaXMgdmFsdWUgd2lsbCBiZSBpZ25vcmVkLlxuICAgKiBJZiBub3QgcHJvdmlkZWQsIHRoZSBjb25zdHJ1Y3Qgd2lsbCBjcmVhdGUgYSBuZXcgZGFzaGJvYXJkIG5hbWVkICdCZWRyb2NrTWV0cmljc0Rhc2hib2FyZCdcbiAgICpcbiAgICogQGRlZmF1bHQgLSBub25lXG4gICAqL1xuICByZWFkb25seSBkYXNoYm9hcmROYW1lPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIFRoZSBCZWRyb2NrQ3dEYXNoYm9hcmQgY2xhc3MuXG4gKi9cbmV4cG9ydCBjbGFzcyBCZWRyb2NrQ3dEYXNoYm9hcmQgZXh0ZW5kcyBDb25zdHJ1Y3Qge1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiBDbG91ZFdhdGNoIGRhc2hib2FyZCB1c2VkIGJ5IHRoZSBjb25zdHJ1Y3RcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBkYXNoYm9hcmQ6IERhc2hib2FyZDtcblxuICAvKipcbiAgICogQ29uc3RydWN0cyBhIG5ldyBpbnN0YW5jZSBvZiB0aGUgQmVkcm9ja0N3RGFzaGJvYXJkIGNsYXNzLlxuICAgKiBAcGFyYW0ge2Nkay5BcHB9IHNjb3BlIC0gcmVwcmVzZW50cyB0aGUgc2NvcGUgZm9yIGFsbCB0aGUgcmVzb3VyY2VzLlxuICAgKiBAcGFyYW0ge3N0cmluZ30gaWQgLSB0aGlzIGlzIGEgYSBzY29wZS11bmlxdWUgaWQuXG4gICAqIEBwYXJhbSB7QmVkcm9ja0N3RGFzaGJvYXJkUHJvcHN9IHByb3BzIC0gdXNlciBwcm92aWRlZCBwcm9wcyBmb3IgdGhlIGNvbnN0cnVjdC5cbiAgICogQHNpbmNlIDAuMC4wXG4gICAqIEBwdWJsaWNcbiAgICovXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBCZWRyb2NrQ3dEYXNoYm9hcmRQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG5cbiAgICB0aGlzLmRhc2hib2FyZCA9IHByb3BzLmV4aXN0aW5nRGFzaGJvYXJkID8/IG5ldyBEYXNoYm9hcmQodGhpcywgJ0JlZHJvY2tNZXRyaWNzRGFzaGJvYXJkJywge1xuICAgICAgZGFzaGJvYXJkTmFtZTogcHJvcHMuZGFzaGJvYXJkTmFtZSA/PyAnQmVkcm9ja01ldHJpY3NEYXNoYm9hcmQnLFxuICAgIH0pO1xuICB9XG5cbiAgLyogUHJvdmlkZSBtZXRyaWNzIGZvciBhIHNwZWNpZmljIG1vZGVsIGlkIGluIEJlZHJvY2tcbiAgICogQHBhcmFtIHtzdHJpbmd9IG1vZGVsTmFtZSAtIE1vZGVsIG5hbWUgYXMgaXQgd2lsbCBhcHBlYXIgaW4gdGhlIGRhc2hib2FyZCByb3cgd2lkZ2V0LlxuICAgKiBAcGFyYW0ge3N0cmluZ30gbW9kZWxJZCAtIEJlZHJvY2sgbW9kZWwgaWQgYXMgZGVmaW5lZCBpbiBodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vYmVkcm9jay9sYXRlc3QvdXNlcmd1aWRlL21vZGVsLWlkcy5odG1sXG4gICAqIEBwYXJhbSB7TW9kZWxNb25pdG9yaW5nUHJvcHN9IHByb3BzIC0gdXNlciBwcm92aWRlZCBwcm9wcyBmb3IgdGhlIG1vbml0b3JpbmcuXG4gICovXG4gIHB1YmxpYyBhZGRNb2RlbE1vbml0b3JpbmcobW9kZWxOYW1lOiBzdHJpbmcsIG1vZGVsSWQ6IHN0cmluZywgcHJvcHM6IE1vZGVsTW9uaXRvcmluZ1Byb3BzKSB7XG5cbiAgICBjb25zdCBwZXJpb2QgPSBwcm9wcy5wZXJpb2QgPz8gRHVyYXRpb24uaG91cnMoMSk7XG5cbiAgICBjb25zdCBtb2RlbElucHV0VG9rZW5zTWV0cmljID0gbmV3IE1ldHJpYyh7XG4gICAgICBuYW1lc3BhY2U6ICdBV1MvQmVkcm9jaycsXG4gICAgICBtZXRyaWNOYW1lOiAnSW5wdXRUb2tlbkNvdW50JyxcbiAgICAgIGRpbWVuc2lvbnNNYXA6IHtcbiAgICAgICAgTW9kZWxJZDogbW9kZWxJZCxcbiAgICAgIH0sXG4gICAgICBzdGF0aXN0aWM6IFN0YXRzLlNVTSxcbiAgICAgIHBlcmlvZDogcGVyaW9kLFxuICAgIH0pO1xuXG4gICAgY29uc3QgbW9kZWxPdXRwdXRUb2tlbnNNZXRyaWMgPSBuZXcgTWV0cmljKHtcbiAgICAgIG5hbWVzcGFjZTogJ0FXUy9CZWRyb2NrJyxcbiAgICAgIG1ldHJpY05hbWU6ICdPdXRwdXRUb2tlbkNvdW50JyxcbiAgICAgIGRpbWVuc2lvbnNNYXA6IHtcbiAgICAgICAgTW9kZWxJZDogbW9kZWxJZCxcbiAgICAgIH0sXG4gICAgICBzdGF0aXN0aWM6IFN0YXRzLlNVTSxcbiAgICAgIHBlcmlvZDogcGVyaW9kLFxuICAgIH0pO1xuXG4gICAgY29uc3QgbW9kZWxMYXRlbmN5QXZnTWV0cmljID0gbmV3IE1ldHJpYyh7XG4gICAgICBuYW1lc3BhY2U6ICdBV1MvQmVkcm9jaycsXG4gICAgICBtZXRyaWNOYW1lOiAnSW52b2NhdGlvbkxhdGVuY3knLFxuICAgICAgZGltZW5zaW9uc01hcDoge1xuICAgICAgICBNb2RlbElkOiBtb2RlbElkLFxuICAgICAgfSxcbiAgICAgIHN0YXRpc3RpYzogU3RhdHMuQVZFUkFHRSxcbiAgICAgIHBlcmlvZDogcGVyaW9kLFxuICAgIH0pO1xuXG4gICAgY29uc3QgbW9kZWxMYXRlbmN5TWluTWV0cmljID0gbmV3IE1ldHJpYyh7XG4gICAgICBuYW1lc3BhY2U6ICdBV1MvQmVkcm9jaycsXG4gICAgICBtZXRyaWNOYW1lOiAnSW52b2NhdGlvbkxhdGVuY3knLFxuICAgICAgZGltZW5zaW9uc01hcDoge1xuICAgICAgICBNb2RlbElkOiBtb2RlbElkLFxuICAgICAgfSxcbiAgICAgIHN0YXRpc3RpYzogU3RhdHMuTUlOSU1VTSxcbiAgICAgIHBlcmlvZDogcGVyaW9kLFxuICAgIH0pO1xuXG4gICAgY29uc3QgbW9kZWxMYXRlbmN5TWF4TWV0cmljID0gbmV3IE1ldHJpYyh7XG4gICAgICBuYW1lc3BhY2U6ICdBV1MvQmVkcm9jaycsXG4gICAgICBtZXRyaWNOYW1lOiAnSW52b2NhdGlvbkxhdGVuY3knLFxuICAgICAgZGltZW5zaW9uc01hcDoge1xuICAgICAgICBNb2RlbElkOiBtb2RlbElkLFxuICAgICAgfSxcbiAgICAgIHN0YXRpc3RpYzogU3RhdHMuTUFYSU1VTSxcbiAgICAgIHBlcmlvZDogcGVyaW9kLFxuICAgIH0pO1xuXG4gICAgY29uc3QgbW9kZWxJbnZvY2F0aW9uc0NvdW50TWV0cmljID0gbmV3IE1ldHJpYyh7XG4gICAgICBuYW1lc3BhY2U6ICdBV1MvQmVkcm9jaycsXG4gICAgICBtZXRyaWNOYW1lOiAnSW52b2NhdGlvbnMnLFxuICAgICAgZGltZW5zaW9uc01hcDoge1xuICAgICAgICBNb2RlbElkOiBtb2RlbElkLFxuICAgICAgfSxcbiAgICAgIHN0YXRpc3RpYzogU3RhdHMuU0FNUExFX0NPVU5ULFxuICAgICAgcGVyaW9kOiBwZXJpb2QsXG4gICAgfSk7XG5cbiAgICBjb25zdCBtb2RlbEludm9jYXRpb25zQ2xpZW50RXJyb3JzTWV0cmljID0gbmV3IE1ldHJpYyh7XG4gICAgICBuYW1lc3BhY2U6ICdBV1MvQmVkcm9jaycsXG4gICAgICBtZXRyaWNOYW1lOiAnSW52b2NhdGlvbkNsaWVudEVycm9ycycsXG4gICAgICBkaW1lbnNpb25zTWFwOiB7XG4gICAgICAgIE1vZGVsSWQ6IG1vZGVsSWQsXG4gICAgICB9LFxuICAgICAgc3RhdGlzdGljOiBTdGF0cy5TQU1QTEVfQ09VTlQsXG4gICAgICBwZXJpb2Q6IHBlcmlvZCxcbiAgICB9KTtcblxuICAgIHRoaXMuZGFzaGJvYXJkLmFkZFdpZGdldHMoXG4gICAgICBuZXcgUm93KFxuICAgICAgICBuZXcgVGV4dFdpZGdldCh7XG4gICAgICAgICAgbWFya2Rvd246IGAjICR7bW9kZWxOYW1lfWAsXG4gICAgICAgICAgd2lkdGg6IDI0LFxuICAgICAgICB9KSxcbiAgICAgICksXG4gICAgKTtcblxuICAgIHRoaXMuZGFzaGJvYXJkLmFkZFdpZGdldHMoXG4gICAgICBuZXcgUm93KFxuICAgICAgICBuZXcgU2luZ2xlVmFsdWVXaWRnZXQoe1xuICAgICAgICAgIHRpdGxlOiAnQXZlcmFnZSBMYXRlbmN5JyxcbiAgICAgICAgICBtZXRyaWNzOiBbbW9kZWxMYXRlbmN5QXZnTWV0cmljXSxcbiAgICAgICAgICB3aWR0aDogOCxcbiAgICAgICAgfSksXG4gICAgICAgIG5ldyBTaW5nbGVWYWx1ZVdpZGdldCh7XG4gICAgICAgICAgdGl0bGU6ICdNaW4gTGF0ZW5jeScsXG4gICAgICAgICAgbWV0cmljczogW21vZGVsTGF0ZW5jeU1pbk1ldHJpY10sXG4gICAgICAgICAgd2lkdGg6IDgsXG4gICAgICAgIH0pLFxuICAgICAgICBuZXcgU2luZ2xlVmFsdWVXaWRnZXQoe1xuICAgICAgICAgIHRpdGxlOiAnTWF4IExhdGVuY3knLFxuICAgICAgICAgIG1ldHJpY3M6IFttb2RlbExhdGVuY3lNYXhNZXRyaWNdLFxuICAgICAgICAgIHdpZHRoOiA4LFxuICAgICAgICB9KSxcbiAgICAgICksXG4gICAgKTtcblxuICAgIHRoaXMuZGFzaGJvYXJkLmFkZFdpZGdldHMoXG4gICAgICBuZXcgUm93KFxuICAgICAgICBuZXcgR3JhcGhXaWRnZXQoe1xuICAgICAgICAgIHRpdGxlOiAnSW5wdXQgYW5kIE91dHB1dCBUb2tlbiBDb3VudHMnLFxuICAgICAgICAgIGxlZnQ6IFttb2RlbElucHV0VG9rZW5zTWV0cmljXSxcbiAgICAgICAgICByaWdodDogW21vZGVsT3V0cHV0VG9rZW5zTWV0cmljXSxcbiAgICAgICAgICBwZXJpb2Q6IHBlcmlvZCxcbiAgICAgICAgICB3aWR0aDogMTIsXG4gICAgICAgICAgaGVpZ2h0OiAxMCxcbiAgICAgICAgfSksXG4gICAgICApLFxuICAgICk7XG5cbiAgICB0aGlzLmRhc2hib2FyZC5hZGRXaWRnZXRzKFxuICAgICAgbmV3IFJvdyhcbiAgICAgICAgbmV3IFNpbmdsZVZhbHVlV2lkZ2V0KHtcbiAgICAgICAgICB0aXRsZTogJ0ludm9jYXRpb25zJyxcbiAgICAgICAgICBtZXRyaWNzOiBbbW9kZWxJbnZvY2F0aW9uc0NvdW50TWV0cmljXSxcbiAgICAgICAgICB3aWR0aDogMTIsXG4gICAgICAgIH0pLFxuICAgICAgICBuZXcgU2luZ2xlVmFsdWVXaWRnZXQoe1xuICAgICAgICAgIHRpdGxlOiAnQ2xpZW50IEVycm9ycycsXG4gICAgICAgICAgbWV0cmljczogW21vZGVsSW52b2NhdGlvbnNDbGllbnRFcnJvcnNNZXRyaWNdLFxuICAgICAgICAgIHdpZHRoOiAxMixcbiAgICAgICAgfSksXG4gICAgICApLFxuICAgICk7XG4gIH1cblxuICAvKiBBZGQgYSBuZXcgcm93IHRvIHRoZSBkYXNoYm9hcmQgcHJvdmlkaW5nIG1ldHJpY3MgYWNyb3NzIGFsbCBtb2RlbCBpZHMgaW4gQmVkcm9ja1xuICAqIEBwYXJhbSB7TW9kZWxNb25pdG9yaW5nUHJvcHN9IHByb3BzIC0gdXNlciBwcm92aWRlZCBwcm9wcyBmb3IgdGhlIG1vbml0b3JpbmcuXG4gICovXG4gIHB1YmxpYyBhZGRBbGxNb2RlbHNNb25pdG9yaW5nKHByb3BzOiBNb2RlbE1vbml0b3JpbmdQcm9wcykge1xuXG4gICAgY29uc3QgcGVyaW9kID0gcHJvcHMucGVyaW9kID8/IER1cmF0aW9uLmhvdXJzKDEpO1xuXG4gICAgLy8gTWV0cmljcyBhY3Jvc3MgYWxsIE1vZGVsIElkc1xuICAgIGNvbnN0IGlucHV0VG9rZW5zQWxsTW9kZWxzTWV0cmljID0gbmV3IE1ldHJpYyh7XG4gICAgICBuYW1lc3BhY2U6ICdBV1MvQmVkcm9jaycsXG4gICAgICBtZXRyaWNOYW1lOiAnSW5wdXRUb2tlbkNvdW50JyxcbiAgICAgIHN0YXRpc3RpYzogU3RhdHMuU1VNLFxuICAgICAgcGVyaW9kOiBwZXJpb2QsXG4gICAgfSk7XG5cbiAgICBjb25zdCBvdXRwdXRUb2tlbnNBbGxNb2RlbHNNZXRyaWMgPSBuZXcgTWV0cmljKHtcbiAgICAgIG5hbWVzcGFjZTogJ0FXUy9CZWRyb2NrJyxcbiAgICAgIG1ldHJpY05hbWU6ICdPdXRwdXRUb2tlbkNvdW50JyxcbiAgICAgIHN0YXRpc3RpYzogU3RhdHMuU1VNLFxuICAgICAgcGVyaW9kOiBwZXJpb2QsXG4gICAgfSk7XG5cbiAgICBjb25zdCBsYXRlbmN5QXZnQWxsTW9kZWxzTWV0cmljID0gbmV3IE1ldHJpYyh7XG4gICAgICBuYW1lc3BhY2U6ICdBV1MvQmVkcm9jaycsXG4gICAgICBtZXRyaWNOYW1lOiAnSW52b2NhdGlvbkxhdGVuY3knLFxuICAgICAgc3RhdGlzdGljOiBTdGF0cy5BVkVSQUdFLFxuICAgICAgcGVyaW9kOiBwZXJpb2QsXG4gICAgfSk7XG5cbiAgICBjb25zdCBsYXRlbmN5TWluQWxsTW9kZWxzTWV0cmljID0gbmV3IE1ldHJpYyh7XG4gICAgICBuYW1lc3BhY2U6ICdBV1MvQmVkcm9jaycsXG4gICAgICBtZXRyaWNOYW1lOiAnSW52b2NhdGlvbkxhdGVuY3knLFxuICAgICAgc3RhdGlzdGljOiBTdGF0cy5NSU5JTVVNLFxuICAgICAgcGVyaW9kOiBwZXJpb2QsXG4gICAgfSk7XG5cbiAgICBjb25zdCBsYXRlbmN5TWF4QWxsTW9kZWxzTWV0cmljID0gbmV3IE1ldHJpYyh7XG4gICAgICBuYW1lc3BhY2U6ICdBV1MvQmVkcm9jaycsXG4gICAgICBtZXRyaWNOYW1lOiAnSW52b2NhdGlvbkxhdGVuY3knLFxuICAgICAgc3RhdGlzdGljOiBTdGF0cy5NQVhJTVVNLFxuICAgICAgcGVyaW9kOiBwZXJpb2QsXG4gICAgfSk7XG5cbiAgICBjb25zdCBpbnZvY2F0aW9uc0NvdW50QWxsTW9kZWxzTWV0cmljID0gbmV3IE1ldHJpYyh7XG4gICAgICBuYW1lc3BhY2U6ICdBV1MvQmVkcm9jaycsXG4gICAgICBtZXRyaWNOYW1lOiAnSW52b2NhdGlvbnMnLFxuICAgICAgc3RhdGlzdGljOiBTdGF0cy5TQU1QTEVfQ09VTlQsXG4gICAgICBwZXJpb2Q6IHBlcmlvZCxcbiAgICB9KTtcblxuICAgIGNvbnN0IGludm9jYXRpb25zQ2xpZW50RXJyb3JzQWxsTW9kZWxzTWV0cmljID0gbmV3IE1ldHJpYyh7XG4gICAgICBuYW1lc3BhY2U6ICdBV1MvQmVkcm9jaycsXG4gICAgICBtZXRyaWNOYW1lOiAnSW52b2NhdGlvbkNsaWVudEVycm9ycycsXG4gICAgICBzdGF0aXN0aWM6IFN0YXRzLlNBTVBMRV9DT1VOVCxcbiAgICAgIHBlcmlvZDogcGVyaW9kLFxuICAgIH0pO1xuXG4gICAgdGhpcy5kYXNoYm9hcmQuYWRkV2lkZ2V0cyhcbiAgICAgIG5ldyBSb3coXG4gICAgICAgIG5ldyBUZXh0V2lkZ2V0KHtcbiAgICAgICAgICBtYXJrZG93bjogJyMgTWV0cmljcyBBY3Jvc3MgQWxsIE1vZGVscycsXG4gICAgICAgICAgd2lkdGg6IDI0LFxuICAgICAgICB9KSxcbiAgICAgICksXG4gICAgKTtcbiAgICB0aGlzLmRhc2hib2FyZC5hZGRXaWRnZXRzKFxuICAgICAgbmV3IFJvdyhcbiAgICAgICAgbmV3IFNpbmdsZVZhbHVlV2lkZ2V0KHtcbiAgICAgICAgICB0aXRsZTogJ0F2ZXJhZ2UgTGF0ZW5jeSAoQWxsIE1vZGVscyknLFxuICAgICAgICAgIG1ldHJpY3M6IFtsYXRlbmN5QXZnQWxsTW9kZWxzTWV0cmljXSxcbiAgICAgICAgICB3aWR0aDogOCxcbiAgICAgICAgfSksXG4gICAgICAgIG5ldyBTaW5nbGVWYWx1ZVdpZGdldCh7XG4gICAgICAgICAgdGl0bGU6ICdNaW4gTGF0ZW5jeSAoQWxsIE1vZGVscyknLFxuICAgICAgICAgIG1ldHJpY3M6IFtsYXRlbmN5TWluQWxsTW9kZWxzTWV0cmljXSxcbiAgICAgICAgICB3aWR0aDogOCxcbiAgICAgICAgfSksXG4gICAgICAgIG5ldyBTaW5nbGVWYWx1ZVdpZGdldCh7XG4gICAgICAgICAgdGl0bGU6ICdNYXggTGF0ZW5jeSAoQWxsIE1vZGVscyknLFxuICAgICAgICAgIG1ldHJpY3M6IFtsYXRlbmN5TWF4QWxsTW9kZWxzTWV0cmljXSxcbiAgICAgICAgICB3aWR0aDogOCxcbiAgICAgICAgfSksXG4gICAgICApLFxuICAgICk7XG4gICAgdGhpcy5kYXNoYm9hcmQuYWRkV2lkZ2V0cyhcbiAgICAgIG5ldyBSb3coXG4gICAgICAgIG5ldyBDb2x1bW4oXG4gICAgICAgICAgbmV3IEdyYXBoV2lkZ2V0KHtcbiAgICAgICAgICAgIHRpdGxlOiAnSW5wdXQgYW5kIE91dHB1dCBUb2tlbnMgKEFsbCBNb2RlbHMpJyxcbiAgICAgICAgICAgIGxlZnQ6IFtpbnB1dFRva2Vuc0FsbE1vZGVsc01ldHJpY10sXG4gICAgICAgICAgICByaWdodDogW291dHB1dFRva2Vuc0FsbE1vZGVsc01ldHJpY10sXG4gICAgICAgICAgICBwZXJpb2Q6IHBlcmlvZCxcbiAgICAgICAgICAgIHdpZHRoOiAxMixcbiAgICAgICAgICB9KSxcbiAgICAgICAgKSxcbiAgICAgICAgbmV3IENvbHVtbihcbiAgICAgICAgICBuZXcgUm93KFxuICAgICAgICAgICAgbmV3IFNpbmdsZVZhbHVlV2lkZ2V0KHtcbiAgICAgICAgICAgICAgdGl0bGU6ICdJbnZvY2F0aW9ucyAoQWxsIE1vZGVscyknLFxuICAgICAgICAgICAgICBtZXRyaWNzOiBbaW52b2NhdGlvbnNDb3VudEFsbE1vZGVsc01ldHJpY10sXG4gICAgICAgICAgICAgIHdpZHRoOiAxMixcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICksXG4gICAgICAgICAgbmV3IFJvdyhcbiAgICAgICAgICAgIG5ldyBTaW5nbGVWYWx1ZVdpZGdldCh7XG4gICAgICAgICAgICAgIHRpdGxlOiAnQ2xpZW50IEVycm9ycyAoQWxsIE1vZGVscyknLFxuICAgICAgICAgICAgICBtZXRyaWNzOiBbaW52b2NhdGlvbnNDbGllbnRFcnJvcnNBbGxNb2RlbHNNZXRyaWNdLFxuICAgICAgICAgICAgICB3aWR0aDogMTIsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICApLFxuICAgICAgICApLFxuICAgICAgKSxcbiAgICApO1xuICB9XG59XG5cbiJdfQ==