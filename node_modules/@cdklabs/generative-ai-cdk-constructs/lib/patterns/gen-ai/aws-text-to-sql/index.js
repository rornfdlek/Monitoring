"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.TextToSql = exports.MetatdataSource = exports.DbName = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const path = require("path");
const cdk = require("aws-cdk-lib");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const ec2 = require("aws-cdk-lib/aws-ec2");
const events = require("aws-cdk-lib/aws-events");
const iam = require("aws-cdk-lib/aws-iam");
const lambda = require("aws-cdk-lib/aws-lambda");
const logs = require("aws-cdk-lib/aws-logs");
const rds = require("aws-cdk-lib/aws-rds");
const s3 = require("aws-cdk-lib/aws-s3");
const secretsmanager = require("aws-cdk-lib/aws-secretsmanager");
const sqs = require("aws-cdk-lib/aws-sqs");
const stepfunctions = require("aws-cdk-lib/aws-stepfunctions");
const tasks = require("aws-cdk-lib/aws-stepfunctions-tasks");
const cdk_nag_1 = require("cdk-nag");
const base_class_1 = require("../../../common/base-class/base-class");
const construct_name_enum_1 = require("../../../common/base-class/construct-name-enum");
const custom_resource_provider_helper_1 = require("../../../common/helpers/custom-resource-provider-helper");
const eventBridgeHelper = require("../../../common/helpers/eventbridge-helper");
const lambda_builder_helper_1 = require("../../../common/helpers/lambda-builder-helper");
const s3BucketHelper = require("../../../common/helpers/s3-bucket-helper");
const utils_1 = require("../../../common/helpers/utils");
const vpcHelper = require("../../../common/helpers/vpc-helper");
var DbName;
(function (DbName) {
    DbName["MYSQL"] = "MySQL";
    DbName["POSTGRESQL"] = "PostgreSQL";
})(DbName || (exports.DbName = DbName = {}));
var MetatdataSource;
(function (MetatdataSource) {
    MetatdataSource["CONFIG_FILE"] = "config_file";
    MetatdataSource["KNOWLEDGE_BASE"] = "knowledge_base";
})(MetatdataSource || (exports.MetatdataSource = MetatdataSource = {}));
class TextToSql extends base_class_1.BaseClass {
    /**
     * Constructs a new instance of the TextToSql class.
     * @param {Construct} scope - represents the scope for all the resources.
     * @param {string} id - this is a a scope-unique id.
     * @param {TextToSqlProps} props - user provided props for the construct.
     * @since 0.0.0
     * @public
     */
    constructor(scope, id, props) {
        super(scope, id);
        const baseProps = {
            stage: props.stage,
            constructName: construct_name_enum_1.ConstructName.AWSTEXTTOSQL,
            constructId: id,
            observability: props.observability,
        };
        vpcHelper.CheckVpcProps(props);
        s3BucketHelper.CheckS3Props({
            existingBucketObj: props.existingconfigAssetsBucketObj,
            bucketProps: props.configAssetsBucketProps,
        });
        eventBridgeHelper.CheckEventBridgeProps(props);
        this.updateEnvSuffix(baseProps);
        this.addObservabilityToConstruct(baseProps);
        // vpc
        if (props?.existingVpc && props?.existingSubnetGroup) {
            this.vpc = props.existingVpc;
            this.subnetGroup = props.existingSubnetGroup;
        }
        else {
            this.vpc = vpcHelper.buildVpc(scope, {
                defaultVpcProps: props?.vpcProps,
                vpcName: 'awsTextToSqlVpc',
            });
            this.subnetGroup = new rds.SubnetGroup(this, 'SubnetGroup', {
                vpc: this.vpc,
                vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE_ISOLATED },
                description: 'Subnet group for Aurora Serverless',
            });
        }
        // add VPC endpoints for the compute environment
        vpcHelper.AddAwsServiceEndpoint(this, this.vpc, [vpcHelper.ServiceEndpointTypeEnum.S3,
            vpcHelper.ServiceEndpointTypeEnum.STEP_FUNCTIONS,
            vpcHelper.ServiceEndpointTypeEnum.EVENTS]);
        const dbPort = props.dbPort ? props.dbPort : 1534;
        // Security group
        if (props?.existingLambdaSecurityGroup) {
            this.lambdaSecurityGroup = props.existingLambdaSecurityGroup;
        }
        else {
            this.lambdaSecurityGroup = new ec2.SecurityGroup(this, 'lambdaSecurityGroup', {
                vpc: this.vpc,
                allowAllOutbound: true,
            });
        }
        if (props?.existingDBSecurityGroup) {
            this.dbSecurityGroup = props.existingDBSecurityGroup;
        }
        else {
            this.dbSecurityGroup = new ec2.SecurityGroup(this, 'DBSecurityGroup', {
                vpc: this.vpc,
            });
            // Add an inbound rule to allow traffic from the Lambda security group
            this.dbSecurityGroup.addIngressRule(ec2.Peer.securityGroupId(this.lambdaSecurityGroup.securityGroupId), ec2.Port.tcp(dbPort), // Assuming MySQL is running on port 3306
            'Allow Lambda function to access the database');
        }
        // vpc flowloggroup
        const logGroup = new logs.LogGroup(this, 'textToSqlConstructVPCGroup');
        const vpcFlowLogrole = new iam.Role(this, 'textToSqlConstructRole', {
            assumedBy: new iam.ServicePrincipal('vpc-flow-logs.amazonaws.com'),
        });
        // vpc flowlogs
        new ec2.FlowLog(this, 'FlowLog', {
            resourceType: ec2.FlowLogResourceType.fromVpc(this.vpc),
            destination: ec2.FlowLogDestination.toCloudWatchLogs(logGroup, vpcFlowLogrole),
        });
        // bucket for storing server access logging
        const serverAccessLogBucket = new s3.Bucket(this, 'serverAccessLogBucket' + this.stage, {
            blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL,
            encryption: s3.BucketEncryption.S3_MANAGED,
            enforceSSL: true,
            versioned: true,
            lifecycleRules: [
                {
                    expiration: cdk.Duration.days(90),
                },
            ],
        });
        // config asset bucket
        if (props?.existingconfigAssetsBucketObj) {
            this.configAssetBucket = props.existingconfigAssetsBucketObj;
        }
        else if (props?.configAssetsBucketProps) {
            this.configAssetBucket = new s3.Bucket(this, 'configasset' + this.stage, props.configAssetsBucketProps);
        }
        else {
            this.configAssetBucket = new s3.Bucket(this, 'configasset' + this.stage, {
                accessControl: s3.BucketAccessControl.PRIVATE,
                blockPublicAccess: s3.BlockPublicAccess.BLOCK_ALL,
                encryption: s3.BucketEncryption.S3_MANAGED,
                bucketName: 'configasset' +
                    this.stage.toLowerCase() +
                    '-' +
                    cdk.Aws.REGION +
                    '-' +
                    cdk.Aws.ACCOUNT_ID,
                serverAccessLogsBucket: serverAccessLogBucket,
                enforceSSL: true,
                versioned: true,
                lifecycleRules: [
                    {
                        expiration: cdk.Duration.days(90),
                    },
                ],
            });
        }
        const configFilePath = path.join(__dirname, '../../../../resources/gen-ai/aws-text-to-sql');
        const textToSQLFunctionRole = new iam.Role(this, 'queryConfigFunctionRole', {
            assumedBy: new iam.ServicePrincipal('lambda.amazonaws.com'),
            inlinePolicies: {
                LambdaFunctionServiceRolePolicy: new iam.PolicyDocument({
                    statements: [
                        new iam.PolicyStatement({
                            actions: [
                                'logs:CreateLogGroup',
                                'logs:CreateLogStream',
                                'logs:PutLogEvents',
                                'bedrock:InvokeModel',
                                'bedrock:InvokeModelWithResponseStream',
                                's3:GetObject',
                                's3:GetBucketLocation',
                                's3:ListBucket',
                                's3:PutObject',
                            ],
                            resources: [
                                `arn:${aws_cdk_lib_1.Aws.PARTITION}:logs:${aws_cdk_lib_1.Aws.REGION}:${aws_cdk_lib_1.Aws.ACCOUNT_ID}:log-group:/aws/lambda/*`,
                                'arn:' +
                                    aws_cdk_lib_1.Aws.PARTITION +
                                    ':s3:::' +
                                    this.configAssetBucket.bucketName +
                                    '/*',
                                `arn:${aws_cdk_lib_1.Aws.PARTITION}:logs:${aws_cdk_lib_1.Aws.REGION}:${aws_cdk_lib_1.Aws.ACCOUNT_ID}:log-group:/aws/lambda/*`,
                                'arn:' +
                                    aws_cdk_lib_1.Aws.PARTITION +
                                    ':bedrock:' +
                                    aws_cdk_lib_1.Aws.REGION +
                                    '::foundation-model/*',
                            ],
                        }),
                    ],
                }),
            },
        });
        // Minimum permissions for a Lambda function to execute while accessing a resource within a VPC
        textToSQLFunctionRole.addToPolicy(new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: [
                'ec2:CreateNetworkInterface',
                'ec2:DeleteNetworkInterface',
                'ec2:AssignPrivateIpAddresses',
                'ec2:UnassignPrivateIpAddresses',
            ],
            resources: [
                'arn:' +
                    aws_cdk_lib_1.Aws.PARTITION +
                    ':ec2:' +
                    aws_cdk_lib_1.Aws.REGION +
                    ':' +
                    aws_cdk_lib_1.Aws.ACCOUNT_ID +
                    ':*/*',
            ],
        }));
        textToSQLFunctionRole.addToPolicy(new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: ['ec2:DescribeNetworkInterfaces'],
            resources: ['*'],
        }));
        textToSQLFunctionRole.addToPolicy(new iam.PolicyStatement({
            effect: iam.Effect.ALLOW,
            actions: ['s3:ListBucket'],
            resources: [
                'arn:' + aws_cdk_lib_1.Aws.PARTITION + ':s3:::' + this.configAssetBucket.bucketName,
            ],
        }));
        const configLoaderPolicy = new iam.ManagedPolicy(this, 'AuroraPgPolicy', {
            managedPolicyName: (0, utils_1.generatePhysicalNameV2)(this, 'configLoaderPolicy', {
                maxLength: 32,
                lower: true,
            }),
            statements: [
                new iam.PolicyStatement({
                    actions: [
                        'ec2:DescribeInstances',
                        'ec2:CreateNetworkInterface',
                        'ec2:AttachNetworkInterface',
                        'ec2:DescribeNetworkInterfaces',
                        'autoscaling:CompleteLifecycleAction',
                        'ec2:DeleteNetworkInterface',
                    ],
                    resources: ['*'],
                }),
                new iam.PolicyStatement({
                    actions: [
                        'logs:CreateLogGroup',
                        'logs:CreateLogStream',
                        'logs:PutLogEvents',
                        'bedrock:InvokeModel',
                        'bedrock:InvokeModelWithResponseStream',
                        's3:GetObject',
                        's3:GetBucketLocation',
                        's3:ListBucket',
                        's3:PutObject',
                    ],
                    resources: [
                        `arn:${aws_cdk_lib_1.Aws.PARTITION}:logs:${aws_cdk_lib_1.Aws.REGION}:${aws_cdk_lib_1.Aws.ACCOUNT_ID}:log-group:/aws/lambda/*`,
                        'arn:' +
                            aws_cdk_lib_1.Aws.PARTITION +
                            ':s3:::' +
                            this.configAssetBucket.bucketName +
                            '/*',
                        `arn:${aws_cdk_lib_1.Aws.PARTITION}:logs:${aws_cdk_lib_1.Aws.REGION}:${aws_cdk_lib_1.Aws.ACCOUNT_ID}:log-group:/aws/lambda/*`,
                        'arn:' +
                            aws_cdk_lib_1.Aws.PARTITION +
                            ':bedrock:' +
                            aws_cdk_lib_1.Aws.REGION +
                            '::foundation-model/*',
                    ],
                }),
            ],
        });
        const customResource = (0, custom_resource_provider_helper_1.buildCustomResourceProvider)({
            providerName: 'ConfigFileLoaderCRProvider',
            vpc: this.vpc,
            securityGroup: this.lambdaSecurityGroup,
            codePath: path.join(__dirname, '../../../../lambda/aws-text-to-sql'),
            handler: 'custom_resources.on_event',
            runtime: cdk.aws_lambda.Runtime.PYTHON_3_12,
        });
        const crProvider = customResource.getProvider(this);
        crProvider.role.addManagedPolicy(configLoaderPolicy);
        const configFileLoader = new cdk.CustomResource(this, 'ConfigFileLoader', {
            resourceType: 'Custom::ConfigFileLoader',
            serviceToken: crProvider.serviceToken,
            properties: {
                configBucket: this.configAssetBucket.bucketName,
                configFilePath: configFilePath,
            },
        });
        configFileLoader.node.addDependency(this.configAssetBucket);
        //crProvider.role.node.addDependency(configLoaderPolicy);
        cdk_nag_1.NagSuppressions.addResourceSuppressions(textToSQLFunctionRole, [
            {
                id: 'AwsSolutions-IAM5',
                reason: 'AWSLambdaBasicExecutionRole is used.',
            },
        ], true);
        const reformulateQuestionFunctionName = (0, utils_1.generatePhysicalNameV2)(this, 'reformulateQuestionFunction' + this.stage, { maxLength: 63, lower: true });
        const reformulateQuestionFunctionProps = {
            functionName: reformulateQuestionFunctionName,
            description: 'Lambda function to reformulate user question',
            code: lambda.DockerImageCode.fromImageAsset(path.join(__dirname, '../../../../lambda/aws-text-to-sql/reformulate_question')),
            vpc: this.vpc,
            vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE_ISOLATED },
            securityGroups: [this.lambdaSecurityGroup],
            memorySize: (0, utils_1.lambdaMemorySizeLimiter)(this, 1769 * 4),
            timeout: aws_cdk_lib_1.Duration.minutes(10),
            tracing: this.lambdaTracing,
            role: textToSQLFunctionRole,
            environment: {
                DB_NAME: props.dbName,
                METADATA_SOURCE: props.metadataSource,
                CONFIG_BUCKET: this.configAssetBucket.bucketName,
            },
        };
        // Lambda function to load  the config and do all pre steps before query generation.
        const reformulateQuestionFunction = (0, lambda_builder_helper_1.buildDockerLambdaFunction)(this, 'reformulateQuestionFunction' + this.stage, reformulateQuestionFunctionProps, props.customQueryConfigurerLambdaProps);
        const queryGeneratorFunctionName = (0, utils_1.generatePhysicalNameV2)(this, 'queryGeneratorFunction' + this.stage, { maxLength: 63, lower: true });
        const queryGeneratorFunctionProps = {
            functionName: queryGeneratorFunctionName,
            description: 'Lambda function to generate the query based on user question.',
            code: lambda.DockerImageCode.fromImageAsset(path.join(__dirname, '../../../../lambda/aws-text-to-sql/query_generator')),
            vpc: this.vpc,
            vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE_ISOLATED },
            securityGroups: [this.lambdaSecurityGroup],
            memorySize: (0, utils_1.lambdaMemorySizeLimiter)(this, 1769 * 4),
            timeout: aws_cdk_lib_1.Duration.minutes(10),
            tracing: this.lambdaTracing,
            role: textToSQLFunctionRole,
            environment: {
                DB_NAME: props.dbName,
                CONFIG_BUCKET: this.configAssetBucket.bucketName,
                SECRET_ARN: props.databaseSecretARN,
            },
        };
        // Lambda function used to generate the query
        const queryGeneratorFunction = (0, lambda_builder_helper_1.buildDockerLambdaFunction)(this, 'queryGeneratorFunction' + this.stage, queryGeneratorFunctionProps, props.customQueryGeneratorLambdaProps);
        // Lambda function used to execute the query
        const queryExecutorFunctionName = (0, utils_1.generatePhysicalNameV2)(this, 'queryExecutorFunctionName' + this.stage, { maxLength: 63, lower: true });
        const queryExecutorFunctionProps = {
            functionName: queryExecutorFunctionName,
            description: 'Lambda function to execute the query.',
            code: lambda.DockerImageCode.fromImageAsset(path.join(__dirname, '../../../../lambda/aws-text-to-sql/query_executor')),
            vpc: this.vpc,
            vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE_ISOLATED },
            securityGroups: [this.lambdaSecurityGroup],
            memorySize: (0, utils_1.lambdaMemorySizeLimiter)(this, 1769 * 4),
            timeout: aws_cdk_lib_1.Duration.minutes(10),
            tracing: this.lambdaTracing,
            role: textToSQLFunctionRole,
            environment: {
                DB_NAME: props.dbName,
                CONFIG_BUCKET: this.configAssetBucket.bucketName,
                SECRET_ARN: props.databaseSecretARN,
            },
        };
        // Lambda function used to generate the query
        const queryExecutorFunction = (0, lambda_builder_helper_1.buildDockerLambdaFunction)(this, 'queryExecutorFunctionName' + this.stage, queryExecutorFunctionProps, props.customQueryExecutorLambdaProps);
        // lambda function for autocorrect loop
        const autocorrectQueryFunctionName = (0, utils_1.generatePhysicalNameV2)(this, 'autocorrectQueryFunction' + this.stage, { maxLength: 63, lower: true });
        const autocorrectQueryFunctionProps = {
            functionName: autocorrectQueryFunctionName,
            description: 'Lambda function to keep the count of autocorrect loop.',
            code: lambda.DockerImageCode.fromImageAsset(path.join(__dirname, '../../../../lambda/aws-text-to-sql/query_autocorrect')),
            vpc: this.vpc,
            vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE_ISOLATED },
            securityGroups: [this.lambdaSecurityGroup],
            memorySize: (0, utils_1.lambdaMemorySizeLimiter)(this, 1769 * 4),
            timeout: aws_cdk_lib_1.Duration.minutes(10),
            tracing: this.lambdaTracing,
            role: textToSQLFunctionRole,
        };
        const autocorrectQueryFunction = (0, lambda_builder_helper_1.buildDockerLambdaFunction)(this, 'autocorrectQueryFunction' + this.stage, autocorrectQueryFunctionProps, undefined);
        const feedbackQueueName = (0, utils_1.generatePhysicalNameV2)(this, 'feedbackQueue' + this.stage, { maxLength: 63, lower: true });
        const queue = new sqs.Queue(this, 'userFeedbackQueue', {
            queueName: feedbackQueueName,
            visibilityTimeout: aws_cdk_lib_1.Duration.seconds(3600),
        });
        queue.addToResourcePolicy(new iam.PolicyStatement({
            effect: iam.Effect.DENY,
            principals: [new iam.AnyPrincipal()],
            actions: ['sqs:*'],
            resources: [queue.queueArn],
            conditions: {
                Bool: {
                    'aws:SecureTransport': 'false',
                },
            },
        }));
        this.feedbackQueue = queue;
        const outputQueueName = (0, utils_1.generatePhysicalNameV2)(this, 'outputQueue' + this.stage, { maxLength: 63, lower: true });
        const outputQueue = new sqs.Queue(this, 'outputQueue', {
            queueName: outputQueueName,
            visibilityTimeout: aws_cdk_lib_1.Duration.seconds(3600),
        });
        outputQueue.addToResourcePolicy(new iam.PolicyStatement({
            effect: iam.Effect.DENY,
            principals: [new iam.AnyPrincipal()],
            actions: ['sqs:*'],
            resources: [outputQueue.queueArn],
            conditions: {
                Bool: {
                    'aws:SecureTransport': 'false',
                },
            },
        }));
        this.outputQueue = outputQueue;
        const dbsecret = secretsmanager.Secret.fromSecretCompleteArn(this, 'dbsecret', props.databaseSecretARN);
        dbsecret.grantRead(queryGeneratorFunction);
        dbsecret.grantRead(queryExecutorFunction);
        const reformulateQuestionState = new tasks.LambdaInvoke(this, 'reformulate_question', {
            lambdaFunction: reformulateQuestionFunction,
            inputPath: '$.detail',
            resultPath: '$.queryConfig',
        });
        const reformulatedQuestionFeedbackState = new tasks.SqsSendMessage(this, 'get_feedback_on_reformulated_question', {
            queue,
            messageBody: stepfunctions.TaskInput.fromObject({
                message: 'Following is the reformulated question. Do you agree with the new question?',
                reformualted_question: stepfunctions.TaskInput.fromJsonPathAt('$.reformulated_user_question'),
                user_question: stepfunctions.TaskInput.fromJsonPathAt('$.user_question'),
                question_unique_id: stepfunctions.TaskInput.fromJsonPathAt('$.question_unique_id'),
                execute_sql_strategy: stepfunctions.TaskInput.fromJsonPathAt('$.execute_sql_strategy'),
                execution_start_time: stepfunctions.TaskInput.fromJsonPathAt('$.execution_start_time'),
                TaskToken: stepfunctions.JsonPath.taskToken,
            }),
            integrationPattern: stepfunctions.IntegrationPattern.WAIT_FOR_TASK_TOKEN,
        });
        const alternateQueryGeneratorState = new tasks.LambdaInvoke(this, 'generate_alternate_query', {
            lambdaFunction: queryGeneratorFunction,
            resultPath: '$.queryConfig',
        });
        // SF loggroup
        const sflogGroup = new logs.LogGroup(this, 'TextToSqlStepFunctionLogGroup', {
            logGroupName: '/aws/vendedlogs/states/TextToSqlStepFunction',
            removalPolicy: cdk.RemovalPolicy.DESTROY,
        });
        const autocorrectChoiceState = new stepfunctions.Choice(this, 'is_autocorrect_required?', {});
        const configureCountState = new stepfunctions.Pass(this, 'configure_count', {
            result: stepfunctions.Result.fromObject({
                count: 3,
                index: 0,
                step: 1,
            }),
            resultPath: '$.iterator',
        });
        const iteratorState = new tasks.LambdaInvoke(this, 'iterator', {
            lambdaFunction: autocorrectQueryFunction,
            resultPath: '$.iterator',
        });
        const isCountReachedState = new stepfunctions.Choice(this, 'is_count_reached', {
        //inputPath: '$.iterator',
        });
        // const queryGeneratorTwoState = new tasks.LambdaInvoke(
        //   this,
        //   'generate_query_path_two',
        //   {
        //     lambdaFunction: queryGeneratorFunction,
        //     resultPath: '$.queryConfig',
        //   },
        // );
        const outputState = new tasks.SqsSendMessage(this, 'publish_query_result', {
            queue: outputQueue,
            messageBody: stepfunctions.TaskInput.fromObject({
                result: stepfunctions.TaskInput.fromJsonPathAt('$.queryConfig.Payload.result'),
                user_question: stepfunctions.TaskInput.fromJsonPathAt('$.user_question'),
                question_unique_id: stepfunctions.TaskInput.fromJsonPathAt('$.question_unique_id'),
            }),
        });
        const alternateQueryCorrectChoiceState = new stepfunctions.Choice(this, 'is_alternate_query_correct?', {
        //inputPath: '$.queryConfig.Payload',
        });
        const alternateQueryExecutorState = new tasks.LambdaInvoke(this, 'execute_alternate_query', {
            lambdaFunction: queryExecutorFunction,
            resultPath: '$.queryConfig',
        }).next(alternateQueryCorrectChoiceState
            .when(stepfunctions.Condition.stringEquals('$.queryConfig.Payload.status', 'QUERY_ERROR'), iteratorState)
            .otherwise(outputState));
        const queryExecutorState = new tasks.LambdaInvoke(this, 'execute_query', {
            lambdaFunction: queryExecutorFunction,
            resultPath: '$.queryConfig',
        }).next(autocorrectChoiceState
            .when(stepfunctions.Condition.stringEquals('$.queryConfig.Payload.status', 'QUERY_ERROR'), configureCountState
            .next(iteratorState)
            .next(isCountReachedState
            .when(stepfunctions.Condition.booleanEquals('$.iterator.Payload.continue', true), alternateQueryGeneratorState.next(alternateQueryExecutorState))
            .otherwise(outputState)))
            .otherwise(outputState));
        const feedbackChoiceStateOne = new stepfunctions.Choice(this, 'is_feedback_req_on_reformualted_question?', {
            inputPath: '$.queryConfig.Payload',
        });
        // const feedbackChoiceStateTwo = new stepfunctions.Choice(
        //   this,
        //   'is_feedback_req_on_generated_query_path_two?',
        //   {},
        // );
        const executeQueryChoiceState = new stepfunctions.Choice(this, 'is_query_execution_req?', {})
            .when(stepfunctions.Condition.stringEquals('$.execute_sql_strategy', 'disabled'), outputState)
            .otherwise(queryExecutorState);
        const generatedQueryFeedbackState = new tasks.SqsSendMessage(this, 'get_feedback_on_generated_query', {
            queue,
            messageBody: stepfunctions.TaskInput.fromObject({
                message: 'Following is the generated query. Do you agree with it or want to override?',
                generated_query: stepfunctions.JsonPath.stringAt('$.queryConfig.Payload.result'),
                execute_sql_strategy: stepfunctions.TaskInput.fromJsonPathAt('$.execute_sql_strategy'),
                execution_start_time: stepfunctions.TaskInput.fromJsonPathAt('$.execution_start_time'),
                reformualted_question: stepfunctions.TaskInput.fromJsonPathAt('$.reformulated_user_question'),
                user_question: stepfunctions.TaskInput.fromJsonPathAt('$.user_question'),
                question_unique_id: stepfunctions.TaskInput.fromJsonPathAt('$.question_unique_id'),
                TaskToken: stepfunctions.JsonPath.taskToken,
            }),
            integrationPattern: stepfunctions.IntegrationPattern.WAIT_FOR_TASK_TOKEN,
        }).next(executeQueryChoiceState);
        const generateQueryfeedbackChoiceState = new stepfunctions.Choice(this, 'is_feedback_req_on_generated_query ?', {})
            .when(stepfunctions.Condition.stringEquals('$.queryConfig.Payload.sql_validation_strategy', 'human'), generatedQueryFeedbackState)
            .otherwise(executeQueryChoiceState);
        const queryGeneratorState = new tasks.LambdaInvoke(this, 'generate_query', {
            lambdaFunction: queryGeneratorFunction,
            resultPath: '$.queryConfig',
        }).next(generateQueryfeedbackChoiceState);
        // event bridge
        // Create an IAM role for Events to start the State Machine
        const eventsRole = new iam.Role(this, 'EventsRuleRole', {
            assumedBy: new iam.ServicePrincipal('events.amazonaws.com'),
        });
        if (props?.existingEventBusInterface) {
            this.eventBus = props.existingEventBusInterface;
        }
        else if (props?.eventBusProps) {
            this.eventBus = eventBridgeHelper.buildEventBus(this, {
                eventBusProps: props.eventBusProps,
            });
        }
        else {
            this.eventBus = new events.EventBus(this, 'textToSqlBus' + props.stage, {
                eventBusName: (0, utils_1.generatePhysicalNameV2)(this, 'textToSql' + this.stage, { maxLength: 63, lower: true }),
            });
        }
        this.stepFunction = new stepfunctions.StateMachine(this, 'textToSqlStepFunction' + props.stage, {
            definition: reformulateQuestionState.next(feedbackChoiceStateOne
                .when(stepfunctions.Condition.stringEquals('$.semantic_layer_strategy', 'human'), reformulatedQuestionFeedbackState.next(queryGeneratorState))
                .otherwise(queryGeneratorState)),
            logs: {
                destination: sflogGroup,
                level: stepfunctions.LogLevel.ALL,
            },
            tracingEnabled: true,
            timeout: aws_cdk_lib_1.Duration.days(90),
        });
        this.eventsRule = new events.Rule(this, 'EventsRule', {
            eventBus: this.eventBus,
            targets: [new aws_cdk_lib_1.aws_events_targets.SfnStateMachine(this.stepFunction, {
                    role: eventsRole,
                })],
            eventPattern: {
                source: ['webclient'],
            },
        });
        this.eventBus.grantPutEventsTo(this.stepFunction);
        // Grant the start execution permission to the Events service
        this.stepFunction.grantStartExecution(eventsRole);
    } // end construct
}
exports.TextToSql = TextToSql;
_a = JSII_RTTI_SYMBOL_1;
TextToSql[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.TextToSql", version: "0.1.285" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvcGF0dGVybnMvZ2VuLWFpL2F3cy10ZXh0LXRvLXNxbC9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBOzs7Ozs7Ozs7OztHQVdHO0FBQ0gsNkJBQTZCO0FBQzdCLG1DQUFtQztBQUNuQyw2Q0FBZ0Y7QUFDaEYsMkNBQTJDO0FBQzNDLGlEQUFpRDtBQUNqRCwyQ0FBMkM7QUFDM0MsaURBQWlEO0FBQ2pELDZDQUE2QztBQUM3QywyQ0FBMkM7QUFDM0MseUNBQXlDO0FBQ3pDLGlFQUFpRTtBQUNqRSwyQ0FBMkM7QUFDM0MsK0RBQStEO0FBQy9ELDZEQUE2RDtBQUM3RCxxQ0FBMEM7QUFFMUMsc0VBRytDO0FBQy9DLHdGQUErRTtBQUMvRSw2R0FBc0c7QUFDdEcsZ0ZBQWdGO0FBRWhGLHlGQUEwRjtBQUMxRiwyRUFBMkU7QUFDM0UseURBR3VDO0FBQ3ZDLGdFQUFnRTtBQUloRSxJQUFZLE1BR1g7QUFIRCxXQUFZLE1BQU07SUFDaEIseUJBQWUsQ0FBQTtJQUNmLG1DQUF5QixDQUFBO0FBQzNCLENBQUMsRUFIVyxNQUFNLHNCQUFOLE1BQU0sUUFHakI7QUFFRCxJQUFZLGVBR1g7QUFIRCxXQUFZLGVBQWU7SUFDekIsOENBQTJCLENBQUE7SUFDM0Isb0RBQWlDLENBQUE7QUFDbkMsQ0FBQyxFQUhXLGVBQWUsK0JBQWYsZUFBZSxRQUcxQjtBQXVJRCxNQUFhLFNBQVUsU0FBUSxzQkFBUztJQW9EdEM7Ozs7Ozs7T0FPRztJQUNILFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBcUI7UUFDN0QsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUVqQixNQUFNLFNBQVMsR0FBbUI7WUFDaEMsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLO1lBQ2xCLGFBQWEsRUFBRSxtQ0FBYSxDQUFDLFlBQVk7WUFDekMsV0FBVyxFQUFFLEVBQUU7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LENBQ0YsQ0FBQztZQUNGLFlBQVksRUFBRTtnQkFDWixNQUFNLEVBQUUsQ0FBQyxXQUFXLENBQUM7YUFDdEI7U0FDRixDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUVsRCw2REFBNkQ7UUFDN0QsSUFBSSxDQUFDLFlBQVksQ0FBQyxtQkFBbUIsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUNwRCxDQUFDLENBQUMsZ0JBQWdCOztBQXQzQnBCLDhCQXkzQkMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqICBDb3B5cmlnaHQgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS4gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogIHdpdGggdGhlIExpY2Vuc2UuIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiAgb3IgaW4gdGhlICdsaWNlbnNlJyBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAnQVMgSVMnIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVNcbiAqICBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xuICogIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCAqIGFzIGNkayBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgeyBBd3MsIER1cmF0aW9uLCBhd3NfZXZlbnRzX3RhcmdldHMgYXMgZXZlbnRzVGFyZ2V0IH0gZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0ICogYXMgZWMyIGZyb20gJ2F3cy1jZGstbGliL2F3cy1lYzInO1xuaW1wb3J0ICogYXMgZXZlbnRzIGZyb20gJ2F3cy1jZGstbGliL2F3cy1ldmVudHMnO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gJ2F3cy1jZGstbGliL2F3cy1pYW0nO1xuaW1wb3J0ICogYXMgbGFtYmRhIGZyb20gJ2F3cy1jZGstbGliL2F3cy1sYW1iZGEnO1xuaW1wb3J0ICogYXMgbG9ncyBmcm9tICdhd3MtY2RrLWxpYi9hd3MtbG9ncyc7XG5pbXBvcnQgKiBhcyByZHMgZnJvbSAnYXdzLWNkay1saWIvYXdzLXJkcyc7XG5pbXBvcnQgKiBhcyBzMyBmcm9tICdhd3MtY2RrLWxpYi9hd3MtczMnO1xuaW1wb3J0ICogYXMgc2VjcmV0c21hbmFnZXIgZnJvbSAnYXdzLWNkay1saWIvYXdzLXNlY3JldHNtYW5hZ2VyJztcbmltcG9ydCAqIGFzIHNxcyBmcm9tICdhd3MtY2RrLWxpYi9hd3Mtc3FzJztcbmltcG9ydCAqIGFzIHN0ZXBmdW5jdGlvbnMgZnJvbSAnYXdzLWNkay1saWIvYXdzLXN0ZXBmdW5jdGlvbnMnO1xuaW1wb3J0ICogYXMgdGFza3MgZnJvbSAnYXdzLWNkay1saWIvYXdzLXN0ZXBmdW5jdGlvbnMtdGFza3MnO1xuaW1wb3J0IHsgTmFnU3VwcHJlc3Npb25zIH0gZnJvbSAnY2RrLW5hZyc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCB7XG4gIEJhc2VDbGFzcyxcbiAgQmFzZUNsYXNzUHJvcHMsXG59IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9iYXNlLWNsYXNzL2Jhc2UtY2xhc3MnO1xuaW1wb3J0IHsgQ29uc3RydWN0TmFtZSB9IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9iYXNlLWNsYXNzL2NvbnN0cnVjdC1uYW1lLWVudW0nO1xuaW1wb3J0IHsgYnVpbGRDdXN0b21SZXNvdXJjZVByb3ZpZGVyIH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2hlbHBlcnMvY3VzdG9tLXJlc291cmNlLXByb3ZpZGVyLWhlbHBlcic7XG5pbXBvcnQgKiBhcyBldmVudEJyaWRnZUhlbHBlciBmcm9tICcuLi8uLi8uLi9jb21tb24vaGVscGVycy9ldmVudGJyaWRnZS1oZWxwZXInO1xuXG5pbXBvcnQgeyBidWlsZERvY2tlckxhbWJkYUZ1bmN0aW9uIH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2hlbHBlcnMvbGFtYmRhLWJ1aWxkZXItaGVscGVyJztcbmltcG9ydCAqIGFzIHMzQnVja2V0SGVscGVyIGZyb20gJy4uLy4uLy4uL2NvbW1vbi9oZWxwZXJzL3MzLWJ1Y2tldC1oZWxwZXInO1xuaW1wb3J0IHtcbiAgZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMixcbiAgbGFtYmRhTWVtb3J5U2l6ZUxpbWl0ZXIsXG59IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9oZWxwZXJzL3V0aWxzJztcbmltcG9ydCAqIGFzIHZwY0hlbHBlciBmcm9tICcuLi8uLi8uLi9jb21tb24vaGVscGVycy92cGMtaGVscGVyJztcbmltcG9ydCB7IERvY2tlckxhbWJkYUN1c3RvbVByb3BzIH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL3Byb3BzL0RvY2tlckxhbWJkYUN1c3RvbVByb3BzJztcblxuXG5leHBvcnQgZW51bSBEYk5hbWUge1xuICBNWVNRTCA9ICdNeVNRTCcsXG4gIFBPU1RHUkVTUUwgPSAnUG9zdGdyZVNRTCcsXG59XG5cbmV4cG9ydCBlbnVtIE1ldGF0ZGF0YVNvdXJjZSB7XG4gIENPTkZJR19GSUxFID0gJ2NvbmZpZ19maWxlJyxcbiAgS05PV0xFREdFX0JBU0UgPSAna25vd2xlZGdlX2Jhc2UnLFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRleHRUb1NxbFByb3BzIHtcbiAgLyoqXG4gICAqIE9wdGlvbmFsLiBUaGUgY29uc3RydWN0IGNyZWF0ZXMgYSBjdXN0b20gVlBDIGJhc2VkIG9uIHZwY1Byb3BzLlxuICAgKiBQcm92aWRpbmcgYm90aCB0aGlzIGFuZCBleGlzdGluZ1ZwYyBpcyBhbiBlcnJvci5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBub25lXG4gICAqL1xuICByZWFkb25seSB2cGNQcm9wcz86IGVjMi5WcGNQcm9wcztcblxuICAvKipcbiAgICogT3B0aW9uYWwuIEFuIGV4aXN0aW5nIFZQQyBjYW4gYmUgdXNlZCB0byBkZXBsb3kgdGhlIGNvbnN0cnVjdC5cbiAgICogUHJvdmlkaW5nIGJvdGggdGhpcyBhbmQgdnBjUHJvcHMgaXMgYW4gZXJyb3IuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gbm9uZVxuICAgKi9cbiAgcmVhZG9ubHkgZXhpc3RpbmdWcGM/OiBlYzIuSVZwYztcblxuICAvKipcbiAgICogT3B0aW9uYWwuIEFuIGV4aXN0aW5nIHN1Ym5ldCBncm91cCBjYW4gYmUgdXNlZCB0byBkZXBsb3kgdGhlIGNvbnN0cnVjdC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBub25lXG4gICAqL1xuICByZWFkb25seSBleGlzdGluZ1N1Ym5ldEdyb3VwPzogcmRzLlN1Ym5ldEdyb3VwO1xuXG4gIC8qKlxuICAgKiBPcHRpb25hbC4gU2VjdXJpdHkgZ3JvdXAgZm9yIHRoZSBsYW1iZGEgZnVuY3Rpb24gd2hpY2ggdGhpcyBjb25zdHJ1Y3Qgd2lsbCB1c2UuXG4gICAqIElmIG5vIGV4aXNpdGluZyBzZWN1cml0eSBncm91cCBpcyBwcm92aWRlZCBpdCB3aWxsIGNyZWF0ZSBvbmUgZnJvbSB0aGUgdnBjLlxuICAgKiBAZGVmYXVsdCAtIG5vbmVcbiAgICovXG4gIHJlYWRvbmx5IGV4aXN0aW5nTGFtYmRhU2VjdXJpdHlHcm91cD86IGVjMi5TZWN1cml0eUdyb3VwO1xuXG4gIC8qKlxuICAgKiBPcHRpb25hbC4gU2VjdXJpdHkgZ3JvdXAgZm9yIHRoZSBkYiBpbnN0YW5jZSB3aGljaCB0aGlzIGNvbnN0cnVjdCB3aWxsIHVzZS5cbiAgICogSWYgbm8gZXhpc2l0aW5nIHNlY3VyaXR5IGdyb3VwIGlzIHByb3ZpZGVkIGl0IHdpbGwgY3JlYXRlIG9uZSBmcm9tIHRoZSB2cGMuXG4gICAqIEBkZWZhdWx0IC0gbm9uZVxuICAgKi9cbiAgcmVhZG9ubHkgZXhpc3RpbmdEQlNlY3VyaXR5R3JvdXA/OiBlYzIuU2VjdXJpdHlHcm91cDtcblxuICAvKipcbiAgICogVmFsdWUgd2lsbCBiZSBhcHBlbmRlZCB0byByZXNvdXJjZXMgbmFtZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBfZGV2XG4gICAqL1xuICByZWFkb25seSBzdGFnZT86IHN0cmluZztcbiAgLyoqXG4gICAqIEVuYWJsZSBvYnNlcnZhYmlsaXR5LiBXYXJuaW5nOiBhc3NvY2lhdGVkIGNvc3Qgd2l0aCB0aGUgc2VydmljZXNcbiAgICogdXNlZC4gQmVzdCBwcmFjdGljZSB0byBlbmFibGUgYnkgZGVmYXVsdC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSB0cnVlXG4gICAqL1xuICByZWFkb25seSBvYnNlcnZhYmlsaXR5PzogYm9vbGVhbjtcblxuICAvKipcbiAgICogRGF0YWJhc2UgbmFtZS4gVGhpcyBpcyB0aGUgdGFyZ2V0IGRhdGFiYXNlIGFnYWluc3Qgd2hpY2ggdGhlIHF1ZXJ5IHdpbGwgYmUgZ2VuZXJhdGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgZGJOYW1lOiBEYk5hbWU7XG5cbiAgLyoqXG4gICAqICBEYXRhYmFzZSBzZWNyZXQuIERCIGNyZWRlbnRpYWxzIHRvIGNvbm5lY3QgdG8gRGF0YWJhc2UuXG4gICAqL1xuICByZWFkb25seSBkYXRhYmFzZVNlY3JldEFSTjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiAgT3B0aW9uYWwuIGRiIHBvcnQgbnVtYmVyLlxuICAgKiAgQGRlZmF1bHQgLTE1MzRcbiAgICovXG4gIHJlYWRvbmx5IGRiUG9ydD86IG51bWJlcjtcblxuICAvKipcbiAgICogT3B0aW9uYWwuIEFsbG93cyB0byBwcm92aWRlIGN1c3RvbSBsYW1iZGEgY29kZSBmb3IgYWxsIHByZSBzdGVwcyByZXF1aXJlZCBiZWZvcmUgZ2VuZXJhdGluZyB0aGUgcXVlcnkuXG4gICAqIElmIG5vdCBwcm92aWRlZCwgZGVmYXVsdCBjb2RlIHdpbGwgYmUgdXNlZC5cbiAgICpcbiAgICovXG4gIHJlYWRvbmx5IGN1c3RvbVF1ZXJ5Q29uZmlndXJlckxhbWJkYVByb3BzPzpcbiAgfCBEb2NrZXJMYW1iZGFDdXN0b21Qcm9wc1xuICB8IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogT3B0aW9uYWwuIEFsbG93cyB0byBwcm92aWRlIGN1c3RvbSBsYW1iZGEgY29kZSBmb3IgZ2VuZXJhdGluZyB0aGUgcXVlcnkuXG4gICAqIElmIG5vdCBwcm92aWRlZCwgZGVmYXVsdCBjb2RlIHdpbGwgYmUgdXNlZC5cbiAgICpcbiAgICovXG4gIHJlYWRvbmx5IGN1c3RvbVF1ZXJ5R2VuZXJhdG9yTGFtYmRhUHJvcHM/OlxuICB8IERvY2tlckxhbWJkYUN1c3RvbVByb3BzXG4gIHwgdW5kZWZpbmVkO1xuXG4gIC8qKlxuICAgKiBPcHRpb25hbC4gQWxsb3dzIHRvIHByb3ZpZGUgY3VzdG9tIGxhbWJkYSBjb2RlIGZvciBleGVjdXRpbmcgdGhlIHF1ZXJ5LlxuICAgKiBJZiBub3QgcHJvdmlkZWQsIGRlZmF1bHQgY29kZSB3aWxsIGJlIHVzZWQuXG4gICAqXG4gICAqL1xuICByZWFkb25seSBjdXN0b21RdWVyeUV4ZWN1dG9yTGFtYmRhUHJvcHM/OiBEb2NrZXJMYW1iZGFDdXN0b21Qcm9wcyB8IHVuZGVmaW5lZDtcblxuICAvKipcbiAgICogVGhlIHNvdXJjZSBvZiBtZXRhdGRhdGEuIFRoaXMgbWV0YWRhdGEgaXMgcmVxdWlyZWQgdG8gcmVkdWNlIHRoZSBuYXR1YWwgbGFuZ3VhZ2UgYW1iaWd1aXR5XG4gICAqIGluIG9yZGVyIHRvIGdlbmVyYXRlIHRoZSBjb3JyZWN0IHNxbCBxdWVyeS4gQSBrbm93bGVkZ2UgbGF5ZXIgaXMgdXNlZCB0byBtYXAgdGhlIG5hdHVyYWwgbGFuZ3VhZ2VcbiAgICogdG8gdGhlIGRhdGFiYXNlIHNjaGVtYS5cbiAgICogVHdvIG1ldGF0ZGF0YSBzb3VyY2UgYXJlIHN1cHBvcnRlZDpcbiAgICogMTogY29uZmlnX2ZpbGUgLSBBIGxvY2FsIGpzb24gZmlsZSBjb250YWluaW5nIHRoZSBrbm93bGVkZ2UgbGF5ZXIga2V5IHZhbHVlIHBhaXIuXG4gICAqIDI6IEtub3dsZWRnZSBiYXNlIC0gU2VtYW50aWMgc2VhcmNoIGlzIHVzZWQgdG8gZmV0Y2ggdGhlIGtub3dsZWRnZSBsYXllciBmcm9tIEFXUyBrbm93bGVkZ2UgYmFzZVxuICAgKiBAZGVmYXVsdCAtIGNvbmZpZ19maWxlXG4gICAqL1xuICByZWFkb25seSBtZXRhZGF0YVNvdXJjZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBPcHRpb25hbC4gVXNlciBwcm92aWRlZCBwcm9wcyB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBwcm9wcyBmb3IgdGhlIFMzIEJ1Y2tldC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBEZWZhdWx0IHByb3BzIGFyZSB1c2VkXG4gICAqL1xuICByZWFkb25seSBjb25maWdBc3NldHNCdWNrZXRQcm9wcz86IHMzLkJ1Y2tldFByb3BzO1xuXG4gIC8qKlxuICAgKiBPcHRpb25hbC4gRXhpc3RpbmcgczMgQnVja2V0IHRvIHN0b3JlIHRoZSBjb25maWcgZmlsZXMuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm9uZVxuICAgKi9cbiAgcmVhZG9ubHkgZXhpc3Rpbmdjb25maWdBc3NldHNCdWNrZXRPYmo/OiBzMy5JQnVja2V0O1xuXG4gIC8qKlxuICAgKiBPcHRpb25hbC4gRXhpc3RpbmcgaW5zdGFuY2Ugb2YgZXZlbnQgYnVzLCBwcm92aWRpbmcgYm90aCB0aGlzIGFuZCBgZXZlbnRCdXNQcm9wc2Agd2lsbCBjYXVzZSBhbiBlcnJvci5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBOb25lLlxuICAgKi9cbiAgcmVhZG9ubHkgZXhpc3RpbmdFdmVudEJ1c0ludGVyZmFjZT86IGV2ZW50cy5JRXZlbnRCdXM7XG5cbiAgLyoqXG4gICAqIE9wdGlvbmFsIHVzZXIgcHJvdmlkZWQgZXZlbnQgYnVzIHByb3BzXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gRGVmYXVsdCBwcm9wcyBhcmUgdXNlZC5cbiAgICovXG4gIHJlYWRvbmx5IGV2ZW50QnVzUHJvcHM/OiBldmVudHMuRXZlbnRCdXNQcm9wcztcbn1cblxuZXhwb3J0IGNsYXNzIFRleHRUb1NxbCBleHRlbmRzIEJhc2VDbGFzcyB7XG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiBlYzIuSVZwYyB1c2VkIGJ5IHRoZSBjb25zdHJ1Y3RcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSB2cGM6IGVjMi5JVnBjO1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiBzdWJuZXQgZ3JvdXAgdXNlZCBieSB0aGUgY29uc3RydWN0XG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgc3VibmV0R3JvdXA6IHJkcy5TdWJuZXRHcm91cDtcblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgaW5zdGFuY2Ugb2YgZWMyLklTZWN1cml0eUdyb3VwIHVzZWQgYnkgdGhlIGNvbnN0cnVjdFxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGxhbWJkYVNlY3VyaXR5R3JvdXA6IGVjMi5TZWN1cml0eUdyb3VwO1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiBlYzIuSVNlY3VyaXR5R3JvdXAgdXNlZCBieSB0aGUgY29uc3RydWN0XG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZGJTZWN1cml0eUdyb3VwITogZWMyLlNlY3VyaXR5R3JvdXA7XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHMzLklCdWNrZXQgdXNlZCBieSB0aGUgY29uc3RydWN0XG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgY29uZmlnQXNzZXRCdWNrZXQhOiBzMy5JQnVja2V0O1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiBFdmVudEJ1cyB1c2VkIGJ5IHRoZSBjb25zdHJ1Y3RcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBldmVudEJ1cz86IGV2ZW50cy5JRXZlbnRCdXM7XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGluc3RhbmNlIG9mIEV2ZW50QnVzIHVzZWQgYnkgdGhlIGNvbnN0cnVjdFxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGV2ZW50c1J1bGU/OiBldmVudHMuUnVsZTtcblxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiBmZWVkYmFjayBRdWV1ZSAgdXNlZCBieSB0aGUgY29uc3RydWN0XG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZmVlZGJhY2tRdWV1ZTogc3FzLlF1ZXVlO1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiBvdXRwdXQgUXVldWUgdXNlZCBieSB0aGUgY29uc3RydWN0XG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgb3V0cHV0UXVldWU6IHNxcy5RdWV1ZTtcblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgSW5zdGFuY2Ugb2Ygc3RlcGZ1bmN0aW9uIGNyZWF0ZWQgYnkgdGhlIGNvbnN0cnVjdFxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHN0ZXBGdW5jdGlvbj86IHN0ZXBmdW5jdGlvbnMuU3RhdGVNYWNoaW5lO1xuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3RzIGEgbmV3IGluc3RhbmNlIG9mIHRoZSBUZXh0VG9TcWwgY2xhc3MuXG4gICAqIEBwYXJhbSB7Q29uc3RydWN0fSBzY29wZSAtIHJlcHJlc2VudHMgdGhlIHNjb3BlIGZvciBhbGwgdGhlIHJlc291cmNlcy5cbiAgICogQHBhcmFtIHtzdHJpbmd9IGlkIC0gdGhpcyBpcyBhIGEgc2NvcGUtdW5pcXVlIGlkLlxuICAgKiBAcGFyYW0ge1RleHRUb1NxbFByb3BzfSBwcm9wcyAtIHVzZXIgcHJvdmlkZWQgcHJvcHMgZm9yIHRoZSBjb25zdHJ1Y3QuXG4gICAqIEBzaW5jZSAwLjAuMFxuICAgKiBAcHVibGljXG4gICAqL1xuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogVGV4dFRvU3FsUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuXG4gICAgY29uc3QgYmFzZVByb3BzOiBCYXNlQ2xhc3NQcm9wcyA9IHtcbiAgICAgIHN0YWdlOiBwcm9wcy5zdGFnZSxcbiAgICAgIGNvbnN0cnVjdE5hbWU6IENvbnN0cnVjdE5hbWUuQVdTVEVYVFRPU1FMLFxuICAgICAgY29uc3RydWN0SWQ6IGlkLFxuICAgICAgb2JzZXJ2YWJpbGl0eTogcHJvcHMub2JzZXJ2YWJpbGl0eSxcbiAgICB9O1xuXG4gICAgdnBjSGVscGVyLkNoZWNrVnBjUHJvcHMocHJvcHMpO1xuICAgIHMzQnVja2V0SGVscGVyLkNoZWNrUzNQcm9wcyh7XG4gICAgICBleGlzdGluZ0J1Y2tldE9iajogcHJvcHMuZXhpc3Rpbmdjb25maWdBc3NldHNCdWNrZXRPYmosXG4gICAgICBidWNrZXRQcm9wczogcHJvcHMuY29uZmlnQXNzZXRzQnVja2V0UHJvcHMsXG4gICAgfSk7XG4gICAgZXZlbnRCcmlkZ2VIZWxwZXIuQ2hlY2tFdmVudEJyaWRnZVByb3BzKHByb3BzKTtcblxuICAgIHRoaXMudXBkYXRlRW52U3VmZml4KGJhc2VQcm9wcyk7XG4gICAgdGhpcy5hZGRPYnNlcnZhYmlsaXR5VG9Db25zdHJ1Y3QoYmFzZVByb3BzKTtcblxuICAgIC8vIHZwY1xuICAgIGlmIChwcm9wcz8uZXhpc3RpbmdWcGMgJiYgcHJvcHM/LmV4aXN0aW5nU3VibmV0R3JvdXApIHtcbiAgICAgIHRoaXMudnBjID0gcHJvcHMuZXhpc3RpbmdWcGM7XG4gICAgICB0aGlzLnN1Ym5ldEdyb3VwID0gcHJvcHMuZXhpc3RpbmdTdWJuZXRHcm91cDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy52cGMgPSB2cGNIZWxwZXIuYnVpbGRWcGMoc2NvcGUsIHtcbiAgICAgICAgZGVmYXVsdFZwY1Byb3BzOiBwcm9wcz8udnBjUHJvcHMsXG4gICAgICAgIHZwY05hbWU6ICdhd3NUZXh0VG9TcWxWcGMnLFxuICAgICAgfSk7XG4gICAgICB0aGlzLnN1Ym5ldEdyb3VwID0gbmV3IHJkcy5TdWJuZXRHcm91cCh0aGlzLCAnU3VibmV0R3JvdXAnLCB7XG4gICAgICAgIHZwYzogdGhpcy52cGMsXG4gICAgICAgIHZwY1N1Ym5ldHM6IHsgc3VibmV0VHlwZTogZWMyLlN1Ym5ldFR5cGUuUFJJVkFURV9JU09MQVRFRCB9LFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1N1Ym5ldCBncm91cCBmb3IgQXVyb3JhIFNlcnZlcmxlc3MnLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gYWRkIFZQQyBlbmRwb2ludHMgZm9yIHRoZSBjb21wdXRlIGVudmlyb25tZW50XG4gICAgdnBjSGVscGVyLkFkZEF3c1NlcnZpY2VFbmRwb2ludCh0aGlzLCB0aGlzLnZwYyxcbiAgICAgIFt2cGNIZWxwZXIuU2VydmljZUVuZHBvaW50VHlwZUVudW0uUzMsXG4gICAgICAgIHZwY0hlbHBlci5TZXJ2aWNlRW5kcG9pbnRUeXBlRW51bS5TVEVQX0ZVTkNUSU9OUyxcbiAgICAgICAgdnBjSGVscGVyLlNlcnZpY2VFbmRwb2ludFR5cGVFbnVtLkVWRU5UU10pO1xuXG5cbiAgICBjb25zdCBkYlBvcnQgPSBwcm9wcy5kYlBvcnQgPyBwcm9wcy5kYlBvcnQgOiAxNTM0O1xuXG4gICAgLy8gU2VjdXJpdHkgZ3JvdXBcbiAgICBpZiAocHJvcHM/LmV4aXN0aW5nTGFtYmRhU2VjdXJpdHlHcm91cCkge1xuICAgICAgdGhpcy5sYW1iZGFTZWN1cml0eUdyb3VwID0gcHJvcHMuZXhpc3RpbmdMYW1iZGFTZWN1cml0eUdyb3VwO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmxhbWJkYVNlY3VyaXR5R3JvdXAgPSBuZXcgZWMyLlNlY3VyaXR5R3JvdXAoXG4gICAgICAgIHRoaXMsXG4gICAgICAgICdsYW1iZGFTZWN1cml0eUdyb3VwJyxcbiAgICAgICAge1xuICAgICAgICAgIHZwYzogdGhpcy52cGMsXG4gICAgICAgICAgYWxsb3dBbGxPdXRib3VuZDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfVxuICAgIGlmIChwcm9wcz8uZXhpc3RpbmdEQlNlY3VyaXR5R3JvdXApIHtcbiAgICAgIHRoaXMuZGJTZWN1cml0eUdyb3VwID0gcHJvcHMuZXhpc3RpbmdEQlNlY3VyaXR5R3JvdXA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZGJTZWN1cml0eUdyb3VwID0gbmV3IGVjMi5TZWN1cml0eUdyb3VwKHRoaXMsICdEQlNlY3VyaXR5R3JvdXAnLCB7XG4gICAgICAgIHZwYzogdGhpcy52cGMsXG4gICAgICB9KTtcbiAgICAgIC8vIEFkZCBhbiBpbmJvdW5kIHJ1bGUgdG8gYWxsb3cgdHJhZmZpYyBmcm9tIHRoZSBMYW1iZGEgc2VjdXJpdHkgZ3JvdXBcbiAgICAgIHRoaXMuZGJTZWN1cml0eUdyb3VwLmFkZEluZ3Jlc3NSdWxlKFxuICAgICAgICBlYzIuUGVlci5zZWN1cml0eUdyb3VwSWQodGhpcy5sYW1iZGFTZWN1cml0eUdyb3VwLnNlY3VyaXR5R3JvdXBJZCksXG4gICAgICAgIGVjMi5Qb3J0LnRjcChkYlBvcnQpLCAvLyBBc3N1bWluZyBNeVNRTCBpcyBydW5uaW5nIG9uIHBvcnQgMzMwNlxuICAgICAgICAnQWxsb3cgTGFtYmRhIGZ1bmN0aW9uIHRvIGFjY2VzcyB0aGUgZGF0YWJhc2UnLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyB2cGMgZmxvd2xvZ2dyb3VwXG4gICAgY29uc3QgbG9nR3JvdXAgPSBuZXcgbG9ncy5Mb2dHcm91cCh0aGlzLCAndGV4dFRvU3FsQ29uc3RydWN0VlBDR3JvdXAnKTtcbiAgICBjb25zdCB2cGNGbG93TG9ncm9sZSA9IG5ldyBpYW0uUm9sZSh0aGlzLCAndGV4dFRvU3FsQ29uc3RydWN0Um9sZScsIHtcbiAgICAgIGFzc3VtZWRCeTogbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCd2cGMtZmxvdy1sb2dzLmFtYXpvbmF3cy5jb20nKSxcbiAgICB9KTtcblxuICAgIC8vIHZwYyBmbG93bG9nc1xuICAgIG5ldyBlYzIuRmxvd0xvZyh0aGlzLCAnRmxvd0xvZycsIHtcbiAgICAgIHJlc291cmNlVHlwZTogZWMyLkZsb3dMb2dSZXNvdXJjZVR5cGUuZnJvbVZwYyh0aGlzLnZwYyksXG4gICAgICBkZXN0aW5hdGlvbjogZWMyLkZsb3dMb2dEZXN0aW5hdGlvbi50b0Nsb3VkV2F0Y2hMb2dzKFxuICAgICAgICBsb2dHcm91cCxcbiAgICAgICAgdnBjRmxvd0xvZ3JvbGUsXG4gICAgICApLFxuICAgIH0pO1xuXG4gICAgLy8gYnVja2V0IGZvciBzdG9yaW5nIHNlcnZlciBhY2Nlc3MgbG9nZ2luZ1xuICAgIGNvbnN0IHNlcnZlckFjY2Vzc0xvZ0J1Y2tldCA9IG5ldyBzMy5CdWNrZXQoXG4gICAgICB0aGlzLFxuICAgICAgJ3NlcnZlckFjY2Vzc0xvZ0J1Y2tldCcgKyB0aGlzLnN0YWdlLFxuICAgICAge1xuICAgICAgICBibG9ja1B1YmxpY0FjY2VzczogczMuQmxvY2tQdWJsaWNBY2Nlc3MuQkxPQ0tfQUxMLFxuICAgICAgICBlbmNyeXB0aW9uOiBzMy5CdWNrZXRFbmNyeXB0aW9uLlMzX01BTkFHRUQsXG4gICAgICAgIGVuZm9yY2VTU0w6IHRydWUsXG4gICAgICAgIHZlcnNpb25lZDogdHJ1ZSxcbiAgICAgICAgbGlmZWN5Y2xlUnVsZXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBleHBpcmF0aW9uOiBjZGsuRHVyYXRpb24uZGF5cyg5MCksXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgIH0sXG4gICAgKTtcblxuICAgIC8vIGNvbmZpZyBhc3NldCBidWNrZXRcbiAgICBpZiAocHJvcHM/LmV4aXN0aW5nY29uZmlnQXNzZXRzQnVja2V0T2JqKSB7XG4gICAgICB0aGlzLmNvbmZpZ0Fzc2V0QnVja2V0ID0gcHJvcHMuZXhpc3Rpbmdjb25maWdBc3NldHNCdWNrZXRPYmo7XG4gICAgfSBlbHNlIGlmIChwcm9wcz8uY29uZmlnQXNzZXRzQnVja2V0UHJvcHMpIHtcbiAgICAgIHRoaXMuY29uZmlnQXNzZXRCdWNrZXQgPSBuZXcgczMuQnVja2V0KFxuICAgICAgICB0aGlzLFxuICAgICAgICAnY29uZmlnYXNzZXQnICsgdGhpcy5zdGFnZSxcbiAgICAgICAgcHJvcHMuY29uZmlnQXNzZXRzQnVja2V0UHJvcHMsXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNvbmZpZ0Fzc2V0QnVja2V0ID0gbmV3IHMzLkJ1Y2tldChcbiAgICAgICAgdGhpcyxcbiAgICAgICAgJ2NvbmZpZ2Fzc2V0JyArIHRoaXMuc3RhZ2UsXG4gICAgICAgIHtcbiAgICAgICAgICBhY2Nlc3NDb250cm9sOiBzMy5CdWNrZXRBY2Nlc3NDb250cm9sLlBSSVZBVEUsXG4gICAgICAgICAgYmxvY2tQdWJsaWNBY2Nlc3M6IHMzLkJsb2NrUHVibGljQWNjZXNzLkJMT0NLX0FMTCxcbiAgICAgICAgICBlbmNyeXB0aW9uOiBzMy5CdWNrZXRFbmNyeXB0aW9uLlMzX01BTkFHRUQsXG4gICAgICAgICAgYnVja2V0TmFtZTpcbiAgICAgICAgICAgICdjb25maWdhc3NldCcgK1xuICAgICAgICAgICAgdGhpcy5zdGFnZS50b0xvd2VyQ2FzZSgpICtcbiAgICAgICAgICAgICctJyArXG4gICAgICAgICAgICBjZGsuQXdzLlJFR0lPTiArXG4gICAgICAgICAgICAnLScgK1xuICAgICAgICAgICAgY2RrLkF3cy5BQ0NPVU5UX0lELFxuICAgICAgICAgIHNlcnZlckFjY2Vzc0xvZ3NCdWNrZXQ6IHNlcnZlckFjY2Vzc0xvZ0J1Y2tldCxcbiAgICAgICAgICBlbmZvcmNlU1NMOiB0cnVlLFxuICAgICAgICAgIHZlcnNpb25lZDogdHJ1ZSxcbiAgICAgICAgICBsaWZlY3ljbGVSdWxlczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBleHBpcmF0aW9uOiBjZGsuRHVyYXRpb24uZGF5cyg5MCksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IGNvbmZpZ0ZpbGVQYXRoID0gcGF0aC5qb2luKFxuICAgICAgX19kaXJuYW1lLFxuICAgICAgJy4uLy4uLy4uLy4uL3Jlc291cmNlcy9nZW4tYWkvYXdzLXRleHQtdG8tc3FsJyxcbiAgICApO1xuXG4gICAgY29uc3QgdGV4dFRvU1FMRnVuY3Rpb25Sb2xlID0gbmV3IGlhbS5Sb2xlKFxuICAgICAgdGhpcyxcbiAgICAgICdxdWVyeUNvbmZpZ0Z1bmN0aW9uUm9sZScsXG4gICAgICB7XG4gICAgICAgIGFzc3VtZWRCeTogbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdsYW1iZGEuYW1hem9uYXdzLmNvbScpLFxuICAgICAgICBpbmxpbmVQb2xpY2llczoge1xuICAgICAgICAgIExhbWJkYUZ1bmN0aW9uU2VydmljZVJvbGVQb2xpY3k6IG5ldyBpYW0uUG9saWN5RG9jdW1lbnQoe1xuICAgICAgICAgICAgc3RhdGVtZW50czogW1xuICAgICAgICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgICAgICAgYWN0aW9uczogW1xuICAgICAgICAgICAgICAgICAgJ2xvZ3M6Q3JlYXRlTG9nR3JvdXAnLFxuICAgICAgICAgICAgICAgICAgJ2xvZ3M6Q3JlYXRlTG9nU3RyZWFtJyxcbiAgICAgICAgICAgICAgICAgICdsb2dzOlB1dExvZ0V2ZW50cycsXG4gICAgICAgICAgICAgICAgICAnYmVkcm9jazpJbnZva2VNb2RlbCcsXG4gICAgICAgICAgICAgICAgICAnYmVkcm9jazpJbnZva2VNb2RlbFdpdGhSZXNwb25zZVN0cmVhbScsXG4gICAgICAgICAgICAgICAgICAnczM6R2V0T2JqZWN0JyxcbiAgICAgICAgICAgICAgICAgICdzMzpHZXRCdWNrZXRMb2NhdGlvbicsXG4gICAgICAgICAgICAgICAgICAnczM6TGlzdEJ1Y2tldCcsXG4gICAgICAgICAgICAgICAgICAnczM6UHV0T2JqZWN0JyxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIHJlc291cmNlczogW1xuICAgICAgICAgICAgICAgICAgYGFybjoke0F3cy5QQVJUSVRJT059OmxvZ3M6JHtBd3MuUkVHSU9OfToke0F3cy5BQ0NPVU5UX0lEfTpsb2ctZ3JvdXA6L2F3cy9sYW1iZGEvKmAsXG4gICAgICAgICAgICAgICAgICAnYXJuOicgK1xuICAgICAgICAgICAgICAgICAgICBBd3MuUEFSVElUSU9OICtcbiAgICAgICAgICAgICAgICAgICAgJzpzMzo6OicgK1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbmZpZ0Fzc2V0QnVja2V0LmJ1Y2tldE5hbWUgK1xuICAgICAgICAgICAgICAgICAgICAnLyonLFxuICAgICAgICAgICAgICAgICAgYGFybjoke0F3cy5QQVJUSVRJT059OmxvZ3M6JHtBd3MuUkVHSU9OfToke0F3cy5BQ0NPVU5UX0lEfTpsb2ctZ3JvdXA6L2F3cy9sYW1iZGEvKmAsXG4gICAgICAgICAgICAgICAgICAnYXJuOicgK1xuICAgICAgICAgICAgICAgICAgICBBd3MuUEFSVElUSU9OICtcbiAgICAgICAgICAgICAgICAgICAgJzpiZWRyb2NrOicgK1xuICAgICAgICAgICAgICAgICAgICBBd3MuUkVHSU9OICtcbiAgICAgICAgICAgICAgICAgICAgJzo6Zm91bmRhdGlvbi1tb2RlbC8qJyxcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgfSksXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICk7XG5cbiAgICAvLyBNaW5pbXVtIHBlcm1pc3Npb25zIGZvciBhIExhbWJkYSBmdW5jdGlvbiB0byBleGVjdXRlIHdoaWxlIGFjY2Vzc2luZyBhIHJlc291cmNlIHdpdGhpbiBhIFZQQ1xuICAgIHRleHRUb1NRTEZ1bmN0aW9uUm9sZS5hZGRUb1BvbGljeShcbiAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgZWZmZWN0OiBpYW0uRWZmZWN0LkFMTE9XLFxuICAgICAgICBhY3Rpb25zOiBbXG4gICAgICAgICAgJ2VjMjpDcmVhdGVOZXR3b3JrSW50ZXJmYWNlJyxcbiAgICAgICAgICAnZWMyOkRlbGV0ZU5ldHdvcmtJbnRlcmZhY2UnLFxuICAgICAgICAgICdlYzI6QXNzaWduUHJpdmF0ZUlwQWRkcmVzc2VzJyxcbiAgICAgICAgICAnZWMyOlVuYXNzaWduUHJpdmF0ZUlwQWRkcmVzc2VzJyxcbiAgICAgICAgXSxcbiAgICAgICAgcmVzb3VyY2VzOiBbXG4gICAgICAgICAgJ2FybjonICtcbiAgICAgICAgICAgIEF3cy5QQVJUSVRJT04gK1xuICAgICAgICAgICAgJzplYzI6JyArXG4gICAgICAgICAgICBBd3MuUkVHSU9OICtcbiAgICAgICAgICAgICc6JyArXG4gICAgICAgICAgICBBd3MuQUNDT1VOVF9JRCArXG4gICAgICAgICAgICAnOiovKicsXG4gICAgICAgIF0sXG4gICAgICB9KSxcbiAgICApO1xuXG4gICAgdGV4dFRvU1FMRnVuY3Rpb25Sb2xlLmFkZFRvUG9saWN5KFxuICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICBlZmZlY3Q6IGlhbS5FZmZlY3QuQUxMT1csXG4gICAgICAgIGFjdGlvbnM6IFsnZWMyOkRlc2NyaWJlTmV0d29ya0ludGVyZmFjZXMnXSxcbiAgICAgICAgcmVzb3VyY2VzOiBbJyonXSxcbiAgICAgIH0pLFxuICAgICk7XG5cbiAgICB0ZXh0VG9TUUxGdW5jdGlvblJvbGUuYWRkVG9Qb2xpY3koXG4gICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgIGVmZmVjdDogaWFtLkVmZmVjdC5BTExPVyxcbiAgICAgICAgYWN0aW9uczogWydzMzpMaXN0QnVja2V0J10sXG4gICAgICAgIHJlc291cmNlczogW1xuICAgICAgICAgICdhcm46JyArIEF3cy5QQVJUSVRJT04gKyAnOnMzOjo6JyArIHRoaXMuY29uZmlnQXNzZXRCdWNrZXQuYnVja2V0TmFtZSxcbiAgICAgICAgXSxcbiAgICAgIH0pLFxuICAgICk7XG5cbiAgICBjb25zdCBjb25maWdMb2FkZXJQb2xpY3kgPSBuZXcgaWFtLk1hbmFnZWRQb2xpY3kodGhpcywgJ0F1cm9yYVBnUG9saWN5Jywge1xuICAgICAgbWFuYWdlZFBvbGljeU5hbWU6IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIodGhpcywgJ2NvbmZpZ0xvYWRlclBvbGljeScsIHtcbiAgICAgICAgbWF4TGVuZ3RoOiAzMixcbiAgICAgICAgbG93ZXI6IHRydWUsXG4gICAgICB9KSxcbiAgICAgIHN0YXRlbWVudHM6IFtcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgICAgICdlYzI6RGVzY3JpYmVJbnN0YW5jZXMnLFxuICAgICAgICAgICAgJ2VjMjpDcmVhdGVOZXR3b3JrSW50ZXJmYWNlJyxcbiAgICAgICAgICAgICdlYzI6QXR0YWNoTmV0d29ya0ludGVyZmFjZScsXG4gICAgICAgICAgICAnZWMyOkRlc2NyaWJlTmV0d29ya0ludGVyZmFjZXMnLFxuICAgICAgICAgICAgJ2F1dG9zY2FsaW5nOkNvbXBsZXRlTGlmZWN5Y2xlQWN0aW9uJyxcbiAgICAgICAgICAgICdlYzI6RGVsZXRlTmV0d29ya0ludGVyZmFjZScsXG4gICAgICAgICAgXSxcbiAgICAgICAgICByZXNvdXJjZXM6IFsnKiddLFxuICAgICAgICB9KSxcblxuICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogW1xuICAgICAgICAgICAgJ2xvZ3M6Q3JlYXRlTG9nR3JvdXAnLFxuICAgICAgICAgICAgJ2xvZ3M6Q3JlYXRlTG9nU3RyZWFtJyxcbiAgICAgICAgICAgICdsb2dzOlB1dExvZ0V2ZW50cycsXG4gICAgICAgICAgICAnYmVkcm9jazpJbnZva2VNb2RlbCcsXG4gICAgICAgICAgICAnYmVkcm9jazpJbnZva2VNb2RlbFdpdGhSZXNwb25zZVN0cmVhbScsXG4gICAgICAgICAgICAnczM6R2V0T2JqZWN0JyxcbiAgICAgICAgICAgICdzMzpHZXRCdWNrZXRMb2NhdGlvbicsXG4gICAgICAgICAgICAnczM6TGlzdEJ1Y2tldCcsXG4gICAgICAgICAgICAnczM6UHV0T2JqZWN0JyxcbiAgICAgICAgICBdLFxuICAgICAgICAgIHJlc291cmNlczogW1xuICAgICAgICAgICAgYGFybjoke0F3cy5QQVJUSVRJT059OmxvZ3M6JHtBd3MuUkVHSU9OfToke0F3cy5BQ0NPVU5UX0lEfTpsb2ctZ3JvdXA6L2F3cy9sYW1iZGEvKmAsXG4gICAgICAgICAgICAnYXJuOicgK1xuICAgICAgICAgICAgICBBd3MuUEFSVElUSU9OICtcbiAgICAgICAgICAgICAgJzpzMzo6OicgK1xuICAgICAgICAgICAgICB0aGlzLmNvbmZpZ0Fzc2V0QnVja2V0LmJ1Y2tldE5hbWUgK1xuICAgICAgICAgICAgICAnLyonLFxuICAgICAgICAgICAgYGFybjoke0F3cy5QQVJUSVRJT059OmxvZ3M6JHtBd3MuUkVHSU9OfToke0F3cy5BQ0NPVU5UX0lEfTpsb2ctZ3JvdXA6L2F3cy9sYW1iZGEvKmAsXG4gICAgICAgICAgICAnYXJuOicgK1xuICAgICAgICAgICAgICBBd3MuUEFSVElUSU9OICtcbiAgICAgICAgICAgICAgJzpiZWRyb2NrOicgK1xuICAgICAgICAgICAgICBBd3MuUkVHSU9OICtcbiAgICAgICAgICAgICAgJzo6Zm91bmRhdGlvbi1tb2RlbC8qJyxcbiAgICAgICAgICBdLFxuICAgICAgICB9KSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBjdXN0b21SZXNvdXJjZSA9IGJ1aWxkQ3VzdG9tUmVzb3VyY2VQcm92aWRlcih7XG4gICAgICBwcm92aWRlck5hbWU6ICdDb25maWdGaWxlTG9hZGVyQ1JQcm92aWRlcicsXG4gICAgICB2cGM6IHRoaXMudnBjLFxuICAgICAgc2VjdXJpdHlHcm91cDogdGhpcy5sYW1iZGFTZWN1cml0eUdyb3VwLFxuICAgICAgY29kZVBhdGg6IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi8uLi8uLi8uLi9sYW1iZGEvYXdzLXRleHQtdG8tc3FsJyksXG4gICAgICBoYW5kbGVyOiAnY3VzdG9tX3Jlc291cmNlcy5vbl9ldmVudCcsXG4gICAgICBydW50aW1lOiBjZGsuYXdzX2xhbWJkYS5SdW50aW1lLlBZVEhPTl8zXzEyLFxuICAgIH0pO1xuXG4gICAgY29uc3QgY3JQcm92aWRlciA9IGN1c3RvbVJlc291cmNlLmdldFByb3ZpZGVyKHRoaXMpO1xuICAgIGNyUHJvdmlkZXIucm9sZS5hZGRNYW5hZ2VkUG9saWN5KGNvbmZpZ0xvYWRlclBvbGljeSk7XG5cbiAgICBjb25zdCBjb25maWdGaWxlTG9hZGVyID0gbmV3IGNkay5DdXN0b21SZXNvdXJjZSh0aGlzLCAnQ29uZmlnRmlsZUxvYWRlcicsIHtcbiAgICAgIHJlc291cmNlVHlwZTogJ0N1c3RvbTo6Q29uZmlnRmlsZUxvYWRlcicsXG4gICAgICBzZXJ2aWNlVG9rZW46IGNyUHJvdmlkZXIuc2VydmljZVRva2VuLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICBjb25maWdCdWNrZXQ6IHRoaXMuY29uZmlnQXNzZXRCdWNrZXQuYnVja2V0TmFtZSxcbiAgICAgICAgY29uZmlnRmlsZVBhdGg6IGNvbmZpZ0ZpbGVQYXRoLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIGNvbmZpZ0ZpbGVMb2FkZXIubm9kZS5hZGREZXBlbmRlbmN5KHRoaXMuY29uZmlnQXNzZXRCdWNrZXQpO1xuICAgIC8vY3JQcm92aWRlci5yb2xlLm5vZGUuYWRkRGVwZW5kZW5jeShjb25maWdMb2FkZXJQb2xpY3kpO1xuXG4gICAgTmFnU3VwcHJlc3Npb25zLmFkZFJlc291cmNlU3VwcHJlc3Npb25zKFxuICAgICAgdGV4dFRvU1FMRnVuY3Rpb25Sb2xlLFxuICAgICAgW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdBd3NTb2x1dGlvbnMtSUFNNScsXG4gICAgICAgICAgcmVhc29uOiAnQVdTTGFtYmRhQmFzaWNFeGVjdXRpb25Sb2xlIGlzIHVzZWQuJyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICB0cnVlLFxuICAgICk7XG5cbiAgICBjb25zdCByZWZvcm11bGF0ZVF1ZXN0aW9uRnVuY3Rpb25OYW1lID0gZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMihcbiAgICAgIHRoaXMsXG4gICAgICAncmVmb3JtdWxhdGVRdWVzdGlvbkZ1bmN0aW9uJyArIHRoaXMuc3RhZ2UsXG4gICAgICB7IG1heExlbmd0aDogNjMsIGxvd2VyOiB0cnVlIH0sXG4gICAgKTtcblxuICAgIGNvbnN0IHJlZm9ybXVsYXRlUXVlc3Rpb25GdW5jdGlvblByb3BzID0ge1xuICAgICAgZnVuY3Rpb25OYW1lOiByZWZvcm11bGF0ZVF1ZXN0aW9uRnVuY3Rpb25OYW1lLFxuICAgICAgZGVzY3JpcHRpb246ICdMYW1iZGEgZnVuY3Rpb24gdG8gcmVmb3JtdWxhdGUgdXNlciBxdWVzdGlvbicsXG4gICAgICBjb2RlOiBsYW1iZGEuRG9ja2VySW1hZ2VDb2RlLmZyb21JbWFnZUFzc2V0KFxuICAgICAgICBwYXRoLmpvaW4oXG4gICAgICAgICAgX19kaXJuYW1lLFxuICAgICAgICAgICcuLi8uLi8uLi8uLi9sYW1iZGEvYXdzLXRleHQtdG8tc3FsL3JlZm9ybXVsYXRlX3F1ZXN0aW9uJyxcbiAgICAgICAgKSxcbiAgICAgICksXG4gICAgICB2cGM6IHRoaXMudnBjLFxuICAgICAgdnBjU3VibmV0czogeyBzdWJuZXRUeXBlOiBlYzIuU3VibmV0VHlwZS5QUklWQVRFX0lTT0xBVEVEIH0sXG4gICAgICBzZWN1cml0eUdyb3VwczogW3RoaXMubGFtYmRhU2VjdXJpdHlHcm91cF0sXG4gICAgICBtZW1vcnlTaXplOiBsYW1iZGFNZW1vcnlTaXplTGltaXRlcih0aGlzLCAxXzc2OSAqIDQpLFxuICAgICAgdGltZW91dDogRHVyYXRpb24ubWludXRlcygxMCksXG4gICAgICB0cmFjaW5nOiB0aGlzLmxhbWJkYVRyYWNpbmcsXG4gICAgICByb2xlOiB0ZXh0VG9TUUxGdW5jdGlvblJvbGUsXG4gICAgICBlbnZpcm9ubWVudDoge1xuICAgICAgICBEQl9OQU1FOiBwcm9wcy5kYk5hbWUsXG4gICAgICAgIE1FVEFEQVRBX1NPVVJDRTogcHJvcHMubWV0YWRhdGFTb3VyY2UsXG4gICAgICAgIENPTkZJR19CVUNLRVQ6IHRoaXMuY29uZmlnQXNzZXRCdWNrZXQuYnVja2V0TmFtZSxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIC8vIExhbWJkYSBmdW5jdGlvbiB0byBsb2FkICB0aGUgY29uZmlnIGFuZCBkbyBhbGwgcHJlIHN0ZXBzIGJlZm9yZSBxdWVyeSBnZW5lcmF0aW9uLlxuICAgIGNvbnN0IHJlZm9ybXVsYXRlUXVlc3Rpb25GdW5jdGlvbiA9IGJ1aWxkRG9ja2VyTGFtYmRhRnVuY3Rpb24oXG4gICAgICB0aGlzLFxuICAgICAgJ3JlZm9ybXVsYXRlUXVlc3Rpb25GdW5jdGlvbicgKyB0aGlzLnN0YWdlLFxuICAgICAgcmVmb3JtdWxhdGVRdWVzdGlvbkZ1bmN0aW9uUHJvcHMsXG4gICAgICBwcm9wcy5jdXN0b21RdWVyeUNvbmZpZ3VyZXJMYW1iZGFQcm9wcyxcbiAgICApO1xuXG4gICAgY29uc3QgcXVlcnlHZW5lcmF0b3JGdW5jdGlvbk5hbWUgPSBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyKFxuICAgICAgdGhpcyxcbiAgICAgICdxdWVyeUdlbmVyYXRvckZ1bmN0aW9uJyArIHRoaXMuc3RhZ2UsXG4gICAgICB7IG1heExlbmd0aDogNjMsIGxvd2VyOiB0cnVlIH0sXG4gICAgKTtcblxuICAgIGNvbnN0IHF1ZXJ5R2VuZXJhdG9yRnVuY3Rpb25Qcm9wcyA9IHtcbiAgICAgIGZ1bmN0aW9uTmFtZTogcXVlcnlHZW5lcmF0b3JGdW5jdGlvbk5hbWUsXG4gICAgICBkZXNjcmlwdGlvbjpcbiAgICAgICAgJ0xhbWJkYSBmdW5jdGlvbiB0byBnZW5lcmF0ZSB0aGUgcXVlcnkgYmFzZWQgb24gdXNlciBxdWVzdGlvbi4nLFxuICAgICAgY29kZTogbGFtYmRhLkRvY2tlckltYWdlQ29kZS5mcm9tSW1hZ2VBc3NldChcbiAgICAgICAgcGF0aC5qb2luKFxuICAgICAgICAgIF9fZGlybmFtZSxcbiAgICAgICAgICAnLi4vLi4vLi4vLi4vbGFtYmRhL2F3cy10ZXh0LXRvLXNxbC9xdWVyeV9nZW5lcmF0b3InLFxuICAgICAgICApLFxuICAgICAgKSxcbiAgICAgIHZwYzogdGhpcy52cGMsXG4gICAgICB2cGNTdWJuZXRzOiB7IHN1Ym5ldFR5cGU6IGVjMi5TdWJuZXRUeXBlLlBSSVZBVEVfSVNPTEFURUQgfSxcbiAgICAgIHNlY3VyaXR5R3JvdXBzOiBbdGhpcy5sYW1iZGFTZWN1cml0eUdyb3VwXSxcbiAgICAgIG1lbW9yeVNpemU6IGxhbWJkYU1lbW9yeVNpemVMaW1pdGVyKHRoaXMsIDFfNzY5ICogNCksXG4gICAgICB0aW1lb3V0OiBEdXJhdGlvbi5taW51dGVzKDEwKSxcbiAgICAgIHRyYWNpbmc6IHRoaXMubGFtYmRhVHJhY2luZyxcbiAgICAgIHJvbGU6IHRleHRUb1NRTEZ1bmN0aW9uUm9sZSxcbiAgICAgIGVudmlyb25tZW50OiB7XG4gICAgICAgIERCX05BTUU6IHByb3BzLmRiTmFtZSxcbiAgICAgICAgQ09ORklHX0JVQ0tFVDogdGhpcy5jb25maWdBc3NldEJ1Y2tldC5idWNrZXROYW1lLFxuICAgICAgICBTRUNSRVRfQVJOOiBwcm9wcy5kYXRhYmFzZVNlY3JldEFSTixcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIC8vIExhbWJkYSBmdW5jdGlvbiB1c2VkIHRvIGdlbmVyYXRlIHRoZSBxdWVyeVxuICAgIGNvbnN0IHF1ZXJ5R2VuZXJhdG9yRnVuY3Rpb24gPSBidWlsZERvY2tlckxhbWJkYUZ1bmN0aW9uKFxuICAgICAgdGhpcyxcbiAgICAgICdxdWVyeUdlbmVyYXRvckZ1bmN0aW9uJyArIHRoaXMuc3RhZ2UsXG4gICAgICBxdWVyeUdlbmVyYXRvckZ1bmN0aW9uUHJvcHMsXG4gICAgICBwcm9wcy5jdXN0b21RdWVyeUdlbmVyYXRvckxhbWJkYVByb3BzLFxuICAgICk7XG5cbiAgICAvLyBMYW1iZGEgZnVuY3Rpb24gdXNlZCB0byBleGVjdXRlIHRoZSBxdWVyeVxuXG4gICAgY29uc3QgcXVlcnlFeGVjdXRvckZ1bmN0aW9uTmFtZSA9IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIoXG4gICAgICB0aGlzLFxuICAgICAgJ3F1ZXJ5RXhlY3V0b3JGdW5jdGlvbk5hbWUnICsgdGhpcy5zdGFnZSxcbiAgICAgIHsgbWF4TGVuZ3RoOiA2MywgbG93ZXI6IHRydWUgfSxcbiAgICApO1xuXG4gICAgY29uc3QgcXVlcnlFeGVjdXRvckZ1bmN0aW9uUHJvcHMgPSB7XG4gICAgICBmdW5jdGlvbk5hbWU6IHF1ZXJ5RXhlY3V0b3JGdW5jdGlvbk5hbWUsXG4gICAgICBkZXNjcmlwdGlvbjogJ0xhbWJkYSBmdW5jdGlvbiB0byBleGVjdXRlIHRoZSBxdWVyeS4nLFxuICAgICAgY29kZTogbGFtYmRhLkRvY2tlckltYWdlQ29kZS5mcm9tSW1hZ2VBc3NldChcbiAgICAgICAgcGF0aC5qb2luKFxuICAgICAgICAgIF9fZGlybmFtZSxcbiAgICAgICAgICAnLi4vLi4vLi4vLi4vbGFtYmRhL2F3cy10ZXh0LXRvLXNxbC9xdWVyeV9leGVjdXRvcicsXG4gICAgICAgICksXG4gICAgICApLFxuICAgICAgdnBjOiB0aGlzLnZwYyxcbiAgICAgIHZwY1N1Ym5ldHM6IHsgc3VibmV0VHlwZTogZWMyLlN1Ym5ldFR5cGUuUFJJVkFURV9JU09MQVRFRCB9LFxuICAgICAgc2VjdXJpdHlHcm91cHM6IFt0aGlzLmxhbWJkYVNlY3VyaXR5R3JvdXBdLFxuICAgICAgbWVtb3J5U2l6ZTogbGFtYmRhTWVtb3J5U2l6ZUxpbWl0ZXIodGhpcywgMV83NjkgKiA0KSxcbiAgICAgIHRpbWVvdXQ6IER1cmF0aW9uLm1pbnV0ZXMoMTApLFxuICAgICAgdHJhY2luZzogdGhpcy5sYW1iZGFUcmFjaW5nLFxuICAgICAgcm9sZTogdGV4dFRvU1FMRnVuY3Rpb25Sb2xlLFxuICAgICAgZW52aXJvbm1lbnQ6IHtcbiAgICAgICAgREJfTkFNRTogcHJvcHMuZGJOYW1lLFxuICAgICAgICBDT05GSUdfQlVDS0VUOiB0aGlzLmNvbmZpZ0Fzc2V0QnVja2V0LmJ1Y2tldE5hbWUsXG4gICAgICAgIFNFQ1JFVF9BUk46IHByb3BzLmRhdGFiYXNlU2VjcmV0QVJOLFxuICAgICAgfSxcbiAgICB9O1xuXG4gICAgLy8gTGFtYmRhIGZ1bmN0aW9uIHVzZWQgdG8gZ2VuZXJhdGUgdGhlIHF1ZXJ5XG4gICAgY29uc3QgcXVlcnlFeGVjdXRvckZ1bmN0aW9uID0gYnVpbGREb2NrZXJMYW1iZGFGdW5jdGlvbihcbiAgICAgIHRoaXMsXG4gICAgICAncXVlcnlFeGVjdXRvckZ1bmN0aW9uTmFtZScgKyB0aGlzLnN0YWdlLFxuICAgICAgcXVlcnlFeGVjdXRvckZ1bmN0aW9uUHJvcHMsXG4gICAgICBwcm9wcy5jdXN0b21RdWVyeUV4ZWN1dG9yTGFtYmRhUHJvcHMsXG4gICAgKTtcblxuICAgIC8vIGxhbWJkYSBmdW5jdGlvbiBmb3IgYXV0b2NvcnJlY3QgbG9vcFxuXG4gICAgY29uc3QgYXV0b2NvcnJlY3RRdWVyeUZ1bmN0aW9uTmFtZSA9IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIoXG4gICAgICB0aGlzLFxuICAgICAgJ2F1dG9jb3JyZWN0UXVlcnlGdW5jdGlvbicgKyB0aGlzLnN0YWdlLFxuICAgICAgeyBtYXhMZW5ndGg6IDYzLCBsb3dlcjogdHJ1ZSB9LFxuICAgICk7XG5cbiAgICBjb25zdCBhdXRvY29ycmVjdFF1ZXJ5RnVuY3Rpb25Qcm9wcyA9IHtcbiAgICAgIGZ1bmN0aW9uTmFtZTogYXV0b2NvcnJlY3RRdWVyeUZ1bmN0aW9uTmFtZSxcbiAgICAgIGRlc2NyaXB0aW9uOiAnTGFtYmRhIGZ1bmN0aW9uIHRvIGtlZXAgdGhlIGNvdW50IG9mIGF1dG9jb3JyZWN0IGxvb3AuJyxcbiAgICAgIGNvZGU6IGxhbWJkYS5Eb2NrZXJJbWFnZUNvZGUuZnJvbUltYWdlQXNzZXQoXG4gICAgICAgIHBhdGguam9pbihcbiAgICAgICAgICBfX2Rpcm5hbWUsXG4gICAgICAgICAgJy4uLy4uLy4uLy4uL2xhbWJkYS9hd3MtdGV4dC10by1zcWwvcXVlcnlfYXV0b2NvcnJlY3QnLFxuICAgICAgICApLFxuICAgICAgKSxcbiAgICAgIHZwYzogdGhpcy52cGMsXG4gICAgICB2cGNTdWJuZXRzOiB7IHN1Ym5ldFR5cGU6IGVjMi5TdWJuZXRUeXBlLlBSSVZBVEVfSVNPTEFURUQgfSxcbiAgICAgIHNlY3VyaXR5R3JvdXBzOiBbdGhpcy5sYW1iZGFTZWN1cml0eUdyb3VwXSxcbiAgICAgIG1lbW9yeVNpemU6IGxhbWJkYU1lbW9yeVNpemVMaW1pdGVyKHRoaXMsIDFfNzY5ICogNCksXG4gICAgICB0aW1lb3V0OiBEdXJhdGlvbi5taW51dGVzKDEwKSxcbiAgICAgIHRyYWNpbmc6IHRoaXMubGFtYmRhVHJhY2luZyxcbiAgICAgIHJvbGU6IHRleHRUb1NRTEZ1bmN0aW9uUm9sZSxcbiAgICB9O1xuXG4gICAgY29uc3QgYXV0b2NvcnJlY3RRdWVyeUZ1bmN0aW9uID0gYnVpbGREb2NrZXJMYW1iZGFGdW5jdGlvbihcbiAgICAgIHRoaXMsXG4gICAgICAnYXV0b2NvcnJlY3RRdWVyeUZ1bmN0aW9uJyArIHRoaXMuc3RhZ2UsXG4gICAgICBhdXRvY29ycmVjdFF1ZXJ5RnVuY3Rpb25Qcm9wcyxcbiAgICAgIHVuZGVmaW5lZCxcbiAgICApO1xuXG4gICAgY29uc3QgZmVlZGJhY2tRdWV1ZU5hbWUgPSBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyKFxuICAgICAgdGhpcyxcbiAgICAgICdmZWVkYmFja1F1ZXVlJyArIHRoaXMuc3RhZ2UsXG4gICAgICB7IG1heExlbmd0aDogNjMsIGxvd2VyOiB0cnVlIH0sXG4gICAgKTtcblxuICAgIGNvbnN0IHF1ZXVlID0gbmV3IHNxcy5RdWV1ZSh0aGlzLCAndXNlckZlZWRiYWNrUXVldWUnLCB7XG4gICAgICBxdWV1ZU5hbWU6IGZlZWRiYWNrUXVldWVOYW1lLFxuICAgICAgdmlzaWJpbGl0eVRpbWVvdXQ6IER1cmF0aW9uLnNlY29uZHMoMzYwMCksXG4gICAgfSk7XG5cbiAgICBxdWV1ZS5hZGRUb1Jlc291cmNlUG9saWN5KFxuICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICBlZmZlY3Q6IGlhbS5FZmZlY3QuREVOWSxcbiAgICAgICAgcHJpbmNpcGFsczogW25ldyBpYW0uQW55UHJpbmNpcGFsKCldLFxuICAgICAgICBhY3Rpb25zOiBbJ3NxczoqJ10sXG4gICAgICAgIHJlc291cmNlczogW3F1ZXVlLnF1ZXVlQXJuXSxcbiAgICAgICAgY29uZGl0aW9uczoge1xuICAgICAgICAgIEJvb2w6IHtcbiAgICAgICAgICAgICdhd3M6U2VjdXJlVHJhbnNwb3J0JzogJ2ZhbHNlJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSksXG4gICAgKTtcbiAgICB0aGlzLmZlZWRiYWNrUXVldWUgPSBxdWV1ZTtcblxuICAgIGNvbnN0IG91dHB1dFF1ZXVlTmFtZSA9IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIoXG4gICAgICB0aGlzLFxuICAgICAgJ291dHB1dFF1ZXVlJyArIHRoaXMuc3RhZ2UsXG4gICAgICB7IG1heExlbmd0aDogNjMsIGxvd2VyOiB0cnVlIH0sXG4gICAgKTtcblxuICAgIGNvbnN0IG91dHB1dFF1ZXVlID0gbmV3IHNxcy5RdWV1ZSh0aGlzLCAnb3V0cHV0UXVldWUnLCB7XG4gICAgICBxdWV1ZU5hbWU6IG91dHB1dFF1ZXVlTmFtZSxcbiAgICAgIHZpc2liaWxpdHlUaW1lb3V0OiBEdXJhdGlvbi5zZWNvbmRzKDM2MDApLFxuICAgIH0pO1xuXG4gICAgb3V0cHV0UXVldWUuYWRkVG9SZXNvdXJjZVBvbGljeShcbiAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgZWZmZWN0OiBpYW0uRWZmZWN0LkRFTlksXG4gICAgICAgIHByaW5jaXBhbHM6IFtuZXcgaWFtLkFueVByaW5jaXBhbCgpXSxcbiAgICAgICAgYWN0aW9uczogWydzcXM6KiddLFxuICAgICAgICByZXNvdXJjZXM6IFtvdXRwdXRRdWV1ZS5xdWV1ZUFybl0sXG4gICAgICAgIGNvbmRpdGlvbnM6IHtcbiAgICAgICAgICBCb29sOiB7XG4gICAgICAgICAgICAnYXdzOlNlY3VyZVRyYW5zcG9ydCc6ICdmYWxzZScsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgICk7XG4gICAgdGhpcy5vdXRwdXRRdWV1ZSA9IG91dHB1dFF1ZXVlO1xuXG5cbiAgICBjb25zdCBkYnNlY3JldCA9IHNlY3JldHNtYW5hZ2VyLlNlY3JldC5mcm9tU2VjcmV0Q29tcGxldGVBcm4odGhpcywgJ2Ric2VjcmV0JywgcHJvcHMuZGF0YWJhc2VTZWNyZXRBUk4pO1xuICAgIGRic2VjcmV0LmdyYW50UmVhZChxdWVyeUdlbmVyYXRvckZ1bmN0aW9uKTtcbiAgICBkYnNlY3JldC5ncmFudFJlYWQocXVlcnlFeGVjdXRvckZ1bmN0aW9uKTtcblxuXG4gICAgY29uc3QgcmVmb3JtdWxhdGVRdWVzdGlvblN0YXRlID0gbmV3IHRhc2tzLkxhbWJkYUludm9rZShcbiAgICAgIHRoaXMsXG4gICAgICAncmVmb3JtdWxhdGVfcXVlc3Rpb24nLFxuICAgICAge1xuICAgICAgICBsYW1iZGFGdW5jdGlvbjogcmVmb3JtdWxhdGVRdWVzdGlvbkZ1bmN0aW9uLFxuICAgICAgICBpbnB1dFBhdGg6ICckLmRldGFpbCcsXG4gICAgICAgIHJlc3VsdFBhdGg6ICckLnF1ZXJ5Q29uZmlnJyxcbiAgICAgIH0sXG4gICAgKTtcblxuICAgIGNvbnN0IHJlZm9ybXVsYXRlZFF1ZXN0aW9uRmVlZGJhY2tTdGF0ZSA9IG5ldyB0YXNrcy5TcXNTZW5kTWVzc2FnZShcbiAgICAgIHRoaXMsXG4gICAgICAnZ2V0X2ZlZWRiYWNrX29uX3JlZm9ybXVsYXRlZF9xdWVzdGlvbicsXG4gICAgICB7XG4gICAgICAgIHF1ZXVlLFxuICAgICAgICBtZXNzYWdlQm9keTogc3RlcGZ1bmN0aW9ucy5UYXNrSW5wdXQuZnJvbU9iamVjdCh7XG4gICAgICAgICAgbWVzc2FnZTpcbiAgICAgICAgICAgICdGb2xsb3dpbmcgaXMgdGhlIHJlZm9ybXVsYXRlZCBxdWVzdGlvbi4gRG8geW91IGFncmVlIHdpdGggdGhlIG5ldyBxdWVzdGlvbj8nLFxuICAgICAgICAgIHJlZm9ybXVhbHRlZF9xdWVzdGlvbjogc3RlcGZ1bmN0aW9ucy5UYXNrSW5wdXQuZnJvbUpzb25QYXRoQXQoXG4gICAgICAgICAgICAnJC5yZWZvcm11bGF0ZWRfdXNlcl9xdWVzdGlvbicsXG4gICAgICAgICAgKSxcbiAgICAgICAgICB1c2VyX3F1ZXN0aW9uOlxuICAgICAgICAgICAgc3RlcGZ1bmN0aW9ucy5UYXNrSW5wdXQuZnJvbUpzb25QYXRoQXQoJyQudXNlcl9xdWVzdGlvbicpLFxuICAgICAgICAgIHF1ZXN0aW9uX3VuaXF1ZV9pZDogc3RlcGZ1bmN0aW9ucy5UYXNrSW5wdXQuZnJvbUpzb25QYXRoQXQoXG4gICAgICAgICAgICAnJC5xdWVzdGlvbl91bmlxdWVfaWQnLFxuICAgICAgICAgICksXG4gICAgICAgICAgZXhlY3V0ZV9zcWxfc3RyYXRlZ3k6IHN0ZXBmdW5jdGlvbnMuVGFza0lucHV0LmZyb21Kc29uUGF0aEF0KFxuICAgICAgICAgICAgJyQuZXhlY3V0ZV9zcWxfc3RyYXRlZ3knLFxuICAgICAgICAgICksXG4gICAgICAgICAgZXhlY3V0aW9uX3N0YXJ0X3RpbWU6IHN0ZXBmdW5jdGlvbnMuVGFza0lucHV0LmZyb21Kc29uUGF0aEF0KFxuICAgICAgICAgICAgJyQuZXhlY3V0aW9uX3N0YXJ0X3RpbWUnLFxuICAgICAgICAgICksXG4gICAgICAgICAgVGFza1Rva2VuOiBzdGVwZnVuY3Rpb25zLkpzb25QYXRoLnRhc2tUb2tlbixcbiAgICAgICAgfSksXG4gICAgICAgIGludGVncmF0aW9uUGF0dGVybjpcbiAgICAgICAgICBzdGVwZnVuY3Rpb25zLkludGVncmF0aW9uUGF0dGVybi5XQUlUX0ZPUl9UQVNLX1RPS0VOLFxuICAgICAgfSxcbiAgICApO1xuICAgIGNvbnN0IGFsdGVybmF0ZVF1ZXJ5R2VuZXJhdG9yU3RhdGUgPSBuZXcgdGFza3MuTGFtYmRhSW52b2tlKFxuICAgICAgdGhpcyxcbiAgICAgICdnZW5lcmF0ZV9hbHRlcm5hdGVfcXVlcnknLFxuICAgICAge1xuICAgICAgICBsYW1iZGFGdW5jdGlvbjogcXVlcnlHZW5lcmF0b3JGdW5jdGlvbixcbiAgICAgICAgcmVzdWx0UGF0aDogJyQucXVlcnlDb25maWcnLFxuICAgICAgfSxcbiAgICApO1xuXG4gICAgLy8gU0YgbG9nZ3JvdXBcbiAgICBjb25zdCBzZmxvZ0dyb3VwID0gbmV3IGxvZ3MuTG9nR3JvdXAodGhpcywgJ1RleHRUb1NxbFN0ZXBGdW5jdGlvbkxvZ0dyb3VwJywge1xuICAgICAgbG9nR3JvdXBOYW1lOiAnL2F3cy92ZW5kZWRsb2dzL3N0YXRlcy9UZXh0VG9TcWxTdGVwRnVuY3Rpb24nLFxuICAgICAgcmVtb3ZhbFBvbGljeTogY2RrLlJlbW92YWxQb2xpY3kuREVTVFJPWSxcbiAgICB9KTtcblxuXG4gICAgY29uc3QgYXV0b2NvcnJlY3RDaG9pY2VTdGF0ZSA9IG5ldyBzdGVwZnVuY3Rpb25zLkNob2ljZShcbiAgICAgIHRoaXMsXG4gICAgICAnaXNfYXV0b2NvcnJlY3RfcmVxdWlyZWQ/JyxcbiAgICAgIHtcbiAgICAgIH0sXG4gICAgKTtcblxuICAgIGNvbnN0IGNvbmZpZ3VyZUNvdW50U3RhdGUgPSBuZXcgc3RlcGZ1bmN0aW9ucy5QYXNzKFxuICAgICAgdGhpcyxcbiAgICAgICdjb25maWd1cmVfY291bnQnLFxuICAgICAge1xuICAgICAgICByZXN1bHQ6IHN0ZXBmdW5jdGlvbnMuUmVzdWx0LmZyb21PYmplY3Qoe1xuICAgICAgICAgIGNvdW50OiAzLFxuICAgICAgICAgIGluZGV4OiAwLFxuICAgICAgICAgIHN0ZXA6IDEsXG4gICAgICAgIH0pLFxuICAgICAgICByZXN1bHRQYXRoOiAnJC5pdGVyYXRvcicsXG4gICAgICB9LFxuICAgICk7XG5cbiAgICBjb25zdCBpdGVyYXRvclN0YXRlID0gbmV3IHRhc2tzLkxhbWJkYUludm9rZSh0aGlzLCAnaXRlcmF0b3InLCB7XG4gICAgICBsYW1iZGFGdW5jdGlvbjogYXV0b2NvcnJlY3RRdWVyeUZ1bmN0aW9uLFxuICAgICAgcmVzdWx0UGF0aDogJyQuaXRlcmF0b3InLFxuICAgIH0pO1xuXG4gICAgY29uc3QgaXNDb3VudFJlYWNoZWRTdGF0ZSA9IG5ldyBzdGVwZnVuY3Rpb25zLkNob2ljZShcbiAgICAgIHRoaXMsXG4gICAgICAnaXNfY291bnRfcmVhY2hlZCcsXG4gICAgICB7XG4gICAgICAgIC8vaW5wdXRQYXRoOiAnJC5pdGVyYXRvcicsXG4gICAgICB9LFxuICAgICk7XG5cbiAgICAvLyBjb25zdCBxdWVyeUdlbmVyYXRvclR3b1N0YXRlID0gbmV3IHRhc2tzLkxhbWJkYUludm9rZShcbiAgICAvLyAgIHRoaXMsXG4gICAgLy8gICAnZ2VuZXJhdGVfcXVlcnlfcGF0aF90d28nLFxuICAgIC8vICAge1xuICAgIC8vICAgICBsYW1iZGFGdW5jdGlvbjogcXVlcnlHZW5lcmF0b3JGdW5jdGlvbixcbiAgICAvLyAgICAgcmVzdWx0UGF0aDogJyQucXVlcnlDb25maWcnLFxuICAgIC8vICAgfSxcbiAgICAvLyApO1xuXG4gICAgY29uc3Qgb3V0cHV0U3RhdGUgPSBuZXcgdGFza3MuU3FzU2VuZE1lc3NhZ2UodGhpcywgJ3B1Ymxpc2hfcXVlcnlfcmVzdWx0Jywge1xuICAgICAgcXVldWU6IG91dHB1dFF1ZXVlLFxuICAgICAgbWVzc2FnZUJvZHk6IHN0ZXBmdW5jdGlvbnMuVGFza0lucHV0LmZyb21PYmplY3Qoe1xuICAgICAgICByZXN1bHQ6IHN0ZXBmdW5jdGlvbnMuVGFza0lucHV0LmZyb21Kc29uUGF0aEF0KFxuICAgICAgICAgICckLnF1ZXJ5Q29uZmlnLlBheWxvYWQucmVzdWx0JyxcbiAgICAgICAgKSxcbiAgICAgICAgdXNlcl9xdWVzdGlvbjpcbiAgICAgICAgICBzdGVwZnVuY3Rpb25zLlRhc2tJbnB1dC5mcm9tSnNvblBhdGhBdCgnJC51c2VyX3F1ZXN0aW9uJyksXG4gICAgICAgIHF1ZXN0aW9uX3VuaXF1ZV9pZDogc3RlcGZ1bmN0aW9ucy5UYXNrSW5wdXQuZnJvbUpzb25QYXRoQXQoXG4gICAgICAgICAgJyQucXVlc3Rpb25fdW5pcXVlX2lkJyxcbiAgICAgICAgKSxcbiAgICAgIH0pLFxuICAgIH0pO1xuXG4gICAgY29uc3QgYWx0ZXJuYXRlUXVlcnlDb3JyZWN0Q2hvaWNlU3RhdGUgPSBuZXcgc3RlcGZ1bmN0aW9ucy5DaG9pY2UoXG4gICAgICB0aGlzLFxuICAgICAgJ2lzX2FsdGVybmF0ZV9xdWVyeV9jb3JyZWN0PycsXG4gICAgICB7XG4gICAgICAgIC8vaW5wdXRQYXRoOiAnJC5xdWVyeUNvbmZpZy5QYXlsb2FkJyxcbiAgICAgIH0sXG4gICAgKTtcbiAgICBjb25zdCBhbHRlcm5hdGVRdWVyeUV4ZWN1dG9yU3RhdGUgPSBuZXcgdGFza3MuTGFtYmRhSW52b2tlKFxuICAgICAgdGhpcyxcbiAgICAgICdleGVjdXRlX2FsdGVybmF0ZV9xdWVyeScsXG4gICAgICB7XG4gICAgICAgIGxhbWJkYUZ1bmN0aW9uOiBxdWVyeUV4ZWN1dG9yRnVuY3Rpb24sXG4gICAgICAgIHJlc3VsdFBhdGg6ICckLnF1ZXJ5Q29uZmlnJyxcbiAgICAgIH0sXG4gICAgKS5uZXh0KFxuICAgICAgYWx0ZXJuYXRlUXVlcnlDb3JyZWN0Q2hvaWNlU3RhdGVcbiAgICAgICAgLndoZW4oXG4gICAgICAgICAgc3RlcGZ1bmN0aW9ucy5Db25kaXRpb24uc3RyaW5nRXF1YWxzKFxuICAgICAgICAgICAgJyQucXVlcnlDb25maWcuUGF5bG9hZC5zdGF0dXMnLFxuICAgICAgICAgICAgJ1FVRVJZX0VSUk9SJyxcbiAgICAgICAgICApLFxuICAgICAgICAgIGl0ZXJhdG9yU3RhdGUsXG4gICAgICAgIClcbiAgICAgICAgLm90aGVyd2lzZShvdXRwdXRTdGF0ZSksXG4gICAgKTtcblxuICAgIGNvbnN0IHF1ZXJ5RXhlY3V0b3JTdGF0ZSA9IG5ldyB0YXNrcy5MYW1iZGFJbnZva2UodGhpcywgJ2V4ZWN1dGVfcXVlcnknLCB7XG4gICAgICBsYW1iZGFGdW5jdGlvbjogcXVlcnlFeGVjdXRvckZ1bmN0aW9uLFxuICAgICAgcmVzdWx0UGF0aDogJyQucXVlcnlDb25maWcnLFxuICAgIH0pLm5leHQoXG4gICAgICBhdXRvY29ycmVjdENob2ljZVN0YXRlXG4gICAgICAgIC53aGVuKFxuICAgICAgICAgIHN0ZXBmdW5jdGlvbnMuQ29uZGl0aW9uLnN0cmluZ0VxdWFscyhcbiAgICAgICAgICAgICckLnF1ZXJ5Q29uZmlnLlBheWxvYWQuc3RhdHVzJyxcbiAgICAgICAgICAgICdRVUVSWV9FUlJPUicsXG4gICAgICAgICAgKSxcbiAgICAgICAgICBjb25maWd1cmVDb3VudFN0YXRlXG4gICAgICAgICAgICAubmV4dChpdGVyYXRvclN0YXRlKVxuICAgICAgICAgICAgLm5leHQoXG4gICAgICAgICAgICAgIGlzQ291bnRSZWFjaGVkU3RhdGVcbiAgICAgICAgICAgICAgICAud2hlbihcbiAgICAgICAgICAgICAgICAgIHN0ZXBmdW5jdGlvbnMuQ29uZGl0aW9uLmJvb2xlYW5FcXVhbHMoXG4gICAgICAgICAgICAgICAgICAgICckLml0ZXJhdG9yLlBheWxvYWQuY29udGludWUnLFxuICAgICAgICAgICAgICAgICAgICB0cnVlLFxuICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgIGFsdGVybmF0ZVF1ZXJ5R2VuZXJhdG9yU3RhdGUubmV4dChhbHRlcm5hdGVRdWVyeUV4ZWN1dG9yU3RhdGUpLFxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAub3RoZXJ3aXNlKG91dHB1dFN0YXRlKSxcbiAgICAgICAgICAgICksXG4gICAgICAgIClcbiAgICAgICAgLm90aGVyd2lzZShvdXRwdXRTdGF0ZSksXG4gICAgKTtcblxuICAgIGNvbnN0IGZlZWRiYWNrQ2hvaWNlU3RhdGVPbmUgPSBuZXcgc3RlcGZ1bmN0aW9ucy5DaG9pY2UoXG4gICAgICB0aGlzLFxuICAgICAgJ2lzX2ZlZWRiYWNrX3JlcV9vbl9yZWZvcm11YWx0ZWRfcXVlc3Rpb24/JyxcbiAgICAgIHtcbiAgICAgICAgaW5wdXRQYXRoOiAnJC5xdWVyeUNvbmZpZy5QYXlsb2FkJyxcbiAgICAgIH0sXG4gICAgKTtcbiAgICAvLyBjb25zdCBmZWVkYmFja0Nob2ljZVN0YXRlVHdvID0gbmV3IHN0ZXBmdW5jdGlvbnMuQ2hvaWNlKFxuICAgIC8vICAgdGhpcyxcbiAgICAvLyAgICdpc19mZWVkYmFja19yZXFfb25fZ2VuZXJhdGVkX3F1ZXJ5X3BhdGhfdHdvPycsXG4gICAgLy8gICB7fSxcbiAgICAvLyApO1xuXG4gICAgY29uc3QgZXhlY3V0ZVF1ZXJ5Q2hvaWNlU3RhdGUgPSBuZXcgc3RlcGZ1bmN0aW9ucy5DaG9pY2UoXG4gICAgICB0aGlzLFxuICAgICAgJ2lzX3F1ZXJ5X2V4ZWN1dGlvbl9yZXE/JyxcbiAgICAgIHt9LFxuICAgIClcbiAgICAgIC53aGVuKFxuICAgICAgICBzdGVwZnVuY3Rpb25zLkNvbmRpdGlvbi5zdHJpbmdFcXVhbHMoXG4gICAgICAgICAgJyQuZXhlY3V0ZV9zcWxfc3RyYXRlZ3knLFxuICAgICAgICAgICdkaXNhYmxlZCcsXG4gICAgICAgICksXG4gICAgICAgIG91dHB1dFN0YXRlLFxuICAgICAgKVxuICAgICAgLm90aGVyd2lzZShxdWVyeUV4ZWN1dG9yU3RhdGUpO1xuXG4gICAgY29uc3QgZ2VuZXJhdGVkUXVlcnlGZWVkYmFja1N0YXRlID0gbmV3IHRhc2tzLlNxc1NlbmRNZXNzYWdlKFxuICAgICAgdGhpcyxcbiAgICAgICdnZXRfZmVlZGJhY2tfb25fZ2VuZXJhdGVkX3F1ZXJ5JyxcbiAgICAgIHtcbiAgICAgICAgcXVldWUsXG4gICAgICAgIG1lc3NhZ2VCb2R5OiBzdGVwZnVuY3Rpb25zLlRhc2tJbnB1dC5mcm9tT2JqZWN0KHtcbiAgICAgICAgICBtZXNzYWdlOlxuICAgICAgICAgICAgJ0ZvbGxvd2luZyBpcyB0aGUgZ2VuZXJhdGVkIHF1ZXJ5LiBEbyB5b3UgYWdyZWUgd2l0aCBpdCBvciB3YW50IHRvIG92ZXJyaWRlPycsXG4gICAgICAgICAgZ2VuZXJhdGVkX3F1ZXJ5OiBzdGVwZnVuY3Rpb25zLkpzb25QYXRoLnN0cmluZ0F0KFxuICAgICAgICAgICAgJyQucXVlcnlDb25maWcuUGF5bG9hZC5yZXN1bHQnLFxuICAgICAgICAgICksXG4gICAgICAgICAgZXhlY3V0ZV9zcWxfc3RyYXRlZ3k6IHN0ZXBmdW5jdGlvbnMuVGFza0lucHV0LmZyb21Kc29uUGF0aEF0KFxuICAgICAgICAgICAgJyQuZXhlY3V0ZV9zcWxfc3RyYXRlZ3knLFxuICAgICAgICAgICksXG4gICAgICAgICAgZXhlY3V0aW9uX3N0YXJ0X3RpbWU6IHN0ZXBmdW5jdGlvbnMuVGFza0lucHV0LmZyb21Kc29uUGF0aEF0KFxuICAgICAgICAgICAgJyQuZXhlY3V0aW9uX3N0YXJ0X3RpbWUnLFxuICAgICAgICAgICksXG5cbiAgICAgICAgICByZWZvcm11YWx0ZWRfcXVlc3Rpb246IHN0ZXBmdW5jdGlvbnMuVGFza0lucHV0LmZyb21Kc29uUGF0aEF0KFxuICAgICAgICAgICAgJyQucmVmb3JtdWxhdGVkX3VzZXJfcXVlc3Rpb24nLFxuICAgICAgICAgICksXG4gICAgICAgICAgdXNlcl9xdWVzdGlvbjpcbiAgICAgICAgICAgIHN0ZXBmdW5jdGlvbnMuVGFza0lucHV0LmZyb21Kc29uUGF0aEF0KCckLnVzZXJfcXVlc3Rpb24nKSxcbiAgICAgICAgICBxdWVzdGlvbl91bmlxdWVfaWQ6IHN0ZXBmdW5jdGlvbnMuVGFza0lucHV0LmZyb21Kc29uUGF0aEF0KFxuICAgICAgICAgICAgJyQucXVlc3Rpb25fdW5pcXVlX2lkJyxcbiAgICAgICAgICApLFxuXG4gICAgICAgICAgVGFza1Rva2VuOiBzdGVwZnVuY3Rpb25zLkpzb25QYXRoLnRhc2tUb2tlbixcbiAgICAgICAgfSksXG4gICAgICAgIGludGVncmF0aW9uUGF0dGVybjpcbiAgICAgICAgICBzdGVwZnVuY3Rpb25zLkludGVncmF0aW9uUGF0dGVybi5XQUlUX0ZPUl9UQVNLX1RPS0VOLFxuICAgICAgfSxcbiAgICApLm5leHQoZXhlY3V0ZVF1ZXJ5Q2hvaWNlU3RhdGUpO1xuXG4gICAgY29uc3QgZ2VuZXJhdGVRdWVyeWZlZWRiYWNrQ2hvaWNlU3RhdGUgPSBuZXcgc3RlcGZ1bmN0aW9ucy5DaG9pY2UoXG4gICAgICB0aGlzLFxuICAgICAgJ2lzX2ZlZWRiYWNrX3JlcV9vbl9nZW5lcmF0ZWRfcXVlcnkgPycsXG4gICAgICB7fSxcbiAgICApXG4gICAgICAud2hlbihcbiAgICAgICAgc3RlcGZ1bmN0aW9ucy5Db25kaXRpb24uc3RyaW5nRXF1YWxzKFxuICAgICAgICAgICckLnF1ZXJ5Q29uZmlnLlBheWxvYWQuc3FsX3ZhbGlkYXRpb25fc3RyYXRlZ3knLFxuICAgICAgICAgICdodW1hbicsXG4gICAgICAgICksXG4gICAgICAgIGdlbmVyYXRlZFF1ZXJ5RmVlZGJhY2tTdGF0ZSxcbiAgICAgIClcbiAgICAgIC5vdGhlcndpc2UoZXhlY3V0ZVF1ZXJ5Q2hvaWNlU3RhdGUpO1xuXG4gICAgY29uc3QgcXVlcnlHZW5lcmF0b3JTdGF0ZSA9IG5ldyB0YXNrcy5MYW1iZGFJbnZva2UodGhpcywgJ2dlbmVyYXRlX3F1ZXJ5Jywge1xuICAgICAgbGFtYmRhRnVuY3Rpb246IHF1ZXJ5R2VuZXJhdG9yRnVuY3Rpb24sXG4gICAgICByZXN1bHRQYXRoOiAnJC5xdWVyeUNvbmZpZycsXG4gICAgfSkubmV4dChnZW5lcmF0ZVF1ZXJ5ZmVlZGJhY2tDaG9pY2VTdGF0ZSk7XG5cbiAgICAvLyBldmVudCBicmlkZ2VcbiAgICAvLyBDcmVhdGUgYW4gSUFNIHJvbGUgZm9yIEV2ZW50cyB0byBzdGFydCB0aGUgU3RhdGUgTWFjaGluZVxuICAgIGNvbnN0IGV2ZW50c1JvbGUgPSBuZXcgaWFtLlJvbGUodGhpcywgJ0V2ZW50c1J1bGVSb2xlJywge1xuICAgICAgYXNzdW1lZEJ5OiBuZXcgaWFtLlNlcnZpY2VQcmluY2lwYWwoJ2V2ZW50cy5hbWF6b25hd3MuY29tJyksXG4gICAgfSk7XG5cbiAgICBpZiAocHJvcHM/LmV4aXN0aW5nRXZlbnRCdXNJbnRlcmZhY2UpIHtcbiAgICAgIHRoaXMuZXZlbnRCdXMgPSBwcm9wcy5leGlzdGluZ0V2ZW50QnVzSW50ZXJmYWNlO1xuICAgIH0gZWxzZSBpZiAocHJvcHM/LmV2ZW50QnVzUHJvcHMpIHtcbiAgICAgIHRoaXMuZXZlbnRCdXMgPSBldmVudEJyaWRnZUhlbHBlci5idWlsZEV2ZW50QnVzKHRoaXMsIHtcbiAgICAgICAgZXZlbnRCdXNQcm9wczogcHJvcHMuZXZlbnRCdXNQcm9wcyxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmV2ZW50QnVzID0gbmV3IGV2ZW50cy5FdmVudEJ1cyhcbiAgICAgICAgdGhpcyxcbiAgICAgICAgJ3RleHRUb1NxbEJ1cycgKyBwcm9wcy5zdGFnZSxcbiAgICAgICAge1xuICAgICAgICAgIGV2ZW50QnVzTmFtZTogZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMihcbiAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICAndGV4dFRvU3FsJyArIHRoaXMuc3RhZ2UsXG4gICAgICAgICAgICB7IG1heExlbmd0aDogNjMsIGxvd2VyOiB0cnVlIH0sXG4gICAgICAgICAgKSxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdGhpcy5zdGVwRnVuY3Rpb24gPSBuZXcgc3RlcGZ1bmN0aW9ucy5TdGF0ZU1hY2hpbmUoXG4gICAgICB0aGlzLFxuICAgICAgJ3RleHRUb1NxbFN0ZXBGdW5jdGlvbicgKyBwcm9wcy5zdGFnZSxcbiAgICAgIHtcbiAgICAgICAgZGVmaW5pdGlvbjogcmVmb3JtdWxhdGVRdWVzdGlvblN0YXRlLm5leHQoXG4gICAgICAgICAgZmVlZGJhY2tDaG9pY2VTdGF0ZU9uZVxuICAgICAgICAgICAgLndoZW4oXG4gICAgICAgICAgICAgIHN0ZXBmdW5jdGlvbnMuQ29uZGl0aW9uLnN0cmluZ0VxdWFscyhcbiAgICAgICAgICAgICAgICAnJC5zZW1hbnRpY19sYXllcl9zdHJhdGVneScsXG4gICAgICAgICAgICAgICAgJ2h1bWFuJyxcbiAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgcmVmb3JtdWxhdGVkUXVlc3Rpb25GZWVkYmFja1N0YXRlLm5leHQocXVlcnlHZW5lcmF0b3JTdGF0ZSksXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAub3RoZXJ3aXNlKHF1ZXJ5R2VuZXJhdG9yU3RhdGUpLFxuICAgICAgICApLFxuICAgICAgICBsb2dzOiB7XG4gICAgICAgICAgZGVzdGluYXRpb246IHNmbG9nR3JvdXAsXG4gICAgICAgICAgbGV2ZWw6IHN0ZXBmdW5jdGlvbnMuTG9nTGV2ZWwuQUxMLFxuICAgICAgICB9LFxuICAgICAgICB0cmFjaW5nRW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgdGltZW91dDogRHVyYXRpb24uZGF5cyg5MCksXG5cbiAgICAgIH0sXG5cbiAgICApO1xuXG5cbiAgICB0aGlzLmV2ZW50c1J1bGUgPSBuZXcgZXZlbnRzLlJ1bGUodGhpcywgJ0V2ZW50c1J1bGUnLCB7XG4gICAgICBldmVudEJ1czogdGhpcy5ldmVudEJ1cyxcbiAgICAgIHRhcmdldHM6IFtuZXcgZXZlbnRzVGFyZ2V0LlNmblN0YXRlTWFjaGluZShcbiAgICAgICAgdGhpcy5zdGVwRnVuY3Rpb24sIHtcbiAgICAgICAgICByb2xlOiBldmVudHNSb2xlLFxuICAgICAgICB9LFxuICAgICAgKV0sXG4gICAgICBldmVudFBhdHRlcm46IHtcbiAgICAgICAgc291cmNlOiBbJ3dlYmNsaWVudCddLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHRoaXMuZXZlbnRCdXMuZ3JhbnRQdXRFdmVudHNUbyh0aGlzLnN0ZXBGdW5jdGlvbik7XG5cbiAgICAvLyBHcmFudCB0aGUgc3RhcnQgZXhlY3V0aW9uIHBlcm1pc3Npb24gdG8gdGhlIEV2ZW50cyBzZXJ2aWNlXG4gICAgdGhpcy5zdGVwRnVuY3Rpb24uZ3JhbnRTdGFydEV4ZWN1dGlvbihldmVudHNSb2xlKTtcbiAgfSAvLyBlbmQgY29uc3RydWN0XG5cblxufVxuIl19