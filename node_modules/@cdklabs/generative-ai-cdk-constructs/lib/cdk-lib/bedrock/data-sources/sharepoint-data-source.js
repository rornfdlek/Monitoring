"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.SharePointDataSource = exports.SharePointObjectType = exports.SharePointDataSourceAuthType = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_bedrock_1 = require("aws-cdk-lib/aws-bedrock");
const base_data_source_1 = require("./base-data-source");
const utils_1 = require("../../../common/helpers/utils");
/**
 * Represents the authentication types available for connecting to a SharePoint data source.
 */
var SharePointDataSourceAuthType;
(function (SharePointDataSourceAuthType) {
    /**
     * OAuth 2.0 Client Credentials flow for authentication with SharePoint.
     * Your secret authentication credentials in AWS Secrets Manager should include:
     * - `username`: The admin username for SharePoint authentication
     * - `password`: The admin password associated with the username
     * - `clientId`: The client ID (also known as application ID)
     * - `clientSecret`: The client secret
     */
    SharePointDataSourceAuthType["OAUTH2_CLIENT_CREDENTIALS"] = "OAUTH2_CLIENT_CREDENTIALS";
})(SharePointDataSourceAuthType || (exports.SharePointDataSourceAuthType = SharePointDataSourceAuthType = {}));
/**
 * Represents the SharePoint object types that can be accessed by the data source connector.
 */
var SharePointObjectType;
(function (SharePointObjectType) {
    /**
     * Represents a SharePoint page, which typically contains web parts and content.
     */
    SharePointObjectType["PAGE"] = "Page";
    /**
     * Represents a calendar event in SharePoint.
     */
    SharePointObjectType["EVENT"] = "Event";
    /**
     * Represents a file stored in SharePoint document libraries.
     */
    SharePointObjectType["FILE"] = "File";
})(SharePointObjectType || (exports.SharePointObjectType = SharePointObjectType = {}));
/**
 * Sets up an data source to be added to a knowledge base.
 */
class SharePointDataSource extends base_data_source_1.DataSourceNew {
    constructor(scope, id, props) {
        super(scope, id);
        // Assign attributes
        this.knowledgeBase = props.knowledgeBase;
        this.dataSourceType = base_data_source_1.DataSourceType.SHAREPOINT;
        this.dataSourceName = props.dataSourceName ?? (0, utils_1.generatePhysicalNameV2)(this, 'sharepoint-ds', { maxLength: 40, lower: true, separator: '-' });
        ;
        this.siteUrls = props.siteUrls;
        this.domain = props.domain;
        this.authSecret = props.authSecret;
        this.kmsKey = props.kmsKey;
        // ------------------------------------------------------
        // Manage permissions for the data source
        // ------------------------------------------------------
        this.handleCommonPermissions(props);
        this.authSecret.grantRead(this.knowledgeBase.role);
        // ------------------------------------------------------
        // L1 Instantiation
        // ------------------------------------------------------
        this.__resource = new aws_bedrock_1.CfnDataSource(this, 'DataSource', {
            ...this.formatAsCfnProps(props, {
                type: this.dataSourceType,
                sharePointConfiguration: {
                    sourceConfiguration: {
                        authType: SharePointDataSourceAuthType.OAUTH2_CLIENT_CREDENTIALS,
                        credentialsSecretArn: this.authSecret.secretArn,
                        hostType: 'ONLINE',
                        domain: props.domain,
                        siteUrls: this.siteUrls,
                        tenantId: props.tenantId,
                    },
                    crawlerConfiguration: (props.filters) ? ({
                        filterConfiguration: {
                            type: 'PATTERN',
                            patternObjectFilter: {
                                filters: props.filters?.map(item => ({
                                    objectType: item.objectType,
                                    inclusionFilters: item.includePatterns,
                                    exclusionFilters: item.excludePatterns,
                                })),
                            },
                        },
                    }) : undefined,
                },
            }),
        });
        this.dataSourceId = this.__resource.attrDataSourceId;
    }
}
exports.SharePointDataSource = SharePointDataSource;
_a = JSII_RTTI_SYMBOL_1;
SharePointDataSource[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.SharePointDataSource", version: "0.1.285" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hhcmVwb2ludC1kYXRhLXNvdXJjZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jZGstbGliL2JlZHJvY2svZGF0YS1zb3VyY2VzL3NoYXJlcG9pbnQtZGF0YS1zb3VyY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7R0FXRztBQUNILHlEQUF3RDtBQU14RCx5REFBK0Y7QUFDL0YseURBQXVFO0FBRXZFOztHQUVHO0FBQ0gsSUFBWSw0QkFVWDtBQVZELFdBQVksNEJBQTRCO0lBQ3RDOzs7Ozs7O09BT0c7SUFDSCx1RkFBdUQsQ0FBQTtBQUN6RCxDQUFDLEVBVlcsNEJBQTRCLDRDQUE1Qiw0QkFBNEIsUUFVdkM7QUFFRDs7R0FFRztBQUNILElBQVksb0JBZVg7QUFmRCxXQUFZLG9CQUFvQjtJQUM5Qjs7T0FFRztJQUNILHFDQUFhLENBQUE7SUFFYjs7T0FFRztJQUNILHVDQUFlLENBQUE7SUFFZjs7T0FFRztJQUNILHFDQUFhLENBQUE7QUFDZixDQUFDLEVBZlcsb0JBQW9CLG9DQUFwQixvQkFBb0IsUUFlL0I7QUF1RUQ7O0dBRUc7QUFDSCxNQUFhLG9CQUFxQixTQUFRLGdDQUFhO0lBaURyRCxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFFLEtBQWdDO1FBQ3hFLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDakIsb0JBQW9CO1FBQ3BCLElBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDLGFBQWEsQ0FBQztRQUN6QyxJQUFJLENBQUMsY0FBYyxHQUFHLGlDQUFjLENBQUMsVUFBVSxDQUFDO1FBQ2hELElBQUksQ0FBQyxjQUFjLEdBQUcsS0FBSyxDQUFDLGNBQWMsSUFBSSxJQUFBLDhCQUFzQixFQUFDLElBQUksRUFBRSxlQUFlLEVBQUUsRUFBRSxTQUFTLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFBQSxDQUFDO1FBQzdJLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQztRQUMvQixJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUM7UUFDM0IsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDO1FBQ25DLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztRQUUzQix5REFBeUQ7UUFDekQseUNBQXlDO1FBQ3pDLHlEQUF5RDtRQUN6RCxJQUFJLENBQUMsdUJBQXVCLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUVuRCx5REFBeUQ7UUFDekQsbUJBQW1CO1FBQ25CLHlEQUF5RDtRQUN6RCxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksMkJBQWEsQ0FBQyxJQUFJLEVBQUUsWUFBWSxFQUFFO1lBQ3RELEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUN0QixLQUFLLEVBQ0w7Z0JBQ0UsSUFBSSxFQUFFLElBQUksQ0FBQyxjQUFjO2dCQUN6Qix1QkFBdUIsRUFBRTtvQkFDdkIsbUJBQW1CLEVBQUU7d0JBQ25CLFFBQVEsRUFBRSw0QkFBNEIsQ0FBQyx5QkFBeUI7d0JBQ2hFLG9CQUFvQixFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUzt3QkFDL0MsUUFBUSxFQUFFLFFBQVE7d0JBQ2xCLE1BQU0sRUFBRSxLQUFLLENBQUMsTUFBTTt3QkFDcEIsUUFBUSxFQUFFLElBQUksQ0FBQyxRQUFRO3dCQUN2QixRQUFRLEVBQUUsS0FBSyxDQUFDLFFBQVE7cUJBQ3pCO29CQUNELG9CQUFvQixFQUNsQixDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDakIsbUJBQW1CLEVBQUU7NEJBQ25CLElBQUksRUFBRSxTQUFTOzRCQUNmLG1CQUFtQixFQUFFO2dDQUNuQixPQUFPLEVBQUUsS0FBSyxDQUFDLE9BQU8sRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO29DQUNuQyxVQUFVLEVBQUUsSUFBSSxDQUFDLFVBQVU7b0NBQzNCLGdCQUFnQixFQUFFLElBQUksQ0FBQyxlQUFlO29DQUN0QyxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsZUFBZTtpQ0FDdkMsQ0FBQyxDQUFDOzZCQUNKO3lCQUNGO3FCQUNGLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUztpQkFDakI7YUFDRixDQUNGO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDO0lBR3ZELENBQUM7O0FBeEdILG9EQXlHQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogIENvcHlyaWdodCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiAgd2l0aCB0aGUgTGljZW5zZS4gQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqICBvciBpbiB0aGUgJ2xpY2Vuc2UnIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICdBUyBJUycgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFU1xuICogIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXG4gKiAgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5pbXBvcnQgeyBDZm5EYXRhU291cmNlIH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWJlZHJvY2snO1xuaW1wb3J0IHsgSUtleSB9IGZyb20gJ2F3cy1jZGstbGliL2F3cy1rbXMnO1xuaW1wb3J0IHsgSVNlY3JldCB9IGZyb20gJ2F3cy1jZGstbGliL2F3cy1zZWNyZXRzbWFuYWdlcic7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcblxuaW1wb3J0IHsgSUtub3dsZWRnZUJhc2UgfSBmcm9tICcuLy4uL2tub3dsZWRnZS1iYXNlJztcbmltcG9ydCB7IERhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzLCBEYXRhU291cmNlTmV3LCBEYXRhU291cmNlVHlwZSB9IGZyb20gJy4vYmFzZS1kYXRhLXNvdXJjZSc7XG5pbXBvcnQgeyBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyIH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2hlbHBlcnMvdXRpbHMnO1xuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIGF1dGhlbnRpY2F0aW9uIHR5cGVzIGF2YWlsYWJsZSBmb3IgY29ubmVjdGluZyB0byBhIFNoYXJlUG9pbnQgZGF0YSBzb3VyY2UuXG4gKi9cbmV4cG9ydCBlbnVtIFNoYXJlUG9pbnREYXRhU291cmNlQXV0aFR5cGUge1xuICAvKipcbiAgICogT0F1dGggMi4wIENsaWVudCBDcmVkZW50aWFscyBmbG93IGZvciBhdXRoZW50aWNhdGlvbiB3aXRoIFNoYXJlUG9pbnQuXG4gICAqIFlvdXIgc2VjcmV0IGF1dGhlbnRpY2F0aW9uIGNyZWRlbnRpYWxzIGluIEFXUyBTZWNyZXRzIE1hbmFnZXIgc2hvdWxkIGluY2x1ZGU6XG4gICAqIC0gYHVzZXJuYW1lYDogVGhlIGFkbWluIHVzZXJuYW1lIGZvciBTaGFyZVBvaW50IGF1dGhlbnRpY2F0aW9uXG4gICAqIC0gYHBhc3N3b3JkYDogVGhlIGFkbWluIHBhc3N3b3JkIGFzc29jaWF0ZWQgd2l0aCB0aGUgdXNlcm5hbWVcbiAgICogLSBgY2xpZW50SWRgOiBUaGUgY2xpZW50IElEIChhbHNvIGtub3duIGFzIGFwcGxpY2F0aW9uIElEKVxuICAgKiAtIGBjbGllbnRTZWNyZXRgOiBUaGUgY2xpZW50IHNlY3JldFxuICAgKi9cbiAgT0FVVEgyX0NMSUVOVF9DUkVERU5USUFMUyA9ICdPQVVUSDJfQ0xJRU5UX0NSRURFTlRJQUxTJ1xufVxuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIFNoYXJlUG9pbnQgb2JqZWN0IHR5cGVzIHRoYXQgY2FuIGJlIGFjY2Vzc2VkIGJ5IHRoZSBkYXRhIHNvdXJjZSBjb25uZWN0b3IuXG4gKi9cbmV4cG9ydCBlbnVtIFNoYXJlUG9pbnRPYmplY3RUeXBlIHtcbiAgLyoqXG4gICAqIFJlcHJlc2VudHMgYSBTaGFyZVBvaW50IHBhZ2UsIHdoaWNoIHR5cGljYWxseSBjb250YWlucyB3ZWIgcGFydHMgYW5kIGNvbnRlbnQuXG4gICAqL1xuICBQQUdFID0gJ1BhZ2UnLFxuXG4gIC8qKlxuICAgKiBSZXByZXNlbnRzIGEgY2FsZW5kYXIgZXZlbnQgaW4gU2hhcmVQb2ludC5cbiAgICovXG4gIEVWRU5UID0gJ0V2ZW50JyxcblxuICAvKipcbiAgICogUmVwcmVzZW50cyBhIGZpbGUgc3RvcmVkIGluIFNoYXJlUG9pbnQgZG9jdW1lbnQgbGlicmFyaWVzLlxuICAgKi9cbiAgRklMRSA9ICdGaWxlJyxcbn1cblxuLyoqXG4gKiBEZWZpbmVzIHRoZSBjcmF3bGluZyBmaWx0ZXJzIGZvciBTaGFyZVBvaW50IGRhdGEgaW5nZXN0aW9uLiBUaGVzZSBmaWx0ZXJzIGFsbG93XG4gKiB5b3UgdG8gc3BlY2lmeSB3aGljaCBjb250ZW50IHNob3VsZCBiZSBpbmNsdWRlZCBvciBleGNsdWRlZCBkdXJpbmcgdGhlIGNyYXdsaW5nIHByb2Nlc3MuXG4gKiBJZiB5b3Ugc3BlY2lmeSBhbiBpbmNsdXNpb24gYW5kIGV4Y2x1c2lvbiBmaWx0ZXIgYW5kIGJvdGggbWF0Y2ggYSBkb2N1bWVudCxcbiAqIHRoZSBleGNsdXNpb24gZmlsdGVyIHRha2VzIHByZWNlZGVuY2UgYW5kIHRoZSBkb2N1bWVudCBpc27igJl0IGNyYXdsZWQuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgU2hhcmVQb2ludENyYXdsaW5nRmlsdGVycyB7XG4gIC8qKlxuICAgKiBUaGUgU2hhcmVQb2ludCBvYmplY3QgdHlwZSB0aGlzIGZpbHRlciBhcHBsaWVzIHRvLlxuICAgKi9cbiAgcmVhZG9ubHkgb2JqZWN0VHlwZTogU2hhcmVQb2ludE9iamVjdFR5cGU7XG4gIC8qKlxuICAgKiBPcHRpb25hbCBhcnJheSBvZiByZWd1bGFyIGV4cHJlc3Npb24gcGF0dGVybnMgdG8gaW5jbHVkZSBzcGVjaWZpYyBjb250ZW50LlxuICAgKiBPbmx5IGNvbnRlbnQgbWF0Y2hpbmcgdGhlc2UgcGF0dGVybnMgd2lsbCBiZSBjcmF3bGVkLlxuICAgKiBAZXhhbXBsZSBbJy4qcHVibGljLionLCAnLipzaGFyZWQuKiddXG4gICAqL1xuICByZWFkb25seSBpbmNsdWRlUGF0dGVybnM/OiBzdHJpbmdbXTtcbiAgLyoqXG4gICAqIE9wdGlvbmFsIGFycmF5IG9mIHJlZ3VsYXIgZXhwcmVzc2lvbiBwYXR0ZXJucyB0byBleGNsdWRlIHNwZWNpZmljIGNvbnRlbnQuXG4gICAqIENvbnRlbnQgbWF0Y2hpbmcgdGhlc2UgcGF0dGVybnMgd2lsbCBiZSBza2lwcGVkIGR1cmluZyBjcmF3bGluZy5cbiAgICogQGV4YW1wbGUgWycuKnByaXZhdGUuKicsICcuKmNvbmZpZGVudGlhbC4qJ11cbiAgICovXG4gIHJlYWRvbmx5IGV4Y2x1ZGVQYXR0ZXJucz86IHN0cmluZ1tdO1xufVxuXG4vKipcbiAqIEludGVyZmFjZSB0byBhZGQgYSBuZXcgZGF0YSBzb3VyY2UgdG8gYW4gZXhpc3RpbmcgS0JcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTaGFyZVBvaW50RGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMgZXh0ZW5kcyBEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyB7XG4gIC8qKlxuICAgKiBUaGUgZG9tYWluIG9mIHlvdXIgU2hhcmVQb2ludCBpbnN0YW5jZSBvciBzaXRlIFVSTC9VUkxzLlxuICAgKiBAZXhhbXBsZSBcInlvdXJkb21haW5cIlxuICAgKi9cbiAgcmVhZG9ubHkgZG9tYWluOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgU2hhcmVQb2ludCBzaXRlIFVSTC9VUkxzLlxuICAgKiBNdXN0IHN0YXJ0IHdpdGgg4oCcaHR0cHPigJ0uIEFsbCBVUkxzIG11c3Qgc3RhcnQgd2l0aCBzYW1lIHByb3RvY29sLlxuICAgKiBAZXhhbXBsZSBbXCJodHRwczovL3lvdXJkb21haW4uc2hhcmVwb2ludC5jb20vc2l0ZXMvbXlzaXRlXCJdXG4gICAqL1xuICByZWFkb25seSBzaXRlVXJsczogc3RyaW5nW107XG4gIC8qKlxuICAgKiBUaGUgaWRlbnRpZmllciBvZiB5b3VyIE1pY3Jvc29mdCAzNjUgdGVuYW50LlxuICAgKiBAZXhhbXBsZSBcImQxYzAzNWE2LTFkY2YtNDU3ZC05N2UzXCJcbiAgICovXG4gIHJlYWRvbmx5IHRlbmFudElkOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgQVdTIFNlY3JldHMgTWFuYWdlciBzZWNyZXQgdGhhdCBzdG9yZXMgeW91ciBhdXRoZW50aWNhdGlvbiBjcmVkZW50aWFsc1xuICAgKiBmb3IgeW91ciBTaGFyZXBvaW50IGluc3RhbmNlIFVSTC4gU2VjcmV0IG11c3Qgc3RhcnQgd2l0aCBcIkFtYXpvbkJlZHJvY2stXCIuXG4gICAqL1xuICByZWFkb25seSBhdXRoU2VjcmV0OiBJU2VjcmV0O1xuICAvKipcbiAgICogVGhlIGZpbHRlcnMgKHJlZ3VsYXIgZXhwcmVzc2lvbiBwYXR0ZXJucykgZm9yIHRoZSBjcmF3bGluZy5cbiAgICogSWYgdGhlcmUncyBhIGNvbmZsaWN0LCB0aGUgZXhjbHVkZSBwYXR0ZXJuIHRha2VzIHByZWNlZGVuY2UuXG4gICAqIEBkZWZhdWx0IE5vbmUgLSBhbGwgeW91ciBjb250ZW50IGlzIGNyYXdsZWQuXG4gICAqL1xuICByZWFkb25seSBmaWx0ZXJzPzogU2hhcmVQb2ludENyYXdsaW5nRmlsdGVyc1tdO1xuXG59XG5cbi8qKlxuICogSW50ZXJmYWNlIHRvIGNyZWF0ZSBhIG5ldyBzdGFuZGFsb25lIGRhdGEgc291cmNlIG9iamVjdFxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNoYXJlUG9pbnREYXRhU291cmNlUHJvcHMgZXh0ZW5kcyBTaGFyZVBvaW50RGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMge1xuICAvKipcbiAgICogVGhlIGtub3dsZWRnZSBiYXNlIHRvIGFzc29jaWF0ZSB3aXRoIHRoZSBkYXRhIHNvdXJjZS5cbiAgICovXG4gIHJlYWRvbmx5IGtub3dsZWRnZUJhc2U6IElLbm93bGVkZ2VCYXNlO1xufVxuXG4vKipcbiAqIFNldHMgdXAgYW4gZGF0YSBzb3VyY2UgdG8gYmUgYWRkZWQgdG8gYSBrbm93bGVkZ2UgYmFzZS5cbiAqL1xuZXhwb3J0IGNsYXNzIFNoYXJlUG9pbnREYXRhU291cmNlIGV4dGVuZHMgRGF0YVNvdXJjZU5ldyB7XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBDb21tb24gYXR0cmlidXRlcyBmb3IgYWxsIG5ldyBkYXRhIHNvdXJjZXNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBUaGUgdW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIGRhdGEgc291cmNlLlxuICAgKiBAZXhhbXBsZSAnSkhVRVZYVVpNVSdcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBkYXRhU291cmNlSWQ6IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSB0eXBlIG9mIGRhdGEgc291cmNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGRhdGFTb3VyY2VUeXBlOiBEYXRhU291cmNlVHlwZTtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBkYXRhIHNvdXJjZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBkYXRhU291cmNlTmFtZTogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIGtub3dsZWRnZSBiYXNlIGFzc29jaWF0ZWQgd2l0aCB0aGUgZGF0YSBzb3VyY2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkga25vd2xlZGdlQmFzZTogSUtub3dsZWRnZUJhc2U7XG4gIC8qKlxuICAgKiBUaGUgS01TIGtleSB0byB1c2UgdG8gZW5jcnlwdCB0aGUgZGF0YSBzb3VyY2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkga21zS2V5PzogSUtleTtcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIFVuaXF1ZSB0byB0aGlzIGNsYXNzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogVGhlIGRvbWFpbiBuYW1lIG9mIHlvdXIgU2hhcmVQb2ludCBpbnN0YW5jZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBkb21haW46IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBBV1MgU2VjcmV0cyBNYW5hZ2VyIHNlY3JldCB0aGF0IHN0b3JlcyB5b3VyIGF1dGhlbnRpY2F0aW9uIGNyZWRlbnRpYWxzLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGF1dGhTZWNyZXQ6IElTZWNyZXQ7XG4gIC8qKlxuICAgKiBUaGUgU2hhcmVQb2ludCBzaXRlIFVSTC9VUkxzLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHNpdGVVcmxzOiBzdHJpbmdbXTtcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEludGVybmFsIE9ubHlcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBUaGUgRGF0YSBTb3VyY2UgY2ZuIHJlc291cmNlLlxuICAgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBfX3Jlc291cmNlOiBDZm5EYXRhU291cmNlO1xuXG5cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IFNoYXJlUG9pbnREYXRhU291cmNlUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuICAgIC8vIEFzc2lnbiBhdHRyaWJ1dGVzXG4gICAgdGhpcy5rbm93bGVkZ2VCYXNlID0gcHJvcHMua25vd2xlZGdlQmFzZTtcbiAgICB0aGlzLmRhdGFTb3VyY2VUeXBlID0gRGF0YVNvdXJjZVR5cGUuU0hBUkVQT0lOVDtcbiAgICB0aGlzLmRhdGFTb3VyY2VOYW1lID0gcHJvcHMuZGF0YVNvdXJjZU5hbWUgPz8gZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMih0aGlzLCAnc2hhcmVwb2ludC1kcycsIHsgbWF4TGVuZ3RoOiA0MCwgbG93ZXI6IHRydWUsIHNlcGFyYXRvcjogJy0nIH0pOztcbiAgICB0aGlzLnNpdGVVcmxzID0gcHJvcHMuc2l0ZVVybHM7XG4gICAgdGhpcy5kb21haW4gPSBwcm9wcy5kb21haW47XG4gICAgdGhpcy5hdXRoU2VjcmV0ID0gcHJvcHMuYXV0aFNlY3JldDtcbiAgICB0aGlzLmttc0tleSA9IHByb3BzLmttc0tleTtcblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIE1hbmFnZSBwZXJtaXNzaW9ucyBmb3IgdGhlIGRhdGEgc291cmNlXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5oYW5kbGVDb21tb25QZXJtaXNzaW9ucyhwcm9wcyk7XG4gICAgdGhpcy5hdXRoU2VjcmV0LmdyYW50UmVhZCh0aGlzLmtub3dsZWRnZUJhc2Uucm9sZSk7XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBMMSBJbnN0YW50aWF0aW9uXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5fX3Jlc291cmNlID0gbmV3IENmbkRhdGFTb3VyY2UodGhpcywgJ0RhdGFTb3VyY2UnLCB7XG4gICAgICAuLi50aGlzLmZvcm1hdEFzQ2ZuUHJvcHMoXG4gICAgICAgIHByb3BzLFxuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogdGhpcy5kYXRhU291cmNlVHlwZSxcbiAgICAgICAgICBzaGFyZVBvaW50Q29uZmlndXJhdGlvbjoge1xuICAgICAgICAgICAgc291cmNlQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgICAgICBhdXRoVHlwZTogU2hhcmVQb2ludERhdGFTb3VyY2VBdXRoVHlwZS5PQVVUSDJfQ0xJRU5UX0NSRURFTlRJQUxTLFxuICAgICAgICAgICAgICBjcmVkZW50aWFsc1NlY3JldEFybjogdGhpcy5hdXRoU2VjcmV0LnNlY3JldEFybixcbiAgICAgICAgICAgICAgaG9zdFR5cGU6ICdPTkxJTkUnLFxuICAgICAgICAgICAgICBkb21haW46IHByb3BzLmRvbWFpbixcbiAgICAgICAgICAgICAgc2l0ZVVybHM6IHRoaXMuc2l0ZVVybHMsXG4gICAgICAgICAgICAgIHRlbmFudElkOiBwcm9wcy50ZW5hbnRJZCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjcmF3bGVyQ29uZmlndXJhdGlvbjpcbiAgICAgICAgICAgICAgKHByb3BzLmZpbHRlcnMpID8gKHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiAnUEFUVEVSTicsXG4gICAgICAgICAgICAgICAgICBwYXR0ZXJuT2JqZWN0RmlsdGVyOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcnM6IHByb3BzLmZpbHRlcnM/Lm1hcChpdGVtID0+ICh7XG4gICAgICAgICAgICAgICAgICAgICAgb2JqZWN0VHlwZTogaXRlbS5vYmplY3RUeXBlLFxuICAgICAgICAgICAgICAgICAgICAgIGluY2x1c2lvbkZpbHRlcnM6IGl0ZW0uaW5jbHVkZVBhdHRlcm5zLFxuICAgICAgICAgICAgICAgICAgICAgIGV4Y2x1c2lvbkZpbHRlcnM6IGl0ZW0uZXhjbHVkZVBhdHRlcm5zLFxuICAgICAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0pIDogdW5kZWZpbmVkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICApLFxuICAgIH0pO1xuXG4gICAgdGhpcy5kYXRhU291cmNlSWQgPSB0aGlzLl9fcmVzb3VyY2UuYXR0ckRhdGFTb3VyY2VJZDtcblxuXG4gIH1cbn0iXX0=