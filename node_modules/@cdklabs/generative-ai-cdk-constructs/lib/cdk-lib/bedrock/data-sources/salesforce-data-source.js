"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.SalesforceDataSource = exports.SalesforceObjectType = exports.SalesforceDataSourceAuthType = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_bedrock_1 = require("aws-cdk-lib/aws-bedrock");
const base_data_source_1 = require("./base-data-source");
const utils_1 = require("../../../common/helpers/utils");
/**
 * Represents the authentication types available for connecting to a Salesforce data source.
 */
var SalesforceDataSourceAuthType;
(function (SalesforceDataSourceAuthType) {
    /**
     * Your secret authentication credentials in AWS Secrets Manager should include:
     * - `consumerKey` (app client ID)
     * - `consumerSecret` (client secret)
     * - `authenticationUrl`
     */
    SalesforceDataSourceAuthType["OAUTH2_CLIENT_CREDENTIALS"] = "OAUTH2_CLIENT_CREDENTIALS";
})(SalesforceDataSourceAuthType || (exports.SalesforceDataSourceAuthType = SalesforceDataSourceAuthType = {}));
/**
 * Represents the Salesforce object types that can be accessed by the data source connector.
 */
var SalesforceObjectType;
(function (SalesforceObjectType) {
    SalesforceObjectType["ACCOUNT"] = "Account";
    SalesforceObjectType["ATTACHMENT"] = "Attachment";
    SalesforceObjectType["CAMPAIGN"] = "Campaign";
    SalesforceObjectType["CONTENT_VERSION"] = "ContentVersion";
    SalesforceObjectType["PARTNER"] = "Partner";
    SalesforceObjectType["PRICEBOOK_2"] = "Pricebook2";
    SalesforceObjectType["CASE"] = "Case";
    SalesforceObjectType["CONTACT"] = "Contact";
    SalesforceObjectType["CONTRACT"] = "Contract";
    SalesforceObjectType["DOCUMENT"] = "Document";
    SalesforceObjectType["IDEA"] = "Idea";
    SalesforceObjectType["LEAD"] = "Lead";
    SalesforceObjectType["OPPORTUNITY"] = "Opportunity";
    SalesforceObjectType["PRODUCT_2"] = "Product2";
    SalesforceObjectType["SOLUTION"] = "Solution";
    SalesforceObjectType["TASK"] = "Task";
    SalesforceObjectType["FEED_ITEM"] = "FeedItem";
    SalesforceObjectType["FEED_COMMENT"] = "FeedComment";
    SalesforceObjectType["KNOWLEDGE_KAV"] = "Knowledge__kav";
    SalesforceObjectType["USER"] = "User";
    SalesforceObjectType["COLLABORATION_GROUP"] = "CollaborationGroup";
})(SalesforceObjectType || (exports.SalesforceObjectType = SalesforceObjectType = {}));
/**
 * Sets up an data source to be added to a knowledge base.
 */
class SalesforceDataSource extends base_data_source_1.DataSourceNew {
    constructor(scope, id, props) {
        super(scope, id);
        // Assign attributes
        this.knowledgeBase = props.knowledgeBase;
        this.dataSourceType = base_data_source_1.DataSourceType.SALESFORCE;
        this.dataSourceName = props.dataSourceName ?? (0, utils_1.generatePhysicalNameV2)(this, 'sfdc-ds', { maxLength: 40, lower: true, separator: '-' });
        ;
        this.endpoint = props.endpoint;
        this.authSecret = props.authSecret;
        this.kmsKey = props.kmsKey;
        // ------------------------------------------------------
        // Manage permissions for the data source
        // ------------------------------------------------------
        this.handleCommonPermissions(props);
        this.authSecret.grantRead(this.knowledgeBase.role);
        // ------------------------------------------------------
        // ------------------------------------------------------
        // L1 Instantiation
        // ------------------------------------------------------
        this.__resource = new aws_bedrock_1.CfnDataSource(this, 'DataSource', {
            ...this.formatAsCfnProps(props, {
                type: this.dataSourceType,
                salesforceConfiguration: {
                    sourceConfiguration: {
                        authType: SalesforceDataSourceAuthType.OAUTH2_CLIENT_CREDENTIALS,
                        credentialsSecretArn: this.authSecret.secretArn,
                        hostUrl: this.endpoint,
                    },
                    crawlerConfiguration: (props.filters) ? ({
                        filterConfiguration: {
                            type: 'PATTERN',
                            patternObjectFilter: {
                                filters: props.filters?.map(item => ({
                                    objectType: item.objectType,
                                    inclusionFilters: item.includePatterns,
                                    exclusionFilters: item.excludePatterns,
                                })),
                            },
                        },
                    }) : undefined,
                },
            }),
        });
        this.dataSourceId = this.__resource.attrDataSourceId;
    }
}
exports.SalesforceDataSource = SalesforceDataSource;
_a = JSII_RTTI_SYMBOL_1;
SalesforceDataSource[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.SalesforceDataSource", version: "0.1.285" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2FsZXNmb3JjZS1kYXRhLXNvdXJjZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jZGstbGliL2JlZHJvY2svZGF0YS1zb3VyY2VzL3NhbGVzZm9yY2UtZGF0YS1zb3VyY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7R0FXRztBQUVILHlEQUF3RDtBQU14RCx5REFBK0Y7QUFDL0YseURBQXVFO0FBR3ZFOztHQUVHO0FBQ0gsSUFBWSw0QkFRWDtBQVJELFdBQVksNEJBQTRCO0lBQ3RDOzs7OztPQUtHO0lBQ0gsdUZBQXVELENBQUE7QUFDekQsQ0FBQyxFQVJXLDRCQUE0Qiw0Q0FBNUIsNEJBQTRCLFFBUXZDO0FBRUQ7O0dBRUc7QUFDSCxJQUFZLG9CQXNCWDtBQXRCRCxXQUFZLG9CQUFvQjtJQUM5QiwyQ0FBbUIsQ0FBQTtJQUNuQixpREFBeUIsQ0FBQTtJQUN6Qiw2Q0FBcUIsQ0FBQTtJQUNyQiwwREFBa0MsQ0FBQTtJQUNsQywyQ0FBbUIsQ0FBQTtJQUNuQixrREFBMEIsQ0FBQTtJQUMxQixxQ0FBYSxDQUFBO0lBQ2IsMkNBQW1CLENBQUE7SUFDbkIsNkNBQXFCLENBQUE7SUFDckIsNkNBQXFCLENBQUE7SUFDckIscUNBQWEsQ0FBQTtJQUNiLHFDQUFhLENBQUE7SUFDYixtREFBMkIsQ0FBQTtJQUMzQiw4Q0FBc0IsQ0FBQTtJQUN0Qiw2Q0FBcUIsQ0FBQTtJQUNyQixxQ0FBYSxDQUFBO0lBQ2IsOENBQXNCLENBQUE7SUFDdEIsb0RBQTRCLENBQUE7SUFDNUIsd0RBQWdDLENBQUE7SUFDaEMscUNBQWEsQ0FBQTtJQUNiLGtFQUEwQyxDQUFBO0FBQzVDLENBQUMsRUF0Qlcsb0JBQW9CLG9DQUFwQixvQkFBb0IsUUFzQi9CO0FBcUREOztHQUVHO0FBQ0gsTUFBYSxvQkFBcUIsU0FBUSxnQ0FBYTtJQTZDckQsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUFnQztRQUN4RSxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ2pCLG9CQUFvQjtRQUNwQixJQUFJLENBQUMsYUFBYSxHQUFHLEtBQUssQ0FBQyxhQUFhLENBQUM7UUFDekMsSUFBSSxDQUFDLGNBQWMsR0FBRyxpQ0FBYyxDQUFDLFVBQVUsQ0FBQztRQUNoRCxJQUFJLENBQUMsY0FBYyxHQUFHLEtBQUssQ0FBQyxjQUFjLElBQUksSUFBQSw4QkFBc0IsRUFBQyxJQUFJLEVBQUUsU0FBUyxFQUFFLEVBQUUsU0FBUyxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQUEsQ0FBQztRQUN2SSxJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUM7UUFDL0IsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDO1FBQ25DLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztRQUUzQix5REFBeUQ7UUFDekQseUNBQXlDO1FBQ3pDLHlEQUF5RDtRQUN6RCxJQUFJLENBQUMsdUJBQXVCLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDcEMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUVuRCx5REFBeUQ7UUFFekQseURBQXlEO1FBQ3pELG1CQUFtQjtRQUNuQix5REFBeUQ7UUFDekQsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLDJCQUFhLENBQUMsSUFBSSxFQUFFLFlBQVksRUFBRTtZQUN0RCxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FDdEIsS0FBSyxFQUNMO2dCQUNFLElBQUksRUFBRSxJQUFJLENBQUMsY0FBYztnQkFDekIsdUJBQXVCLEVBQUU7b0JBQ3ZCLG1CQUFtQixFQUFFO3dCQUNuQixRQUFRLEVBQUUsNEJBQTRCLENBQUMseUJBQXlCO3dCQUNoRSxvQkFBb0IsRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLFNBQVM7d0JBQy9DLE9BQU8sRUFBRSxJQUFJLENBQUMsUUFBUTtxQkFDdkI7b0JBQ0Qsb0JBQW9CLEVBQ2xCLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNqQixtQkFBbUIsRUFBRTs0QkFDbkIsSUFBSSxFQUFFLFNBQVM7NEJBQ2YsbUJBQW1CLEVBQUU7Z0NBQ25CLE9BQU8sRUFBRSxLQUFLLENBQUMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7b0NBQ25DLFVBQVUsRUFBRSxJQUFJLENBQUMsVUFBVTtvQ0FDM0IsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLGVBQWU7b0NBQ3RDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxlQUFlO2lDQUN2QyxDQUFDLENBQUM7NkJBQ0o7eUJBQ0Y7cUJBQ0YsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTO2lCQUNqQjthQUNGLENBQ0Y7U0FDRixDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsZ0JBQWdCLENBQUM7SUFHdkQsQ0FBQzs7QUFsR0gsb0RBbUdDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiAgQ29weXJpZ2h0IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqICB3aXRoIHRoZSBMaWNlbnNlLiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICpcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogIG9yIGluIHRoZSAnbGljZW5zZScgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWQgb24gYW4gJ0FTIElTJyBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTXG4gKiAgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnNcbiAqICBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQ2ZuRGF0YVNvdXJjZSB9IGZyb20gJ2F3cy1jZGstbGliL2F3cy1iZWRyb2NrJztcbmltcG9ydCB7IElLZXkgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3Mta21zJztcbmltcG9ydCB7IElTZWNyZXQgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3Mtc2VjcmV0c21hbmFnZXInO1xuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XG5cbmltcG9ydCB7IElLbm93bGVkZ2VCYXNlIH0gZnJvbSAnLi8uLi9rbm93bGVkZ2UtYmFzZSc7XG5pbXBvcnQgeyBEYXRhU291cmNlTmV3LCBEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcywgRGF0YVNvdXJjZVR5cGUgfSBmcm9tICcuL2Jhc2UtZGF0YS1zb3VyY2UnO1xuaW1wb3J0IHsgZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMiB9IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9oZWxwZXJzL3V0aWxzJztcblxuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIGF1dGhlbnRpY2F0aW9uIHR5cGVzIGF2YWlsYWJsZSBmb3IgY29ubmVjdGluZyB0byBhIFNhbGVzZm9yY2UgZGF0YSBzb3VyY2UuXG4gKi9cbmV4cG9ydCBlbnVtIFNhbGVzZm9yY2VEYXRhU291cmNlQXV0aFR5cGUge1xuICAvKipcbiAgICogWW91ciBzZWNyZXQgYXV0aGVudGljYXRpb24gY3JlZGVudGlhbHMgaW4gQVdTIFNlY3JldHMgTWFuYWdlciBzaG91bGQgaW5jbHVkZTpcbiAgICogLSBgY29uc3VtZXJLZXlgIChhcHAgY2xpZW50IElEKVxuICAgKiAtIGBjb25zdW1lclNlY3JldGAgKGNsaWVudCBzZWNyZXQpXG4gICAqIC0gYGF1dGhlbnRpY2F0aW9uVXJsYFxuICAgKi9cbiAgT0FVVEgyX0NMSUVOVF9DUkVERU5USUFMUyA9ICdPQVVUSDJfQ0xJRU5UX0NSRURFTlRJQUxTJ1xufVxuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIFNhbGVzZm9yY2Ugb2JqZWN0IHR5cGVzIHRoYXQgY2FuIGJlIGFjY2Vzc2VkIGJ5IHRoZSBkYXRhIHNvdXJjZSBjb25uZWN0b3IuXG4gKi9cbmV4cG9ydCBlbnVtIFNhbGVzZm9yY2VPYmplY3RUeXBlIHtcbiAgQUNDT1VOVCA9ICdBY2NvdW50JyxcbiAgQVRUQUNITUVOVCA9ICdBdHRhY2htZW50JyxcbiAgQ0FNUEFJR04gPSAnQ2FtcGFpZ24nLFxuICBDT05URU5UX1ZFUlNJT04gPSAnQ29udGVudFZlcnNpb24nLFxuICBQQVJUTkVSID0gJ1BhcnRuZXInLFxuICBQUklDRUJPT0tfMiA9ICdQcmljZWJvb2syJyxcbiAgQ0FTRSA9ICdDYXNlJyxcbiAgQ09OVEFDVCA9ICdDb250YWN0JyxcbiAgQ09OVFJBQ1QgPSAnQ29udHJhY3QnLFxuICBET0NVTUVOVCA9ICdEb2N1bWVudCcsXG4gIElERUEgPSAnSWRlYScsXG4gIExFQUQgPSAnTGVhZCcsXG4gIE9QUE9SVFVOSVRZID0gJ09wcG9ydHVuaXR5JyxcbiAgUFJPRFVDVF8yID0gJ1Byb2R1Y3QyJyxcbiAgU09MVVRJT04gPSAnU29sdXRpb24nLFxuICBUQVNLID0gJ1Rhc2snLFxuICBGRUVEX0lURU0gPSAnRmVlZEl0ZW0nLFxuICBGRUVEX0NPTU1FTlQgPSAnRmVlZENvbW1lbnQnLFxuICBLTk9XTEVER0VfS0FWID0gJ0tub3dsZWRnZV9fa2F2JyxcbiAgVVNFUiA9ICdVc2VyJyxcbiAgQ09MTEFCT1JBVElPTl9HUk9VUCA9ICdDb2xsYWJvcmF0aW9uR3JvdXAnXG59XG5cbi8qKlxuICogRGVmaW5lcyB0aGUgY3Jhd2xpbmcgZmlsdGVycyBmb3IgU2FsZXNmb3JjZSBkYXRhIGluZ2VzdGlvbi5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTYWxlc2ZvcmNlQ3Jhd2xpbmdGaWx0ZXJzIHtcbiAgLyoqXG4gICAqIFRoZSBTYWxlc2ZvcmNlIG9iamVjdCB0eXBlIHRvIHdoaWNoIHRoaXMgZmlsdGVyIGFwcGxpZXMuXG4gICAqL1xuICByZWFkb25seSBvYmplY3RUeXBlOiBTYWxlc2ZvcmNlT2JqZWN0VHlwZTtcbiAgLyoqXG4gICAqIFJlZ3VsYXIgZXhwcmVzc2lvbiBwYXR0ZXJucyB0byBpbmNsdWRlIHNwZWNpZmljIGNvbnRlbnQuXG4gICAqL1xuICByZWFkb25seSBpbmNsdWRlUGF0dGVybnM/OiBzdHJpbmdbXTtcbiAgLyoqXG4gICAqIFJlZ3VsYXIgZXhwcmVzc2lvbiBwYXR0ZXJucyB0byBleGNsdWRlIHNwZWNpZmljIGNvbnRlbnQuXG4gICAqL1xuICByZWFkb25seSBleGNsdWRlUGF0dGVybnM/OiBzdHJpbmdbXTtcbn1cblxuLyoqXG4gKiBJbnRlcmZhY2UgdG8gYWRkIGEgbmV3IGRhdGEgc291cmNlIHRvIGFuIGV4aXN0aW5nIEtCLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNhbGVzZm9yY2VEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyBleHRlbmRzIERhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBTYWxlc2ZvcmNlIGhvc3QgVVJMIG9yIGluc3RhbmNlIFVSTC5cbiAgICogQGV4YW1wbGUgXCJodHRwczovL2NvbXBhbnkuc2FsZXNmb3JjZS5jb20vXCJcbiAgICovXG4gIHJlYWRvbmx5IGVuZHBvaW50OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgQVdTIFNlY3JldHMgTWFuYWdlciBzZWNyZXQgdGhhdCBzdG9yZXMgeW91ciBhdXRoZW50aWNhdGlvbiBjcmVkZW50aWFsc1xuICAgKiBmb3IgeW91ciBTYWxlc2ZvcmNlIGluc3RhbmNlIFVSTC4gU2VjcmV0IG11c3Qgc3RhcnQgd2l0aCBcIkFtYXpvbkJlZHJvY2stXCIuXG4gICAqL1xuICByZWFkb25seSBhdXRoU2VjcmV0OiBJU2VjcmV0O1xuICAvKipcbiAgICogVGhlIGZpbHRlcnMgKHJlZ3VsYXIgZXhwcmVzc2lvbiBwYXR0ZXJucykgZm9yIHRoZSBjcmF3bGluZy5cbiAgICogSWYgdGhlcmUncyBhIGNvbmZsaWN0LCB0aGUgZXhjbHVkZSBwYXR0ZXJuIHRha2VzIHByZWNlZGVuY2UuXG4gICAqIEBkZWZhdWx0IE5vbmUgLSBhbGwgeW91ciBjb250ZW50IGlzIGNyYXdsZWQuXG4gICAqL1xuICByZWFkb25seSBmaWx0ZXJzPzogU2FsZXNmb3JjZUNyYXdsaW5nRmlsdGVyc1tdO1xuXG59XG5cbi8qKlxuICogSW50ZXJmYWNlIHRvIGNyZWF0ZSBhIG5ldyBzdGFuZGFsb25lIGRhdGEgc291cmNlIG9iamVjdC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBTYWxlc2ZvcmNlRGF0YVNvdXJjZVByb3BzIGV4dGVuZHMgU2FsZXNmb3JjZURhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBrbm93bGVkZ2UgYmFzZSB0byBhc3NvY2lhdGUgd2l0aCB0aGUgZGF0YSBzb3VyY2UuXG4gICAqL1xuICByZWFkb25seSBrbm93bGVkZ2VCYXNlOiBJS25vd2xlZGdlQmFzZTtcbn1cblxuLyoqXG4gKiBTZXRzIHVwIGFuIGRhdGEgc291cmNlIHRvIGJlIGFkZGVkIHRvIGEga25vd2xlZGdlIGJhc2UuXG4gKi9cbmV4cG9ydCBjbGFzcyBTYWxlc2ZvcmNlRGF0YVNvdXJjZSBleHRlbmRzIERhdGFTb3VyY2VOZXcge1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQ29tbW9uIGF0dHJpYnV0ZXMgZm9yIGFsbCBuZXcgZGF0YSBzb3VyY2VzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogVGhlIHVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBkYXRhIHNvdXJjZS5cbiAgICogQGV4YW1wbGUgJ0pIVUVWWFVaTVUnXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZGF0YVNvdXJjZUlkOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgdHlwZSBvZiBkYXRhIHNvdXJjZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBkYXRhU291cmNlVHlwZTogRGF0YVNvdXJjZVR5cGU7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgZGF0YSBzb3VyY2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZGF0YVNvdXJjZU5hbWU6IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBrbm93bGVkZ2UgYmFzZSBhc3NvY2lhdGVkIHdpdGggdGhlIGRhdGEgc291cmNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGtub3dsZWRnZUJhc2U6IElLbm93bGVkZ2VCYXNlO1xuICAvKipcbiAgICogVGhlIEtNUyBrZXkgdG8gdXNlIHRvIGVuY3J5cHQgdGhlIGRhdGEgc291cmNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGttc0tleT86IElLZXk7XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBVbmlxdWUgdG8gdGhpcyBjbGFzc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSBTYWxlc2ZvcmNlIGhvc3QgVVJMIG9yIGluc3RhbmNlIFVSTC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBlbmRwb2ludDogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIEFXUyBTZWNyZXRzIE1hbmFnZXIgc2VjcmV0IHRoYXQgc3RvcmVzIHlvdXIgYXV0aGVudGljYXRpb24gY3JlZGVudGlhbHMuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgYXV0aFNlY3JldDogSVNlY3JldDtcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEludGVybmFsIE9ubHlcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBUaGUgRGF0YSBTb3VyY2UgY2ZuIHJlc291cmNlLlxuICAgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBfX3Jlc291cmNlOiBDZm5EYXRhU291cmNlO1xuXG5cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IFNhbGVzZm9yY2VEYXRhU291cmNlUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuICAgIC8vIEFzc2lnbiBhdHRyaWJ1dGVzXG4gICAgdGhpcy5rbm93bGVkZ2VCYXNlID0gcHJvcHMua25vd2xlZGdlQmFzZTtcbiAgICB0aGlzLmRhdGFTb3VyY2VUeXBlID0gRGF0YVNvdXJjZVR5cGUuU0FMRVNGT1JDRTtcbiAgICB0aGlzLmRhdGFTb3VyY2VOYW1lID0gcHJvcHMuZGF0YVNvdXJjZU5hbWUgPz8gZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMih0aGlzLCAnc2ZkYy1kcycsIHsgbWF4TGVuZ3RoOiA0MCwgbG93ZXI6IHRydWUsIHNlcGFyYXRvcjogJy0nIH0pOztcbiAgICB0aGlzLmVuZHBvaW50ID0gcHJvcHMuZW5kcG9pbnQ7XG4gICAgdGhpcy5hdXRoU2VjcmV0ID0gcHJvcHMuYXV0aFNlY3JldDtcbiAgICB0aGlzLmttc0tleSA9IHByb3BzLmttc0tleTtcblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIE1hbmFnZSBwZXJtaXNzaW9ucyBmb3IgdGhlIGRhdGEgc291cmNlXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5oYW5kbGVDb21tb25QZXJtaXNzaW9ucyhwcm9wcyk7XG4gICAgdGhpcy5hdXRoU2VjcmV0LmdyYW50UmVhZCh0aGlzLmtub3dsZWRnZUJhc2Uucm9sZSk7XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIEwxIEluc3RhbnRpYXRpb25cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICB0aGlzLl9fcmVzb3VyY2UgPSBuZXcgQ2ZuRGF0YVNvdXJjZSh0aGlzLCAnRGF0YVNvdXJjZScsIHtcbiAgICAgIC4uLnRoaXMuZm9ybWF0QXNDZm5Qcm9wcyhcbiAgICAgICAgcHJvcHMsXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiB0aGlzLmRhdGFTb3VyY2VUeXBlLFxuICAgICAgICAgIHNhbGVzZm9yY2VDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgICBzb3VyY2VDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgICAgIGF1dGhUeXBlOiBTYWxlc2ZvcmNlRGF0YVNvdXJjZUF1dGhUeXBlLk9BVVRIMl9DTElFTlRfQ1JFREVOVElBTFMsXG4gICAgICAgICAgICAgIGNyZWRlbnRpYWxzU2VjcmV0QXJuOiB0aGlzLmF1dGhTZWNyZXQuc2VjcmV0QXJuLFxuICAgICAgICAgICAgICBob3N0VXJsOiB0aGlzLmVuZHBvaW50LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNyYXdsZXJDb25maWd1cmF0aW9uOlxuICAgICAgICAgICAgICAocHJvcHMuZmlsdGVycykgPyAoe1xuICAgICAgICAgICAgICAgIGZpbHRlckNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6ICdQQVRURVJOJyxcbiAgICAgICAgICAgICAgICAgIHBhdHRlcm5PYmplY3RGaWx0ZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyczogcHJvcHMuZmlsdGVycz8ubWFwKGl0ZW0gPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgICBvYmplY3RUeXBlOiBpdGVtLm9iamVjdFR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgaW5jbHVzaW9uRmlsdGVyczogaXRlbS5pbmNsdWRlUGF0dGVybnMsXG4gICAgICAgICAgICAgICAgICAgICAgZXhjbHVzaW9uRmlsdGVyczogaXRlbS5leGNsdWRlUGF0dGVybnMsXG4gICAgICAgICAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSkgOiB1bmRlZmluZWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICksXG4gICAgfSk7XG5cbiAgICB0aGlzLmRhdGFTb3VyY2VJZCA9IHRoaXMuX19yZXNvdXJjZS5hdHRyRGF0YVNvdXJjZUlkO1xuXG5cbiAgfVxufSJdfQ==