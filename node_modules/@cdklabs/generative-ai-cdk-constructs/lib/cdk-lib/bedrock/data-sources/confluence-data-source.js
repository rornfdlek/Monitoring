"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConfluenceDataSource = exports.ConfluenceObjectType = exports.ConfluenceDataSourceAuthType = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_bedrock_1 = require("aws-cdk-lib/aws-bedrock");
const base_data_source_1 = require("./base-data-source");
const utils_1 = require("../../../common/helpers/utils");
/**
 * The different authentication types available to connect to your Confluence instance.
 * @see https://docs.aws.amazon.com/bedrock/latest/userguide/confluence-data-source-connector.html#configuration-confluence-connector
 */
var ConfluenceDataSourceAuthType;
(function (ConfluenceDataSourceAuthType) {
    /**
     * Your secret authentication credentials in AWS Secrets Manager should include:
     * - `confluenceAppKey`
     * - `confluenceAppSecret`
     * - `confluenceAccessToken`
     * - `confluenceRefreshToken`
     */
    ConfluenceDataSourceAuthType["OAUTH2_CLIENT_CREDENTIALS"] = "OAUTH2_CLIENT_CREDENTIALS";
    /**
     * Your secret authentication credentials in AWS Secrets Manager should include:
     *  - `username` (email of admin account)
     *  - `password` (API token)
     */
    ConfluenceDataSourceAuthType["BASIC"] = "BASIC";
})(ConfluenceDataSourceAuthType || (exports.ConfluenceDataSourceAuthType = ConfluenceDataSourceAuthType = {}));
/**
 * Represents the different types of content objects in Confluence that can be
 * crawled by the data source.
 */
var ConfluenceObjectType;
(function (ConfluenceObjectType) {
    ConfluenceObjectType["SPACE"] = "Space";
    ConfluenceObjectType["PAGE"] = "Page";
    ConfluenceObjectType["BLOG"] = "Blog";
    ConfluenceObjectType["COMMENT"] = "Comment";
    ConfluenceObjectType["ATTACHMENT"] = "Attachment";
})(ConfluenceObjectType || (exports.ConfluenceObjectType = ConfluenceObjectType = {}));
/**
 * Sets up a Confluence Data Source to be added to a knowledge base.
 * @see https://docs.aws.amazon.com/bedrock/latest/userguide/confluence-data-source-connector.html
 */
class ConfluenceDataSource extends base_data_source_1.DataSourceNew {
    constructor(scope, id, props) {
        super(scope, id);
        // Assign common attributes
        this.knowledgeBase = props.knowledgeBase;
        this.dataSourceType = base_data_source_1.DataSourceType.CONFLUENCE;
        this.dataSourceName = props.dataSourceName ?? (0, utils_1.generatePhysicalNameV2)(this, 'confluence-ds', { maxLength: 40, lower: true, separator: '-' });
        this.kmsKey = props.kmsKey;
        // Assign unique attributes
        this.confluenceUrl = props.confluenceUrl;
        this.authSecret = props.authSecret;
        // ------------------------------------------------------
        // Manage permissions for the data source
        // ------------------------------------------------------
        this.handleCommonPermissions(props);
        this.authSecret.grantRead(this.knowledgeBase.role);
        // Grant write permissions to the knowledge base role for updating the secret.
        // This is necessary when using OAuth 2.0 authentication with a refresh token.
        if (props.authType === ConfluenceDataSourceAuthType.OAUTH2_CLIENT_CREDENTIALS) {
            this.authSecret.grantWrite(this.knowledgeBase.role);
        }
        // ------------------------------------------------------
        // L1 Instantiation
        // ------------------------------------------------------
        this.__resource = new aws_bedrock_1.CfnDataSource(this, 'DataSource', {
            ...this.formatAsCfnProps(props, {
                type: this.dataSourceType,
                confluenceConfiguration: {
                    sourceConfiguration: {
                        authType: props.authType ?? ConfluenceDataSourceAuthType.OAUTH2_CLIENT_CREDENTIALS,
                        credentialsSecretArn: this.authSecret.secretArn,
                        hostUrl: this.confluenceUrl,
                        hostType: 'SAAS',
                    },
                    crawlerConfiguration: (props.filters) ? ({
                        filterConfiguration: {
                            type: 'PATTERN',
                            patternObjectFilter: {
                                filters: props.filters?.map(item => ({
                                    objectType: item.objectType,
                                    inclusionFilters: item.includePatterns,
                                    exclusionFilters: item.excludePatterns,
                                })),
                            },
                        },
                    }) : undefined,
                },
            }),
        });
        this.dataSourceId = this.__resource.attrDataSourceId;
    }
}
exports.ConfluenceDataSource = ConfluenceDataSource;
_a = JSII_RTTI_SYMBOL_1;
ConfluenceDataSource[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.ConfluenceDataSource", version: "0.1.285" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29uZmx1ZW5jZS1kYXRhLXNvdXJjZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jZGstbGliL2JlZHJvY2svZGF0YS1zb3VyY2VzL2NvbmZsdWVuY2UtZGF0YS1zb3VyY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7R0FXRztBQUNILHlEQUF3RDtBQU14RCx5REFBK0Y7QUFDL0YseURBQXVFO0FBRXZFOzs7R0FHRztBQUNILElBQVksNEJBZVg7QUFmRCxXQUFZLDRCQUE0QjtJQUN0Qzs7Ozs7O09BTUc7SUFDSCx1RkFBdUQsQ0FBQTtJQUN2RDs7OztPQUlHO0lBQ0gsK0NBQWUsQ0FBQTtBQUNqQixDQUFDLEVBZlcsNEJBQTRCLDRDQUE1Qiw0QkFBNEIsUUFldkM7QUFFRDs7O0dBR0c7QUFDSCxJQUFZLG9CQU1YO0FBTkQsV0FBWSxvQkFBb0I7SUFDOUIsdUNBQWUsQ0FBQTtJQUNmLHFDQUFhLENBQUE7SUFDYixxQ0FBYSxDQUFBO0lBQ2IsMkNBQW1CLENBQUE7SUFDbkIsaURBQXlCLENBQUE7QUFDM0IsQ0FBQyxFQU5XLG9CQUFvQixvQ0FBcEIsb0JBQW9CLFFBTS9CO0FBZ0ZEOzs7R0FHRztBQUNILE1BQWEsb0JBQXFCLFNBQVEsZ0NBQWE7SUE2Q3JELFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBZ0M7UUFDeEUsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNqQiwyQkFBMkI7UUFDM0IsSUFBSSxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUMsYUFBYSxDQUFDO1FBQ3pDLElBQUksQ0FBQyxjQUFjLEdBQUcsaUNBQWMsQ0FBQyxVQUFVLENBQUM7UUFDaEQsSUFBSSxDQUFDLGNBQWMsR0FBRyxLQUFLLENBQUMsY0FBYyxJQUFJLElBQUEsOEJBQXNCLEVBQUMsSUFBSSxFQUFFLGVBQWUsRUFBRSxFQUFFLFNBQVMsRUFBRSxFQUFFLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUM1SSxJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUM7UUFDM0IsMkJBQTJCO1FBQzNCLElBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDLGFBQWEsQ0FBQztRQUN6QyxJQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQyxVQUFVLENBQUM7UUFFbkMseURBQXlEO1FBQ3pELHlDQUF5QztRQUN6Qyx5REFBeUQ7UUFDekQsSUFBSSxDQUFDLHVCQUF1QixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3BDLElBQUksQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFbkQsOEVBQThFO1FBQzlFLDhFQUE4RTtRQUM5RSxJQUFJLEtBQUssQ0FBQyxRQUFRLEtBQUssNEJBQTRCLENBQUMseUJBQXlCLEVBQUUsQ0FBQztZQUM5RSxJQUFJLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3RELENBQUM7UUFDRCx5REFBeUQ7UUFDekQsbUJBQW1CO1FBQ25CLHlEQUF5RDtRQUN6RCxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksMkJBQWEsQ0FBQyxJQUFJLEVBQUUsWUFBWSxFQUFFO1lBQ3RELEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUN0QixLQUFLLEVBQ0w7Z0JBQ0UsSUFBSSxFQUFFLElBQUksQ0FBQyxjQUFjO2dCQUN6Qix1QkFBdUIsRUFBRTtvQkFDdkIsbUJBQW1CLEVBQUU7d0JBQ25CLFFBQVEsRUFBRSxLQUFLLENBQUMsUUFBUSxJQUFJLDRCQUE0QixDQUFDLHlCQUF5Qjt3QkFDbEYsb0JBQW9CLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTO3dCQUMvQyxPQUFPLEVBQUUsSUFBSSxDQUFDLGFBQWE7d0JBQzNCLFFBQVEsRUFBRSxNQUFNO3FCQUNqQjtvQkFDRCxvQkFBb0IsRUFDbEIsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ2pCLG1CQUFtQixFQUFFOzRCQUNuQixJQUFJLEVBQUUsU0FBUzs0QkFDZixtQkFBbUIsRUFBRTtnQ0FDbkIsT0FBTyxFQUFFLEtBQUssQ0FBQyxPQUFPLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztvQ0FDbkMsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVO29DQUMzQixnQkFBZ0IsRUFBRSxJQUFJLENBQUMsZUFBZTtvQ0FDdEMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLGVBQWU7aUNBQ3ZDLENBQUMsQ0FBQzs2QkFDSjt5QkFDRjtxQkFDRixDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVM7aUJBQ2pCO2FBQ0YsQ0FDRjtTQUNGLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQztJQUV2RCxDQUFDOztBQXRHSCxvREF1R0MiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqICBDb3B5cmlnaHQgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS4gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogIHdpdGggdGhlIExpY2Vuc2UuIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiAgb3IgaW4gdGhlICdsaWNlbnNlJyBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAnQVMgSVMnIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVNcbiAqICBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xuICogIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuaW1wb3J0IHsgQ2ZuRGF0YVNvdXJjZSB9IGZyb20gJ2F3cy1jZGstbGliL2F3cy1iZWRyb2NrJztcbmltcG9ydCB7IElLZXkgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3Mta21zJztcbmltcG9ydCB7IElTZWNyZXQgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3Mtc2VjcmV0c21hbmFnZXInO1xuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XG5cbmltcG9ydCB7IElLbm93bGVkZ2VCYXNlIH0gZnJvbSAnLi8uLi9rbm93bGVkZ2UtYmFzZSc7XG5pbXBvcnQgeyBEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcywgRGF0YVNvdXJjZU5ldywgRGF0YVNvdXJjZVR5cGUgfSBmcm9tICcuL2Jhc2UtZGF0YS1zb3VyY2UnO1xuaW1wb3J0IHsgZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMiB9IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9oZWxwZXJzL3V0aWxzJztcblxuLyoqXG4gKiBUaGUgZGlmZmVyZW50IGF1dGhlbnRpY2F0aW9uIHR5cGVzIGF2YWlsYWJsZSB0byBjb25uZWN0IHRvIHlvdXIgQ29uZmx1ZW5jZSBpbnN0YW5jZS5cbiAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2JlZHJvY2svbGF0ZXN0L3VzZXJndWlkZS9jb25mbHVlbmNlLWRhdGEtc291cmNlLWNvbm5lY3Rvci5odG1sI2NvbmZpZ3VyYXRpb24tY29uZmx1ZW5jZS1jb25uZWN0b3JcbiAqL1xuZXhwb3J0IGVudW0gQ29uZmx1ZW5jZURhdGFTb3VyY2VBdXRoVHlwZSB7XG4gIC8qKlxuICAgKiBZb3VyIHNlY3JldCBhdXRoZW50aWNhdGlvbiBjcmVkZW50aWFscyBpbiBBV1MgU2VjcmV0cyBNYW5hZ2VyIHNob3VsZCBpbmNsdWRlOlxuICAgKiAtIGBjb25mbHVlbmNlQXBwS2V5YFxuICAgKiAtIGBjb25mbHVlbmNlQXBwU2VjcmV0YFxuICAgKiAtIGBjb25mbHVlbmNlQWNjZXNzVG9rZW5gXG4gICAqIC0gYGNvbmZsdWVuY2VSZWZyZXNoVG9rZW5gXG4gICAqL1xuICBPQVVUSDJfQ0xJRU5UX0NSRURFTlRJQUxTID0gJ09BVVRIMl9DTElFTlRfQ1JFREVOVElBTFMnLFxuICAvKipcbiAgICogWW91ciBzZWNyZXQgYXV0aGVudGljYXRpb24gY3JlZGVudGlhbHMgaW4gQVdTIFNlY3JldHMgTWFuYWdlciBzaG91bGQgaW5jbHVkZTpcbiAgICogIC0gYHVzZXJuYW1lYCAoZW1haWwgb2YgYWRtaW4gYWNjb3VudClcbiAgICogIC0gYHBhc3N3b3JkYCAoQVBJIHRva2VuKVxuICAgKi9cbiAgQkFTSUMgPSAnQkFTSUMnLFxufVxuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIGRpZmZlcmVudCB0eXBlcyBvZiBjb250ZW50IG9iamVjdHMgaW4gQ29uZmx1ZW5jZSB0aGF0IGNhbiBiZVxuICogY3Jhd2xlZCBieSB0aGUgZGF0YSBzb3VyY2UuXG4gKi9cbmV4cG9ydCBlbnVtIENvbmZsdWVuY2VPYmplY3RUeXBlIHtcbiAgU1BBQ0UgPSAnU3BhY2UnLFxuICBQQUdFID0gJ1BhZ2UnLFxuICBCTE9HID0gJ0Jsb2cnLFxuICBDT01NRU5UID0gJ0NvbW1lbnQnLFxuICBBVFRBQ0hNRU5UID0gJ0F0dGFjaG1lbnQnLFxufVxuXG4vKipcbiAqIERlZmluZXMgZmlsdGVycyBmb3IgY3Jhd2xpbmcgQ29uZmx1ZW5jZSBjb250ZW50LlxuICogVGhlc2UgZmlsdGVycyBhbGxvdyB5b3UgdG8gaW5jbHVkZSBvciBleGNsdWRlIHNwZWNpZmljIGNvbnRlbnQgYmFzZWQgb24gb2JqZWN0IHR5cGVzIGFuZCBwYXR0ZXJucy5cbiAqXG4gKiAtIEZvciBTcGFjZXM6IFVzZSB0aGUgdW5pcXVlIHNwYWNlIGtleVxuICogLSBGb3IgUGFnZXM6IFVzZSB0aGUgbWFpbiBwYWdlIHRpdGxlXG4gKiAtIEZvciBCbG9nczogVXNlIHRoZSBtYWluIGJsb2cgdGl0bGVcbiAqIC0gRm9yIENvbW1lbnRzOiBVc2UgXCJSZTogUGFnZS9CbG9nIFRpdGxlXCJcbiAqIC0gRm9yIEF0dGFjaG1lbnRzOiBVc2UgdGhlIGZpbGVuYW1lIHdpdGggZXh0ZW5zaW9uXG4gKiBAcmVtYXJrc1xuICogLSBZb3UgY2FuIHNwZWNpZnkgaW5jbHVzaW9uIGFuZCBleGNsdXNpb24gcGF0dGVybnMgdXNpbmcgcmVndWxhciBleHByZXNzaW9ucy5cbiAqIC0gSWYgYm90aCBpbmNsdXNpb24gYW5kIGV4Y2x1c2lvbiBwYXR0ZXJucyBtYXRjaCBhIGRvY3VtZW50LCB0aGUgZXhjbHVzaW9uIHRha2VzIHByZWNlZGVuY2UuXG4gKlxuICogQGV4YW1wbGVcbiAqIHtcbiAqICAgb2JqZWN0VHlwZTogQ29uZmx1ZW5jZU9iamVjdFR5cGUuQVRUQUNITUVOVCxcbiAqICAgZXhjbHVkZVBhdHRlcm5zOiBbXCIuKnByaXZhdGUuKlxcXFwucGRmXCJdXG4gKiB9XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ29uZmx1ZW5jZUNyYXdsaW5nRmlsdGVycyB7XG4gIC8qKlxuICAgKiBUaGUgdHlwZSBvZiBDb25mbHVlbmNlIG9iamVjdCB0byBhcHBseSB0aGUgZmlsdGVycyB0by5cbiAgICovXG4gIHJlYWRvbmx5IG9iamVjdFR5cGU6IENvbmZsdWVuY2VPYmplY3RUeXBlO1xuXG4gIC8qKlxuICAgKiBSZWd1bGFyIGV4cHJlc3Npb24gcGF0dGVybnMgdG8gaW5jbHVkZSBjb250ZW50LlxuICAgKiBJZiBzcGVjaWZpZWQsIG9ubHkgY29udGVudCBtYXRjaGluZyB0aGVzZSBwYXR0ZXJucyB3aWxsIGJlIGNyYXdsZWQuXG4gICAqL1xuICByZWFkb25seSBpbmNsdWRlUGF0dGVybnM/OiBzdHJpbmdbXTtcblxuICAvKipcbiAgICogUmVndWxhciBleHByZXNzaW9uIHBhdHRlcm5zIHRvIGV4Y2x1ZGUgY29udGVudC5cbiAgICogQ29udGVudCBtYXRjaGluZyB0aGVzZSBwYXR0ZXJucyB3aWxsIG5vdCBiZSBjcmF3bGVkLCBldmVuIGlmIGl0IG1hdGNoZXMgYW4gaW5jbHVkZSBwYXR0ZXJuLlxuICAgKi9cbiAgcmVhZG9ubHkgZXhjbHVkZVBhdHRlcm5zPzogc3RyaW5nW107XG59XG5cblxuLyoqXG4gKiBJbnRlcmZhY2UgdG8gYWRkIGEgbmV3IGRhdGEgc291cmNlIHRvIGFuIGV4aXN0aW5nIEtCLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIENvbmZsdWVuY2VEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyBleHRlbmRzIERhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzIHtcbiAgLyoqXG4gICAqIFRoZSBDb25mbHVlbmNlIGhvc3QgVVJMIG9yIGluc3RhbmNlIFVSTC5cbiAgICogQGV4YW1wbGUgaHR0cHM6Ly9leGFtcGxlLmF0bGFzc2lhbi5uZXRcbiAgICovXG4gIHJlYWRvbmx5IGNvbmZsdWVuY2VVcmw6IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBBV1MgU2VjcmV0cyBNYW5hZ2VyIHNlY3JldCB0aGF0IHN0b3JlcyB5b3VyIGF1dGhlbnRpY2F0aW9uIGNyZWRlbnRpYWxzXG4gICAqIGZvciB5b3VyIENvbmZsdWVuY2UgaW5zdGFuY2UgVVJMLiBTZWNyZXQgbXVzdCBzdGFydCB3aXRoIFwiQW1hem9uQmVkcm9jay1cIi5cbiAgICovXG4gIHJlYWRvbmx5IGF1dGhTZWNyZXQ6IElTZWNyZXQ7XG4gIC8qKlxuICAgKiBUaGUgc3VwcG9ydGVkIGF1dGhlbnRpY2F0aW9uIG1ldGhvZCB0byBjb25uZWN0IHRvIHRoZSBkYXRhIHNvdXJjZS5cbiAgICogQGRlZmF1bHQgQ29uZmx1ZW5jZURhdGFTb3VyY2VBdXRoVHlwZS5PQVVUSDJfQ0xJRU5UX0NSRURFTlRJQUxTXG4gICAqL1xuICByZWFkb25seSBhdXRoVHlwZT86IENvbmZsdWVuY2VEYXRhU291cmNlQXV0aFR5cGU7XG4gIC8qKlxuICAgKiBUaGUgZmlsdGVycyAocmVndWxhciBleHByZXNzaW9uIHBhdHRlcm5zKSBmb3IgdGhlIGNyYXdsaW5nLlxuICAgKiBJZiB0aGVyZSdzIGEgY29uZmxpY3QsIHRoZSBleGNsdWRlIHBhdHRlcm4gdGFrZXMgcHJlY2VkZW5jZS5cbiAgICogQGRlZmF1bHQgTm9uZSAtIGFsbCB5b3VyIGNvbnRlbnQgaXMgY3Jhd2xlZC5cbiAgICovXG4gIHJlYWRvbmx5IGZpbHRlcnM/OiBDb25mbHVlbmNlQ3Jhd2xpbmdGaWx0ZXJzW107XG5cbn1cblxuLyoqXG4gKiBJbnRlcmZhY2UgdG8gY3JlYXRlIGEgbmV3IHN0YW5kYWxvbmUgZGF0YSBzb3VyY2Ugb2JqZWN0LlxuICovXG5leHBvcnQgaW50ZXJmYWNlIENvbmZsdWVuY2VEYXRhU291cmNlUHJvcHMgZXh0ZW5kcyBDb25mbHVlbmNlRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMge1xuICAvKipcbiAgICogVGhlIGtub3dsZWRnZSBiYXNlIHRvIGFzc29jaWF0ZSB3aXRoIHRoZSBkYXRhIHNvdXJjZS5cbiAgICovXG4gIHJlYWRvbmx5IGtub3dsZWRnZUJhc2U6IElLbm93bGVkZ2VCYXNlO1xufVxuXG5cbi8qKlxuICogU2V0cyB1cCBhIENvbmZsdWVuY2UgRGF0YSBTb3VyY2UgdG8gYmUgYWRkZWQgdG8gYSBrbm93bGVkZ2UgYmFzZS5cbiAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2JlZHJvY2svbGF0ZXN0L3VzZXJndWlkZS9jb25mbHVlbmNlLWRhdGEtc291cmNlLWNvbm5lY3Rvci5odG1sXG4gKi9cbmV4cG9ydCBjbGFzcyBDb25mbHVlbmNlRGF0YVNvdXJjZSBleHRlbmRzIERhdGFTb3VyY2VOZXcge1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQ29tbW9uIGF0dHJpYnV0ZXMgZm9yIGFsbCBuZXcgZGF0YSBzb3VyY2VzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogVGhlIHVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBkYXRhIHNvdXJjZS5cbiAgICogQGV4YW1wbGUgJ0pIVUVWWFVaTVUnXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZGF0YVNvdXJjZUlkOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgdHlwZSBvZiBkYXRhIHNvdXJjZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBkYXRhU291cmNlVHlwZTogRGF0YVNvdXJjZVR5cGU7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgZGF0YSBzb3VyY2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZGF0YVNvdXJjZU5hbWU6IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBrbm93bGVkZ2UgYmFzZSBhc3NvY2lhdGVkIHdpdGggdGhlIGRhdGEgc291cmNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGtub3dsZWRnZUJhc2U6IElLbm93bGVkZ2VCYXNlO1xuICAvKipcbiAgICogVGhlIEtNUyBrZXkgdG8gdXNlIHRvIGVuY3J5cHQgdGhlIGRhdGEgc291cmNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGttc0tleT86IElLZXk7XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBVbmlxdWUgdG8gdGhpcyBjbGFzc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSBDb25mbHVlbmNlIGhvc3QgVVJMIG9yIGluc3RhbmNlIFVSTC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBjb25mbHVlbmNlVXJsOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgQVdTIFNlY3JldHMgTWFuYWdlciBzZWNyZXQgdGhhdCBzdG9yZXMgeW91ciBhdXRoZW50aWNhdGlvbiBjcmVkZW50aWFscy5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBhdXRoU2VjcmV0OiBJU2VjcmV0O1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gSW50ZXJuYWwgT25seVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSBEYXRhIFNvdXJjZSBjZm4gcmVzb3VyY2UuXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IF9fcmVzb3VyY2U6IENmbkRhdGFTb3VyY2U7XG5cblxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogQ29uZmx1ZW5jZURhdGFTb3VyY2VQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG4gICAgLy8gQXNzaWduIGNvbW1vbiBhdHRyaWJ1dGVzXG4gICAgdGhpcy5rbm93bGVkZ2VCYXNlID0gcHJvcHMua25vd2xlZGdlQmFzZTtcbiAgICB0aGlzLmRhdGFTb3VyY2VUeXBlID0gRGF0YVNvdXJjZVR5cGUuQ09ORkxVRU5DRTtcbiAgICB0aGlzLmRhdGFTb3VyY2VOYW1lID0gcHJvcHMuZGF0YVNvdXJjZU5hbWUgPz8gZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMih0aGlzLCAnY29uZmx1ZW5jZS1kcycsIHsgbWF4TGVuZ3RoOiA0MCwgbG93ZXI6IHRydWUsIHNlcGFyYXRvcjogJy0nIH0pO1xuICAgIHRoaXMua21zS2V5ID0gcHJvcHMua21zS2V5O1xuICAgIC8vIEFzc2lnbiB1bmlxdWUgYXR0cmlidXRlc1xuICAgIHRoaXMuY29uZmx1ZW5jZVVybCA9IHByb3BzLmNvbmZsdWVuY2VVcmw7XG4gICAgdGhpcy5hdXRoU2VjcmV0ID0gcHJvcHMuYXV0aFNlY3JldDtcblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIE1hbmFnZSBwZXJtaXNzaW9ucyBmb3IgdGhlIGRhdGEgc291cmNlXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5oYW5kbGVDb21tb25QZXJtaXNzaW9ucyhwcm9wcyk7XG4gICAgdGhpcy5hdXRoU2VjcmV0LmdyYW50UmVhZCh0aGlzLmtub3dsZWRnZUJhc2Uucm9sZSk7XG5cbiAgICAvLyBHcmFudCB3cml0ZSBwZXJtaXNzaW9ucyB0byB0aGUga25vd2xlZGdlIGJhc2Ugcm9sZSBmb3IgdXBkYXRpbmcgdGhlIHNlY3JldC5cbiAgICAvLyBUaGlzIGlzIG5lY2Vzc2FyeSB3aGVuIHVzaW5nIE9BdXRoIDIuMCBhdXRoZW50aWNhdGlvbiB3aXRoIGEgcmVmcmVzaCB0b2tlbi5cbiAgICBpZiAocHJvcHMuYXV0aFR5cGUgPT09IENvbmZsdWVuY2VEYXRhU291cmNlQXV0aFR5cGUuT0FVVEgyX0NMSUVOVF9DUkVERU5USUFMUykge1xuICAgICAgdGhpcy5hdXRoU2VjcmV0LmdyYW50V3JpdGUodGhpcy5rbm93bGVkZ2VCYXNlLnJvbGUpO1xuICAgIH1cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBMMSBJbnN0YW50aWF0aW9uXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5fX3Jlc291cmNlID0gbmV3IENmbkRhdGFTb3VyY2UodGhpcywgJ0RhdGFTb3VyY2UnLCB7XG4gICAgICAuLi50aGlzLmZvcm1hdEFzQ2ZuUHJvcHMoXG4gICAgICAgIHByb3BzLFxuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogdGhpcy5kYXRhU291cmNlVHlwZSxcbiAgICAgICAgICBjb25mbHVlbmNlQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgICAgc291cmNlQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgICAgICBhdXRoVHlwZTogcHJvcHMuYXV0aFR5cGUgPz8gQ29uZmx1ZW5jZURhdGFTb3VyY2VBdXRoVHlwZS5PQVVUSDJfQ0xJRU5UX0NSRURFTlRJQUxTLFxuICAgICAgICAgICAgICBjcmVkZW50aWFsc1NlY3JldEFybjogdGhpcy5hdXRoU2VjcmV0LnNlY3JldEFybixcbiAgICAgICAgICAgICAgaG9zdFVybDogdGhpcy5jb25mbHVlbmNlVXJsLFxuICAgICAgICAgICAgICBob3N0VHlwZTogJ1NBQVMnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNyYXdsZXJDb25maWd1cmF0aW9uOlxuICAgICAgICAgICAgICAocHJvcHMuZmlsdGVycykgPyAoe1xuICAgICAgICAgICAgICAgIGZpbHRlckNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICAgICAgICAgIHR5cGU6ICdQQVRURVJOJyxcbiAgICAgICAgICAgICAgICAgIHBhdHRlcm5PYmplY3RGaWx0ZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVyczogcHJvcHMuZmlsdGVycz8ubWFwKGl0ZW0gPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgICBvYmplY3RUeXBlOiBpdGVtLm9iamVjdFR5cGUsXG4gICAgICAgICAgICAgICAgICAgICAgaW5jbHVzaW9uRmlsdGVyczogaXRlbS5pbmNsdWRlUGF0dGVybnMsXG4gICAgICAgICAgICAgICAgICAgICAgZXhjbHVzaW9uRmlsdGVyczogaXRlbS5leGNsdWRlUGF0dGVybnMsXG4gICAgICAgICAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSkgOiB1bmRlZmluZWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICksXG4gICAgfSk7XG5cbiAgICB0aGlzLmRhdGFTb3VyY2VJZCA9IHRoaXMuX19yZXNvdXJjZS5hdHRyRGF0YVNvdXJjZUlkO1xuXG4gIH1cbn0iXX0=