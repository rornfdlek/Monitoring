"use strict";
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", { value: true });
exports.DataSource = exports.DataSourceNew = exports.DataSourceBase = exports.DataSourceType = exports.DataDeletionPolicy = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_cdk_lib_1 = require("aws-cdk-lib");
// import { PolicyStatement } from 'aws-cdk-lib/aws-iam';
/**
 * Specifies the policy for handling data when a data source resource is deleted.
 * This policy affects the vector embeddings created from the data source.
 */
var DataDeletionPolicy;
(function (DataDeletionPolicy) {
    /**
     * Deletes all vector embeddings derived from the data source upon deletion
     * of a data source resource.
     */
    DataDeletionPolicy["DELETE"] = "DELETE";
    /**
     * Retains all vector embeddings derived from the data source even after
     * deletion of a data source resource.
     */
    DataDeletionPolicy["RETAIN"] = "RETAIN";
})(DataDeletionPolicy || (exports.DataDeletionPolicy = DataDeletionPolicy = {}));
/**
 * Represents the types of data sources that can be associated to an Knowledge Base.
 */
var DataSourceType;
(function (DataSourceType) {
    /**
     * Amazon S3 Bucket data source.
     */
    DataSourceType["S3"] = "S3";
    /**
     * Confluence Cloud Instance data source.
     */
    DataSourceType["CONFLUENCE"] = "CONFLUENCE";
    /**
     * Salesforce instance data source.
     */
    DataSourceType["SALESFORCE"] = "SALESFORCE";
    /**
     * Microsoft SharePoint instance data source.
     */
    DataSourceType["SHAREPOINT"] = "SHAREPOINT";
    /**
     * Web Crawler data source.
     * Extracts content from authorized public web pages using a crawler.
     */
    DataSourceType["WEB_CRAWLER"] = "WEB";
})(DataSourceType || (exports.DataSourceType = DataSourceType = {}));
/**
 * Specifies the base class for all data source resources (imported and new).
 */
class DataSourceBase extends aws_cdk_lib_1.Resource {
}
exports.DataSourceBase = DataSourceBase;
_a = JSII_RTTI_SYMBOL_1;
DataSourceBase[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.DataSourceBase", version: "0.1.285" };
/**
 * Specifies the base class for all NEW data source resources of ANY type.
 */
class DataSourceNew extends DataSourceBase {
    // ------------------------------------------------------
    // Common methods for ALL NEW data sources
    // ------------------------------------------------------
    /**
     * Adds appropriate permissions to the KB execution role needed by the data source.
     */
    handleCommonPermissions(props) {
        let statementsToAdd = [];
        // Parsing strategy requires access to the parsing FM, so be sure to add permissions
        if (props.parsingStrategy) {
            statementsToAdd.push(...props.parsingStrategy.generatePolicyStatements());
        }
        // Custom transformation requires invoke permissions for the Lambda
        if (props.customTransformation) {
            statementsToAdd.push(...props.customTransformation.generatePolicyStatements(this));
        }
        // Add the permission statements to the KB execution role
        statementsToAdd.forEach((statement) => {
            this.knowledgeBase.role.addToPrincipalPolicy(statement);
        });
    }
    /**
     * Formats the data source configuration properties for CloudFormation.
     */
    formatAsCfnProps(props, dataSourceConfiguration) {
        return {
            dataDeletionPolicy: props.dataDeletionPolicy,
            dataSourceConfiguration: dataSourceConfiguration,
            description: props.description,
            knowledgeBaseId: this.knowledgeBase.knowledgeBaseId,
            name: this.dataSourceName,
            serverSideEncryptionConfiguration: props.kmsKey ? {
                kmsKeyArn: props.kmsKey.keyArn,
            } : undefined,
            vectorIngestionConfiguration: (props.chunkingStrategy || props.parsingStrategy || props.customTransformation) ? {
                chunkingConfiguration: props.chunkingStrategy?.configuration,
                parsingConfiguration: props.parsingStrategy?.configuration,
                customTransformationConfiguration: props.customTransformation?.configuration,
            } : undefined,
        };
    }
}
exports.DataSourceNew = DataSourceNew;
_b = JSII_RTTI_SYMBOL_1;
DataSourceNew[_b] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.DataSourceNew", version: "0.1.285" };
class DataSource extends DataSourceBase {
    static fromDataSourceId(scope, id, dataSourceId) {
        return new DataSource(scope, id, dataSourceId);
    }
    constructor(scope, id, dataSourceId) {
        super(scope, id);
        this.dataSourceId = dataSourceId;
    }
}
exports.DataSource = DataSource;
_c = JSII_RTTI_SYMBOL_1;
DataSource[_c] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.DataSource", version: "0.1.285" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS1kYXRhLXNvdXJjZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jZGstbGliL2JlZHJvY2svZGF0YS1zb3VyY2VzL2Jhc2UtZGF0YS1zb3VyY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTs7Ozs7Ozs7Ozs7R0FXRztBQUVILDZDQUFrRDtBQVVsRCx5REFBeUQ7QUFHekQ7OztHQUdHO0FBQ0gsSUFBWSxrQkFZWDtBQVpELFdBQVksa0JBQWtCO0lBQzVCOzs7T0FHRztJQUNILHVDQUFpQixDQUFBO0lBRWpCOzs7T0FHRztJQUNILHVDQUFpQixDQUFBO0FBQ25CLENBQUMsRUFaVyxrQkFBa0Isa0NBQWxCLGtCQUFrQixRQVk3QjtBQUdEOztHQUVHO0FBQ0gsSUFBWSxjQTBCWDtBQTFCRCxXQUFZLGNBQWM7SUFDeEI7O09BRUc7SUFDSCwyQkFBUyxDQUFBO0lBRVQ7O09BRUc7SUFDSCwyQ0FBeUIsQ0FBQTtJQUV6Qjs7T0FFRztJQUNILDJDQUF5QixDQUFBO0lBRXpCOztPQUVHO0lBQ0gsMkNBQXlCLENBQUE7SUFFekI7OztPQUdHO0lBQ0gscUNBQW1CLENBQUE7QUFDckIsQ0FBQyxFQTFCVyxjQUFjLDhCQUFkLGNBQWMsUUEwQnpCO0FBY0Q7O0dBRUc7QUFDSCxNQUFzQixjQUFlLFNBQVEsc0JBQVE7O0FBQXJELHdDQVFDOzs7QUEyREQ7O0dBRUc7QUFDSCxNQUFzQixhQUFjLFNBQVEsY0FBYztJQXVCeEQseURBQXlEO0lBQ3pELDBDQUEwQztJQUMxQyx5REFBeUQ7SUFFekQ7O09BRUc7SUFDSSx1QkFBdUIsQ0FBQyxLQUFpQztRQUM5RCxJQUFJLGVBQWUsR0FBc0IsRUFBRSxDQUFDO1FBQzVDLG9GQUFvRjtRQUNwRixJQUFJLEtBQUssQ0FBQyxlQUFlLEVBQUUsQ0FBQztZQUMxQixlQUFlLENBQUMsSUFBSSxDQUFDLEdBQUcsS0FBSyxDQUFDLGVBQWUsQ0FBQyx3QkFBd0IsRUFBRSxDQUFDLENBQUM7UUFDNUUsQ0FBQztRQUNELG1FQUFtRTtRQUNuRSxJQUFJLEtBQUssQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1lBQy9CLGVBQWUsQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLENBQUMsb0JBQW9CLENBQUMsd0JBQXdCLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUNyRixDQUFDO1FBQ0QseURBQXlEO1FBQ3pELGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxTQUFTLEVBQUUsRUFBRTtZQUNwQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMxRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRDs7T0FFRztJQUNJLGdCQUFnQixDQUNyQixLQUFpQyxFQUNqQyx1QkFBc0U7UUFFdEUsT0FBTztZQUNMLGtCQUFrQixFQUFFLEtBQUssQ0FBQyxrQkFBa0I7WUFDNUMsdUJBQXVCLEVBQUUsdUJBQXVCO1lBQ2hELFdBQVcsRUFBRSxLQUFLLENBQUMsV0FBVztZQUM5QixlQUFlLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxlQUFlO1lBQ25ELElBQUksRUFBRSxJQUFJLENBQUMsY0FBYztZQUN6QixpQ0FBaUMsRUFBRSxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztnQkFDaEQsU0FBUyxFQUFFLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBTTthQUMvQixDQUFDLENBQUMsQ0FBQyxTQUFTO1lBQ2IsNEJBQTRCLEVBQUUsQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLElBQUksS0FBSyxDQUFDLGVBQWUsSUFBSSxLQUFLLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzlHLHFCQUFxQixFQUFFLEtBQUssQ0FBQyxnQkFBZ0IsRUFBRSxhQUFhO2dCQUM1RCxvQkFBb0IsRUFBRSxLQUFLLENBQUMsZUFBZSxFQUFFLGFBQWE7Z0JBQzFELGlDQUFpQyxFQUFFLEtBQUssQ0FBQyxvQkFBb0IsRUFBRSxhQUFhO2FBQzdFLENBQUMsQ0FBQyxDQUFDLFNBQVM7U0FFZCxDQUFDO0lBQ0osQ0FBQzs7QUFyRUgsc0NBdUVDOzs7QUFHRCxNQUFhLFVBQVcsU0FBUSxjQUFjO0lBRXJDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFnQixFQUFFLEVBQVUsRUFBRSxZQUFvQjtRQUMvRSxPQUFPLElBQUksVUFBVSxDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDakQsQ0FBQztJQUlELFlBQW9CLEtBQWdCLEVBQUUsRUFBVSxFQUFFLFlBQW9CO1FBQ3BFLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDakIsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUM7SUFDbkMsQ0FBQzs7QUFYSCxnQ0FZQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogIENvcHlyaWdodCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiAgd2l0aCB0aGUgTGljZW5zZS4gQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqICBvciBpbiB0aGUgJ2xpY2Vuc2UnIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICdBUyBJUycgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFU1xuICogIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXG4gKiAgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7IElSZXNvdXJjZSwgUmVzb3VyY2UgfSBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgeyBDZm5EYXRhU291cmNlLCBDZm5EYXRhU291cmNlUHJvcHMgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtYmVkcm9jayc7XG5pbXBvcnQgeyBQb2xpY3lTdGF0ZW1lbnQgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtaWFtJztcbmltcG9ydCAqIGFzIGttcyBmcm9tICdhd3MtY2RrLWxpYi9hd3Mta21zJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuXG5pbXBvcnQgeyBJS25vd2xlZGdlQmFzZSB9IGZyb20gJy4vLi4va25vd2xlZGdlLWJhc2UnO1xuaW1wb3J0IHsgQ2h1bmtpbmdTdHJhdGVneSB9IGZyb20gJy4vY2h1bmtpbmcnO1xuaW1wb3J0IHsgQ3VzdG9tVHJhbnNmb3JtYXRpb24gfSBmcm9tICcuL2N1c3RvbS10cmFuc2Zvcm1hdGlvbic7XG5pbXBvcnQgeyBQYXJzaW5nU3RhdGVneSB9IGZyb20gJy4vcGFyc2luZyc7XG4vLyBpbXBvcnQgeyBQb2xpY3lTdGF0ZW1lbnQgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtaWFtJztcblxuXG4vKipcbiAqIFNwZWNpZmllcyB0aGUgcG9saWN5IGZvciBoYW5kbGluZyBkYXRhIHdoZW4gYSBkYXRhIHNvdXJjZSByZXNvdXJjZSBpcyBkZWxldGVkLlxuICogVGhpcyBwb2xpY3kgYWZmZWN0cyB0aGUgdmVjdG9yIGVtYmVkZGluZ3MgY3JlYXRlZCBmcm9tIHRoZSBkYXRhIHNvdXJjZS5cbiAqL1xuZXhwb3J0IGVudW0gRGF0YURlbGV0aW9uUG9saWN5IHtcbiAgLyoqXG4gICAqIERlbGV0ZXMgYWxsIHZlY3RvciBlbWJlZGRpbmdzIGRlcml2ZWQgZnJvbSB0aGUgZGF0YSBzb3VyY2UgdXBvbiBkZWxldGlvblxuICAgKiBvZiBhIGRhdGEgc291cmNlIHJlc291cmNlLlxuICAgKi9cbiAgREVMRVRFID0gJ0RFTEVURScsXG5cbiAgLyoqXG4gICAqIFJldGFpbnMgYWxsIHZlY3RvciBlbWJlZGRpbmdzIGRlcml2ZWQgZnJvbSB0aGUgZGF0YSBzb3VyY2UgZXZlbiBhZnRlclxuICAgKiBkZWxldGlvbiBvZiBhIGRhdGEgc291cmNlIHJlc291cmNlLlxuICAgKi9cbiAgUkVUQUlOID0gJ1JFVEFJTidcbn1cblxuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIHR5cGVzIG9mIGRhdGEgc291cmNlcyB0aGF0IGNhbiBiZSBhc3NvY2lhdGVkIHRvIGFuIEtub3dsZWRnZSBCYXNlLlxuICovXG5leHBvcnQgZW51bSBEYXRhU291cmNlVHlwZSB7XG4gIC8qKlxuICAgKiBBbWF6b24gUzMgQnVja2V0IGRhdGEgc291cmNlLlxuICAgKi9cbiAgUzMgPSAnUzMnLFxuXG4gIC8qKlxuICAgKiBDb25mbHVlbmNlIENsb3VkIEluc3RhbmNlIGRhdGEgc291cmNlLlxuICAgKi9cbiAgQ09ORkxVRU5DRSA9ICdDT05GTFVFTkNFJyxcblxuICAvKipcbiAgICogU2FsZXNmb3JjZSBpbnN0YW5jZSBkYXRhIHNvdXJjZS5cbiAgICovXG4gIFNBTEVTRk9SQ0UgPSAnU0FMRVNGT1JDRScsXG5cbiAgLyoqXG4gICAqIE1pY3Jvc29mdCBTaGFyZVBvaW50IGluc3RhbmNlIGRhdGEgc291cmNlLlxuICAgKi9cbiAgU0hBUkVQT0lOVCA9ICdTSEFSRVBPSU5UJyxcblxuICAvKipcbiAgICogV2ViIENyYXdsZXIgZGF0YSBzb3VyY2UuXG4gICAqIEV4dHJhY3RzIGNvbnRlbnQgZnJvbSBhdXRob3JpemVkIHB1YmxpYyB3ZWIgcGFnZXMgdXNpbmcgYSBjcmF3bGVyLlxuICAgKi9cbiAgV0VCX0NSQVdMRVIgPSAnV0VCJ1xufVxuXG5cbi8qKlxuICogU3BlY2lmaWVzIGludGVyZmFjZSBmb3IgcmVzb3VyY2VzIGNyZWF0ZWQgd2l0aCBDREsgb3IgaW1wb3J0ZWQgaW50byBDREsuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSURhdGFTb3VyY2UgZXh0ZW5kcyBJUmVzb3VyY2Uge1xuICAvKipcbiAgICogVGhlIHVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBkYXRhIHNvdXJjZS5cbiAgICogQGV4YW1wbGUgJ0pIVUVWWFVaTVUnXG4gICAqL1xuICByZWFkb25seSBkYXRhU291cmNlSWQ6IHN0cmluZztcbn1cblxuLyoqXG4gKiBTcGVjaWZpZXMgdGhlIGJhc2UgY2xhc3MgZm9yIGFsbCBkYXRhIHNvdXJjZSByZXNvdXJjZXMgKGltcG9ydGVkIGFuZCBuZXcpLlxuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgRGF0YVNvdXJjZUJhc2UgZXh0ZW5kcyBSZXNvdXJjZSBpbXBsZW1lbnRzIElEYXRhU291cmNlIHtcbiAgLyoqXG4gICAqIFRoZSB1bmlxdWUgaWRlbnRpZmllciBvZiB0aGUgZGF0YSBzb3VyY2UuXG4gICAqIEBleGFtcGxlICdKSFVFVlhVWk1VJ1xuICAgKi9cbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGRhdGFTb3VyY2VJZDogc3RyaW5nO1xuXG4gIC8vIENvbW1vbiBtZXRob2RzIGZvciBpbXBvcnRlZCBhbmQgbmV3IGRhdGEgc291cmNlcyBnbyBoZXJlXG59XG5cblxuLyoqXG4gKiBQcm9wZXJ0aWVzIGNvbW1vbiBmb3IgY3JlYXRpbmcgYW55IG9mIHRoZSBkaWZmZXJlbnQgZGF0YSBzb3VyY2UgdHlwZXMuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMge1xuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGRhdGEgc291cmNlLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIEEgbmV3IG5hbWUgd2lsbCBiZSBnZW5lcmF0ZWQuXG4gICAqL1xuICByZWFkb25seSBkYXRhU291cmNlTmFtZT86IHN0cmluZztcblxuICAvKipcbiAgICogQSBkZXNjcmlwdGlvbiBvZiB0aGUgZGF0YSBzb3VyY2UuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm8gZGVzY3JpcHRpb24gaXMgcHJvdmlkZWQuXG4gICAqL1xuICByZWFkb25seSBkZXNjcmlwdGlvbj86IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIEtNUyBrZXkgdG8gdXNlIHRvIGVuY3J5cHQgdGhlIGRhdGEgc291cmNlLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIFNlcnZpY2Ugb3duZWQgYW5kIG1hbmFnZWQga2V5LlxuICAgKi9cbiAgcmVhZG9ubHkga21zS2V5Pzoga21zLklLZXk7XG5cbiAgLyoqXG4gICAqIFRoZSBkYXRhIGRlbGV0aW9uIHBvbGljeSB0byBhcHBseSB0byB0aGUgZGF0YSBzb3VyY2UuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gU2V0cyB0aGUgZGF0YSBkZWxldGlvbiBwb2xpY3kgdG8gdGhlIGRlZmF1bHQgb2YgdGhlIGRhdGEgc291cmNlIHR5cGUuXG4gICAqL1xuICByZWFkb25seSBkYXRhRGVsZXRpb25Qb2xpY3k/OiBEYXRhRGVsZXRpb25Qb2xpY3k7XG5cbiAgLyoqXG4gICAqIFRoZSBjaHVua2luZyBzdGF0ZWd5IHRvIHVzZSBmb3Igc3BsaXR0aW5nIHlvdXIgZG9jdW1lbnRzIG9yIGNvbnRlbnQuXG4gICAqIFRoZSBjaHVua3MgYXJlIHRoZW4gY29udmVydGVkIHRvIGVtYmVkZGluZ3MgYW5kIHdyaXR0ZW4gdG8gdGhlIHZlY3RvclxuICAgKiBpbmRleCBhbGxvd2luZyBmb3Igc2ltaWxhcml0eSBzZWFyY2ggYW5kIHJldHJpZXZhbCBvZiB0aGUgY29udGVudC5cbiAgICpcbiAgICogQGRlZmF1bHQgQ2h1bmtpbmdTdHJhdGVneS5ERUZBVUxUXG4gICAqL1xuICByZWFkb25seSBjaHVua2luZ1N0cmF0ZWd5PzogQ2h1bmtpbmdTdHJhdGVneTtcblxuICAvKipcbiAgICogVGhlIHBhcnNpbmcgc3RyYXRlZ3kgdG8gdXNlLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIE5vIFBhcnNpbmcgU3RhdGVneSBpcyB1c2VkLlxuICAgKi9cbiAgcmVhZG9ubHkgcGFyc2luZ1N0cmF0ZWd5PzogUGFyc2luZ1N0YXRlZ3k7XG5cbiAgLyoqXG4gICAqIFRoZSBjdXN0b20gdHJhbnNmb3JtYXRpb24gc3RyYXRlZ3kgdG8gdXNlLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIE5vIGN1c3RvbSB0cmFuc2Zvcm1hdGlvbiBpcyB1c2VkLlxuICAgKi9cbiAgcmVhZG9ubHkgY3VzdG9tVHJhbnNmb3JtYXRpb24/OiBDdXN0b21UcmFuc2Zvcm1hdGlvbjtcbn1cblxuLyoqXG4gKiBTcGVjaWZpZXMgdGhlIGJhc2UgY2xhc3MgZm9yIGFsbCBORVcgZGF0YSBzb3VyY2UgcmVzb3VyY2VzIG9mIEFOWSB0eXBlLlxuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgRGF0YVNvdXJjZU5ldyBleHRlbmRzIERhdGFTb3VyY2VCYXNlIHtcbiAgLyoqXG4gICAqIFRoZSB1bmlxdWUgaWRlbnRpZmllciBvZiB0aGUgZGF0YSBzb3VyY2UuXG4gICAqIEBleGFtcGxlICdKSFVFVlhVWk1VJ1xuICAgKi9cbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGRhdGFTb3VyY2VJZDogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIHR5cGUgb2YgZGF0YSBzb3VyY2UuXG4gICAqL1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgZGF0YVNvdXJjZVR5cGU6IERhdGFTb3VyY2VUeXBlO1xuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGRhdGEgc291cmNlLlxuICAgKi9cbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGRhdGFTb3VyY2VOYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUga25vd2xlZGdlIGJhc2UgYXNzb2NpYXRlZCB3aXRoIHRoZSBkYXRhIHNvdXJjZS5cbiAgICovXG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSBrbm93bGVkZ2VCYXNlOiBJS25vd2xlZGdlQmFzZTtcbiAgLyoqXG4gICogVGhlIEtNUyBrZXkgdG8gdXNlIHRvIGVuY3J5cHQgdGhlIGRhdGEgc291cmNlLlxuICAqL1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkga21zS2V5Pzoga21zLklLZXk7XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIENvbW1vbiBtZXRob2RzIGZvciBBTEwgTkVXIGRhdGEgc291cmNlc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvKipcbiAgICogQWRkcyBhcHByb3ByaWF0ZSBwZXJtaXNzaW9ucyB0byB0aGUgS0IgZXhlY3V0aW9uIHJvbGUgbmVlZGVkIGJ5IHRoZSBkYXRhIHNvdXJjZS5cbiAgICovXG4gIHB1YmxpYyBoYW5kbGVDb21tb25QZXJtaXNzaW9ucyhwcm9wczogRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMpIHtcbiAgICBsZXQgc3RhdGVtZW50c1RvQWRkOiBQb2xpY3lTdGF0ZW1lbnRbXSA9IFtdO1xuICAgIC8vIFBhcnNpbmcgc3RyYXRlZ3kgcmVxdWlyZXMgYWNjZXNzIHRvIHRoZSBwYXJzaW5nIEZNLCBzbyBiZSBzdXJlIHRvIGFkZCBwZXJtaXNzaW9uc1xuICAgIGlmIChwcm9wcy5wYXJzaW5nU3RyYXRlZ3kpIHtcbiAgICAgIHN0YXRlbWVudHNUb0FkZC5wdXNoKC4uLnByb3BzLnBhcnNpbmdTdHJhdGVneS5nZW5lcmF0ZVBvbGljeVN0YXRlbWVudHMoKSk7XG4gICAgfVxuICAgIC8vIEN1c3RvbSB0cmFuc2Zvcm1hdGlvbiByZXF1aXJlcyBpbnZva2UgcGVybWlzc2lvbnMgZm9yIHRoZSBMYW1iZGFcbiAgICBpZiAocHJvcHMuY3VzdG9tVHJhbnNmb3JtYXRpb24pIHtcbiAgICAgIHN0YXRlbWVudHNUb0FkZC5wdXNoKC4uLnByb3BzLmN1c3RvbVRyYW5zZm9ybWF0aW9uLmdlbmVyYXRlUG9saWN5U3RhdGVtZW50cyh0aGlzKSk7XG4gICAgfVxuICAgIC8vIEFkZCB0aGUgcGVybWlzc2lvbiBzdGF0ZW1lbnRzIHRvIHRoZSBLQiBleGVjdXRpb24gcm9sZVxuICAgIHN0YXRlbWVudHNUb0FkZC5mb3JFYWNoKChzdGF0ZW1lbnQpID0+IHtcbiAgICAgIHRoaXMua25vd2xlZGdlQmFzZS5yb2xlLmFkZFRvUHJpbmNpcGFsUG9saWN5KHN0YXRlbWVudCk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRm9ybWF0cyB0aGUgZGF0YSBzb3VyY2UgY29uZmlndXJhdGlvbiBwcm9wZXJ0aWVzIGZvciBDbG91ZEZvcm1hdGlvbi5cbiAgICovXG4gIHB1YmxpYyBmb3JtYXRBc0NmblByb3BzKFxuICAgIHByb3BzOiBEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyxcbiAgICBkYXRhU291cmNlQ29uZmlndXJhdGlvbjogQ2ZuRGF0YVNvdXJjZS5EYXRhU291cmNlQ29uZmlndXJhdGlvblByb3BlcnR5LFxuICApOiBDZm5EYXRhU291cmNlUHJvcHMge1xuICAgIHJldHVybiB7XG4gICAgICBkYXRhRGVsZXRpb25Qb2xpY3k6IHByb3BzLmRhdGFEZWxldGlvblBvbGljeSxcbiAgICAgIGRhdGFTb3VyY2VDb25maWd1cmF0aW9uOiBkYXRhU291cmNlQ29uZmlndXJhdGlvbixcbiAgICAgIGRlc2NyaXB0aW9uOiBwcm9wcy5kZXNjcmlwdGlvbixcbiAgICAgIGtub3dsZWRnZUJhc2VJZDogdGhpcy5rbm93bGVkZ2VCYXNlLmtub3dsZWRnZUJhc2VJZCxcbiAgICAgIG5hbWU6IHRoaXMuZGF0YVNvdXJjZU5hbWUsXG4gICAgICBzZXJ2ZXJTaWRlRW5jcnlwdGlvbkNvbmZpZ3VyYXRpb246IHByb3BzLmttc0tleSA/IHtcbiAgICAgICAga21zS2V5QXJuOiBwcm9wcy5rbXNLZXkua2V5QXJuLFxuICAgICAgfSA6IHVuZGVmaW5lZCxcbiAgICAgIHZlY3RvckluZ2VzdGlvbkNvbmZpZ3VyYXRpb246IChwcm9wcy5jaHVua2luZ1N0cmF0ZWd5IHx8IHByb3BzLnBhcnNpbmdTdHJhdGVneSB8fCBwcm9wcy5jdXN0b21UcmFuc2Zvcm1hdGlvbikgPyB7XG4gICAgICAgIGNodW5raW5nQ29uZmlndXJhdGlvbjogcHJvcHMuY2h1bmtpbmdTdHJhdGVneT8uY29uZmlndXJhdGlvbixcbiAgICAgICAgcGFyc2luZ0NvbmZpZ3VyYXRpb246IHByb3BzLnBhcnNpbmdTdHJhdGVneT8uY29uZmlndXJhdGlvbixcbiAgICAgICAgY3VzdG9tVHJhbnNmb3JtYXRpb25Db25maWd1cmF0aW9uOiBwcm9wcy5jdXN0b21UcmFuc2Zvcm1hdGlvbj8uY29uZmlndXJhdGlvbixcbiAgICAgIH0gOiB1bmRlZmluZWQsXG5cbiAgICB9O1xuICB9XG5cbn1cblxuXG5leHBvcnQgY2xhc3MgRGF0YVNvdXJjZSBleHRlbmRzIERhdGFTb3VyY2VCYXNlIHtcblxuICBwdWJsaWMgc3RhdGljIGZyb21EYXRhU291cmNlSWQoc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgZGF0YVNvdXJjZUlkOiBzdHJpbmcpOiBJRGF0YVNvdXJjZSB7XG4gICAgcmV0dXJuIG5ldyBEYXRhU291cmNlKHNjb3BlLCBpZCwgZGF0YVNvdXJjZUlkKTtcbiAgfVxuXG4gIHB1YmxpYyByZWFkb25seSBkYXRhU291cmNlSWQ6IHN0cmluZztcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIGRhdGFTb3VyY2VJZDogc3RyaW5nKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcbiAgICB0aGlzLmRhdGFTb3VyY2VJZCA9IGRhdGFTb3VyY2VJZDtcbiAgfVxufVxuIl19