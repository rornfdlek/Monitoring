"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.KnowledgeBase = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_cdk_lib_1 = require("aws-cdk-lib");
const iam = require("aws-cdk-lib/aws-iam");
const nag_suppressions_1 = require("cdk-nag/lib/nag-suppressions");
const confluence_data_source_1 = require("./data-sources/confluence-data-source");
const s3_data_source_1 = require("./data-sources/s3-data-source");
const salesforce_data_source_1 = require("./data-sources/salesforce-data-source");
const sharepoint_data_source_1 = require("./data-sources/sharepoint-data-source");
const web_crawler_data_source_1 = require("./data-sources/web-crawler-data-source");
const utils_1 = require("../../common/helpers/utils");
const amazonaurora_1 = require("../amazonaurora");
const opensearch_vectorindex_1 = require("../opensearch-vectorindex");
const opensearchserverless_1 = require("../opensearchserverless");
const pinecone_1 = require("../pinecone");
/**
 * Knowledge base can be backed by different vector databases.
 * This enum represents the different vector databases that can be used.
 *
 * `OPENSEARCH_SERVERLESS` is the default vector database.
 * `REDIS_ENTERPRISE_CLOUD` is the vector database for Redis Enterprise Cloud.
 * `PINECONE` is the vector database for Pinecone.
 * `AMAZON_AURORA` is the vector database for Amazon Aurora PostgreSQL.
 */
var VectorStoreType;
(function (VectorStoreType) {
    /**
     * `OPENSEARCH_SERVERLESS` is the vector store for OpenSearch Serverless.
     */
    VectorStoreType["OPENSEARCH_SERVERLESS"] = "OPENSEARCH_SERVERLESS";
    /**
     * `PINECONE` is the vector store for Pinecone.
     */
    VectorStoreType["PINECONE"] = "PINECONE";
    /**
     * `RDS` is the vector store for Amazon Aurora.
     */
    VectorStoreType["AMAZON_AURORA"] = "RDS";
})(VectorStoreType || (VectorStoreType = {}));
/**
 * Abstract base class for Knowledge Base.
 * Contains methods valid for KBs either created with CDK or imported.
 */
class KnowledgeBaseBase extends aws_cdk_lib_1.Resource {
    constructor(scope, id) { super(scope, id); }
    // ------------------------------------------------------
    // Helper methods to add Data Sources
    // ------------------------------------------------------
    addS3DataSource(props) {
        return new s3_data_source_1.S3DataSource(this, `s3-${props.bucket.node.addr}`, {
            knowledgeBase: this, ...props,
        });
    }
    addWebCrawlerDataSource(props) {
        const url = new URL(props.sourceUrls[0]);
        return new web_crawler_data_source_1.WebCrawlerDataSource(this, `web-${url.hostname.replace('.', '-')}`, {
            knowledgeBase: this, ...props,
        });
    }
    addSharePointDataSource(props) {
        const url = new URL(props.siteUrls[0]);
        return new sharepoint_data_source_1.SharePointDataSource(this, `sp-${url.hostname.replace('.', '-')}`, {
            knowledgeBase: this, ...props,
        });
    }
    addConfluenceDataSource(props) {
        const url = new URL(props.confluenceUrl);
        return new confluence_data_source_1.ConfluenceDataSource(this, `cf-${url.hostname.replace('.', '-')}`, {
            knowledgeBase: this, ...props,
        });
    }
    addSalesforceDataSource(props) {
        const url = new URL(props.endpoint);
        return new salesforce_data_source_1.SalesforceDataSource(this, `sf-${url.hostname.replace('.', '-')}`, {
            knowledgeBase: this, ...props,
        });
    }
}
/**
 * Deploys a Bedrock Knowledge Base and configures a backend by OpenSearch Serverless,
 * Pinecone, Redis Enterprise Cloud or Amazon Aurora PostgreSQL.
 *
 */
class KnowledgeBase extends KnowledgeBaseBase {
    // ------------------------------------------------------
    // Import Methods
    // ------------------------------------------------------
    static fromKnowledgeBaseAttributes(scope, id, attrs) {
        const stack = aws_cdk_lib_1.Stack.of(scope);
        class Import extends KnowledgeBaseBase {
            constructor() {
                super(...arguments);
                this.knowledgeBaseArn = stack.formatArn({
                    service: 'bedrock',
                    resource: 'knowledge-base',
                    resourceName: attrs.knowledgeBaseId,
                    arnFormat: aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME,
                });
                this.role = iam.Role.fromRoleArn(this, `kb-${attrs.knowledgeBaseId}-role`, attrs.executionRoleArn);
                this.knowledgeBaseId = attrs.knowledgeBaseId;
            }
        }
        return new Import(scope, id);
    }
    constructor(scope, id, props) {
        super(scope, id);
        this.instruction = props.instruction;
        const embeddingsModel = props.embeddingsModel;
        const indexName = props.indexName ?? 'bedrock-knowledge-base-default-index';
        const vectorField = props.vectorField ?? 'bedrock-knowledge-base-default-vector';
        const textField = 'AMAZON_BEDROCK_TEXT_CHUNK';
        const metadataField = 'AMAZON_BEDROCK_METADATA';
        this.description = props.description ?? 'CDK deployed Knowledge base'; // even though this prop is optional, if no value is provided it will fail to deploy
        this.knowledgeBaseState = props.knowledgeBaseState ?? 'ENABLED';
        validateModel(embeddingsModel);
        validateVectorIndex(props.vectorStore, props.vectorIndex, props.vectorField, props.indexName);
        if (props.vectorIndex) {
            validateIndexParameters(props.vectorIndex, indexName, vectorField);
        }
        this.name =
            props.name ?? (0, utils_1.generatePhysicalNameV2)(this, 'KB', { maxLength: 32 });
        if (props.existingRole) {
            this.role = props.existingRole;
        }
        else {
            const roleName = (0, utils_1.generatePhysicalNameV2)(this, 'AmazonBedrockExecutionRoleForKnowledgeBase', { maxLength: 64 });
            this.role = new iam.Role(this, 'Role', {
                roleName: roleName,
                assumedBy: new iam.ServicePrincipal('bedrock.amazonaws.com', {
                    conditions: {
                        StringEquals: { 'aws:SourceAccount': aws_cdk_lib_1.Stack.of(this).account },
                        ArnLike: {
                            'aws:SourceArn': aws_cdk_lib_1.Stack.of(this).formatArn({
                                service: 'bedrock',
                                resource: 'knowledge-base',
                                resourceName: '*',
                                arnFormat: aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME,
                            }),
                        },
                    },
                }),
            });
            this.role.addToPrincipalPolicy(new iam.PolicyStatement({
                actions: ['bedrock:InvokeModel'],
                resources: [embeddingsModel.asArn(this)],
            }));
        }
        /**
         * Create the vector store if the vector store was provided by the user.
         * Otherwise check againts all possible vector datastores.
         * If none was provided create default OpenSearch Serverless Collection.
         */
        if (props.vectorStore instanceof opensearchserverless_1.VectorCollection) {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handleOpenSearchCollection(props));
        }
        else if (props.vectorStore instanceof pinecone_1.PineconeVectorStore) {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handlePineconeVectorStore(props));
        }
        else if (props.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ||
            props.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore) {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handleAmazonAuroraVectorStore(props));
        }
        else {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handleOpenSearchDefaultVectorCollection());
        }
        /**
         * We need to add `secretsmanager:GetSecretValue` to the role
         * of the knowledge base if we use data sources
         * other than OpenSearch Serverless.
         */
        if (!(this.vectorStore instanceof opensearchserverless_1.VectorCollection)) {
            this.role.addToPrincipalPolicy(new iam.PolicyStatement({
                actions: ['secretsmanager:GetSecretValue'],
                resources: [this.vectorStore.credentialsSecretArn],
            }));
        }
        /**
         * We need to add `rds-data:ExecuteStatement`,
         * `rds-data:BatchExecuteStatement` and
         * `rds:DescribeDBClusters` to the role
         * of the knowledge base if we use Amazon Aurora as
         * a data source.
         */
        if (this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ||
            this.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore) {
            this.role.addToPrincipalPolicy(new iam.PolicyStatement({
                actions: [
                    'rds-data:ExecuteStatement',
                    'rds-data:BatchExecuteStatement',
                    'rds:DescribeDBClusters',
                ],
                resources: [this.vectorStore.resourceArn],
            }));
        }
        /**
         * Create the vector index if the vector store is OpenSearch Serverless
         * and it was not provided. Otherwise use the provided vector index.
         */
        if (this.vectorStoreType === VectorStoreType.OPENSEARCH_SERVERLESS) {
            if (!props.vectorIndex) {
                this.vectorIndex = new opensearch_vectorindex_1.VectorIndex(this, 'KBIndex', {
                    collection: this.vectorStore,
                    indexName,
                    vectorField,
                    vectorDimensions: embeddingsModel.vectorDimensions,
                    mappings: [
                        {
                            mappingField: 'AMAZON_BEDROCK_TEXT_CHUNK',
                            dataType: 'text',
                            filterable: true,
                        },
                        {
                            mappingField: 'AMAZON_BEDROCK_METADATA',
                            dataType: 'text',
                            filterable: false,
                        },
                    ],
                });
                this.vectorIndex.node.addDependency(this.vectorStore);
            }
            else {
                this.vectorIndex = props.vectorIndex;
            }
        }
        /**
         * Create storage configuraion. If it is of type of
         * `AmazonAuroraVectorStore` or `ExistingAmazonAuroraVectorStore`,
         * then get textField, metadataField and vectorField from
         * the arguments. Otherwise use default values.
         */
        const storageConfiguration = {
            indexName: indexName,
            vectorStore: this.vectorStore,
            vectorStoreType: this.vectorStoreType,
            vectorField: this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ||
                this.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore
                ? this.vectorStore.vectorField
                : vectorField,
            textField: this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ||
                this.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore ||
                this.vectorStore instanceof pinecone_1.PineconeVectorStore
                ? this.vectorStore.textField
                : textField,
            metadataField: this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ||
                this.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore ||
                this.vectorStore instanceof pinecone_1.PineconeVectorStore
                ? this.vectorStore.metadataField
                : metadataField,
        };
        const knowledgeBase = new aws_cdk_lib_1.aws_bedrock.CfnKnowledgeBase(this, 'MyCfnKnowledgeBase', {
            knowledgeBaseConfiguration: {
                type: 'VECTOR',
                vectorKnowledgeBaseConfiguration: {
                    embeddingModelArn: embeddingsModel.asArn(this),
                    // Used this approach as if property is specified on models that do not
                    // support configurable dimensions CloudFormation throws an error at runtime
                    embeddingModelConfiguration: (embeddingsModel.modelId === 'amazon.titan-embed-text-v2:0')
                        ? ({ bedrockEmbeddingModelConfiguration: { dimensions: embeddingsModel.vectorDimensions } })
                        : undefined,
                },
            },
            name: this.name,
            roleArn: this.role.roleArn,
            storageConfiguration: getStorageConfiguration(storageConfiguration),
            description: props.description,
            tags: props.tags,
        });
        this.knowledgeBaseInstance = knowledgeBase;
        const kbCRPolicy = new iam.Policy(this, 'KBCRPolicy', {
            // roles: [crProvider.role],
            roles: [this.role],
            statements: [
                new iam.PolicyStatement({
                    actions: [
                        'bedrock:CreateKnowledgeBase',
                        /**
                         * We need to add `bedrock:AssociateThirdPartyKnowledgeBase` if
                         * we are deploying Redis or Pinecone data sources
                         */
                        //...(this.vectorStoreType === VectorStoreType.REDIS_ENTERPRISE_CLOUD ||
                        ...(this.vectorStoreType === VectorStoreType.PINECONE
                            ? ['bedrock:AssociateThirdPartyKnowledgeBase']
                            : []),
                    ],
                    resources: ['*'],
                }),
                new iam.PolicyStatement({
                    actions: [
                        'bedrock:UpdateKnowledgeBase',
                        'bedrock:DeleteKnowledgeBase',
                        'bedrock:TagResource',
                    ],
                    resources: [
                        aws_cdk_lib_1.Stack.of(this).formatArn({
                            service: 'bedrock',
                            resource: 'knowledge-base',
                            resourceName: '*',
                            arnFormat: aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME,
                        }),
                    ],
                }),
                new iam.PolicyStatement({
                    actions: ['iam:PassRole'],
                    resources: [this.role.roleArn],
                }),
            ],
        });
        knowledgeBase.node.addDependency(this.role);
        knowledgeBase.node.addDependency(kbCRPolicy);
        if (this.vectorStoreType === VectorStoreType.OPENSEARCH_SERVERLESS &&
            this.vectorIndex) {
            knowledgeBase.node.addDependency(this.vectorIndex);
        }
        if (this.vectorStoreType === VectorStoreType.AMAZON_AURORA) {
            knowledgeBase.node.addDependency(this.vectorStore);
        }
        nag_suppressions_1.NagSuppressions.addResourceSuppressions(kbCRPolicy, [
            {
                id: 'AwsSolutions-IAM5',
                reason: "Bedrock CreateKnowledgeBase can't be restricted by resource.",
            },
        ], true);
        this.knowledgeBaseArn = knowledgeBase.attrKnowledgeBaseArn;
        this.knowledgeBaseId = knowledgeBase.attrKnowledgeBaseId;
    }
    /**
     * Handle VectorCollection type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of VectorCollection, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleOpenSearchCollection(props) {
        const vectorStore = props.vectorStore;
        vectorStore.grantDataAccess(this.role);
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.OPENSEARCH_SERVERLESS,
        };
    }
    /**
     * Handle PineconeVectorStore type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of PineconeVectorStore, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handlePineconeVectorStore(props) {
        const vectorStore = props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.PINECONE,
        };
    }
    /**
     * Handle AmazonAuroraVectorStore type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of AmazonAuroraVectorStore, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleAmazonAuroraVectorStore(props) {
        const vectorStore = props.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore ?
            props.vectorStore : props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.AMAZON_AURORA,
        };
    }
    /**
     * Handle the default VectorStore type.
     *
     * @returns The instance of VectorCollection, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleOpenSearchDefaultVectorCollection() {
        const vectorStore = new opensearchserverless_1.VectorCollection(this, 'KBVectors');
        vectorStore.grantDataAccess(this.role);
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.OPENSEARCH_SERVERLESS,
        };
    }
    /**
     * Associate knowledge base with an agent
     */
    associateToAgent(agent) {
        const agentKnowledgeBaseProperty = {
            description: this.description,
            knowledgeBaseId: this.knowledgeBaseId,
            knowledgeBaseState: this.knowledgeBaseState,
        };
        agent.knowledgeBases = [agentKnowledgeBaseProperty];
    }
}
exports.KnowledgeBase = KnowledgeBase;
_a = JSII_RTTI_SYMBOL_1;
KnowledgeBase[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.KnowledgeBase", version: "0.1.285" };
/**
 * Validate that Bedrock Knowledge Base can use the selected model.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateModel(foundationModel) {
    if (!foundationModel.supportsKnowledgeBase) {
        throw new Error(`The model ${foundationModel} is not supported by Bedrock Knowledge Base.`);
    }
}
/**
 * Validate if VectorIndex was provided for a VectorStore of type
 * other than `VectorCollection`.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateVectorIndex(vectorStore, vectorIndex, vectorField, indexName) {
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && vectorIndex) {
        throw new Error('If vectorStore is not of type VectorCollection, vectorIndex should not be provided ' +
            'in KnowledgeBase construct.');
    }
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && indexName) {
        throw new Error('If vectorStore is not of type VectorCollection, indexName should not be provided ' +
            'in KnowledgeBase construct.');
    }
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && vectorField) {
        throw new Error('If vectorStore is not of type VectorCollection, vectorField should not be provided ' +
            'in KnowledgeBase construct.');
    }
}
/**
 * Validate that indexName and vectorField parameters are identical
 * in KnowledgeBase construct if VectorIndex was created manually.
 *
 * By default we assign `vectorIndex` to `bedrock-knowledge-base-default-index`
 * value and if user provides `vectorIndex` manually, we need to make sure
 * they also provide it in KnowledgeBase construct if the value is not
 * `bedrock-knowledge-base-default-index`. Same for vectorField.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateIndexParameters(vectorIndex, indexName, vectorField) {
    if (vectorIndex.indexName !== 'bedrock-knowledge-base-default-index') {
        if (vectorIndex.indexName !== indexName) {
            throw new Error('Default value of indexName is `bedrock-knowledge-base-default-index`.' +
                ' If you create VectorIndex manually and assign vectorIndex to value other than' +
                ' `bedrock-knowledge-base-default-index` then you must provide the same value in KnowledgeBase construct.' +
                ' If you created VectorIndex manually and set it to `bedrock-knowledge-base-default-index`' +
                ' then do not assign indexName in KnowledgeBase construct.');
        }
    }
    if (vectorIndex.vectorField !== 'bedrock-knowledge-base-default-vector') {
        if (vectorIndex.vectorField !== vectorField) {
            throw new Error('Default value of vectorField is `bedrock-knowledge-base-default-vector`.' +
                ' If you create VectorIndex manually and assign vectorField to value other than' +
                ' `bedrock-knowledge-base-default-field` then you must provide the same value in KnowledgeBase construct.' +
                ' If you created VectorIndex manually and set it to `bedrock-knowledge-base-default-vector`' +
                ' then do not assign vectorField in KnowledgeBase construct.');
        }
    }
}
/**
 * Determine storage configuration based on vector store type.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function getStorageConfiguration(params) {
    switch (params.vectorStoreType) {
        case VectorStoreType.OPENSEARCH_SERVERLESS:
            params.vectorStore = params.vectorStore;
            return {
                type: VectorStoreType.OPENSEARCH_SERVERLESS,
                opensearchServerlessConfiguration: {
                    collectionArn: params.vectorStore.collectionArn,
                    fieldMapping: {
                        vectorField: params.vectorField,
                        textField: params.textField,
                        metadataField: params.metadataField,
                    },
                    vectorIndexName: params.indexName,
                },
            };
        case VectorStoreType.PINECONE:
            params.vectorStore = params.vectorStore;
            return {
                type: VectorStoreType.PINECONE,
                pineconeConfiguration: {
                    namespace: params.vectorStore.namespace || undefined,
                    connectionString: params.vectorStore.connectionString,
                    credentialsSecretArn: params.vectorStore.credentialsSecretArn,
                    fieldMapping: {
                        textField: params.textField,
                        metadataField: params.metadataField,
                    },
                },
            };
        case VectorStoreType.AMAZON_AURORA:
            params.vectorStore =
                params.vectorStore instanceof amazonaurora_1.ExistingAmazonAuroraVectorStore ?
                    params.vectorStore : params.vectorStore;
            return {
                type: VectorStoreType.AMAZON_AURORA,
                rdsConfiguration: {
                    credentialsSecretArn: params.vectorStore.credentialsSecretArn,
                    databaseName: params.vectorStore.databaseName,
                    resourceArn: params.vectorStore.resourceArn,
                    tableName: `${params.vectorStore.schemaName}.${params.vectorStore.tableName}`,
                    fieldMapping: {
                        vectorField: params.vectorField.replace(/-/g, '_'),
                        primaryKeyField: params.vectorStore.primaryKeyField,
                        textField: params.textField.toLowerCase(),
                        metadataField: params.metadataField.toLowerCase(),
                    },
                },
            };
        default:
            throw new Error(`Unsupported vector store type: ${params.vectorStoreType}`);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia25vd2xlZGdlLWJhc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY2RrLWxpYi9iZWRyb2NrL2tub3dsZWRnZS1iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7QUFFSCw2Q0FBNEY7QUFDNUYsMkNBQTJDO0FBQzNDLG1FQUErRDtBQUcvRCxrRkFBbUg7QUFDbkgsa0VBQTJGO0FBQzNGLGtGQUFtSDtBQUNuSCxrRkFBbUg7QUFDbkgsb0ZBQW9IO0FBQ3BILHNEQUFvRTtBQUNwRSxrREFBMkY7QUFFM0Ysc0VBQXdEO0FBQ3hELGtFQUEyRDtBQUMzRCwwQ0FBa0Q7QUFFbEQ7Ozs7Ozs7O0dBUUc7QUFDSCxJQUFLLGVBYUo7QUFiRCxXQUFLLGVBQWU7SUFDbEI7O09BRUc7SUFDSCxrRUFBK0MsQ0FBQTtJQUMvQzs7T0FFRztJQUNILHdDQUFxQixDQUFBO0lBQ3JCOztPQUVHO0lBQ0gsd0NBQXFCLENBQUE7QUFDdkIsQ0FBQyxFQWJJLGVBQWUsS0FBZixlQUFlLFFBYW5CO0FBeUZEOzs7R0FHRztBQUNILE1BQWUsaUJBQWtCLFNBQVEsc0JBQVE7SUFLL0MsWUFBWSxLQUFnQixFQUFFLEVBQVUsSUFBSSxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMvRCx5REFBeUQ7SUFDekQscUNBQXFDO0lBQ3JDLHlEQUF5RDtJQUNsRCxlQUFlLENBQUMsS0FBbUM7UUFDeEQsT0FBTyxJQUFJLDZCQUFZLENBQUMsSUFBSSxFQUFFLE1BQU0sS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEVBQUU7WUFDNUQsYUFBYSxFQUFFLElBQUksRUFBRSxHQUFHLEtBQUs7U0FDOUIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUNNLHVCQUF1QixDQUFDLEtBQTJDO1FBQ3hFLE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssQ0FB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em9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS4gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogIHdpdGggdGhlIExpY2Vuc2UuIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiAgb3IgaW4gdGhlICdsaWNlbnNlJyBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAnQVMgSVMnIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVNcbiAqICBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xuICogIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgeyBBcm5Gb3JtYXQsIGF3c19iZWRyb2NrIGFzIGJlZHJvY2ssIElSZXNvdXJjZSwgUmVzb3VyY2UsIFN0YWNrIH0gZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gJ2F3cy1jZGstbGliL2F3cy1pYW0nO1xuaW1wb3J0IHsgTmFnU3VwcHJlc3Npb25zIH0gZnJvbSAnY2RrLW5hZy9saWIvbmFnLXN1cHByZXNzaW9ucyc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCB7IEFnZW50IH0gZnJvbSAnLi8uLi9iZWRyb2NrL2FnZW50JztcbmltcG9ydCB7IENvbmZsdWVuY2VEYXRhU291cmNlLCBDb25mbHVlbmNlRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMgfSBmcm9tICcuL2RhdGEtc291cmNlcy9jb25mbHVlbmNlLWRhdGEtc291cmNlJztcbmltcG9ydCB7IFMzRGF0YVNvdXJjZSwgUzNEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyB9IGZyb20gJy4vZGF0YS1zb3VyY2VzL3MzLWRhdGEtc291cmNlJztcbmltcG9ydCB7IFNhbGVzZm9yY2VEYXRhU291cmNlLCBTYWxlc2ZvcmNlRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMgfSBmcm9tICcuL2RhdGEtc291cmNlcy9zYWxlc2ZvcmNlLWRhdGEtc291cmNlJztcbmltcG9ydCB7IFNoYXJlUG9pbnREYXRhU291cmNlLCBTaGFyZVBvaW50RGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMgfSBmcm9tICcuL2RhdGEtc291cmNlcy9zaGFyZXBvaW50LWRhdGEtc291cmNlJztcbmltcG9ydCB7IFdlYkNyYXdsZXJEYXRhU291cmNlLCBXZWJDcmF3bGVyRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMgfSBmcm9tICcuL2RhdGEtc291cmNlcy93ZWItY3Jhd2xlci1kYXRhLXNvdXJjZSc7XG5pbXBvcnQgeyBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyIH0gZnJvbSAnLi4vLi4vY29tbW9uL2hlbHBlcnMvdXRpbHMnO1xuaW1wb3J0IHsgRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSwgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUgfSBmcm9tICcuLi9hbWF6b25hdXJvcmEnO1xuaW1wb3J0IHsgQmVkcm9ja0ZvdW5kYXRpb25Nb2RlbCB9IGZyb20gJy4vbW9kZWxzJztcbmltcG9ydCB7IFZlY3RvckluZGV4IH0gZnJvbSAnLi4vb3BlbnNlYXJjaC12ZWN0b3JpbmRleCc7XG5pbXBvcnQgeyBWZWN0b3JDb2xsZWN0aW9uIH0gZnJvbSAnLi4vb3BlbnNlYXJjaHNlcnZlcmxlc3MnO1xuaW1wb3J0IHsgUGluZWNvbmVWZWN0b3JTdG9yZSB9IGZyb20gJy4uL3BpbmVjb25lJztcblxuLyoqXG4gKiBLbm93bGVkZ2UgYmFzZSBjYW4gYmUgYmFja2VkIGJ5IGRpZmZlcmVudCB2ZWN0b3IgZGF0YWJhc2VzLlxuICogVGhpcyBlbnVtIHJlcHJlc2VudHMgdGhlIGRpZmZlcmVudCB2ZWN0b3IgZGF0YWJhc2VzIHRoYXQgY2FuIGJlIHVzZWQuXG4gKlxuICogYE9QRU5TRUFSQ0hfU0VSVkVSTEVTU2AgaXMgdGhlIGRlZmF1bHQgdmVjdG9yIGRhdGFiYXNlLlxuICogYFJFRElTX0VOVEVSUFJJU0VfQ0xPVURgIGlzIHRoZSB2ZWN0b3IgZGF0YWJhc2UgZm9yIFJlZGlzIEVudGVycHJpc2UgQ2xvdWQuXG4gKiBgUElORUNPTkVgIGlzIHRoZSB2ZWN0b3IgZGF0YWJhc2UgZm9yIFBpbmVjb25lLlxuICogYEFNQVpPTl9BVVJPUkFgIGlzIHRoZSB2ZWN0b3IgZGF0YWJhc2UgZm9yIEFtYXpvbiBBdXJvcmEgUG9zdGdyZVNRTC5cbiAqL1xuZW51bSBWZWN0b3JTdG9yZVR5cGUge1xuICAvKipcbiAgICogYE9QRU5TRUFSQ0hfU0VSVkVSTEVTU2AgaXMgdGhlIHZlY3RvciBzdG9yZSBmb3IgT3BlblNlYXJjaCBTZXJ2ZXJsZXNzLlxuICAgKi9cbiAgT1BFTlNFQVJDSF9TRVJWRVJMRVNTID0gJ09QRU5TRUFSQ0hfU0VSVkVSTEVTUycsXG4gIC8qKlxuICAgKiBgUElORUNPTkVgIGlzIHRoZSB2ZWN0b3Igc3RvcmUgZm9yIFBpbmVjb25lLlxuICAgKi9cbiAgUElORUNPTkUgPSAnUElORUNPTkUnLFxuICAvKipcbiAgICogYFJEU2AgaXMgdGhlIHZlY3RvciBzdG9yZSBmb3IgQW1hem9uIEF1cm9yYS5cbiAgICovXG4gIEFNQVpPTl9BVVJPUkEgPSAnUkRTJyxcbn1cblxuLyoqXG4gKiBJbnRlcmZhY2UgZm9yIHRoZSBjb25maWd1cmF0aW9uIG9mIHRoZSBzdG9yYWdlIGZvciBrbm93bGVkZ2UgYmFzZS5cbiAqL1xuaW50ZXJmYWNlIFN0b3JhZ2VDb25maWd1cmF0aW9uIHtcbiAgLyoqXG4gICAqIFRoZSB2ZWN0b3Igc3RvcmUsIHdoaWNoIGNhbiBiZSBvZiBgVmVjdG9yQ29sbGVjdGlvbmAsIGBQaW5lY29uZVZlY3RvclN0b3JlYCBvclxuICAgKiBgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVgIHR5cGVzLlxuICAgKi9cbiAgdmVjdG9yU3RvcmU6XG4gIHwgVmVjdG9yQ29sbGVjdGlvblxuICB8IFBpbmVjb25lVmVjdG9yU3RvcmVcbiAgfCBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVxuICB8IEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmU7XG5cbiAgLyoqXG4gICAqIFRoZSB0eXBlIG9mIHRoZSB2ZWN0b3Igc3RvcmUuXG4gICAqL1xuICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZTtcblxuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGluZGV4LlxuICAgKi9cbiAgaW5kZXhOYW1lOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBmaWVsZCBvZiB0aGUgdmVjdG9yIGZpZWxkIGZvciB2ZWN0b3IgbWFwcGluZy5cbiAgICovXG4gIHZlY3RvckZpZWxkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBmaWVsZCBvZiB0aGUgdGV4dCBmaWVsZCBmb3IgdmVjdG9yIG1hcHBpbmcuXG4gICAqL1xuICB0ZXh0RmllbGQ6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGZpZWxkIG9mIHRoZSBtZXRhZGF0YS5cbiAgICovXG4gIG1ldGFkYXRhRmllbGQ6IHN0cmluZztcbn1cblxuLyoqXG4gKiBSZXByZXNlbnRzIGEgS25vd2xlZGdlIEJhc2UsIGVpdGhlciBjcmVhdGVkIHdpdGggQ0RLIG9yIGltcG9ydGVkLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIElLbm93bGVkZ2VCYXNlIGV4dGVuZHMgSVJlc291cmNlIHtcbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKiBAZXhhbXBsZSBcImFybjphd3M6YmVkcm9jazp1cy1lYXN0LTE6MTIzNDU2Nzg5MDEyOmtub3dsZWRnZS1iYXNlL0tCMTIzNDU2NzhcIlxuICAgKi9cbiAgcmVhZG9ubHkga25vd2xlZGdlQmFzZUFybjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgSUQgb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKiBAZXhhbXBsZSBcIktCMTIzNDU2NzhcIlxuICAgKi9cbiAgcmVhZG9ubHkga25vd2xlZGdlQmFzZUlkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSByb2xlIGFzc29jaWF0ZWQgd2l0aCB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICByZWFkb25seSByb2xlOiBpYW0uSVJvbGU7XG5cbiAgLyoqXG4gICAqIEFkZCBhbiBTMyBkYXRhIHNvdXJjZSB0byB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICBhZGRTM0RhdGFTb3VyY2UocHJvcHM6IFMzRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMpOiBTM0RhdGFTb3VyY2U7XG5cbiAgLyoqXG4gICAqIEFkZCBhIHdlYiBjcmF3bGVyIGRhdGEgc291cmNlIHRvIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIGFkZFdlYkNyYXdsZXJEYXRhU291cmNlKHByb3BzOiBXZWJDcmF3bGVyRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMpOiBXZWJDcmF3bGVyRGF0YVNvdXJjZTtcblxuICAvKipcbiAgICogQWRkIGEgU2hhcmVQb2ludCBkYXRhIHNvdXJjZSB0byB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICBhZGRTaGFyZVBvaW50RGF0YVNvdXJjZShwcm9wczogU2hhcmVQb2ludERhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzKTogU2hhcmVQb2ludERhdGFTb3VyY2U7XG5cbiAgLyoqXG4gICAqIEFkZCBhIENvbmZsdWVuY2UgZGF0YSBzb3VyY2UgdG8gdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgYWRkQ29uZmx1ZW5jZURhdGFTb3VyY2UocHJvcHM6IENvbmZsdWVuY2VEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyk6IENvbmZsdWVuY2VEYXRhU291cmNlO1xuXG4gIC8qKlxuICAgKiBBZGQgYSBTYWxlc2ZvcmNlIGRhdGEgc291cmNlIHRvIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIGFkZFNhbGVzZm9yY2VEYXRhU291cmNlKHByb3BzOiBTYWxlc2ZvcmNlRGF0YVNvdXJjZUFzc29jaWF0aW9uUHJvcHMpOiBTYWxlc2ZvcmNlRGF0YVNvdXJjZTtcbn1cblxuLyoqXG4gKiBBYnN0cmFjdCBiYXNlIGNsYXNzIGZvciBLbm93bGVkZ2UgQmFzZS5cbiAqIENvbnRhaW5zIG1ldGhvZHMgdmFsaWQgZm9yIEtCcyBlaXRoZXIgY3JlYXRlZCB3aXRoIENESyBvciBpbXBvcnRlZC5cbiAqL1xuYWJzdHJhY3QgY2xhc3MgS25vd2xlZGdlQmFzZUJhc2UgZXh0ZW5kcyBSZXNvdXJjZSBpbXBsZW1lbnRzIElLbm93bGVkZ2VCYXNlIHtcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGtub3dsZWRnZUJhc2VBcm46IHN0cmluZztcbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGtub3dsZWRnZUJhc2VJZDogc3RyaW5nO1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgcm9sZTogaWFtLklSb2xlO1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcpIHsgc3VwZXIoc2NvcGUsIGlkKTsgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gSGVscGVyIG1ldGhvZHMgdG8gYWRkIERhdGEgU291cmNlc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgcHVibGljIGFkZFMzRGF0YVNvdXJjZShwcm9wczogUzNEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyk6IFMzRGF0YVNvdXJjZSB7XG4gICAgcmV0dXJuIG5ldyBTM0RhdGFTb3VyY2UodGhpcywgYHMzLSR7cHJvcHMuYnVja2V0Lm5vZGUuYWRkcn1gLCB7XG4gICAgICBrbm93bGVkZ2VCYXNlOiB0aGlzLCAuLi5wcm9wcyxcbiAgICB9KTtcbiAgfVxuICBwdWJsaWMgYWRkV2ViQ3Jhd2xlckRhdGFTb3VyY2UocHJvcHM6IFdlYkNyYXdsZXJEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyk6IFdlYkNyYXdsZXJEYXRhU291cmNlIHtcbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHByb3BzLnNvdXJjZVVybHNbMF0pO1xuICAgIHJldHVybiBuZXcgV2ViQ3Jhd2xlckRhdGFTb3VyY2UodGhpcywgYHdlYi0ke3VybC5ob3N0bmFtZS5yZXBsYWNlKCcuJywgJy0nKX1gLCB7XG4gICAgICBrbm93bGVkZ2VCYXNlOiB0aGlzLCAuLi5wcm9wcyxcbiAgICB9KTtcbiAgfVxuICBwdWJsaWMgYWRkU2hhcmVQb2ludERhdGFTb3VyY2UocHJvcHM6IFNoYXJlUG9pbnREYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyk6IFNoYXJlUG9pbnREYXRhU291cmNlIHtcbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHByb3BzLnNpdGVVcmxzWzBdKTtcbiAgICByZXR1cm4gbmV3IFNoYXJlUG9pbnREYXRhU291cmNlKHRoaXMsIGBzcC0ke3VybC5ob3N0bmFtZS5yZXBsYWNlKCcuJywgJy0nKX1gLCB7XG4gICAgICBrbm93bGVkZ2VCYXNlOiB0aGlzLCAuLi5wcm9wcyxcbiAgICB9KTtcbiAgfVxuICBwdWJsaWMgYWRkQ29uZmx1ZW5jZURhdGFTb3VyY2UocHJvcHM6IENvbmZsdWVuY2VEYXRhU291cmNlQXNzb2NpYXRpb25Qcm9wcyk6IENvbmZsdWVuY2VEYXRhU291cmNlIHtcbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHByb3BzLmNvbmZsdWVuY2VVcmwpO1xuICAgIHJldHVybiBuZXcgQ29uZmx1ZW5jZURhdGFTb3VyY2UodGhpcywgYGNmLSR7dXJsLmhvc3RuYW1lLnJlcGxhY2UoJy4nLCAnLScpfWAsIHtcbiAgICAgIGtub3dsZWRnZUJhc2U6IHRoaXMsIC4uLnByb3BzLFxuICAgIH0pO1xuICB9XG4gIHB1YmxpYyBhZGRTYWxlc2ZvcmNlRGF0YVNvdXJjZShwcm9wczogU2FsZXNmb3JjZURhdGFTb3VyY2VBc3NvY2lhdGlvblByb3BzKTogU2FsZXNmb3JjZURhdGFTb3VyY2Uge1xuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwocHJvcHMuZW5kcG9pbnQpO1xuICAgIHJldHVybiBuZXcgU2FsZXNmb3JjZURhdGFTb3VyY2UodGhpcywgYHNmLSR7dXJsLmhvc3RuYW1lLnJlcGxhY2UoJy4nLCAnLScpfWAsIHtcbiAgICAgIGtub3dsZWRnZUJhc2U6IHRoaXMsIC4uLnByb3BzLFxuICAgIH0pO1xuICB9XG59XG5cbi8qKlxuICogUHJvcGVydGllcyBmb3IgYSBrbm93bGVkZ2UgYmFzZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIEtub3dsZWRnZUJhc2VQcm9wcyB7XG4gIC8qKlxuICAgKiBUaGUgZW1iZWRkaW5ncyBtb2RlbCBmb3IgdGhlIGtub3dsZWRnZSBiYXNlXG4gICAqL1xuICByZWFkb25seSBlbWJlZGRpbmdzTW9kZWw6IEJlZHJvY2tGb3VuZGF0aW9uTW9kZWw7XG5cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIHJlYWRvbmx5IG5hbWU/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBkZXNjcmlwdGlvbiBvZiB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm8gZGVzY3JpcHRpb24gcHJvdmlkZWQuXG4gICAqL1xuICByZWFkb25seSBkZXNjcmlwdGlvbj86IHN0cmluZztcblxuICAvKipcbiAgICogRXhpc3RpbmcgSUFNIHJvbGUgd2l0aCBhIHBvbGljeSBzdGF0ZW1lbnRcbiAgICogZ3JhbnRpbmcgcGVybWlzc2lvbiB0byBpbnZva2UgdGhlIHNwZWNpZmljIGVtYmVkZGluZ3MgbW9kZWwuXG4gICAqIEFueSBlbnRpdHkgKGUuZy4sIGFuIEFXUyBzZXJ2aWNlIG9yIGFwcGxpY2F0aW9uKSB0aGF0IGFzc3VtZXNcbiAgICogdGhpcyByb2xlIHdpbGwgYmUgYWJsZSB0byBpbnZva2Ugb3IgdXNlIHRoZVxuICAgKiBzcGVjaWZpZWQgZW1iZWRkaW5ncyBtb2RlbCB3aXRoaW4gdGhlIEJlZHJvY2sgc2VydmljZS5cbiAgICovXG4gIHJlYWRvbmx5IGV4aXN0aW5nUm9sZT86IGlhbS5JUm9sZTtcblxuICAvKipcbiAgICogQSBuYXJyYXRpdmUgZGVzY3JpcHRpb24gb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKlxuICAgKiBBIEJlZHJvY2sgQWdlbnQgY2FuIHVzZSB0aGlzIGluc3RydWN0aW9uIHRvIGRldGVybWluZSBpZiBpdCBzaG91bGRcbiAgICogcXVlcnkgdGhpcyBLbm93bGVkZ2UgQmFzZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBkZXNjcmlwdGlvbiBwcm92aWRlZC5cbiAgICovXG4gIHJlYWRvbmx5IGluc3RydWN0aW9uPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgdmVjdG9yIGluZGV4LlxuICAgKiBJZiB2ZWN0b3JTdG9yZSBpcyBub3Qgb2YgdHlwZSBgVmVjdG9yQ29sbGVjdGlvbmAsXG4gICAqIGRvIG5vdCBpbmNsdWRlIHRoaXMgcHJvcGVydHkgYXMgaXQgd2lsbCB0aHJvdyBlcnJvci5cbiAgICpcbiAgICogQGRlZmF1bHQgLSAnYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWluZGV4J1xuICAgKi9cbiAgcmVhZG9ubHkgaW5kZXhOYW1lPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgZmllbGQgaW4gdGhlIHZlY3RvciBpbmRleC5cbiAgICogSWYgdmVjdG9yU3RvcmUgaXMgbm90IG9mIHR5cGUgYFZlY3RvckNvbGxlY3Rpb25gLFxuICAgKiBkbyBub3QgaW5jbHVkZSB0aGlzIHByb3BlcnR5IGFzIGl0IHdpbGwgdGhyb3cgZXJyb3IuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gJ2JlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC12ZWN0b3InXG4gICAqL1xuICByZWFkb25seSB2ZWN0b3JGaWVsZD86IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIHZlY3RvciBzdG9yZSBmb3IgdGhlIGtub3dsZWRnZSBiYXNlLiBNdXN0IGJlIGVpdGhlciBvZlxuICAgKiB0eXBlIGBWZWN0b3JDb2xsZWN0aW9uYCwgYFJlZGlzRW50ZXJwcmlzZVZlY3RvclN0b3JlYCxcbiAgICogYFBpbmVjb25lVmVjdG9yU3RvcmVgIG9yIGBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZWAuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gQSBuZXcgT3BlblNlYXJjaCBTZXJ2ZXJsZXNzIHZlY3RvciBjb2xsZWN0aW9uIGlzIGNyZWF0ZWQuXG4gICAqL1xuICByZWFkb25seSB2ZWN0b3JTdG9yZT86XG4gIHwgVmVjdG9yQ29sbGVjdGlvblxuICB8IFBpbmVjb25lVmVjdG9yU3RvcmVcbiAgfCBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVxuICB8IEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmU7XG5cbiAgLyoqXG4gICAqIFRoZSB2ZWN0b3IgaW5kZXggZm9yIHRoZSBPcGVuU2VhcmNoIFNlcnZlcmxlc3MgYmFja2VkIGtub3dsZWRnZSBiYXNlLlxuICAgKiBJZiB2ZWN0b3JTdG9yZSBpcyBub3Qgb2YgdHlwZSBgVmVjdG9yQ29sbGVjdGlvbmAsIGRvIG5vdCBpbmNsdWRlXG4gICAqIHRoaXMgcHJvcGVydHkgYXMgaXQgd2lsbCB0aHJvdyBlcnJvci5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBBIG5ldyB2ZWN0b3IgaW5kZXggaXMgY3JlYXRlZCBvbiB0aGUgVmVjdG9yIENvbGxlY3Rpb25cbiAgICogaWYgdmVjdG9yIHN0b3JlIGlzIG9mIGBWZWN0b3JDb2xsZWN0aW9uYCB0eXBlLlxuICAgKi9cbiAgcmVhZG9ubHkgdmVjdG9ySW5kZXg/OiBWZWN0b3JJbmRleDtcblxuICAvKipcbiAgICogU3BlY2lmaWVzIHdoZXRoZXIgdG8gdXNlIHRoZSBrbm93bGVkZ2UgYmFzZSBvciBub3Qgd2hlbiBzZW5kaW5nIGFuIEludm9rZUFnZW50IHJlcXVlc3QuXG4gICAqL1xuICByZWFkb25seSBrbm93bGVkZ2VCYXNlU3RhdGU/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIE9QVElPTkFMOiBUYWcgKEtFWS1WQUxVRSkgYmVkcm9jayBhZ2VudCByZXNvdXJjZVxuICAgKlxuICAgKiBAZGVmYXVsdCAtIGZhbHNlXG4gICAqL1xuICByZWFkb25seSB0YWdzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbn1cblxuLyoqXG4gKiBQcm9wZXJ0aWVzIGZvciBpbXBvcnRpbmcgYSBrbm93bGVkZ2UgYmFzZSBvdXRzaWRlIG9mIHRoaXMgc3RhY2tcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBLbm93bGVkZ2VCYXNlQXR0cmlidXRlcyB7XG4gIC8qKlxuICAgKiBUaGUgSUQgb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKiBAZXhhbXBsZSBcIktCMTIzNDU2NzhcIlxuICAgKi9cbiAgcmVhZG9ubHkga25vd2xlZGdlQmFzZUlkOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgU2VydmljZSBFeGVjdXRpb24gUm9sZSBhc3NvY2lhdGVkIHdpdGggdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKiBAZXhhbXBsZSBcImFybjphd3M6aWFtOjoxMjM0NTY3ODkwMTI6cm9sZS9BbWF6b25CZWRyb2NrRXhlY3V0aW9uUm9sZUZvcktub3dsZWRnZUJhc2Vhd3NjZGtiZGdlQmFzZUtCMTIzNDU2NzhcIlxuICAgKi9cbiAgcmVhZG9ubHkgZXhlY3V0aW9uUm9sZUFybjogc3RyaW5nO1xufVxuXG4vKipcbiAqIERlcGxveXMgYSBCZWRyb2NrIEtub3dsZWRnZSBCYXNlIGFuZCBjb25maWd1cmVzIGEgYmFja2VuZCBieSBPcGVuU2VhcmNoIFNlcnZlcmxlc3MsXG4gKiBQaW5lY29uZSwgUmVkaXMgRW50ZXJwcmlzZSBDbG91ZCBvciBBbWF6b24gQXVyb3JhIFBvc3RncmVTUUwuXG4gKlxuICovXG5leHBvcnQgY2xhc3MgS25vd2xlZGdlQmFzZSBleHRlbmRzIEtub3dsZWRnZUJhc2VCYXNlIHtcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEltcG9ydCBNZXRob2RzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBwdWJsaWMgc3RhdGljIGZyb21Lbm93bGVkZ2VCYXNlQXR0cmlidXRlcyhzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBhdHRyczogS25vd2xlZGdlQmFzZUF0dHJpYnV0ZXMpOiBJS25vd2xlZGdlQmFzZSB7XG4gICAgY29uc3Qgc3RhY2sgPSBTdGFjay5vZihzY29wZSk7XG4gICAgY2xhc3MgSW1wb3J0IGV4dGVuZHMgS25vd2xlZGdlQmFzZUJhc2Uge1xuICAgICAgcHVibGljIHJlYWRvbmx5IGtub3dsZWRnZUJhc2VBcm4gPSBzdGFjay5mb3JtYXRBcm4oe1xuICAgICAgICBzZXJ2aWNlOiAnYmVkcm9jaycsXG4gICAgICAgIHJlc291cmNlOiAna25vd2xlZGdlLWJhc2UnLFxuICAgICAgICByZXNvdXJjZU5hbWU6IGF0dHJzLmtub3dsZWRnZUJhc2VJZCxcbiAgICAgICAgYXJuRm9ybWF0OiBBcm5Gb3JtYXQuU0xBU0hfUkVTT1VSQ0VfTkFNRSxcbiAgICAgIH0pO1xuICAgICAgcHVibGljIHJlYWRvbmx5IHJvbGUgPSBpYW0uUm9sZS5mcm9tUm9sZUFybih0aGlzLCBga2ItJHthdHRycy5rbm93bGVkZ2VCYXNlSWR9LXJvbGVgLCBhdHRycy5leGVjdXRpb25Sb2xlQXJuKTtcbiAgICAgIHB1YmxpYyByZWFkb25seSBrbm93bGVkZ2VCYXNlSWQgPSBhdHRycy5rbm93bGVkZ2VCYXNlSWQ7XG4gICAgfVxuICAgIHJldHVybiBuZXcgSW1wb3J0KHNjb3BlLCBpZCk7XG5cbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gQXR0cmlidXRlc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBuYW1lOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEluc3RhbmNlIG9mIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGtub3dsZWRnZUJhc2VJbnN0YW5jZTogYmVkcm9jay5DZm5Lbm93bGVkZ2VCYXNlO1xuXG4gIC8qKlxuICAgKiBUaGUgcm9sZSB0aGUgS25vd2xlZGdlIEJhc2UgdXNlcyB0byBhY2Nlc3MgdGhlIHZlY3RvciBzdG9yZSBhbmQgZGF0YSBzb3VyY2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgcm9sZTogaWFtLklSb2xlO1xuXG4gIC8qKlxuICAgKiBUaGUgdmVjdG9yIHN0b3JlIGZvciB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgdmVjdG9yU3RvcmU6XG4gIHwgVmVjdG9yQ29sbGVjdGlvblxuICB8IFBpbmVjb25lVmVjdG9yU3RvcmVcbiAgfCBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVxuICB8IEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmU7XG5cbiAgLyoqXG4gICAqIEEgbmFycmF0aXZlIGluc3RydWN0aW9uIG9mIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBpbnN0cnVjdGlvbj86IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkga25vd2xlZGdlQmFzZUFybjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgSUQgb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGtub3dsZWRnZUJhc2VJZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgT3BlblNlYXJjaCB2ZWN0b3IgaW5kZXggZm9yIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHByaXZhdGUgdmVjdG9ySW5kZXg/OiBWZWN0b3JJbmRleDtcblxuICAvKipcbiAgICogVGhlIGRlc2NyaXB0aW9uIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGRlc2NyaXB0aW9uOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFNwZWNpZmllcyB3aGV0aGVyIHRvIHVzZSB0aGUga25vd2xlZGdlIGJhc2Ugb3Igbm90IHdoZW4gc2VuZGluZyBhbiBJbnZva2VBZ2VudCByZXF1ZXN0LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGtub3dsZWRnZUJhc2VTdGF0ZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgdHlwZSBvZiB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwcml2YXRlIHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlO1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBLbm93bGVkZ2VCYXNlUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuICAgIHRoaXMuaW5zdHJ1Y3Rpb24gPSBwcm9wcy5pbnN0cnVjdGlvbjtcbiAgICBjb25zdCBlbWJlZGRpbmdzTW9kZWwgPSBwcm9wcy5lbWJlZGRpbmdzTW9kZWw7XG4gICAgY29uc3QgaW5kZXhOYW1lID0gcHJvcHMuaW5kZXhOYW1lID8/ICdiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtaW5kZXgnO1xuICAgIGNvbnN0IHZlY3RvckZpZWxkID1cbiAgICAgIHByb3BzLnZlY3RvckZpZWxkID8/ICdiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtdmVjdG9yJztcbiAgICBjb25zdCB0ZXh0RmllbGQgPSAnQU1BWk9OX0JFRFJPQ0tfVEVYVF9DSFVOSyc7XG4gICAgY29uc3QgbWV0YWRhdGFGaWVsZCA9ICdBTUFaT05fQkVEUk9DS19NRVRBREFUQSc7XG5cbiAgICB0aGlzLmRlc2NyaXB0aW9uID0gcHJvcHMuZGVzY3JpcHRpb24gPz8gJ0NESyBkZXBsb3llZCBLbm93bGVkZ2UgYmFzZSc7IC8vIGV2ZW4gdGhvdWdoIHRoaXMgcHJvcCBpcyBvcHRpb25hbCwgaWYgbm8gdmFsdWUgaXMgcHJvdmlkZWQgaXQgd2lsbCBmYWlsIHRvIGRlcGxveVxuICAgIHRoaXMua25vd2xlZGdlQmFzZVN0YXRlID0gcHJvcHMua25vd2xlZGdlQmFzZVN0YXRlID8/ICdFTkFCTEVEJztcblxuICAgIHZhbGlkYXRlTW9kZWwoZW1iZWRkaW5nc01vZGVsKTtcbiAgICB2YWxpZGF0ZVZlY3RvckluZGV4KFxuICAgICAgcHJvcHMudmVjdG9yU3RvcmUsXG4gICAgICBwcm9wcy52ZWN0b3JJbmRleCxcbiAgICAgIHByb3BzLnZlY3RvckZpZWxkLFxuICAgICAgcHJvcHMuaW5kZXhOYW1lLFxuICAgICk7XG4gICAgaWYgKHByb3BzLnZlY3RvckluZGV4KSB7XG4gICAgICB2YWxpZGF0ZUluZGV4UGFyYW1ldGVycyhwcm9wcy52ZWN0b3JJbmRleCwgaW5kZXhOYW1lLCB2ZWN0b3JGaWVsZCk7XG4gICAgfVxuXG4gICAgdGhpcy5uYW1lID1cbiAgICAgIHByb3BzLm5hbWUgPz8gZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMih0aGlzLCAnS0InLCB7IG1heExlbmd0aDogMzIgfSk7XG5cbiAgICBpZiAocHJvcHMuZXhpc3RpbmdSb2xlKSB7XG4gICAgICB0aGlzLnJvbGUgPSBwcm9wcy5leGlzdGluZ1JvbGU7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHJvbGVOYW1lID0gZ2VuZXJhdGVQaHlzaWNhbE5hbWVWMihcbiAgICAgICAgdGhpcyxcbiAgICAgICAgJ0FtYXpvbkJlZHJvY2tFeGVjdXRpb25Sb2xlRm9yS25vd2xlZGdlQmFzZScsXG4gICAgICAgIHsgbWF4TGVuZ3RoOiA2NCB9LFxuICAgICAgKTtcbiAgICAgIHRoaXMucm9sZSA9IG5ldyBpYW0uUm9sZSh0aGlzLCAnUm9sZScsIHtcbiAgICAgICAgcm9sZU5hbWU6IHJvbGVOYW1lLFxuICAgICAgICBhc3N1bWVkQnk6IG5ldyBpYW0uU2VydmljZVByaW5jaXBhbCgnYmVkcm9jay5hbWF6b25hd3MuY29tJywge1xuICAgICAgICAgIGNvbmRpdGlvbnM6IHtcbiAgICAgICAgICAgIFN0cmluZ0VxdWFsczogeyAnYXdzOlNvdXJjZUFjY291bnQnOiBTdGFjay5vZih0aGlzKS5hY2NvdW50IH0sXG4gICAgICAgICAgICBBcm5MaWtlOiB7XG4gICAgICAgICAgICAgICdhd3M6U291cmNlQXJuJzogU3RhY2sub2YodGhpcykuZm9ybWF0QXJuKHtcbiAgICAgICAgICAgICAgICBzZXJ2aWNlOiAnYmVkcm9jaycsXG4gICAgICAgICAgICAgICAgcmVzb3VyY2U6ICdrbm93bGVkZ2UtYmFzZScsXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VOYW1lOiAnKicsXG4gICAgICAgICAgICAgICAgYXJuRm9ybWF0OiBBcm5Gb3JtYXQuU0xBU0hfUkVTT1VSQ0VfTkFNRSxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMucm9sZS5hZGRUb1ByaW5jaXBhbFBvbGljeShcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFsnYmVkcm9jazpJbnZva2VNb2RlbCddLFxuICAgICAgICAgIHJlc291cmNlczogW2VtYmVkZGluZ3NNb2RlbC5hc0Fybih0aGlzKV0sXG4gICAgICAgIH0pLFxuICAgICAgKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlIHRoZSB2ZWN0b3Igc3RvcmUgaWYgdGhlIHZlY3RvciBzdG9yZSB3YXMgcHJvdmlkZWQgYnkgdGhlIHVzZXIuXG4gICAgICogT3RoZXJ3aXNlIGNoZWNrIGFnYWludHMgYWxsIHBvc3NpYmxlIHZlY3RvciBkYXRhc3RvcmVzLlxuICAgICAqIElmIG5vbmUgd2FzIHByb3ZpZGVkIGNyZWF0ZSBkZWZhdWx0IE9wZW5TZWFyY2ggU2VydmVybGVzcyBDb2xsZWN0aW9uLlxuICAgICAqL1xuICAgIGlmIChwcm9wcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIFZlY3RvckNvbGxlY3Rpb24pIHtcbiAgICAgICh7XG4gICAgICAgIHZlY3RvclN0b3JlOiB0aGlzLnZlY3RvclN0b3JlLFxuICAgICAgICB2ZWN0b3JTdG9yZVR5cGU6IHRoaXMudmVjdG9yU3RvcmVUeXBlLFxuICAgICAgfSA9IHRoaXMuaGFuZGxlT3BlblNlYXJjaENvbGxlY3Rpb24ocHJvcHMpKTtcbiAgICB9IGVsc2UgaWYgKHByb3BzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgUGluZWNvbmVWZWN0b3JTdG9yZSkge1xuICAgICAgKHtcbiAgICAgICAgdmVjdG9yU3RvcmU6IHRoaXMudmVjdG9yU3RvcmUsXG4gICAgICAgIHZlY3RvclN0b3JlVHlwZTogdGhpcy52ZWN0b3JTdG9yZVR5cGUsXG4gICAgICB9ID0gdGhpcy5oYW5kbGVQaW5lY29uZVZlY3RvclN0b3JlKHByb3BzKSk7XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIHByb3BzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUgfHxcbiAgICAgIHByb3BzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZVxuICAgICkge1xuICAgICAgKHtcbiAgICAgICAgdmVjdG9yU3RvcmU6IHRoaXMudmVjdG9yU3RvcmUsXG4gICAgICAgIHZlY3RvclN0b3JlVHlwZTogdGhpcy52ZWN0b3JTdG9yZVR5cGUsXG4gICAgICB9ID0gdGhpcy5oYW5kbGVBbWF6b25BdXJvcmFWZWN0b3JTdG9yZShwcm9wcykpO1xuICAgIH0gZWxzZSB7XG4gICAgICAoe1xuICAgICAgICB2ZWN0b3JTdG9yZTogdGhpcy52ZWN0b3JTdG9yZSxcbiAgICAgICAgdmVjdG9yU3RvcmVUeXBlOiB0aGlzLnZlY3RvclN0b3JlVHlwZSxcbiAgICAgIH0gPSB0aGlzLmhhbmRsZU9wZW5TZWFyY2hEZWZhdWx0VmVjdG9yQ29sbGVjdGlvbigpKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBXZSBuZWVkIHRvIGFkZCBgc2VjcmV0c21hbmFnZXI6R2V0U2VjcmV0VmFsdWVgIHRvIHRoZSByb2xlXG4gICAgICogb2YgdGhlIGtub3dsZWRnZSBiYXNlIGlmIHdlIHVzZSBkYXRhIHNvdXJjZXNcbiAgICAgKiBvdGhlciB0aGFuIE9wZW5TZWFyY2ggU2VydmVybGVzcy5cbiAgICAgKi9cbiAgICBpZiAoISh0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgVmVjdG9yQ29sbGVjdGlvbikpIHtcbiAgICAgIHRoaXMucm9sZS5hZGRUb1ByaW5jaXBhbFBvbGljeShcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFsnc2VjcmV0c21hbmFnZXI6R2V0U2VjcmV0VmFsdWUnXSxcbiAgICAgICAgICByZXNvdXJjZXM6IFt0aGlzLnZlY3RvclN0b3JlLmNyZWRlbnRpYWxzU2VjcmV0QXJuXSxcbiAgICAgICAgfSksXG4gICAgICApO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFdlIG5lZWQgdG8gYWRkIGByZHMtZGF0YTpFeGVjdXRlU3RhdGVtZW50YCxcbiAgICAgKiBgcmRzLWRhdGE6QmF0Y2hFeGVjdXRlU3RhdGVtZW50YCBhbmRcbiAgICAgKiBgcmRzOkRlc2NyaWJlREJDbHVzdGVyc2AgdG8gdGhlIHJvbGVcbiAgICAgKiBvZiB0aGUga25vd2xlZGdlIGJhc2UgaWYgd2UgdXNlIEFtYXpvbiBBdXJvcmEgYXNcbiAgICAgKiBhIGRhdGEgc291cmNlLlxuICAgICAqL1xuICAgIGlmIChcbiAgICAgIHRoaXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB8fFxuICAgICAgdGhpcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVcbiAgICApIHtcbiAgICAgIHRoaXMucm9sZS5hZGRUb1ByaW5jaXBhbFBvbGljeShcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgICAgICdyZHMtZGF0YTpFeGVjdXRlU3RhdGVtZW50JyxcbiAgICAgICAgICAgICdyZHMtZGF0YTpCYXRjaEV4ZWN1dGVTdGF0ZW1lbnQnLFxuICAgICAgICAgICAgJ3JkczpEZXNjcmliZURCQ2x1c3RlcnMnLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbdGhpcy52ZWN0b3JTdG9yZS5yZXNvdXJjZUFybl0sXG4gICAgICAgIH0pLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgdGhlIHZlY3RvciBpbmRleCBpZiB0aGUgdmVjdG9yIHN0b3JlIGlzIE9wZW5TZWFyY2ggU2VydmVybGVzc1xuICAgICAqIGFuZCBpdCB3YXMgbm90IHByb3ZpZGVkLiBPdGhlcndpc2UgdXNlIHRoZSBwcm92aWRlZCB2ZWN0b3IgaW5kZXguXG4gICAgICovXG4gICAgaWYgKHRoaXMudmVjdG9yU3RvcmVUeXBlID09PSBWZWN0b3JTdG9yZVR5cGUuT1BFTlNFQVJDSF9TRVJWRVJMRVNTKSB7XG4gICAgICBpZiAoIXByb3BzLnZlY3RvckluZGV4KSB7XG4gICAgICAgIHRoaXMudmVjdG9ySW5kZXggPSBuZXcgVmVjdG9ySW5kZXgodGhpcywgJ0tCSW5kZXgnLCB7XG4gICAgICAgICAgY29sbGVjdGlvbjogdGhpcy52ZWN0b3JTdG9yZSBhcyBWZWN0b3JDb2xsZWN0aW9uLFxuICAgICAgICAgIGluZGV4TmFtZSxcbiAgICAgICAgICB2ZWN0b3JGaWVsZCxcbiAgICAgICAgICB2ZWN0b3JEaW1lbnNpb25zOiBlbWJlZGRpbmdzTW9kZWwudmVjdG9yRGltZW5zaW9ucyEsXG4gICAgICAgICAgbWFwcGluZ3M6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgbWFwcGluZ0ZpZWxkOiAnQU1BWk9OX0JFRFJPQ0tfVEVYVF9DSFVOSycsXG4gICAgICAgICAgICAgIGRhdGFUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgIGZpbHRlcmFibGU6IHRydWUsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBtYXBwaW5nRmllbGQ6ICdBTUFaT05fQkVEUk9DS19NRVRBREFUQScsXG4gICAgICAgICAgICAgIGRhdGFUeXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgIGZpbHRlcmFibGU6IGZhbHNlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnZlY3RvckluZGV4Lm5vZGUuYWRkRGVwZW5kZW5jeSh0aGlzLnZlY3RvclN0b3JlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMudmVjdG9ySW5kZXggPSBwcm9wcy52ZWN0b3JJbmRleDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgc3RvcmFnZSBjb25maWd1cmFpb24uIElmIGl0IGlzIG9mIHR5cGUgb2ZcbiAgICAgKiBgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVgIG9yIGBFeGlzdGluZ0FtYXpvbkF1cm9yYVZlY3RvclN0b3JlYCxcbiAgICAgKiB0aGVuIGdldCB0ZXh0RmllbGQsIG1ldGFkYXRhRmllbGQgYW5kIHZlY3RvckZpZWxkIGZyb21cbiAgICAgKiB0aGUgYXJndW1lbnRzLiBPdGhlcndpc2UgdXNlIGRlZmF1bHQgdmFsdWVzLlxuICAgICAqL1xuICAgIGNvbnN0IHN0b3JhZ2VDb25maWd1cmF0aW9uOiBTdG9yYWdlQ29uZmlndXJhdGlvbiA9IHtcbiAgICAgIGluZGV4TmFtZTogaW5kZXhOYW1lLFxuICAgICAgdmVjdG9yU3RvcmU6IHRoaXMudmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IHRoaXMudmVjdG9yU3RvcmVUeXBlLFxuICAgICAgdmVjdG9yRmllbGQ6XG4gICAgICAgIHRoaXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB8fFxuICAgICAgICAgIHRoaXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBFeGlzdGluZ0FtYXpvbkF1cm9yYVZlY3RvclN0b3JlXG4gICAgICAgICAgPyB0aGlzLnZlY3RvclN0b3JlLnZlY3RvckZpZWxkXG4gICAgICAgICAgOiB2ZWN0b3JGaWVsZCxcbiAgICAgIHRleHRGaWVsZDpcbiAgICAgICAgdGhpcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlIHx8XG4gICAgICAgICAgdGhpcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUgfHxcbiAgICAgICAgICAgIHRoaXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBQaW5lY29uZVZlY3RvclN0b3JlXG4gICAgICAgICAgPyB0aGlzLnZlY3RvclN0b3JlLnRleHRGaWVsZFxuICAgICAgICAgIDogdGV4dEZpZWxkLFxuICAgICAgbWV0YWRhdGFGaWVsZDpcbiAgICAgICAgdGhpcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlIHx8XG4gICAgICAgICAgdGhpcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUgfHxcbiAgICAgICAgICAgIHRoaXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBQaW5lY29uZVZlY3RvclN0b3JlXG4gICAgICAgICAgPyB0aGlzLnZlY3RvclN0b3JlLm1ldGFkYXRhRmllbGRcbiAgICAgICAgICA6IG1ldGFkYXRhRmllbGQsXG4gICAgfTtcblxuICAgIGNvbnN0IGtub3dsZWRnZUJhc2UgPSBuZXcgYmVkcm9jay5DZm5Lbm93bGVkZ2VCYXNlKFxuICAgICAgdGhpcyxcbiAgICAgICdNeUNmbktub3dsZWRnZUJhc2UnLFxuICAgICAge1xuICAgICAgICBrbm93bGVkZ2VCYXNlQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgIHR5cGU6ICdWRUNUT1InLFxuICAgICAgICAgIHZlY3Rvcktub3dsZWRnZUJhc2VDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgICBlbWJlZGRpbmdNb2RlbEFybjogZW1iZWRkaW5nc01vZGVsLmFzQXJuKHRoaXMpLFxuICAgICAgICAgICAgLy8gVXNlZCB0aGlzIGFwcHJvYWNoIGFzIGlmIHByb3BlcnR5IGlzIHNwZWNpZmllZCBvbiBtb2RlbHMgdGhhdCBkbyBub3RcbiAgICAgICAgICAgIC8vIHN1cHBvcnQgY29uZmlndXJhYmxlIGRpbWVuc2lvbnMgQ2xvdWRGb3JtYXRpb24gdGhyb3dzIGFuIGVycm9yIGF0IHJ1bnRpbWVcbiAgICAgICAgICAgIGVtYmVkZGluZ01vZGVsQ29uZmlndXJhdGlvbjogKGVtYmVkZGluZ3NNb2RlbC5tb2RlbElkID09PSAnYW1hem9uLnRpdGFuLWVtYmVkLXRleHQtdjI6MCcpXG4gICAgICAgICAgICAgID8gKHsgYmVkcm9ja0VtYmVkZGluZ01vZGVsQ29uZmlndXJhdGlvbjogeyBkaW1lbnNpb25zOiBlbWJlZGRpbmdzTW9kZWwudmVjdG9yRGltZW5zaW9ucyB9IH0pXG4gICAgICAgICAgICAgIDogdW5kZWZpbmVkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIG5hbWU6IHRoaXMubmFtZSxcbiAgICAgICAgcm9sZUFybjogdGhpcy5yb2xlLnJvbGVBcm4sXG4gICAgICAgIHN0b3JhZ2VDb25maWd1cmF0aW9uOiBnZXRTdG9yYWdlQ29uZmlndXJhdGlvbihzdG9yYWdlQ29uZmlndXJhdGlvbiksXG4gICAgICAgIGRlc2NyaXB0aW9uOiBwcm9wcy5kZXNjcmlwdGlvbixcbiAgICAgICAgdGFnczogcHJvcHMudGFncyxcbiAgICAgIH0sXG4gICAgKTtcblxuICAgIHRoaXMua25vd2xlZGdlQmFzZUluc3RhbmNlID0ga25vd2xlZGdlQmFzZTtcblxuICAgIGNvbnN0IGtiQ1JQb2xpY3kgPSBuZXcgaWFtLlBvbGljeSh0aGlzLCAnS0JDUlBvbGljeScsIHtcbiAgICAgIC8vIHJvbGVzOiBbY3JQcm92aWRlci5yb2xlXSxcbiAgICAgIHJvbGVzOiBbdGhpcy5yb2xlXSxcbiAgICAgIHN0YXRlbWVudHM6IFtcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgICAgICdiZWRyb2NrOkNyZWF0ZUtub3dsZWRnZUJhc2UnLFxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBXZSBuZWVkIHRvIGFkZCBgYmVkcm9jazpBc3NvY2lhdGVUaGlyZFBhcnR5S25vd2xlZGdlQmFzZWAgaWZcbiAgICAgICAgICAgICAqIHdlIGFyZSBkZXBsb3lpbmcgUmVkaXMgb3IgUGluZWNvbmUgZGF0YSBzb3VyY2VzXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIC8vLi4uKHRoaXMudmVjdG9yU3RvcmVUeXBlID09PSBWZWN0b3JTdG9yZVR5cGUuUkVESVNfRU5URVJQUklTRV9DTE9VRCB8fFxuICAgICAgICAgICAgLi4uKHRoaXMudmVjdG9yU3RvcmVUeXBlID09PSBWZWN0b3JTdG9yZVR5cGUuUElORUNPTkVcbiAgICAgICAgICAgICAgPyBbJ2JlZHJvY2s6QXNzb2NpYXRlVGhpcmRQYXJ0eUtub3dsZWRnZUJhc2UnXVxuICAgICAgICAgICAgICA6IFtdKSxcbiAgICAgICAgICBdLFxuICAgICAgICAgIHJlc291cmNlczogWycqJ10sXG4gICAgICAgIH0pLFxuICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogW1xuICAgICAgICAgICAgJ2JlZHJvY2s6VXBkYXRlS25vd2xlZGdlQmFzZScsXG4gICAgICAgICAgICAnYmVkcm9jazpEZWxldGVLbm93bGVkZ2VCYXNlJyxcbiAgICAgICAgICAgICdiZWRyb2NrOlRhZ1Jlc291cmNlJyxcbiAgICAgICAgICBdLFxuICAgICAgICAgIHJlc291cmNlczogW1xuICAgICAgICAgICAgU3RhY2sub2YodGhpcykuZm9ybWF0QXJuKHtcbiAgICAgICAgICAgICAgc2VydmljZTogJ2JlZHJvY2snLFxuICAgICAgICAgICAgICByZXNvdXJjZTogJ2tub3dsZWRnZS1iYXNlJyxcbiAgICAgICAgICAgICAgcmVzb3VyY2VOYW1lOiAnKicsXG4gICAgICAgICAgICAgIGFybkZvcm1hdDogQXJuRm9ybWF0LlNMQVNIX1JFU09VUkNFX05BTUUsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICBdLFxuICAgICAgICB9KSxcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFsnaWFtOlBhc3NSb2xlJ10sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbdGhpcy5yb2xlLnJvbGVBcm5dLFxuICAgICAgICB9KSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBrbm93bGVkZ2VCYXNlLm5vZGUuYWRkRGVwZW5kZW5jeSh0aGlzLnJvbGUpO1xuICAgIGtub3dsZWRnZUJhc2Uubm9kZS5hZGREZXBlbmRlbmN5KGtiQ1JQb2xpY3kpO1xuICAgIGlmIChcbiAgICAgIHRoaXMudmVjdG9yU3RvcmVUeXBlID09PSBWZWN0b3JTdG9yZVR5cGUuT1BFTlNFQVJDSF9TRVJWRVJMRVNTICYmXG4gICAgICB0aGlzLnZlY3RvckluZGV4XG4gICAgKSB7XG4gICAgICBrbm93bGVkZ2VCYXNlLm5vZGUuYWRkRGVwZW5kZW5jeSh0aGlzLnZlY3RvckluZGV4KTtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgdGhpcy52ZWN0b3JTdG9yZVR5cGUgPT09IFZlY3RvclN0b3JlVHlwZS5BTUFaT05fQVVST1JBXG4gICAgKSB7XG4gICAgICBrbm93bGVkZ2VCYXNlLm5vZGUuYWRkRGVwZW5kZW5jeSh0aGlzLnZlY3RvclN0b3JlKTtcbiAgICB9XG5cbiAgICBOYWdTdXBwcmVzc2lvbnMuYWRkUmVzb3VyY2VTdXBwcmVzc2lvbnMoXG4gICAgICBrYkNSUG9saWN5LFxuICAgICAgW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdBd3NTb2x1dGlvbnMtSUFNNScsXG4gICAgICAgICAgcmVhc29uOlxuICAgICAgICAgICAgXCJCZWRyb2NrIENyZWF0ZUtub3dsZWRnZUJhc2UgY2FuJ3QgYmUgcmVzdHJpY3RlZCBieSByZXNvdXJjZS5cIixcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICB0cnVlLFxuICAgICk7XG5cbiAgICB0aGlzLmtub3dsZWRnZUJhc2VBcm4gPSBrbm93bGVkZ2VCYXNlLmF0dHJLbm93bGVkZ2VCYXNlQXJuO1xuICAgIHRoaXMua25vd2xlZGdlQmFzZUlkID0ga25vd2xlZGdlQmFzZS5hdHRyS25vd2xlZGdlQmFzZUlkO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBWZWN0b3JDb2xsZWN0aW9uIHR5cGUgb2YgVmVjdG9yU3RvcmUuXG4gICAqXG4gICAqIEBwYXJhbSBwcm9wcyAtIFRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBLbm93bGVkZ2VCYXNlLlxuICAgKiBAcmV0dXJucyBUaGUgaW5zdGFuY2Ugb2YgVmVjdG9yQ29sbGVjdGlvbiwgVmVjdG9yU3RvcmVUeXBlLlxuICAgKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAgICovXG4gIHByaXZhdGUgaGFuZGxlT3BlblNlYXJjaENvbGxlY3Rpb24ocHJvcHM6IEtub3dsZWRnZUJhc2VQcm9wcyk6IHtcbiAgICB2ZWN0b3JTdG9yZTogVmVjdG9yQ29sbGVjdGlvbjtcbiAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZTtcbiAgfSB7XG4gICAgY29uc3QgdmVjdG9yU3RvcmUgPSBwcm9wcy52ZWN0b3JTdG9yZSBhcyBWZWN0b3JDb2xsZWN0aW9uO1xuICAgIHZlY3RvclN0b3JlLmdyYW50RGF0YUFjY2Vzcyh0aGlzLnJvbGUpO1xuICAgIHJldHVybiB7XG4gICAgICB2ZWN0b3JTdG9yZTogdmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX1NFUlZFUkxFU1MsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgUGluZWNvbmVWZWN0b3JTdG9yZSB0eXBlIG9mIFZlY3RvclN0b3JlLlxuICAgKlxuICAgKiBAcGFyYW0gcHJvcHMgLSBUaGUgcHJvcGVydGllcyBvZiB0aGUgS25vd2xlZGdlQmFzZS5cbiAgICogQHJldHVybnMgVGhlIGluc3RhbmNlIG9mIFBpbmVjb25lVmVjdG9yU3RvcmUsIFZlY3RvclN0b3JlVHlwZS5cbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZVBpbmVjb25lVmVjdG9yU3RvcmUocHJvcHM6IEtub3dsZWRnZUJhc2VQcm9wcyk6IHtcbiAgICB2ZWN0b3JTdG9yZTogUGluZWNvbmVWZWN0b3JTdG9yZTtcbiAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZTtcbiAgfSB7XG4gICAgY29uc3QgdmVjdG9yU3RvcmUgPSBwcm9wcy52ZWN0b3JTdG9yZSBhcyBQaW5lY29uZVZlY3RvclN0b3JlO1xuICAgIHJldHVybiB7XG4gICAgICB2ZWN0b3JTdG9yZTogdmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZS5QSU5FQ09ORSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB0eXBlIG9mIFZlY3RvclN0b3JlLlxuICAgKlxuICAgKiBAcGFyYW0gcHJvcHMgLSBUaGUgcHJvcGVydGllcyBvZiB0aGUgS25vd2xlZGdlQmFzZS5cbiAgICogQHJldHVybnMgVGhlIGluc3RhbmNlIG9mIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlLCBWZWN0b3JTdG9yZVR5cGUuXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHJpdmF0ZSBoYW5kbGVBbWF6b25BdXJvcmFWZWN0b3JTdG9yZShwcm9wczogS25vd2xlZGdlQmFzZVByb3BzKToge1xuICAgIHZlY3RvclN0b3JlOiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB8IEV4aXN0aW5nQW1hem9uQXVyb3JhVmVjdG9yU3RvcmU7XG4gICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGU7XG4gIH0ge1xuICAgIGNvbnN0IHZlY3RvclN0b3JlID1cbiAgICAgIHByb3BzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgRXhpc3RpbmdBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSA/XG4gICAgICAgIHByb3BzLnZlY3RvclN0b3JlIDogcHJvcHMudmVjdG9yU3RvcmUgYXMgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmU7XG4gICAgcmV0dXJuIHtcbiAgICAgIHZlY3RvclN0b3JlOiB2ZWN0b3JTdG9yZSxcbiAgICAgIHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlLkFNQVpPTl9BVVJPUkEsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgdGhlIGRlZmF1bHQgVmVjdG9yU3RvcmUgdHlwZS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGluc3RhbmNlIG9mIFZlY3RvckNvbGxlY3Rpb24sIFZlY3RvclN0b3JlVHlwZS5cbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZU9wZW5TZWFyY2hEZWZhdWx0VmVjdG9yQ29sbGVjdGlvbigpOiB7XG4gICAgdmVjdG9yU3RvcmU6IFZlY3RvckNvbGxlY3Rpb247XG4gICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGU7XG4gIH0ge1xuICAgIGNvbnN0IHZlY3RvclN0b3JlID0gbmV3IFZlY3RvckNvbGxlY3Rpb24odGhpcywgJ0tCVmVjdG9ycycpO1xuICAgIHZlY3RvclN0b3JlLmdyYW50RGF0YUFjY2Vzcyh0aGlzLnJvbGUpO1xuICAgIHJldHVybiB7XG4gICAgICB2ZWN0b3JTdG9yZTogdmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX1NFUlZFUkxFU1MsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBc3NvY2lhdGUga25vd2xlZGdlIGJhc2Ugd2l0aCBhbiBhZ2VudFxuICAgKi9cbiAgcHVibGljIGFzc29jaWF0ZVRvQWdlbnQoYWdlbnQ6IEFnZW50KSB7XG4gICAgY29uc3QgYWdlbnRLbm93bGVkZ2VCYXNlUHJvcGVydHk6IGJlZHJvY2suQ2ZuQWdlbnQuQWdlbnRLbm93bGVkZ2VCYXNlUHJvcGVydHkgPVxuICAgIHtcbiAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmRlc2NyaXB0aW9uLFxuICAgICAga25vd2xlZGdlQmFzZUlkOiB0aGlzLmtub3dsZWRnZUJhc2VJZCxcbiAgICAgIGtub3dsZWRnZUJhc2VTdGF0ZTogdGhpcy5rbm93bGVkZ2VCYXNlU3RhdGUsXG4gICAgfTtcbiAgICBhZ2VudC5rbm93bGVkZ2VCYXNlcyA9IFthZ2VudEtub3dsZWRnZUJhc2VQcm9wZXJ0eV07XG4gIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSB0aGF0IEJlZHJvY2sgS25vd2xlZGdlIEJhc2UgY2FuIHVzZSB0aGUgc2VsZWN0ZWQgbW9kZWwuXG4gKlxuICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gKi9cbmZ1bmN0aW9uIHZhbGlkYXRlTW9kZWwoZm91bmRhdGlvbk1vZGVsOiBCZWRyb2NrRm91bmRhdGlvbk1vZGVsKSB7XG4gIGlmICghZm91bmRhdGlvbk1vZGVsLnN1cHBvcnRzS25vd2xlZGdlQmFzZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIGBUaGUgbW9kZWwgJHtmb3VuZGF0aW9uTW9kZWx9IGlzIG5vdCBzdXBwb3J0ZWQgYnkgQmVkcm9jayBLbm93bGVkZ2UgQmFzZS5gLFxuICAgICk7XG4gIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSBpZiBWZWN0b3JJbmRleCB3YXMgcHJvdmlkZWQgZm9yIGEgVmVjdG9yU3RvcmUgb2YgdHlwZVxuICogb3RoZXIgdGhhbiBgVmVjdG9yQ29sbGVjdGlvbmAuXG4gKlxuICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gKi9cbmZ1bmN0aW9uIHZhbGlkYXRlVmVjdG9ySW5kZXgoXG4gIHZlY3RvclN0b3JlOiBhbnksXG4gIHZlY3RvckluZGV4OiBhbnksXG4gIHZlY3RvckZpZWxkOiBhbnksXG4gIGluZGV4TmFtZTogYW55LFxuKSB7XG4gIGlmICghKHZlY3RvclN0b3JlIGluc3RhbmNlb2YgVmVjdG9yQ29sbGVjdGlvbikgJiYgdmVjdG9ySW5kZXgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAnSWYgdmVjdG9yU3RvcmUgaXMgbm90IG9mIHR5cGUgVmVjdG9yQ29sbGVjdGlvbiwgdmVjdG9ySW5kZXggc2hvdWxkIG5vdCBiZSBwcm92aWRlZCAnICtcbiAgICAgICdpbiBLbm93bGVkZ2VCYXNlIGNvbnN0cnVjdC4nLFxuICAgICk7XG4gIH1cbiAgaWYgKCEodmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBWZWN0b3JDb2xsZWN0aW9uKSAmJiBpbmRleE5hbWUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAnSWYgdmVjdG9yU3RvcmUgaXMgbm90IG9mIHR5cGUgVmVjdG9yQ29sbGVjdGlvbiwgaW5kZXhOYW1lIHNob3VsZCBub3QgYmUgcHJvdmlkZWQgJyArXG4gICAgICAnaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuJyxcbiAgICApO1xuICB9XG4gIGlmICghKHZlY3RvclN0b3JlIGluc3RhbmNlb2YgVmVjdG9yQ29sbGVjdGlvbikgJiYgdmVjdG9yRmllbGQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAnSWYgdmVjdG9yU3RvcmUgaXMgbm90IG9mIHR5cGUgVmVjdG9yQ29sbGVjdGlvbiwgdmVjdG9yRmllbGQgc2hvdWxkIG5vdCBiZSBwcm92aWRlZCAnICtcbiAgICAgICdpbiBLbm93bGVkZ2VCYXNlIGNvbnN0cnVjdC4nLFxuICAgICk7XG4gIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSB0aGF0IGluZGV4TmFtZSBhbmQgdmVjdG9yRmllbGQgcGFyYW1ldGVycyBhcmUgaWRlbnRpY2FsXG4gKiBpbiBLbm93bGVkZ2VCYXNlIGNvbnN0cnVjdCBpZiBWZWN0b3JJbmRleCB3YXMgY3JlYXRlZCBtYW51YWxseS5cbiAqXG4gKiBCeSBkZWZhdWx0IHdlIGFzc2lnbiBgdmVjdG9ySW5kZXhgIHRvIGBiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtaW5kZXhgXG4gKiB2YWx1ZSBhbmQgaWYgdXNlciBwcm92aWRlcyBgdmVjdG9ySW5kZXhgIG1hbnVhbGx5LCB3ZSBuZWVkIHRvIG1ha2Ugc3VyZVxuICogdGhleSBhbHNvIHByb3ZpZGUgaXQgaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QgaWYgdGhlIHZhbHVlIGlzIG5vdFxuICogYGJlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC1pbmRleGAuIFNhbWUgZm9yIHZlY3RvckZpZWxkLlxuICpcbiAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICovXG5mdW5jdGlvbiB2YWxpZGF0ZUluZGV4UGFyYW1ldGVycyhcbiAgdmVjdG9ySW5kZXg6IFZlY3RvckluZGV4LFxuICBpbmRleE5hbWU6IHN0cmluZyxcbiAgdmVjdG9yRmllbGQ6IHN0cmluZyxcbikge1xuICBpZiAodmVjdG9ySW5kZXguaW5kZXhOYW1lICE9PSAnYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWluZGV4Jykge1xuICAgIGlmICh2ZWN0b3JJbmRleC5pbmRleE5hbWUgIT09IGluZGV4TmFtZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnRGVmYXVsdCB2YWx1ZSBvZiBpbmRleE5hbWUgaXMgYGJlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC1pbmRleGAuJyArXG4gICAgICAgICcgSWYgeW91IGNyZWF0ZSBWZWN0b3JJbmRleCBtYW51YWxseSBhbmQgYXNzaWduIHZlY3RvckluZGV4IHRvIHZhbHVlIG90aGVyIHRoYW4nICtcbiAgICAgICAgJyBgYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWluZGV4YCB0aGVuIHlvdSBtdXN0IHByb3ZpZGUgdGhlIHNhbWUgdmFsdWUgaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuJyArXG4gICAgICAgICcgSWYgeW91IGNyZWF0ZWQgVmVjdG9ySW5kZXggbWFudWFsbHkgYW5kIHNldCBpdCB0byBgYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWluZGV4YCcgK1xuICAgICAgICAnIHRoZW4gZG8gbm90IGFzc2lnbiBpbmRleE5hbWUgaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuJyxcbiAgICAgICk7XG4gICAgfVxuICB9XG4gIGlmICh2ZWN0b3JJbmRleC52ZWN0b3JGaWVsZCAhPT0gJ2JlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC12ZWN0b3InKSB7XG4gICAgaWYgKHZlY3RvckluZGV4LnZlY3RvckZpZWxkICE9PSB2ZWN0b3JGaWVsZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAnRGVmYXVsdCB2YWx1ZSBvZiB2ZWN0b3JGaWVsZCBpcyBgYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LXZlY3RvcmAuJyArXG4gICAgICAgICcgSWYgeW91IGNyZWF0ZSBWZWN0b3JJbmRleCBtYW51YWxseSBhbmQgYXNzaWduIHZlY3RvckZpZWxkIHRvIHZhbHVlIG90aGVyIHRoYW4nICtcbiAgICAgICAgJyBgYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWZpZWxkYCB0aGVuIHlvdSBtdXN0IHByb3ZpZGUgdGhlIHNhbWUgdmFsdWUgaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuJyArXG4gICAgICAgICcgSWYgeW91IGNyZWF0ZWQgVmVjdG9ySW5kZXggbWFudWFsbHkgYW5kIHNldCBpdCB0byBgYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LXZlY3RvcmAnICtcbiAgICAgICAgJyB0aGVuIGRvIG5vdCBhc3NpZ24gdmVjdG9yRmllbGQgaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuJyxcbiAgICAgICk7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogRGV0ZXJtaW5lIHN0b3JhZ2UgY29uZmlndXJhdGlvbiBiYXNlZCBvbiB2ZWN0b3Igc3RvcmUgdHlwZS5cbiAqXG4gKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAqL1xuZnVuY3Rpb24gZ2V0U3RvcmFnZUNvbmZpZ3VyYXRpb24ocGFyYW1zOiBTdG9yYWdlQ29uZmlndXJhdGlvbik6IGFueSB7XG4gIHN3aXRjaCAocGFyYW1zLnZlY3RvclN0b3JlVHlwZSkge1xuICAgIGNhc2UgVmVjdG9yU3RvcmVUeXBlLk9QRU5TRUFSQ0hfU0VSVkVSTEVTUzpcbiAgICAgIHBhcmFtcy52ZWN0b3JTdG9yZSA9IHBhcmFtcy52ZWN0b3JTdG9yZSBhcyBWZWN0b3JDb2xsZWN0aW9uO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogVmVjdG9yU3RvcmVUeXBlLk9QRU5TRUFSQ0hfU0VSVkVSTEVTUyxcbiAgICAgICAgb3BlbnNlYXJjaFNlcnZlcmxlc3NDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgY29sbGVjdGlvbkFybjogcGFyYW1zLnZlY3RvclN0b3JlLmNvbGxlY3Rpb25Bcm4sXG4gICAgICAgICAgZmllbGRNYXBwaW5nOiB7XG4gICAgICAgICAgICB2ZWN0b3JGaWVsZDogcGFyYW1zLnZlY3RvckZpZWxkLFxuICAgICAgICAgICAgdGV4dEZpZWxkOiBwYXJhbXMudGV4dEZpZWxkLFxuICAgICAgICAgICAgbWV0YWRhdGFGaWVsZDogcGFyYW1zLm1ldGFkYXRhRmllbGQsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB2ZWN0b3JJbmRleE5hbWU6IHBhcmFtcy5pbmRleE5hbWUsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIGNhc2UgVmVjdG9yU3RvcmVUeXBlLlBJTkVDT05FOlxuICAgICAgcGFyYW1zLnZlY3RvclN0b3JlID0gcGFyYW1zLnZlY3RvclN0b3JlIGFzIFBpbmVjb25lVmVjdG9yU3RvcmU7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBWZWN0b3JTdG9yZVR5cGUuUElORUNPTkUsXG4gICAgICAgIHBpbmVjb25lQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgIG5hbWVzcGFjZTogcGFyYW1zLnZlY3RvclN0b3JlLm5hbWVzcGFjZSB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgY29ubmVjdGlvblN0cmluZzogcGFyYW1zLnZlY3RvclN0b3JlLmNvbm5lY3Rpb25TdHJpbmcsXG4gICAgICAgICAgY3JlZGVudGlhbHNTZWNyZXRBcm46IHBhcmFtcy52ZWN0b3JTdG9yZS5jcmVkZW50aWFsc1NlY3JldEFybixcbiAgICAgICAgICBmaWVsZE1hcHBpbmc6IHtcbiAgICAgICAgICAgIHRleHRGaWVsZDogcGFyYW1zLnRleHRGaWVsZCxcbiAgICAgICAgICAgIG1ldGFkYXRhRmllbGQ6IHBhcmFtcy5tZXRhZGF0YUZpZWxkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIGNhc2UgVmVjdG9yU3RvcmVUeXBlLkFNQVpPTl9BVVJPUkE6XG4gICAgICBwYXJhbXMudmVjdG9yU3RvcmUgPVxuICAgICAgICBwYXJhbXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBFeGlzdGluZ0FtYXpvbkF1cm9yYVZlY3RvclN0b3JlID9cbiAgICAgICAgICBwYXJhbXMudmVjdG9yU3RvcmUgOiBwYXJhbXMudmVjdG9yU3RvcmUgYXMgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmU7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBWZWN0b3JTdG9yZVR5cGUuQU1BWk9OX0FVUk9SQSxcbiAgICAgICAgcmRzQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgIGNyZWRlbnRpYWxzU2VjcmV0QXJuOiBwYXJhbXMudmVjdG9yU3RvcmUuY3JlZGVudGlhbHNTZWNyZXRBcm4sXG4gICAgICAgICAgZGF0YWJhc2VOYW1lOiBwYXJhbXMudmVjdG9yU3RvcmUuZGF0YWJhc2VOYW1lLFxuICAgICAgICAgIHJlc291cmNlQXJuOiBwYXJhbXMudmVjdG9yU3RvcmUucmVzb3VyY2VBcm4sXG4gICAgICAgICAgdGFibGVOYW1lOiBgJHtwYXJhbXMudmVjdG9yU3RvcmUuc2NoZW1hTmFtZX0uJHtwYXJhbXMudmVjdG9yU3RvcmUudGFibGVOYW1lfWAsXG4gICAgICAgICAgZmllbGRNYXBwaW5nOiB7XG4gICAgICAgICAgICB2ZWN0b3JGaWVsZDogcGFyYW1zLnZlY3RvckZpZWxkLnJlcGxhY2UoLy0vZywgJ18nKSxcbiAgICAgICAgICAgIHByaW1hcnlLZXlGaWVsZDogcGFyYW1zLnZlY3RvclN0b3JlLnByaW1hcnlLZXlGaWVsZCxcbiAgICAgICAgICAgIHRleHRGaWVsZDogcGFyYW1zLnRleHRGaWVsZC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgbWV0YWRhdGFGaWVsZDogcGFyYW1zLm1ldGFkYXRhRmllbGQudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICBkZWZhdWx0OlxuICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICBgVW5zdXBwb3J0ZWQgdmVjdG9yIHN0b3JlIHR5cGU6ICR7cGFyYW1zLnZlY3RvclN0b3JlVHlwZX1gLFxuICAgICAgKTtcbiAgfVxufVxuIl19