"use strict";
var _a, _b;
Object.defineProperty(exports, "__esModule", { value: true });
exports.Guardrail = exports.GuardrailBase = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const fs = require("fs");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const bedrock = require("aws-cdk-lib/aws-bedrock");
const iam = require("aws-cdk-lib/aws-iam");
const aws_kms_1 = require("aws-cdk-lib/aws-kms");
const helpers_internal_1 = require("aws-cdk-lib/core/lib/helpers-internal");
/**
 * Abstract base class for a Guardrail.
 * Contains methods and attributes valid for Guardrails either created with CDK or imported.
 */
class GuardrailBase extends aws_cdk_lib_1.Resource {
    /**
     * Grant the given identity permissions to apply the guardrail.
     */
    grantApply(grantee) {
        return iam.Grant.addToPrincipal({
            grantee,
            resourceArns: [this.guardrailArn],
            actions: ['bedrock:ApplyGuardrail'],
            scope: this,
        });
    }
}
exports.GuardrailBase = GuardrailBase;
_a = JSII_RTTI_SYMBOL_1;
GuardrailBase[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.GuardrailBase", version: "0.1.285" };
/******************************************************************************
 *                        NEW CONSTRUCT DEFINITION
 *****************************************************************************/
/**
 * Class to create a Guardrail with CDK.
 */
class Guardrail extends GuardrailBase {
    /**
     * Import a guardrail given its attributes
     */
    static fromGuardrailAttributes(scope, id, attrs) {
        class Import extends GuardrailBase {
            constructor() {
                super(...arguments);
                this.guardrailArn = attrs.guardrailArn;
                this.guardrailId = aws_cdk_lib_1.Arn.split(attrs.guardrailArn, aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME).resourceName;
                this.guardrailVersion = attrs.guardrailVersion ?? 'DRAFT';
                this.kmsKey = attrs.kmsKey;
            }
        }
        return new Import(scope, id);
    }
    /**
     * Import a low-level L1 Cfn Guardrail
     */
    static fromCfnGuardrail(cfnGuardrail) {
        return new (class extends GuardrailBase {
            constructor() {
                super(...arguments);
                this.guardrailArn = cfnGuardrail.attrGuardrailArn;
                this.guardrailId = cfnGuardrail.attrGuardrailId;
                this.guardrailVersion = cfnGuardrail.attrVersion;
                this.kmsKey = cfnGuardrail.kmsKeyArn
                    ? aws_kms_1.Key.fromKeyArn(this, '@FromCfnGuardrailKey', cfnGuardrail.kmsKeyArn)
                    : undefined;
            }
        })(cfnGuardrail, '@FromCfnGuardrail');
    }
    constructor(scope, id, props) {
        super(scope, id, {
            physicalName: props.name,
        });
        // ------------------------------------------------------
        // Set properties or defaults
        // ------------------------------------------------------
        this.name = this.physicalName;
        this.contentFilters = props.contentFilters ?? [];
        this.piiFilters = props.piiFilters ?? [];
        this.regexFilters = props.regexFilters ?? [];
        this.deniedTopics = props.deniedTopics ?? [];
        this.contextualGroundingFilters = props.contextualGroundingFilters ?? [];
        this.wordFilters = props.wordFilters ?? [];
        this.managedWordListFilters = props.managedWordListFilters ?? [];
        const defaultBlockedInputMessaging = 'Sorry, your query violates our usage policy.';
        const defaultBlockedOutputsMessaging = 'Sorry, I am unable to answer your question because of our usage policy.';
        // ------------------------------------------------------
        // CFN Props - With Lazy support
        // ------------------------------------------------------
        let cfnProps = {
            name: this.name,
            description: props.description,
            kmsKeyArn: props.kmsKey?.keyArn,
            blockedInputMessaging: props.blockedInputMessaging ?? defaultBlockedInputMessaging,
            blockedOutputsMessaging: props.blockedOutputsMessaging ?? defaultBlockedOutputsMessaging,
            // Lazy props
            contentPolicyConfig: this.generateCfnContentPolicyConfig(),
            contextualGroundingPolicyConfig: this.generateCfnContextualPolicyConfig(),
            topicPolicyConfig: this.generateCfnTopicPolicy(),
            wordPolicyConfig: this.generateCfnWordPolicyConfig(),
            sensitiveInformationPolicyConfig: this.generateCfnSensitiveInformationPolicyConfig(),
        };
        // Hash calculation useful for versioning of the guardrail
        this.hash = (0, helpers_internal_1.md5hash)(JSON.stringify(cfnProps));
        // ------------------------------------------------------
        // L1 Instantiation
        // ------------------------------------------------------
        this.__resource = new bedrock.CfnGuardrail(this, 'MyGuardrail', cfnProps);
        this.guardrailId = this.__resource.attrGuardrailId;
        this.guardrailArn = this.__resource.attrGuardrailArn;
        this.guardrailVersion = this.__resource.attrVersion;
    }
    // ------------------------------------------------------
    // METHODS
    // ------------------------------------------------------
    /**
     * Adds a content filter to the guardrail.
     * @param filter The content filter to add.
     */
    addContentFilter(filter) {
        this.contentFilters.push(filter);
    }
    /**
     * Adds a PII filter to the guardrail.
     * @param filter The PII filter to add.
     */
    addPIIFilter(filter) {
        this.piiFilters.push(filter);
    }
    /**
     * Adds a regex filter to the guardrail.
     * @param filter The regex filter to add.
     */
    addRegexFilter(filter) {
        this.regexFilters.push(filter);
    }
    /**
     * Adds a denied topic filter to the guardrail.
     * @param filter The denied topic filter to add.
     */
    addDeniedTopicFilter(filter) {
        this.deniedTopics.push(filter);
    }
    /**
     * Adds a contextual grounding filter to the guardrail.
     * @param filter The contextual grounding filter to add.
     */
    addContextualGroundingFilter(filter) {
        this.contextualGroundingFilters.push(filter);
    }
    /**
     * Adds a word filter to the guardrail.
     * @param filter The word filter to add.
     */
    addWordFilter(filter) {
        this.wordFilters.push(filter);
    }
    /**
     * Adds a word filter to the guardrail.
     * @param filePath The location of the word filter file.
     */
    addWordFilterFromFile(filePath) {
        const fileContents = fs.readFileSync(filePath, 'utf8');
        const words = fileContents.trim().split(',');
        for (const word of words)
            this.addWordFilter(word);
    }
    /**
     * Adds a managed word list filter to the guardrail.
     * @param filter The managed word list filter to add.
     */
    addManagedWordListFilter(filter) {
        this.managedWordListFilters.push(filter);
    }
    /**
     * Create a version for the guardrail.
     * @param description The description of the version.
     * @returns The guardrail version.
     */
    createVersion(description) {
        const cfnVersion = new bedrock.CfnGuardrailVersion(this, `GuardrailVersion-${this.hash.slice(0, 16)}`, {
            description: description,
            guardrailIdentifier: this.guardrailId,
        });
        this.guardrailVersion = cfnVersion.attrVersion;
        return this.guardrailVersion;
    }
    // ------------------------------------------------------
    // CFN Generators
    // ------------------------------------------------------
    /**
     * Returns the content filters applied to the guardrail. This method defers the computation
     * to synth time.
     */
    generateCfnContentPolicyConfig() {
        return aws_cdk_lib_1.Lazy.any({
            produce: () => {
                if (this.contentFilters.length > 0) {
                    return { filtersConfig: this.contentFilters };
                }
                else {
                    return undefined;
                }
            },
        });
    }
    /**
     * Returns the topic filters applied to the guardrail. This method defers the computation
     * to synth time.
     */
    generateCfnTopicPolicy() {
        return aws_cdk_lib_1.Lazy.any({
            produce: () => {
                if (this.deniedTopics.length > 0) {
                    return {
                        topicsConfig: this.deniedTopics.flatMap((topic) => {
                            return {
                                definition: topic.definition,
                                name: topic.name,
                                examples: topic.examples,
                                type: 'DENY',
                            };
                        }),
                    };
                }
                else {
                    return undefined;
                }
            },
        });
    }
    /**
     * Returns the contectual filters applied to the guardrail. This method defers the computation
     * to synth time.
     */
    generateCfnContextualPolicyConfig() {
        return aws_cdk_lib_1.Lazy.any({
            produce: () => {
                if (this.contextualGroundingFilters.length > 0) {
                    return {
                        filtersConfig: this.contextualGroundingFilters.flatMap((filter) => {
                            return {
                                type: filter.type,
                                threshold: filter.threshold,
                            };
                        }),
                    };
                }
                else {
                    return undefined;
                }
            },
        });
    }
    /**
     * Returns the word config applied to the guardrail. This method defers the computation
     * to synth time.
     */
    generateCfnWordPolicyConfig() {
        return aws_cdk_lib_1.Lazy.any({
            produce: () => {
                if (this.wordFilters.length > 0 || this.managedWordListFilters.length > 0) {
                    return {
                        wordsConfig: this.generateCfnWordConfig(),
                        managedWordListsConfig: this.generateCfnManagedWordListsConfig(),
                    };
                }
                else {
                    return undefined;
                }
            },
        });
    }
    /**
     * Returns the word filters applied to the guardrail. This method defers the computation
     * to synth time.
     */
    generateCfnWordConfig() {
        return aws_cdk_lib_1.Lazy.any({
            produce: () => {
                return this.wordFilters.flatMap((word) => {
                    return {
                        text: word,
                    };
                });
            },
        }, { omitEmptyArray: true });
    }
    /**
     * Returns the word filters applied to the guardrail. This method defers the computation
     * to synth time.
     */
    generateCfnManagedWordListsConfig() {
        return aws_cdk_lib_1.Lazy.any({
            produce: () => {
                return this.managedWordListFilters.flatMap((filter) => {
                    return {
                        type: filter.toString(),
                    };
                });
            },
        }, { omitEmptyArray: true });
    }
    /**
     * Returns the sensitive information config applied to the guardrail. This method defers the computation
     * to synth time.
     */
    generateCfnSensitiveInformationPolicyConfig() {
        return aws_cdk_lib_1.Lazy.any({
            produce: () => {
                if (this.regexFilters.length > 0 || this.piiFilters.length > 0) {
                    return {
                        regexesConfig: this.generateCfnRegexesConfig(),
                        piiEntitiesConfig: this.generateCfnPiiEntitiesConfig(),
                    };
                }
                else {
                    return undefined;
                }
            },
        }, { omitEmptyArray: true });
    }
    /**
     * Returns the regex filters applied to the guardrail. This method defers the computation
     * to synth time.
     */
    generateCfnRegexesConfig() {
        return aws_cdk_lib_1.Lazy.any({
            produce: () => {
                return this.regexFilters.flatMap((regex) => {
                    return {
                        name: regex.name,
                        description: regex.description,
                        pattern: regex.pattern,
                        action: regex.action,
                    };
                });
            },
        }, { omitEmptyArray: true });
    }
    /**
     * Returns the Pii filters applied to the guardrail. This method defers the computation
     * to synth time.
     */
    generateCfnPiiEntitiesConfig() {
        return aws_cdk_lib_1.Lazy.any({
            produce: () => {
                return this.piiFilters.flatMap((filter) => {
                    return {
                        type: filter.type,
                        action: filter.action,
                    };
                });
            },
        }, { omitEmptyArray: true });
    }
}
exports.Guardrail = Guardrail;
_b = JSII_RTTI_SYMBOL_1;
Guardrail[_b] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.Guardrail", version: "0.1.285" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3VhcmRyYWlscy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jZGstbGliL2JlZHJvY2svZ3VhcmRyYWlscy9ndWFyZHJhaWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7QUFFSCx5QkFBeUI7QUFDekIsNkNBQXFGO0FBQ3JGLG1EQUFtRDtBQUNuRCwyQ0FBMkM7QUFDM0MsaURBQWdEO0FBQ2hELDRFQUFnRTtBQXNDaEU7OztHQUdHO0FBQ0gsTUFBc0IsYUFBYyxTQUFRLHNCQUFRO0lBaUJsRDs7T0FFRztJQUNJLFVBQVUsQ0FBQyxPQUF1QjtRQUN2QyxPQUFPLEdBQUcsQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDO1lBQzlCLE9BQU87WUFDUCxZQUFZLEVBQUUsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDO1lBQ2pDLE9BQU8sRUFBRSxDQUFDLHdCQUF3QixDQUFDO1lBQ25DLEtBQUssRUFBRSxJQUFJO1NBQ1osQ0FBQyxDQUFDO0lBQ0wsQ0FBQzs7QUEzQkgsc0NBNEJDOzs7QUF5RkQ7OytFQUUrRTtBQUMvRTs7R0FFRztBQUNILE1BQWEsU0FBVSxTQUFRLGFBQWE7SUFDMUM7O09BRUc7SUFDSSxNQUFNLENBQUMsdUJBQXVCLENBQUMsS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBMEI7UUFDNUYsTUFBTSxNQUFPLFNBQVEsYUFBYTtZQUFsQzs7Z0JBQ2tCLGlCQUFZLEdBQUcsS0FBSyxDQUFDLFlBQVksQ0FBQztnQkFDbEMsZ0JBQVcsR0FBRyxpQkFBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUFFLHVCQUFTLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxZQUFhLENBQUM7Z0JBQ3pGLHFCQUFnQixHQUFHLEtBQUssQ0FBQyxnQkFBZ0IsSUFBSSxPQUFPLENBQUM7Z0JBQ3JELFdBQU0sR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDO1lBQ3hDLENBQUM7U0FBQTtR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Q0FDYjtZQUNFLE9BQU8sRUFBRSxHQUFHLEVBQUU7Z0JBQ1osT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQXlCLEVBQUUsRUFBRTtvQkFDM0QsT0FBTzt3QkFDTCxJQUFJLEVBQUUsTUFBTSxDQUFDLElBQUk7d0JBQ2pCLE1BQU0sRUFBRSxNQUFNLENBQUMsTUFBTTtxQkFDMEIsQ0FBQztnQkFDcEQsQ0FBQyxDQUFDLENBQUM7WUFDTCxDQUFDO1NBQ0YsRUFDRCxFQUFFLGNBQWMsRUFBRSxJQUFJLEVBQUUsQ0FDekIsQ0FBQztJQUNKLENBQUM7O0FBN1pILDhCQThaQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogIENvcHlyaWdodCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiAgd2l0aCB0aGUgTGljZW5zZS4gQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqICBvciBpbiB0aGUgJ2xpY2Vuc2UnIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICdBUyBJUycgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFU1xuICogIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXG4gKiAgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCB7IEFybiwgQXJuRm9ybWF0LCBJUmVzb2x2YWJsZSwgSVJlc291cmNlLCBMYXp5LCBSZXNvdXJjZSB9IGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCAqIGFzIGJlZHJvY2sgZnJvbSAnYXdzLWNkay1saWIvYXdzLWJlZHJvY2snO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gJ2F3cy1jZGstbGliL2F3cy1pYW0nO1xuaW1wb3J0IHsgSUtleSwgS2V5IH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWttcyc7XG5pbXBvcnQgeyBtZDVoYXNoIH0gZnJvbSAnYXdzLWNkay1saWIvY29yZS9saWIvaGVscGVycy1pbnRlcm5hbCc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCAqIGFzIGZpbHRlcnMgZnJvbSAnLi9ndWFyZHJhaWwtZmlsdGVycyc7XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ09NTU9OXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIFJlcHJlc2VudHMgYSBHdWFyZHJhaWwsIGVpdGhlciBjcmVhdGVkIHdpdGggQ0RLIG9yIGltcG9ydGVkLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIElHdWFyZHJhaWwgZXh0ZW5kcyBJUmVzb3VyY2Uge1xuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUgZ3VhcmRyYWlsLlxuICAgKiBAZXhhbXBsZSBcImFybjphd3M6YmVkcm9jazp1cy1lYXN0LTE6MTIzNDU2Nzg5MDEyOmd1YXJkcmFpbC95eW1wem8zOThpcHFcIlxuICAgKiBAYXR0cmlidXRlXG4gICAqL1xuICByZWFkb25seSBndWFyZHJhaWxBcm46IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBJRCBvZiB0aGUgZ3VhcmRyYWlsLlxuICAgKiBAZXhhbXBsZSBcInl5bXB6bzM5OGlwcVwiXG4gICAqIEBhdHRyaWJ1dGVcbiAgICovXG4gIHJlYWRvbmx5IGd1YXJkcmFpbElkOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgdmVyc2lvbiBvZiB0aGUgZ3VhcmRyYWlsLiBJZiBubyBleHBsaWNpdCB2ZXJzaW9uIGlzIGNyZWF0ZWQsXG4gICAqIHRoaXMgd2lsbCBkZWZhdWx0IHRvIFwiRFJBRlRcIlxuICAgKi9cbiAgZ3VhcmRyYWlsVmVyc2lvbjogc3RyaW5nO1xuICAvKipcbiAgICogT3B0aW9uYWwgS01TIGVuY3J5cHRpb24ga2V5IGFzc29jaWF0ZWQgd2l0aCB0aGlzIGd1YXJkcmFpbFxuICAgKi9cbiAgcmVhZG9ubHkga21zS2V5PzogSUtleTtcbiAgLyoqXG4gICAqIEdyYW50IHRoZSBnaXZlbiBpZGVudGl0eSBwZXJtaXNzaW9ucyB0byBhcHBseSB0aGUgZ3VhcmRyYWlsLlxuICAgKi9cbiAgZ3JhbnRBcHBseShncmFudGVlOiBpYW0uSUdyYW50YWJsZSk6IGlhbS5HcmFudDtcbn1cblxuLyoqXG4gKiBBYnN0cmFjdCBiYXNlIGNsYXNzIGZvciBhIEd1YXJkcmFpbC5cbiAqIENvbnRhaW5zIG1ldGhvZHMgYW5kIGF0dHJpYnV0ZXMgdmFsaWQgZm9yIEd1YXJkcmFpbHMgZWl0aGVyIGNyZWF0ZWQgd2l0aCBDREsgb3IgaW1wb3J0ZWQuXG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBHdWFyZHJhaWxCYXNlIGV4dGVuZHMgUmVzb3VyY2UgaW1wbGVtZW50cyBJR3VhcmRyYWlsIHtcbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgdGhlIGd1YXJkcmFpbC5cbiAgICovXG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSBndWFyZHJhaWxBcm46IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBJRCBvZiB0aGUgZ3VhcmRyYWlsLlxuICAgKi9cbiAgcHVibGljIGFic3RyYWN0IHJlYWRvbmx5IGd1YXJkcmFpbElkOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgSUQgb2YgdGhlIGd1YXJkcmFpbC5cbiAgICovXG4gIHB1YmxpYyBhYnN0cmFjdCBndWFyZHJhaWxWZXJzaW9uOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgS01TIGtleSBvZiB0aGUgZ3VhcmRyYWlsIGlmIGN1c3RvbSBlbmNyeXB0aW9uIGlzIGNvbmZpZ3VyZWQuXG4gICAqL1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkga21zS2V5PzogSUtleTtcbiAgLyoqXG4gICAqIEdyYW50IHRoZSBnaXZlbiBpZGVudGl0eSBwZXJtaXNzaW9ucyB0byBhcHBseSB0aGUgZ3VhcmRyYWlsLlxuICAgKi9cbiAgcHVibGljIGdyYW50QXBwbHkoZ3JhbnRlZTogaWFtLklHcmFudGFibGUpOiBpYW0uR3JhbnQge1xuICAgIHJldHVybiBpYW0uR3JhbnQuYWRkVG9QcmluY2lwYWwoe1xuICAgICAgZ3JhbnRlZSxcbiAgICAgIHJlc291cmNlQXJuczogW3RoaXMuZ3VhcmRyYWlsQXJuXSxcbiAgICAgIGFjdGlvbnM6IFsnYmVkcm9jazpBcHBseUd1YXJkcmFpbCddLFxuICAgICAgc2NvcGU6IHRoaXMsXG4gICAgfSk7XG4gIH1cbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogICAgICAgICAgICAgICAgICAgICAgICBQUk9QUyBGT1IgTkVXIENPTlNUUlVDVFxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqXG4gKiBQcm9wZXJ0aWVzIGZvciBjcmVhdGluZyBhIEd1YXJkcmFpbC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBHdWFyZHJhaWxQcm9wcyB7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgZ3VhcmRyYWlsLlxuICAgKi9cbiAgcmVhZG9ubHkgbmFtZTogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIGRlc2NyaXB0aW9uIG9mIHRoZSBndWFyZHJhaWwuXG4gICAqL1xuICByZWFkb25seSBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBtZXNzYWdlIHRvIHJldHVybiB3aGVuIHRoZSBndWFyZHJhaWwgYmxvY2tzIGEgcHJvbXB0LlxuICAgKlxuICAgKiBAZGVmYXVsdCBcIlNvcnJ5LCB5b3VyIHF1ZXJ5IHZpb2xhdGVzIG91ciB1c2FnZSBwb2xpY3kuXCJcbiAgICovXG4gIHJlYWRvbmx5IGJsb2NrZWRJbnB1dE1lc3NhZ2luZz86IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBtZXNzYWdlIHRvIHJldHVybiB3aGVuIHRoZSBndWFyZHJhaWwgYmxvY2tzIGEgbW9kZWwgcmVzcG9uc2UuXG4gICAqXG4gICAqIEBkZWZhdWx0IFwiU29ycnksIEkgYW0gdW5hYmxlIHRvIGFuc3dlciB5b3VyIHF1ZXN0aW9uIGJlY2F1c2Ugb2Ygb3VyIHVzYWdlIHBvbGljeS5cIlxuICAgKi9cbiAgcmVhZG9ubHkgYmxvY2tlZE91dHB1dHNNZXNzYWdpbmc/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBBIGN1c3RvbSBLTVMga2V5IHRvIHVzZSBmb3IgZW5jcnlwdGluZyBkYXRhLlxuICAgKlxuICAgKiBAZGVmYXVsdCBcIllvdXIgZGF0YSBpcyBlbmNyeXB0ZWQgYnkgZGVmYXVsdCB3aXRoIGEga2V5IHRoYXQgQVdTIG93bnMgYW5kIG1hbmFnZXMgZm9yIHlvdS5cIlxuICAgKi9cbiAgcmVhZG9ubHkga21zS2V5PzogSUtleTtcbiAgLyoqXG4gICAqIFRoZSBjb250ZW50IGZpbHRlcnMgdG8gYXBwbHkgdG8gdGhlIGd1YXJkcmFpbC5cbiAgICogTm90ZSwgaWYgb25lIG9mXG4gICAqL1xuICByZWFkb25seSBjb250ZW50RmlsdGVycz86IGZpbHRlcnMuQ29udGVudEZpbHRlcltdO1xuICAvKipcbiAgICogVXAgdG8gMzAgZGVuaWVkIHRvcGljcyB0byBibG9jayB1c2VyIGlucHV0cyBvciBtb2RlbCByZXNwb25zZXMgYXNzb2NpYXRlZCB3aXRoIHRoZSB0b3BpYy5cbiAgICovXG4gIHJlYWRvbmx5IGRlbmllZFRvcGljcz86IGZpbHRlcnMuVG9waWNbXTtcbiAgLyoqXG4gICAqIFRoZSB3b3JkIGZpbHRlcnMgdG8gYXBwbHkgdG8gdGhlIGd1YXJkcmFpbC5cbiAgICovXG4gIHJlYWRvbmx5IHdvcmRGaWx0ZXJzPzogc3RyaW5nW107XG4gIC8qKlxuICAgKiBUaGUgbWFuYWdlZCB3b3JkIGZpbHRlcnMgdG8gYXBwbHkgdG8gdGhlIGd1YXJkcmFpbC5cbiAgICovXG4gIHJlYWRvbmx5IG1hbmFnZWRXb3JkTGlzdEZpbHRlcnM/OiBmaWx0ZXJzLk1hbmFnZWRXb3JkRmlsdGVyVHlwZVtdO1xuICAvKipcbiAgICogVGhlIFBJSSBmaWx0ZXJzIHRvIGFwcGx5IHRvIHRoZSBndWFyZHJhaWwuXG4gICAqL1xuICByZWFkb25seSBwaWlGaWx0ZXJzPzogZmlsdGVycy5QSUlGaWx0ZXJbXTtcbiAgLyoqXG4gICAqIFRoZSByZWd1bGFyIGV4cHJlc3Npb24gKHJlZ2V4KSBmaWx0ZXJzIHRvIGFwcGx5IHRvIHRoZSBndWFyZHJhaWwuXG4gICAqL1xuICByZWFkb25seSByZWdleEZpbHRlcnM/OiBmaWx0ZXJzLlJlZ2V4RmlsdGVyW107XG4gIC8qKlxuICAgKiBUaGUgY29udGV4dHVhbCBncm91bmRpbmcgZmlsdGVycyB0byBhcHBseSB0byB0aGUgZ3VhcmRyYWlsLlxuICAgKi9cbiAgcmVhZG9ubHkgY29udGV4dHVhbEdyb3VuZGluZ0ZpbHRlcnM/OiBmaWx0ZXJzLkNvbnRleHR1YWxHcm91bmRpbmdGaWx0ZXJbXTtcbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogICAgICAgICAgICAgICAgICAgICAgQVRUUlMgRk9SIElNUE9SVEVEIENPTlNUUlVDVFxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuZXhwb3J0IGludGVyZmFjZSBHdWFyZHJhaWxBdHRyaWJ1dGVzIHtcbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgdGhlIGd1YXJkcmFpbC4gQXQgbGVhc3Qgb25lIG9mIGd1YXJkcmFpbEFybiBvciBndWFyZHJhaWxJZCBtdXN0IGJlXG4gICAqIGRlZmluZWQgaW4gb3JkZXIgdG8gaW5pdGlhbGl6ZSBhIGd1YXJkcmFpbCByZWYuXG4gICAqL1xuICByZWFkb25seSBndWFyZHJhaWxBcm46IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBLTVMga2V5IG9mIHRoZSBndWFyZHJhaWwgaWYgY3VzdG9tIGVuY3J5cHRpb24gaXMgY29uZmlndXJlZC5cbiAgICpcbiAgICogQGRlZmF1bHQgdW5kZWZpbmVkIC0gTWVhbnMgZGF0YSBpcyBlbmNyeXB0ZWQgYnkgZGVmYXVsdCB3aXRoIGEgQVdTLW1hbmFnZWQga2V5XG4gICAqL1xuICByZWFkb25seSBrbXNLZXk/OiBJS2V5O1xuICAvKipcbiAgICogVGhlIHZlcnNpb24gb2YgdGhlIGd1YXJkcmFpbC5cbiAgICpcbiAgICogQGRlZmF1bHQgXCJEUkFGVFwiXG4gICAqL1xuICByZWFkb25seSBndWFyZHJhaWxWZXJzaW9uPzogc3RyaW5nO1xufVxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiAgICAgICAgICAgICAgICAgICAgICAgIE5FVyBDT05TVFJVQ1QgREVGSU5JVElPTlxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqXG4gKiBDbGFzcyB0byBjcmVhdGUgYSBHdWFyZHJhaWwgd2l0aCBDREsuXG4gKi9cbmV4cG9ydCBjbGFzcyBHdWFyZHJhaWwgZXh0ZW5kcyBHdWFyZHJhaWxCYXNlIHtcbiAgLyoqXG4gICAqIEltcG9ydCBhIGd1YXJkcmFpbCBnaXZlbiBpdHMgYXR0cmlidXRlc1xuICAgKi9cbiAgcHVibGljIHN0YXRpYyBmcm9tR3VhcmRyYWlsQXR0cmlidXRlcyhzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBhdHRyczogR3VhcmRyYWlsQXR0cmlidXRlcyk6IElHdWFyZHJhaWwge1xuICAgIGNsYXNzIEltcG9ydCBleHRlbmRzIEd1YXJkcmFpbEJhc2Uge1xuICAgICAgcHVibGljIHJlYWRvbmx5IGd1YXJkcmFpbEFybiA9IGF0dHJzLmd1YXJkcmFpbEFybjtcbiAgICAgIHB1YmxpYyByZWFkb25seSBndWFyZHJhaWxJZCA9IEFybi5zcGxpdChhdHRycy5ndWFyZHJhaWxBcm4sIEFybkZvcm1hdC5TTEFTSF9SRVNPVVJDRV9OQU1FKS5yZXNvdXJjZU5hbWUhO1xuICAgICAgcHVibGljIHJlYWRvbmx5IGd1YXJkcmFpbFZlcnNpb24gPSBhdHRycy5ndWFyZHJhaWxWZXJzaW9uID8/ICdEUkFGVCc7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkga21zS2V5ID0gYXR0cnMua21zS2V5O1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgSW1wb3J0KHNjb3BlLCBpZCk7XG4gIH1cblxuICAvKipcbiAgICogSW1wb3J0IGEgbG93LWxldmVsIEwxIENmbiBHdWFyZHJhaWxcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgZnJvbUNmbkd1YXJkcmFpbChjZm5HdWFyZHJhaWw6IGJlZHJvY2suQ2ZuR3VhcmRyYWlsKTogSUd1YXJkcmFpbCB7XG4gICAgcmV0dXJuIG5ldyAoY2xhc3MgZXh0ZW5kcyBHdWFyZHJhaWxCYXNlIHtcbiAgICAgIHB1YmxpYyByZWFkb25seSBndWFyZHJhaWxBcm4gPSBjZm5HdWFyZHJhaWwuYXR0ckd1YXJkcmFpbEFybjtcbiAgICAgIHB1YmxpYyByZWFkb25seSBndWFyZHJhaWxJZCA9IGNmbkd1YXJkcmFpbC5hdHRyR3VhcmRyYWlsSWQ7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgZ3VhcmRyYWlsVmVyc2lvbiA9IGNmbkd1YXJkcmFpbC5hdHRyVmVyc2lvbjtcbiAgICAgIHB1YmxpYyByZWFkb25seSBrbXNLZXkgPSBjZm5HdWFyZHJhaWwua21zS2V5QXJuXG4gICAgICAgID8gS2V5LmZyb21LZXlBcm4odGhpcywgJ0BGcm9tQ2ZuR3VhcmRyYWlsS2V5JywgY2ZuR3VhcmRyYWlsLmttc0tleUFybilcbiAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgfSkoY2ZuR3VhcmRyYWlsLCAnQEZyb21DZm5HdWFyZHJhaWwnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBndWFyZHJhaWwuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZ3VhcmRyYWlsQXJuOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgSUQgb2YgdGhlIGd1YXJkcmFpbC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBndWFyZHJhaWxJZDogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGd1YXJkcmFpbC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBuYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgdmVyc2lvbiBvZiB0aGUgZ3VhcmRyYWlsLlxuICAgKiBCeSBkZWZhdWx0LCB0aGlzIHZhbHVlIHdpbGwgYWx3YXlzIGJlIGBEUkFGVGAgdW5sZXNzIGFuIGV4cGxpY2l0IHZlcnNpb24gaXMgY3JlYXRlZC5cbiAgICogRm9yIGFuIGV4cGxpY2l0IHZlcnNpb24gY3JlYXRlZCwgdGhpcyB3aWxsIHVzdWFsbHkgYmUgYSBudW1iZXIgKGUuZy4gZm9yIFZlcnNpb24gMSBqdXN0IGVudGVyIFwiMVwiKVxuICAgKlxuICAgKiBAZXhhbXBsZSBcIjFcIlxuICAgKiBAZGVmYXVsdCAtIFwiRFJBRlRcIlxuICAgKi9cbiAgcHVibGljIGd1YXJkcmFpbFZlcnNpb246IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBLTVMga2V5IHVzZWQgdG8gZW5jcnlwdCBkYXRhLlxuICAgKlxuICAgKiBAZGVmYXVsdCB1bmRlZmluZWQgLSBcIkRhdGEgaXMgZW5jcnlwdGVkIGJ5IGRlZmF1bHQgd2l0aCBhIGtleSB0aGF0IEFXUyBvd25zIGFuZCBtYW5hZ2VzIGZvciB5b3VcIlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGttc0tleT86IElLZXk7XG4gIC8qKlxuICAgKiBUaGUgY29udGVudCBmaWx0ZXJzIGFwcGxpZWQgYnkgdGhlIGd1YXJkcmFpbC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBjb250ZW50RmlsdGVyczogZmlsdGVycy5Db250ZW50RmlsdGVyW107XG4gIC8qKlxuICAgKiBUaGUgUElJIGZpbHRlcnMgYXBwbGllZCBieSB0aGUgZ3VhcmRyYWlsLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHBpaUZpbHRlcnM6IGZpbHRlcnMuUElJRmlsdGVyW107XG4gIC8qKlxuICAgKiBUaGUgcmVnZXggZmlsdGVycyBhcHBsaWVkIGJ5IHRoZSBndWFyZHJhaWwuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgcmVnZXhGaWx0ZXJzOiBmaWx0ZXJzLlJlZ2V4RmlsdGVyW107XG4gIC8qKlxuICAgKiBUaGUgZGVuaWVkIHRvcGljIGZpbHRlcnMgYXBwbGllZCBieSB0aGUgZ3VhcmRyYWlsLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGRlbmllZFRvcGljczogZmlsdGVycy5Ub3BpY1tdO1xuICAvKipcbiAgICogVGhlIGNvbnRleHR1YWwgZ3JvdW5kaW5nIGZpbHRlcnMgYXBwbGllZCBieSB0aGUgZ3VhcmRyYWlsLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGNvbnRleHR1YWxHcm91bmRpbmdGaWx0ZXJzOiBmaWx0ZXJzLkNvbnRleHR1YWxHcm91bmRpbmdGaWx0ZXJbXTtcbiAgLyoqXG4gICAqIFRoZSB3b3JkIGZpbHRlcnMgYXBwbGllZCBieSB0aGUgZ3VhcmRyYWlsLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHdvcmRGaWx0ZXJzOiBzdHJpbmdbXTtcbiAgLyoqXG4gICAqIFRoZSBtYW5hZ2VkIHdvcmQgbGlzdCBmaWx0ZXJzIGFwcGxpZWQgYnkgdGhlIGd1YXJkcmFpbC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBtYW5hZ2VkV29yZExpc3RGaWx0ZXJzOiBmaWx0ZXJzLk1hbmFnZWRXb3JkRmlsdGVyVHlwZVtdO1xuICAvKipcbiAgICogVGhlIGNvbXB1dGVkIGhhc2ggb2YgdGhlIGd1YXJkcmFpbCBwcm9wZXJ0aWVzLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGhhc2g6IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBMMSByZXByZXNlbnRhdGlvbiBvZiB0aGUgZ3VhcmRyYWlsXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IF9fcmVzb3VyY2U6IGJlZHJvY2suQ2ZuR3VhcmRyYWlsO1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBHdWFyZHJhaWxQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCwge1xuICAgICAgcGh5c2ljYWxOYW1lOiBwcm9wcy5uYW1lLFxuICAgIH0pO1xuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gU2V0IHByb3BlcnRpZXMgb3IgZGVmYXVsdHNcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICB0aGlzLm5hbWUgPSB0aGlzLnBoeXNpY2FsTmFtZTtcbiAgICB0aGlzLmNvbnRlbnRGaWx0ZXJzID0gcHJvcHMuY29udGVudEZpbHRlcnMgPz8gW107XG4gICAgdGhpcy5waWlGaWx0ZXJzID0gcHJvcHMucGlpRmlsdGVycyA/PyBbXTtcbiAgICB0aGlzLnJlZ2V4RmlsdGVycyA9IHByb3BzLnJlZ2V4RmlsdGVycyA/PyBbXTtcbiAgICB0aGlzLmRlbmllZFRvcGljcyA9IHByb3BzLmRlbmllZFRvcGljcyA/PyBbXTtcbiAgICB0aGlzLmNvbnRleHR1YWxHcm91bmRpbmdGaWx0ZXJzID0gcHJvcHMuY29udGV4dHVhbEdyb3VuZGluZ0ZpbHRlcnMgPz8gW107XG4gICAgdGhpcy53b3JkRmlsdGVycyA9IHByb3BzLndvcmRGaWx0ZXJzID8/IFtdO1xuICAgIHRoaXMubWFuYWdlZFdvcmRMaXN0RmlsdGVycyA9IHByb3BzLm1hbmFnZWRXb3JkTGlzdEZpbHRlcnMgPz8gW107XG5cbiAgICBjb25zdCBkZWZhdWx0QmxvY2tlZElucHV0TWVzc2FnaW5nID0gJ1NvcnJ5LCB5b3VyIHF1ZXJ5IHZpb2xhdGVzIG91ciB1c2FnZSBwb2xpY3kuJztcbiAgICBjb25zdCBkZWZhdWx0QmxvY2tlZE91dHB1dHNNZXNzYWdpbmcgPSAnU29ycnksIEkgYW0gdW5hYmxlIHRvIGFuc3dlciB5b3VyIHF1ZXN0aW9uIGJlY2F1c2Ugb2Ygb3VyIHVzYWdlIHBvbGljeS4nO1xuXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gQ0ZOIFByb3BzIC0gV2l0aCBMYXp5IHN1cHBvcnRcbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICBsZXQgY2ZuUHJvcHM6IGJlZHJvY2suQ2ZuR3VhcmRyYWlsUHJvcHMgPSB7XG4gICAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgICBkZXNjcmlwdGlvbjogcHJvcHMuZGVzY3JpcHRpb24sXG4gICAgICBrbXNLZXlBcm46IHByb3BzLmttc0tleT8ua2V5QXJuLFxuICAgICAgYmxvY2tlZElucHV0TWVzc2FnaW5nOiBwcm9wcy5ibG9ja2VkSW5wdXRNZXNzYWdpbmcgPz8gZGVmYXVsdEJsb2NrZWRJbnB1dE1lc3NhZ2luZyxcbiAgICAgIGJsb2NrZWRPdXRwdXRzTWVzc2FnaW5nOiBwcm9wcy5ibG9ja2VkT3V0cHV0c01lc3NhZ2luZyA/PyBkZWZhdWx0QmxvY2tlZE91dHB1dHNNZXNzYWdpbmcsXG4gICAgICAvLyBMYXp5IHByb3BzXG4gICAgICBjb250ZW50UG9saWN5Q29uZmlnOiB0aGlzLmdlbmVyYXRlQ2ZuQ29udGVudFBvbGljeUNvbmZpZygpLFxuICAgICAgY29udGV4dHVhbEdyb3VuZGluZ1BvbGljeUNvbmZpZzogdGhpcy5nZW5lcmF0ZUNmbkNvbnRleHR1YWxQb2xpY3lDb25maWcoKSxcbiAgICAgIHRvcGljUG9saWN5Q29uZmlnOiB0aGlzLmdlbmVyYXRlQ2ZuVG9waWNQb2xpY3koKSxcbiAgICAgIHdvcmRQb2xpY3lDb25maWc6IHRoaXMuZ2VuZXJhdGVDZm5Xb3JkUG9saWN5Q29uZmlnKCksXG4gICAgICBzZW5zaXRpdmVJbmZvcm1hdGlvblBvbGljeUNvbmZpZzogdGhpcy5nZW5lcmF0ZUNmblNlbnNpdGl2ZUluZm9ybWF0aW9uUG9saWN5Q29uZmlnKCksXG4gICAgfTtcblxuICAgIC8vIEhhc2ggY2FsY3VsYXRpb24gdXNlZnVsIGZvciB2ZXJzaW9uaW5nIG9mIHRoZSBndWFyZHJhaWxcbiAgICB0aGlzLmhhc2ggPSBtZDVoYXNoKEpTT04uc3RyaW5naWZ5KGNmblByb3BzKSk7XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBMMSBJbnN0YW50aWF0aW9uXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5fX3Jlc291cmNlID0gbmV3IGJlZHJvY2suQ2ZuR3VhcmRyYWlsKHRoaXMsICdNeUd1YXJkcmFpbCcsIGNmblByb3BzKTtcblxuICAgIHRoaXMuZ3VhcmRyYWlsSWQgPSB0aGlzLl9fcmVzb3VyY2UuYXR0ckd1YXJkcmFpbElkO1xuICAgIHRoaXMuZ3VhcmRyYWlsQXJuID0gdGhpcy5fX3Jlc291cmNlLmF0dHJHdWFyZHJhaWxBcm47XG4gICAgdGhpcy5ndWFyZHJhaWxWZXJzaW9uID0gdGhpcy5fX3Jlc291cmNlLmF0dHJWZXJzaW9uO1xuICB9XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIE1FVEhPRFNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8qKlxuICAgKiBBZGRzIGEgY29udGVudCBmaWx0ZXIgdG8gdGhlIGd1YXJkcmFpbC5cbiAgICogQHBhcmFtIGZpbHRlciBUaGUgY29udGVudCBmaWx0ZXIgdG8gYWRkLlxuICAgKi9cbiAgcHVibGljIGFkZENvbnRlbnRGaWx0ZXIoZmlsdGVyOiBmaWx0ZXJzLkNvbnRlbnRGaWx0ZXIpOiB2b2lkIHtcbiAgICB0aGlzLmNvbnRlbnRGaWx0ZXJzLnB1c2goZmlsdGVyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGEgUElJIGZpbHRlciB0byB0aGUgZ3VhcmRyYWlsLlxuICAgKiBAcGFyYW0gZmlsdGVyIFRoZSBQSUkgZmlsdGVyIHRvIGFkZC5cbiAgICovXG4gIHB1YmxpYyBhZGRQSUlGaWx0ZXIoZmlsdGVyOiBmaWx0ZXJzLlBJSUZpbHRlcik6IHZvaWQge1xuICAgIHRoaXMucGlpRmlsdGVycy5wdXNoKGZpbHRlcik7XG4gIH1cblxuICAvKipcbiAgICogQWRkcyBhIHJlZ2V4IGZpbHRlciB0byB0aGUgZ3VhcmRyYWlsLlxuICAgKiBAcGFyYW0gZmlsdGVyIFRoZSByZWdleCBmaWx0ZXIgdG8gYWRkLlxuICAgKi9cbiAgcHVibGljIGFkZFJlZ2V4RmlsdGVyKGZpbHRlcjogZmlsdGVycy5SZWdleEZpbHRlcik6IHZvaWQge1xuICAgIHRoaXMucmVnZXhGaWx0ZXJzLnB1c2goZmlsdGVyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGEgZGVuaWVkIHRvcGljIGZpbHRlciB0byB0aGUgZ3VhcmRyYWlsLlxuICAgKiBAcGFyYW0gZmlsdGVyIFRoZSBkZW5pZWQgdG9waWMgZmlsdGVyIHRvIGFkZC5cbiAgICovXG4gIHB1YmxpYyBhZGREZW5pZWRUb3BpY0ZpbHRlcihmaWx0ZXI6IGZpbHRlcnMuVG9waWMpOiB2b2lkIHtcbiAgICB0aGlzLmRlbmllZFRvcGljcy5wdXNoKGZpbHRlcik7XG4gIH1cblxuICAvKipcbiAgICogQWRkcyBhIGNvbnRleHR1YWwgZ3JvdW5kaW5nIGZpbHRlciB0byB0aGUgZ3VhcmRyYWlsLlxuICAgKiBAcGFyYW0gZmlsdGVyIFRoZSBjb250ZXh0dWFsIGdyb3VuZGluZyBmaWx0ZXIgdG8gYWRkLlxuICAgKi9cbiAgcHVibGljIGFkZENvbnRleHR1YWxHcm91bmRpbmdGaWx0ZXIoZmlsdGVyOiBmaWx0ZXJzLkNvbnRleHR1YWxHcm91bmRpbmdGaWx0ZXIpOiB2b2lkIHtcbiAgICB0aGlzLmNvbnRleHR1YWxHcm91bmRpbmdGaWx0ZXJzLnB1c2goZmlsdGVyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGEgd29yZCBmaWx0ZXIgdG8gdGhlIGd1YXJkcmFpbC5cbiAgICogQHBhcmFtIGZpbHRlciBUaGUgd29yZCBmaWx0ZXIgdG8gYWRkLlxuICAgKi9cbiAgcHVibGljIGFkZFdvcmRGaWx0ZXIoZmlsdGVyOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLndvcmRGaWx0ZXJzLnB1c2goZmlsdGVyKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGEgd29yZCBmaWx0ZXIgdG8gdGhlIGd1YXJkcmFpbC5cbiAgICogQHBhcmFtIGZpbGVQYXRoIFRoZSBsb2NhdGlvbiBvZiB0aGUgd29yZCBmaWx0ZXIgZmlsZS5cbiAgICovXG4gIHB1YmxpYyBhZGRXb3JkRmlsdGVyRnJvbUZpbGUoZmlsZVBhdGg6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGZpbGVDb250ZW50cyA9IGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0ZjgnKTtcbiAgICBjb25zdCB3b3JkcyA9IGZpbGVDb250ZW50cy50cmltKCkuc3BsaXQoJywnKTtcbiAgICBmb3IgKGNvbnN0IHdvcmQgb2Ygd29yZHMpIHRoaXMuYWRkV29yZEZpbHRlcih3b3JkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGRzIGEgbWFuYWdlZCB3b3JkIGxpc3QgZmlsdGVyIHRvIHRoZSBndWFyZHJhaWwuXG4gICAqIEBwYXJhbSBmaWx0ZXIgVGhlIG1hbmFnZWQgd29yZCBsaXN0IGZpbHRlciB0byBhZGQuXG4gICAqL1xuICBwdWJsaWMgYWRkTWFuYWdlZFdvcmRMaXN0RmlsdGVyKGZpbHRlcjogZmlsdGVycy5NYW5hZ2VkV29yZEZpbHRlclR5cGUpOiB2b2lkIHtcbiAgICB0aGlzLm1hbmFnZWRXb3JkTGlzdEZpbHRlcnMucHVzaChmaWx0ZXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIHZlcnNpb24gZm9yIHRoZSBndWFyZHJhaWwuXG4gICAqIEBwYXJhbSBkZXNjcmlwdGlvbiBUaGUgZGVzY3JpcHRpb24gb2YgdGhlIHZlcnNpb24uXG4gICAqIEByZXR1cm5zIFRoZSBndWFyZHJhaWwgdmVyc2lvbi5cbiAgICovXG4gIHB1YmxpYyBjcmVhdGVWZXJzaW9uKGRlc2NyaXB0aW9uPzogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBjZm5WZXJzaW9uID0gbmV3IGJlZHJvY2suQ2ZuR3VhcmRyYWlsVmVyc2lvbih0aGlzLCBgR3VhcmRyYWlsVmVyc2lvbi0ke3RoaXMuaGFzaC5zbGljZSgwLCAxNil9YCwge1xuICAgICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uLFxuICAgICAgZ3VhcmRyYWlsSWRlbnRpZmllcjogdGhpcy5ndWFyZHJhaWxJZCxcbiAgICB9KTtcblxuICAgIHRoaXMuZ3VhcmRyYWlsVmVyc2lvbiA9IGNmblZlcnNpb24uYXR0clZlcnNpb247XG4gICAgcmV0dXJuIHRoaXMuZ3VhcmRyYWlsVmVyc2lvbjtcbiAgfVxuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBDRk4gR2VuZXJhdG9yc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGNvbnRlbnQgZmlsdGVycyBhcHBsaWVkIHRvIHRoZSBndWFyZHJhaWwuIFRoaXMgbWV0aG9kIGRlZmVycyB0aGUgY29tcHV0YXRpb25cbiAgICogdG8gc3ludGggdGltZS5cbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVDZm5Db250ZW50UG9saWN5Q29uZmlnKCk6IElSZXNvbHZhYmxlIHtcbiAgICByZXR1cm4gTGF6eS5hbnkoe1xuICAgICAgcHJvZHVjZTogKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5jb250ZW50RmlsdGVycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgcmV0dXJuIHsgZmlsdGVyc0NvbmZpZzogdGhpcy5jb250ZW50RmlsdGVycyB9IGFzIGJlZHJvY2suQ2ZuR3VhcmRyYWlsLkNvbnRlbnRQb2xpY3lDb25maWdQcm9wZXJ0eTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHRvcGljIGZpbHRlcnMgYXBwbGllZCB0byB0aGUgZ3VhcmRyYWlsLiBUaGlzIG1ldGhvZCBkZWZlcnMgdGhlIGNvbXB1dGF0aW9uXG4gICAqIHRvIHN5bnRoIHRpbWUuXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlQ2ZuVG9waWNQb2xpY3koKTogSVJlc29sdmFibGUge1xuICAgIHJldHVybiBMYXp5LmFueSh7XG4gICAgICBwcm9kdWNlOiAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLmRlbmllZFRvcGljcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRvcGljc0NvbmZpZzogdGhpcy5kZW5pZWRUb3BpY3MuZmxhdE1hcCgodG9waWM6IGZpbHRlcnMuVG9waWMpID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBkZWZpbml0aW9uOiB0b3BpYy5kZWZpbml0aW9uLFxuICAgICAgICAgICAgICAgIG5hbWU6IHRvcGljLm5hbWUsXG4gICAgICAgICAgICAgICAgZXhhbXBsZXM6IHRvcGljLmV4YW1wbGVzLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdERU5ZJyxcbiAgICAgICAgICAgICAgfSBhcyBiZWRyb2NrLkNmbkd1YXJkcmFpbC5Ub3BpY0NvbmZpZ1Byb3BlcnR5O1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGNvbnRlY3R1YWwgZmlsdGVycyBhcHBsaWVkIHRvIHRoZSBndWFyZHJhaWwuIFRoaXMgbWV0aG9kIGRlZmVycyB0aGUgY29tcHV0YXRpb25cbiAgICogdG8gc3ludGggdGltZS5cbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVDZm5Db250ZXh0dWFsUG9saWN5Q29uZmlnKCk6IElSZXNvbHZhYmxlIHtcbiAgICByZXR1cm4gTGF6eS5hbnkoe1xuICAgICAgcHJvZHVjZTogKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5jb250ZXh0dWFsR3JvdW5kaW5nRmlsdGVycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGZpbHRlcnNDb25maWc6IHRoaXMuY29udGV4dHVhbEdyb3VuZGluZ0ZpbHRlcnMuZmxhdE1hcCgoZmlsdGVyOiBmaWx0ZXJzLkNvbnRleHR1YWxHcm91bmRpbmdGaWx0ZXIpID0+IHtcbiAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBmaWx0ZXIudHlwZSxcbiAgICAgICAgICAgICAgICB0aHJlc2hvbGQ6IGZpbHRlci50aHJlc2hvbGQsXG4gICAgICAgICAgICAgIH0gYXMgYmVkcm9jay5DZm5HdWFyZHJhaWwuQ29udGV4dHVhbEdyb3VuZGluZ0ZpbHRlckNvbmZpZ1Byb3BlcnR5O1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHdvcmQgY29uZmlnIGFwcGxpZWQgdG8gdGhlIGd1YXJkcmFpbC4gVGhpcyBtZXRob2QgZGVmZXJzIHRoZSBjb21wdXRhdGlvblxuICAgKiB0byBzeW50aCB0aW1lLlxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZUNmbldvcmRQb2xpY3lDb25maWcoKTogSVJlc29sdmFibGUge1xuICAgIHJldHVybiBMYXp5LmFueSh7XG4gICAgICBwcm9kdWNlOiAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLndvcmRGaWx0ZXJzLmxlbmd0aCA+IDAgfHwgdGhpcy5tYW5hZ2VkV29yZExpc3RGaWx0ZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgd29yZHNDb25maWc6IHRoaXMuZ2VuZXJhdGVDZm5Xb3JkQ29uZmlnKCksXG4gICAgICAgICAgICBtYW5hZ2VkV29yZExpc3RzQ29uZmlnOiB0aGlzLmdlbmVyYXRlQ2ZuTWFuYWdlZFdvcmRMaXN0c0NvbmZpZygpLFxuICAgICAgICAgIH0gYXMgYmVkcm9jay5DZm5HdWFyZHJhaWwuV29yZFBvbGljeUNvbmZpZ1Byb3BlcnR5O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgd29yZCBmaWx0ZXJzIGFwcGxpZWQgdG8gdGhlIGd1YXJkcmFpbC4gVGhpcyBtZXRob2QgZGVmZXJzIHRoZSBjb21wdXRhdGlvblxuICAgKiB0byBzeW50aCB0aW1lLlxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZUNmbldvcmRDb25maWcoKTogSVJlc29sdmFibGUge1xuICAgIHJldHVybiBMYXp5LmFueShcbiAgICAgIHtcbiAgICAgICAgcHJvZHVjZTogKCkgPT4ge1xuICAgICAgICAgIHJldHVybiB0aGlzLndvcmRGaWx0ZXJzLmZsYXRNYXAoKHdvcmQ6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgdGV4dDogd29yZCxcbiAgICAgICAgICAgIH0gYXMgYmVkcm9jay5DZm5HdWFyZHJhaWwuV29yZENvbmZpZ1Byb3BlcnR5O1xuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHsgb21pdEVtcHR5QXJyYXk6IHRydWUgfSxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHdvcmQgZmlsdGVycyBhcHBsaWVkIHRvIHRoZSBndWFyZHJhaWwuIFRoaXMgbWV0aG9kIGRlZmVycyB0aGUgY29tcHV0YXRpb25cbiAgICogdG8gc3ludGggdGltZS5cbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVDZm5NYW5hZ2VkV29yZExpc3RzQ29uZmlnKCk6IElSZXNvbHZhYmxlIHtcbiAgICByZXR1cm4gTGF6eS5hbnkoXG4gICAgICB7XG4gICAgICAgIHByb2R1Y2U6ICgpID0+IHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5tYW5hZ2VkV29yZExpc3RGaWx0ZXJzLmZsYXRNYXAoKGZpbHRlcjogZmlsdGVycy5NYW5hZ2VkV29yZEZpbHRlclR5cGUpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIHR5cGU6IGZpbHRlci50b1N0cmluZygpLFxuICAgICAgICAgICAgfSBhcyBiZWRyb2NrLkNmbkd1YXJkcmFpbC5NYW5hZ2VkV29yZHNDb25maWdQcm9wZXJ0eTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB7IG9taXRFbXB0eUFycmF5OiB0cnVlIH0sXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBzZW5zaXRpdmUgaW5mb3JtYXRpb24gY29uZmlnIGFwcGxpZWQgdG8gdGhlIGd1YXJkcmFpbC4gVGhpcyBtZXRob2QgZGVmZXJzIHRoZSBjb21wdXRhdGlvblxuICAgKiB0byBzeW50aCB0aW1lLlxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZUNmblNlbnNpdGl2ZUluZm9ybWF0aW9uUG9saWN5Q29uZmlnKCk6IElSZXNvbHZhYmxlIHtcbiAgICByZXR1cm4gTGF6eS5hbnkoXG4gICAgICB7XG4gICAgICAgIHByb2R1Y2U6ICgpID0+IHtcbiAgICAgICAgICBpZiAodGhpcy5yZWdleEZpbHRlcnMubGVuZ3RoID4gMCB8fCB0aGlzLnBpaUZpbHRlcnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgcmVnZXhlc0NvbmZpZzogdGhpcy5nZW5lcmF0ZUNmblJlZ2V4ZXNDb25maWcoKSxcbiAgICAgICAgICAgICAgcGlpRW50aXRpZXNDb25maWc6IHRoaXMuZ2VuZXJhdGVDZm5QaWlFbnRpdGllc0NvbmZpZygpLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgeyBvbWl0RW1wdHlBcnJheTogdHJ1ZSB9LFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgcmVnZXggZmlsdGVycyBhcHBsaWVkIHRvIHRoZSBndWFyZHJhaWwuIFRoaXMgbWV0aG9kIGRlZmVycyB0aGUgY29tcHV0YXRpb25cbiAgICogdG8gc3ludGggdGltZS5cbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVDZm5SZWdleGVzQ29uZmlnKCk6IElSZXNvbHZhYmxlIHtcbiAgICByZXR1cm4gTGF6eS5hbnkoXG4gICAgICB7XG4gICAgICAgIHByb2R1Y2U6ICgpID0+IHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5yZWdleEZpbHRlcnMuZmxhdE1hcCgocmVnZXg6IGZpbHRlcnMuUmVnZXhGaWx0ZXIpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIG5hbWU6IHJlZ2V4Lm5hbWUsXG4gICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiByZWdleC5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgICAgcGF0dGVybjogcmVnZXgucGF0dGVybixcbiAgICAgICAgICAgICAgYWN0aW9uOiByZWdleC5hY3Rpb24sXG4gICAgICAgICAgICB9IGFzIGJlZHJvY2suQ2ZuR3VhcmRyYWlsLlJlZ2V4Q29uZmlnUHJvcGVydHk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgeyBvbWl0RW1wdHlBcnJheTogdHJ1ZSB9LFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUgUGlpIGZpbHRlcnMgYXBwbGllZCB0byB0aGUgZ3VhcmRyYWlsLiBUaGlzIG1ldGhvZCBkZWZlcnMgdGhlIGNvbXB1dGF0aW9uXG4gICAqIHRvIHN5bnRoIHRpbWUuXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlQ2ZuUGlpRW50aXRpZXNDb25maWcoKTogSVJlc29sdmFibGUge1xuICAgIHJldHVybiBMYXp5LmFueShcbiAgICAgIHtcbiAgICAgICAgcHJvZHVjZTogKCkgPT4ge1xuICAgICAgICAgIHJldHVybiB0aGlzLnBpaUZpbHRlcnMuZmxhdE1hcCgoZmlsdGVyOiBmaWx0ZXJzLlBJSUZpbHRlcikgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgdHlwZTogZmlsdGVyLnR5cGUsXG4gICAgICAgICAgICAgIGFjdGlvbjogZmlsdGVyLmFjdGlvbixcbiAgICAgICAgICAgIH0gYXMgYmVkcm9jay5DZm5HdWFyZHJhaWwuUGlpRW50aXR5Q29uZmlnUHJvcGVydHk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgeyBvbWl0RW1wdHlBcnJheTogdHJ1ZSB9LFxuICAgICk7XG4gIH1cbn1cbiJdfQ==