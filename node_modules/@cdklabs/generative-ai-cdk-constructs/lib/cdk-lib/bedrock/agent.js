"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.validatePromptOverrideConfiguration = exports.validateInferenceConfiguration = exports.Agent = exports.PromptState = exports.PromptCreationMode = exports.ParserMode = exports.PromptType = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const cdk = require("aws-cdk-lib");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const iam = require("aws-cdk-lib/aws-iam");
const constructs_1 = require("constructs");
const agent_action_group_1 = require("./agent-action-group");
const agent_alias_1 = require("./agent-alias");
const utils_1 = require("../../common/helpers/utils");
/**
 * The step in the agent sequence that this prompt configuration applies to.
 */
var PromptType;
(function (PromptType) {
    PromptType["PRE_PROCESSING"] = "PRE_PROCESSING";
    PromptType["ORCHESTRATION"] = "ORCHESTRATION";
    PromptType["POST_PROCESSING"] = "POST_PROCESSING";
    PromptType["KNOWLEDGE_BASE_RESPONSE_GENERATION"] = "KNOWLEDGE_BASE_RESPONSE_GENERATION";
})(PromptType || (exports.PromptType = PromptType = {}));
/**
 * Specifies whether to override the default parser Lambda function when
 * parsing the raw foundation model output in the part of the agent sequence
 * defined by the promptType. If you set the field as OVERRIDEN, the
 * overrideLambda field in the PromptOverrideConfiguration must be specified
 * with the ARN of a Lambda function.
 */
var ParserMode;
(function (ParserMode) {
    ParserMode["DEFAULT"] = "DEFAULT";
    ParserMode["OVERRIDDEN"] = "OVERRIDDEN";
})(ParserMode || (exports.ParserMode = ParserMode = {}));
/**
 * Specifies whether to override the default prompt template for this
 * promptType. Set this value to OVERRIDDEN to use the prompt that you
 * provide in the basePromptTemplate. If you leave it as DEFAULT, the agent
 * uses a default prompt template.
 */
var PromptCreationMode;
(function (PromptCreationMode) {
    PromptCreationMode["DEFAULT"] = "DEFAULT";
    PromptCreationMode["OVERRIDDEN"] = "OVERRIDDEN";
})(PromptCreationMode || (exports.PromptCreationMode = PromptCreationMode = {}));
/**
 * Specifies whether to allow the agent to carry out the step specified in the
 * promptType. If you set this value to DISABLED, the agent skips that step.
 * The default state for each promptType is as follows.
 *
 *     PRE_PROCESSING – ENABLED
 *     ORCHESTRATION – ENABLED
 *     KNOWLEDGE_BASE_RESPONSE_GENERATION – ENABLED
 *     POST_PROCESSING – DISABLED
 */
var PromptState;
(function (PromptState) {
    PromptState["ENABLED"] = "ENABLED";
    PromptState["DISABLED"] = "DISABLED";
})(PromptState || (exports.PromptState = PromptState = {}));
/**
 * Deploy a Bedrock Agent.
 */
class Agent extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        /**
         * A list of values to indicate if PrepareAgent or an Alias needs to be updated.
         * @private
         */
        this.resourceUpdates = [];
        /**
         * A list of action groups associated with the agent
         * @private
         */
        this.actionGroups = [];
        /**
         * A list of KnowledgeBases associated with the agent.
         *
         * @default - No knowledge base is used.
         */
        this.knowledgeBases = [];
        validatePromptOverrideConfiguration(props.promptOverrideConfiguration);
        this.foundationModel = props.foundationModel;
        this.name =
            props.name ?? (0, utils_1.generatePhysicalNameV2)(this, 'bedrock-agent', { maxLength: 32, lower: true, separator: '-' });
        if (props.existingRole) {
            this.role = props.existingRole;
        }
        else {
            this.role = new iam.Role(this, 'Role', {
                assumedBy: new iam.ServicePrincipal('bedrock.amazonaws.com'),
                roleName: (0, utils_1.generatePhysicalNameV2)(this, 'AmazonBedrockExecutionRoleForAgents_', { maxLength: 64, lower: false }),
            });
            this.role.assumeRolePolicy.addStatements(new iam.PolicyStatement({
                actions: ['sts:AssumeRole'],
                principals: [new iam.ServicePrincipal('bedrock.amazonaws.com')],
                conditions: {
                    StringEquals: {
                        'aws:SourceAccount': cdk.Stack.of(this).account,
                    },
                    ArnLike: {
                        'aws:SourceArn': cdk.Stack.of(this).formatArn({
                            service: 'bedrock',
                            resource: 'agent',
                            resourceName: '*',
                            arnFormat: cdk.ArnFormat.SLASH_RESOURCE_NAME,
                        }),
                    },
                },
            }));
        }
        this.foundationModel.grantInvoke(this.role);
        const agent = new aws_cdk_lib_1.aws_bedrock.CfnAgent(this, 'Agent', {
            agentName: this.name,
            foundationModel: props.foundationModel.invokableArn,
            instruction: props.instruction,
            description: props.description,
            idleSessionTtlInSeconds: props.idleSessionTTL?.toSeconds(),
            agentResourceRoleArn: this.role.roleArn,
            customerEncryptionKeyArn: props.encryptionKey?.keyArn,
            tags: props.tags,
            promptOverrideConfiguration: props.promptOverrideConfiguration,
            autoPrepare: props.shouldPrepareAgent,
        });
        this.agentInstance = agent;
        this.agentId = agent.attrAgentId;
        this.agentArn = agent.attrAgentArn;
        this.agentversion = agent.attrAgentVersion;
        if (props.guardrailConfiguration) {
            this.agentInstance.guardrailConfiguration = {
                guardrailIdentifier: props.guardrailConfiguration?.guardrailId,
                guardrailVersion: props.guardrailConfiguration?.guardrailVersion,
            };
        }
        this._addAliasDependency(agent.attrUpdatedAt);
        if (props.aliasName) {
            const alias = this.addAlias({
                aliasName: props.aliasName,
            });
            this.aliasId = alias.aliasId;
            this.aliasArn = alias.aliasArn;
            this.aliasName = alias.aliasName;
        }
        if (props.knowledgeBases) {
            this.addKnowledgeBases(props.knowledgeBases);
        }
        if (props.actionGroups) {
            this.addActionGroups(props.actionGroups);
        }
        // To allow your agent to request the user for additional information
        // when trying to complete a task, add this action group
        this.addActionGroup(new agent_action_group_1.AgentActionGroup(this, 'userInputEnabledActionGroup', {
            actionGroupName: 'UserInputAction',
            parentActionGroupSignature: 'AMAZON.UserInput',
            actionGroupState: props.enableUserInput ? 'ENABLED' : 'DISABLED',
        }));
    }
    /**
     * Add an alias to the agent.
     */
    addAlias(props) {
        const alias = new agent_alias_1.AgentAlias(this, `AgentAlias-${props.aliasName}`, {
            agentId: this.agentId,
            agentVersion: props.agentVersion,
            resourceUpdates: cdk.Lazy.list({ produce: () => this.resourceUpdates }),
            aliasName: props.aliasName,
            description: props.description,
        });
        return alias;
    }
    /**
     * Add knowledge bases to the agent.
     */
    addKnowledgeBases(knowledgeBases) {
        for (const kb of knowledgeBases) {
            this.addKnowledgeBase(kb);
        }
    }
    /**
     * Add knowledge base to the agent.
     */
    addKnowledgeBase(knowledgeBase) {
        if (!knowledgeBase.instruction) {
            throw new Error('Agent Knowledge Bases require instructions.');
        }
        new iam.Policy(this, `AgentKBPolicy-${knowledgeBase.name}`, {
            roles: [this.role],
            statements: [
                new iam.PolicyStatement({
                    actions: ['bedrock:UpdateKnowledgeBase', 'bedrock:Retrieve'],
                    resources: [knowledgeBase.knowledgeBaseArn],
                }),
            ],
        });
        const agentKnowledgeBaseProperty = {
            description: knowledgeBase.instruction, // known issue: wrong parameter mapping in Cfn. Workaround: pass instruction through description
            knowledgeBaseId: knowledgeBase.knowledgeBaseId,
            knowledgeBaseState: knowledgeBase.knowledgeBaseState,
        };
        if (!this.agentInstance.knowledgeBases || !Array.isArray(this.agentInstance.knowledgeBases)) {
            this.agentInstance.knowledgeBases = [agentKnowledgeBaseProperty];
        }
        else {
            this.agentInstance.knowledgeBases.push(agentKnowledgeBaseProperty);
        }
    }
    /**
     * Add action group to the agent.
     */
    addActionGroup(actionGroup) {
        actionGroup.actionGroupExecutor?.lambda?.addPermission('AgentLambdaInvocationPolicy', {
            principal: new iam.ServicePrincipal('bedrock.amazonaws.com'),
            sourceArn: this.agentArn,
            sourceAccount: cdk.Stack.of(this).account,
        });
        if (!this.agentInstance.actionGroups || !Array.isArray(this.agentInstance.actionGroups)) {
            this.agentInstance.actionGroups = [actionGroup.actionGroupProperty];
        }
        else {
            this.agentInstance.actionGroups.push(actionGroup.actionGroupProperty);
        }
    }
    /**
     * Add action groups to the agent.
     */
    addActionGroups(actionGroups) {
        for (const actionGroup of actionGroups) {
            this.addActionGroup(actionGroup);
        }
    }
    /**
     * Add guardrail to the agent.
     */
    addGuardrail(guardrail) {
        // Handle permissions
        guardrail.grantApply(this.role);
        guardrail.kmsKey?.grantDecrypt(this.role);
        // Handle CFN agent configuration
        this.agentInstance.guardrailConfiguration = {
            guardrailIdentifier: guardrail.guardrailId,
            guardrailVersion: guardrail.guardrailVersion,
        };
    }
    /**
     * Register a dependency for aliases.
     *
     * @param updatedAt - The updatedAt of the resource that will be registered as a dependency.
     *
     * @internal This is an internal core function and should not be called directly.
     */
    _addAliasDependency(updatedAt) {
        if (updatedAt) {
            this.resourceUpdates.push(updatedAt);
        }
    }
}
exports.Agent = Agent;
_a = JSII_RTTI_SYMBOL_1;
Agent[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.Agent", version: "0.1.285" };
/**
 * Validate the inferenceConfiguration of a prompt override.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateInferenceConfiguration(inferenceConfiguration) {
    if (inferenceConfiguration.topK < 0 || inferenceConfiguration.topK > 500) {
        throw new Error('topK must be between 0 and 500');
    }
    if (!Number.isInteger(inferenceConfiguration.topK)) {
        throw new Error('topK must be an integer');
    }
    if (inferenceConfiguration.stopSequences.length > 4) {
        throw new Error('stopSequences cannot contain more than 4 elements');
    }
    if (inferenceConfiguration.maximumLength < 0 || inferenceConfiguration.maximumLength > 4096) {
        throw new Error('maximumLength must be between 0 and 4096');
    }
    if (!Number.isInteger(inferenceConfiguration.maximumLength)) {
        throw new Error('maximumLength must be an integer');
    }
    if (inferenceConfiguration.topP < 0 || inferenceConfiguration.topP > 1) {
        throw new Error('topP must be between 0 and 1');
    }
    if (inferenceConfiguration.temperature < 0 || inferenceConfiguration.temperature > 1) {
        throw new Error('temperature must be between 0 and 1');
    }
}
exports.validateInferenceConfiguration = validateInferenceConfiguration;
/**
 * Validate the promptOverrideConfiguration.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validatePromptOverrideConfiguration(promptOverrideConfiguration) {
    if (!promptOverrideConfiguration) {
        return;
    }
    if (promptOverrideConfiguration.overrideLambda &&
        promptOverrideConfiguration.promptConfigurations.some((pc) => pc.parserMode !== ParserMode.OVERRIDDEN)) {
        throw new Error('overrideLambda can only be used if all promptConfigurations have a parserMode value of OVERRIDDEN');
    }
    if (!promptOverrideConfiguration.overrideLambda &&
        promptOverrideConfiguration.promptConfigurations.some((pc) => pc.parserMode === ParserMode.OVERRIDDEN)) {
        throw new Error('At least one promptConfiguration has a parserMode value of OVERRIDDEN, but no overrideLambda is specified');
    }
    // check inferenceConfiguration number types
    Object.values(promptOverrideConfiguration.promptConfigurations).forEach((pc) => {
        validateInferenceConfiguration(pc.inferenceConfiguration);
    });
    return;
}
exports.validatePromptOverrideConfiguration = validatePromptOverrideConfiguration;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWdlbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY2RrLWxpYi9iZWRyb2NrL2FnZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7QUFFSCxtQ0FBbUM7QUFDbkMsNkNBQXFEO0FBQ3JELDJDQUEyQztBQUUzQywyQ0FBdUM7QUFFdkMsNkRBQXdEO0FBQ3hELCtDQUEyQztBQUkzQyxzREFBb0U7QUFFcEU7O0dBRUc7QUFDSCxJQUFZLFVBS1g7QUFMRCxXQUFZLFVBQVU7SUFDcEIsK0NBQWlDLENBQUE7SUFDakMsNkNBQStCLENBQUE7SUFDL0IsaURBQW1DLENBQUE7SUFDbkMsdUZBQXlFLENBQUE7QUFDM0UsQ0FBQyxFQUxXLFVBQVUsMEJBQVYsVUFBVSxRQUtyQjtBQUVEOzs7Ozs7R0FNRztBQUNILElBQVksVUFHWDtBQUhELFdBQVksVUFBVTtJQUNwQixpQ0FBbUIsQ0FBQTtJQUNuQix1Q0FBeUIsQ0FBQTtBQUMzQixDQUFDLEVBSFcsVUFBVSwwQkFBVixVQUFVLFFBR3JCO0FBRUQ7Ozs7O0dBS0c7QUFDSCxJQUFZLGtCQUdYO0FBSEQsV0FBWSxrQkFBa0I7SUFDNUIseUNBQW1CLENBQUE7SUFDbkIsK0NBQXlCLENBQUE7QUFDM0IsQ0FBQyxFQUhXLGtCQUFrQixrQ0FBbEIsa0JBQWtCLFFBRzdCO0FBRUQ7Ozs7Ozs7OztHQVNHO0FBQ0gsSUFBWSxXQUdYO0FBSEQsV0FBWSxXQUFXO0lBQ3JCLGtDQUFtQixDQUFBO0lBQ25CLG9DQUFxQixDQUFBO0FBQ3ZCLENBQUMsRUFIVyxXQUFXLDJCQUFYLFdBQVcsUUFHdEI7QUFrUUQ7O0dBRUc7QUFDSCxNQUFhLEtBQU0sU0FBUSxzQkFBUztJQTJEbEMsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUFpQjtRQUN6RCxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBbkJuQjs7O1dBR0c7UUFDSyxvQkFBZSxH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O0FBRUQ7Ozs7R0FJRztBQUNILFNBQWdCLG1DQUFtQyxDQUNqRCwyQkFBb0U7SUFFcEUsSUFBSSxDQUFDLDJCQUEyQixFQUFFLENBQUM7UUFDakMsT0FBTztJQUNULENBQUM7SUFFRCxJQUNFLDJCQUEyQixDQUFDLGNBQWM7UUFDMUMsMkJBQTJCLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsVUFBVSxLQUFLLFVBQVUsQ0FBQyxVQUFVLENBQUMsRUFDdEcsQ0FBQztRQUNELE1BQU0sSUFBSSxLQUFLLENBQ2IsbUdBQW1HLENBQ3BHLENBQUM7SUFDSixDQUFDO0lBRUQsSUFDRSxDQUFDLDJCQUEyQixDQUFDLGNBQWM7UUFDM0MsMkJBQTJCLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsVUFBVSxLQUFLLFVBQVUsQ0FBQyxVQUFVLENBQUMsRUFDdEcsQ0FBQztRQUNELE1BQU0sSUFBSSxLQUFLLENBQ2IsMkdBQTJHLENBQzVHLENBQUM7SUFDSixDQUFDO0lBRUQsNENBQTRDO0lBQzVDLE1BQU0sQ0FBQyxNQUFNLENBQUMsMkJBQTJCLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRTtRQUM3RSw4QkFBOEIsQ0FBQyxFQUFFLENBQUMsc0JBQXNCLENBQUMsQ0FBQztJQUM1RCxDQUFDLENBQUMsQ0FBQztJQUVILE9BQU87QUFDVCxDQUFDO0FBL0JELGtGQStCQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogIENvcHlyaWdodCBBbWF6b24uY29tLCBJbmMuIG9yIGl0cyBhZmZpbGlhdGVzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpLiBZb3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiAgd2l0aCB0aGUgTGljZW5zZS4gQSBjb3B5IG9mIHRoZSBMaWNlbnNlIGlzIGxvY2F0ZWQgYXRcbiAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqICBvciBpbiB0aGUgJ2xpY2Vuc2UnIGZpbGUgYWNjb21wYW55aW5nIHRoaXMgZmlsZS4gVGhpcyBmaWxlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICdBUyBJUycgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFU1xuICogIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGV4cHJlc3Mgb3IgaW1wbGllZC4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zXG4gKiAgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCAqIGFzIGNkayBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgeyBhd3NfYmVkcm9jayBhcyBiZWRyb2NrIH0gZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gJ2F3cy1jZGstbGliL2F3cy1pYW0nO1xuaW1wb3J0ICogYXMga21zIGZyb20gJ2F3cy1jZGstbGliL2F3cy1rbXMnO1xuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XG5cbmltcG9ydCB7IEFnZW50QWN0aW9uR3JvdXAgfSBmcm9tICcuL2FnZW50LWFjdGlvbi1ncm91cCc7XG5pbXBvcnQgeyBBZ2VudEFsaWFzIH0gZnJvbSAnLi9hZ2VudC1hbGlhcyc7XG5pbXBvcnQgeyBJR3VhcmRyYWlsIH0gZnJvbSAnLi9ndWFyZHJhaWxzL2d1YXJkcmFpbHMnO1xuaW1wb3J0IHsgS25vd2xlZGdlQmFzZSB9IGZyb20gJy4va25vd2xlZGdlLWJhc2UnO1xuaW1wb3J0IHsgSUludm9rYWJsZSB9IGZyb20gJy4vbW9kZWxzJztcbmltcG9ydCB7IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIgfSBmcm9tICcuLi8uLi9jb21tb24vaGVscGVycy91dGlscyc7XG5cbi8qKlxuICogVGhlIHN0ZXAgaW4gdGhlIGFnZW50IHNlcXVlbmNlIHRoYXQgdGhpcyBwcm9tcHQgY29uZmlndXJhdGlvbiBhcHBsaWVzIHRvLlxuICovXG5leHBvcnQgZW51bSBQcm9tcHRUeXBlIHtcbiAgUFJFX1BST0NFU1NJTkcgPSAnUFJFX1BST0NFU1NJTkcnLFxuICBPUkNIRVNUUkFUSU9OID0gJ09SQ0hFU1RSQVRJT04nLFxuICBQT1NUX1BST0NFU1NJTkcgPSAnUE9TVF9QUk9DRVNTSU5HJyxcbiAgS05PV0xFREdFX0JBU0VfUkVTUE9OU0VfR0VORVJBVElPTiA9ICdLTk9XTEVER0VfQkFTRV9SRVNQT05TRV9HRU5FUkFUSU9OJyxcbn1cblxuLyoqXG4gKiBTcGVjaWZpZXMgd2hldGhlciB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBwYXJzZXIgTGFtYmRhIGZ1bmN0aW9uIHdoZW5cbiAqIHBhcnNpbmcgdGhlIHJhdyBmb3VuZGF0aW9uIG1vZGVsIG91dHB1dCBpbiB0aGUgcGFydCBvZiB0aGUgYWdlbnQgc2VxdWVuY2VcbiAqIGRlZmluZWQgYnkgdGhlIHByb21wdFR5cGUuIElmIHlvdSBzZXQgdGhlIGZpZWxkIGFzIE9WRVJSSURFTiwgdGhlXG4gKiBvdmVycmlkZUxhbWJkYSBmaWVsZCBpbiB0aGUgUHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uIG11c3QgYmUgc3BlY2lmaWVkXG4gKiB3aXRoIHRoZSBBUk4gb2YgYSBMYW1iZGEgZnVuY3Rpb24uXG4gKi9cbmV4cG9ydCBlbnVtIFBhcnNlck1vZGUge1xuICBERUZBVUxUID0gJ0RFRkFVTFQnLFxuICBPVkVSUklEREVOID0gJ09WRVJSSURERU4nLFxufVxuXG4vKipcbiAqIFNwZWNpZmllcyB3aGV0aGVyIHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IHByb21wdCB0ZW1wbGF0ZSBmb3IgdGhpc1xuICogcHJvbXB0VHlwZS4gU2V0IHRoaXMgdmFsdWUgdG8gT1ZFUlJJRERFTiB0byB1c2UgdGhlIHByb21wdCB0aGF0IHlvdVxuICogcHJvdmlkZSBpbiB0aGUgYmFzZVByb21wdFRlbXBsYXRlLiBJZiB5b3UgbGVhdmUgaXQgYXMgREVGQVVMVCwgdGhlIGFnZW50XG4gKiB1c2VzIGEgZGVmYXVsdCBwcm9tcHQgdGVtcGxhdGUuXG4gKi9cbmV4cG9ydCBlbnVtIFByb21wdENyZWF0aW9uTW9kZSB7XG4gIERFRkFVTFQgPSAnREVGQVVMVCcsXG4gIE9WRVJSSURERU4gPSAnT1ZFUlJJRERFTicsXG59XG5cbi8qKlxuICogU3BlY2lmaWVzIHdoZXRoZXIgdG8gYWxsb3cgdGhlIGFnZW50IHRvIGNhcnJ5IG91dCB0aGUgc3RlcCBzcGVjaWZpZWQgaW4gdGhlXG4gKiBwcm9tcHRUeXBlLiBJZiB5b3Ugc2V0IHRoaXMgdmFsdWUgdG8gRElTQUJMRUQsIHRoZSBhZ2VudCBza2lwcyB0aGF0IHN0ZXAuXG4gKiBUaGUgZGVmYXVsdCBzdGF0ZSBmb3IgZWFjaCBwcm9tcHRUeXBlIGlzIGFzIGZvbGxvd3MuXG4gKlxuICogICAgIFBSRV9QUk9DRVNTSU5HIOKAkyBFTkFCTEVEXG4gKiAgICAgT1JDSEVTVFJBVElPTiDigJMgRU5BQkxFRFxuICogICAgIEtOT1dMRURHRV9CQVNFX1JFU1BPTlNFX0dFTkVSQVRJT04g4oCTIEVOQUJMRURcbiAqICAgICBQT1NUX1BST0NFU1NJTkcg4oCTIERJU0FCTEVEXG4gKi9cbmV4cG9ydCBlbnVtIFByb21wdFN0YXRlIHtcbiAgRU5BQkxFRCA9ICdFTkFCTEVEJyxcbiAgRElTQUJMRUQgPSAnRElTQUJMRUQnLFxufVxuXG4vKiogRGV0YWlscyBhYm91dCB0aGUgZ3VhcmRyYWlsIGFzc29jaWF0ZWQgd2l0aCB0aGUgYWdlbnQuICovXG5leHBvcnQgaW50ZXJmYWNlIEd1YXJkcmFpbENvbmZpZ3VyYXRpb24ge1xuICAvKlRoZSB2ZXJzaW9uIG9mIHRoZSBndWFyZHJhaWwuKi9cbiAgcmVhZG9ubHkgZ3VhcmRyYWlsVmVyc2lvbj86IHN0cmluZztcbiAgLypUaGUgaWRlbnRpZmllZCBvZiB0aGUgZ3VhcmRyYWlsLiovXG4gIHJlYWRvbmx5IGd1YXJkcmFpbElkPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIExMTSBpbmZlcmVuY2UgY29uZmlndXJhdGlvblxuICovXG5leHBvcnQgaW50ZXJmYWNlIEluZmVyZW5jZUNvbmZpZ3VyYXRpb24ge1xuICAvKipcbiAgICogVGhlIGxpa2VsaWhvb2Qgb2YgdGhlIG1vZGVsIHNlbGVjdGluZyBoaWdoZXItcHJvYmFiaWxpdHkgb3B0aW9ucyB3aGlsZVxuICAgKiBnZW5lcmF0aW5nIGEgcmVzcG9uc2UuIEEgbG93ZXIgdmFsdWUgbWFrZXMgdGhlIG1vZGVsIG1vcmUgbGlrZWx5IHRvIGNob29zZVxuICAgKiBoaWdoZXItcHJvYmFiaWxpdHkgb3B0aW9ucywgd2hpbGUgYSBoaWdoZXIgdmFsdWUgbWFrZXMgdGhlIG1vZGVsIG1vcmVcbiAgICogbGlrZWx5IHRvIGNob29zZSBsb3dlci1wcm9iYWJpbGl0eSBvcHRpb25zLlxuICAgKlxuICAgKiBGbG9hdGluZyBwb2ludFxuICAgKlxuICAgKiBtaW4gMFxuICAgKiBtYXggMVxuICAgKi9cbiAgcmVhZG9ubHkgdGVtcGVyYXR1cmU6IG51bWJlcjtcbiAgLyoqXG4gICAqIFdoaWxlIGdlbmVyYXRpbmcgYSByZXNwb25zZSwgdGhlIG1vZGVsIGRldGVybWluZXMgdGhlIHByb2JhYmlsaXR5IG9mIHRoZVxuICAgKiBmb2xsb3dpbmcgdG9rZW4gYXQgZWFjaCBwb2ludCBvZiBnZW5lcmF0aW9uLiBUaGUgdmFsdWUgdGhhdCB5b3Ugc2V0IGZvclxuICAgKiBUb3AgUCBkZXRlcm1pbmVzIHRoZSBudW1iZXIgb2YgbW9zdC1saWtlbHkgY2FuZGlkYXRlcyBmcm9tIHdoaWNoIHRoZSBtb2RlbFxuICAgKiBjaG9vc2VzIHRoZSBuZXh0IHRva2VuIGluIHRoZSBzZXF1ZW5jZS4gRm9yIGV4YW1wbGUsIGlmIHlvdSBzZXQgdG9wUCB0b1xuICAgKiA4MCwgdGhlIG1vZGVsIG9ubHkgc2VsZWN0cyB0aGUgbmV4dCB0b2tlbiBmcm9tIHRoZSB0b3AgODAlIG9mIHRoZVxuICAgKiBwcm9iYWJpbGl0eSBkaXN0cmlidXRpb24gb2YgbmV4dCB0b2tlbnMuXG4gICAqXG4gICAqIEZsb2F0aW5nIHBvaW50XG4gICAqXG4gICAqIG1pbiAwXG4gICAqIG1heCAxXG4gICAqL1xuICByZWFkb25seSB0b3BQOiBudW1iZXI7XG4gIC8qKlxuICAgKiBXaGlsZSBnZW5lcmF0aW5nIGEgcmVzcG9uc2UsIHRoZSBtb2RlbCBkZXRlcm1pbmVzIHRoZSBwcm9iYWJpbGl0eSBvZiB0aGVcbiAgICogZm9sbG93aW5nIHRva2VuIGF0IGVhY2ggcG9pbnQgb2YgZ2VuZXJhdGlvbi4gVGhlIHZhbHVlIHRoYXQgeW91IHNldCBmb3JcbiAgICogdG9wSyBpcyB0aGUgbnVtYmVyIG9mIG1vc3QtbGlrZWx5IGNhbmRpZGF0ZXMgZnJvbSB3aGljaCB0aGUgbW9kZWwgY2hvb3Nlc1xuICAgKiB0aGUgbmV4dCB0b2tlbiBpbiB0aGUgc2VxdWVuY2UuIEZvciBleGFtcGxlLCBpZiB5b3Ugc2V0IHRvcEsgdG8gNTAsIHRoZVxuICAgKiBtb2RlbCBzZWxlY3RzIHRoZSBuZXh0IHRva2VuIGZyb20gYW1vbmcgdGhlIHRvcCA1MCBtb3N0IGxpa2VseSBjaG9pY2VzLlxuICAgKlxuICAgKiBJbnRlZ2VyXG4gICAqXG4gICAqIG1pbiAwXG4gICAqIG1heCA1MDBcbiAgICovXG4gIHJlYWRvbmx5IHRvcEs6IG51bWJlcjtcbiAgLyoqXG4gICAqIEEgbGlzdCBvZiBzdG9wIHNlcXVlbmNlcy4gQSBzdG9wIHNlcXVlbmNlIGlzIGEgc2VxdWVuY2Ugb2YgY2hhcmFjdGVycyB0aGF0XG4gICAqIGNhdXNlcyB0aGUgbW9kZWwgdG8gc3RvcCBnZW5lcmF0aW5nIHRoZSByZXNwb25zZS5cbiAgICpcbiAgICogbGVuZ3RoIDAtNFxuICAgKi9cbiAgcmVhZG9ubHkgc3RvcFNlcXVlbmNlczogc3RyaW5nW107XG4gIC8qKlxuICAgKiBUaGUgbWF4aW11bSBudW1iZXIgb2YgdG9rZW5zIHRvIGdlbmVyYXRlIGluIHRoZSByZXNwb25zZS5cbiAgICpcbiAgICogSW50ZWdlclxuICAgKlxuICAgKiBtaW4gMFxuICAgKiBtYXggNDA5NlxuICAgKi9cbiAgcmVhZG9ubHkgbWF4aW11bUxlbmd0aDogbnVtYmVyO1xufVxuXG4vKipcbiAqIENvbnRhaW5zIGNvbmZpZ3VyYXRpb25zIHRvIG92ZXJyaWRlIGEgcHJvbXB0IHRlbXBsYXRlIGluIG9uZSBwYXJ0IG9mIGFuIGFnZW50IHNlcXVlbmNlLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFByb21wdENvbmZpZ3VyYXRpb24ge1xuICAvKipcbiAgICogVGhlIHN0ZXAgaW4gdGhlIGFnZW50IHNlcXVlbmNlIHRoYXQgdGhpcyBwcm9tcHQgY29uZmlndXJhdGlvbiBhcHBsaWVzIHRvLlxuICAgKi9cbiAgcmVhZG9ubHkgcHJvbXB0VHlwZTogUHJvbXB0VHlwZTtcbiAgLyoqXG4gICAqIENvbnRhaW5zIGluZmVyZW5jZSBwYXJhbWV0ZXJzIHRvIHVzZSB3aGVuIHRoZSBhZ2VudCBpbnZva2VzIGEgZm91bmRhdGlvblxuICAgKiBtb2RlbCBpbiB0aGUgcGFydCBvZiB0aGUgYWdlbnQgc2VxdWVuY2UgZGVmaW5lZCBieSB0aGUgcHJvbXB0VHlwZS5cbiAgICovXG4gIHJlYWRvbmx5IGluZmVyZW5jZUNvbmZpZ3VyYXRpb246IEluZmVyZW5jZUNvbmZpZ3VyYXRpb247XG4gIC8qKlxuICAgKiBEZWZpbmVzIHRoZSBwcm9tcHQgdGVtcGxhdGUgd2l0aCB3aGljaCB0byByZXBsYWNlIHRoZSBkZWZhdWx0IHByb21wdCB0ZW1wbGF0ZS5cbiAgICpcbiAgICogbGVuZ3RoIDAtMTAwMDAwXG4gICAqL1xuICByZWFkb25seSBiYXNlUHJvbXB0VGVtcGxhdGU6IHN0cmluZztcbiAgLyoqXG4gICAqIFNwZWNpZmllcyB3aGV0aGVyIHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IHBhcnNlciBMYW1iZGEgZnVuY3Rpb24gd2hlblxuICAgKiBwYXJzaW5nIHRoZSByYXcgZm91bmRhdGlvbiBtb2RlbCBvdXRwdXQgaW4gdGhlIHBhcnQgb2YgdGhlIGFnZW50IHNlcXVlbmNlXG4gICAqIGRlZmluZWQgYnkgdGhlIHByb21wdFR5cGUuIElmIHlvdSBzZXQgdGhlIGZpZWxkIGFzIE9WRVJSSURFTiwgdGhlXG4gICAqIG92ZXJyaWRlTGFtYmRhIGZpZWxkIGluIHRoZSBQcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb24gbXVzdCBiZSBzcGVjaWZpZWRcbiAgICogd2l0aCB0aGUgQVJOIG9mIGEgTGFtYmRhIGZ1bmN0aW9uLlxuICAgKi9cbiAgcmVhZG9ubHkgcGFyc2VyTW9kZT86IFBhcnNlck1vZGU7XG4gIC8qKlxuICAgKiBTcGVjaWZpZXMgd2hldGhlciB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBwcm9tcHQgdGVtcGxhdGUgZm9yIHRoaXNcbiAgICogcHJvbXB0VHlwZS4gU2V0IHRoaXMgdmFsdWUgdG8gT1ZFUlJJRERFTiB0byB1c2UgdGhlIHByb21wdCB0aGF0IHlvdVxuICAgKiBwcm92aWRlIGluIHRoZSBiYXNlUHJvbXB0VGVtcGxhdGUuIElmIHlvdSBsZWF2ZSBpdCBhcyBERUZBVUxULCB0aGUgYWdlbnRcbiAgICogdXNlcyBhIGRlZmF1bHQgcHJvbXB0IHRlbXBsYXRlLlxuICAgKi9cbiAgcmVhZG9ubHkgcHJvbXB0Q3JlYXRpb25Nb2RlOiBQcm9tcHRDcmVhdGlvbk1vZGU7XG4gIC8qKlxuICAgKiBTcGVjaWZpZXMgd2hldGhlciB0byBhbGxvdyB0aGUgYWdlbnQgdG8gY2Fycnkgb3V0IHRoZSBzdGVwIHNwZWNpZmllZCBpblxuICAgKiB0aGUgcHJvbXB0VHlwZS4gSWYgeW91IHNldCB0aGlzIHZhbHVlIHRvIERJU0FCTEVELCB0aGUgYWdlbnQgc2tpcHMgdGhhdFxuICAgKiBzdGVwLiBUaGUgZGVmYXVsdCBzdGF0ZSBmb3IgZWFjaCBwcm9tcHRUeXBlIGlzIGFzIGZvbGxvd3MuXG4gICAqXG4gICAqICAgICBQUkVfUFJPQ0VTU0lORyDigJMgRU5BQkxFRFxuICAgKiAgICAgT1JDSEVTVFJBVElPTiDigJMgRU5BQkxFRFxuICAgKiAgICAgS05PV0xFREdFX0JBU0VfUkVTUE9OU0VfR0VORVJBVElPTiDigJMgRU5BQkxFRFxuICAgKiAgICAgUE9TVF9QUk9DRVNTSU5HIOKAkyBESVNBQkxFRFxuICAgKi9cbiAgcmVhZG9ubHkgcHJvbXB0U3RhdGU6IFByb21wdFN0YXRlO1xufVxuXG4vKipcbiAqIENvbnRhaW5zIGNvbmZpZ3VyYXRpb25zIHRvIG92ZXJyaWRlIHByb21wdHMgaW4gZGlmZmVyZW50IHBhcnRzIG9mIGFuIGFnZW50IHNlcXVlbmNlLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbiB7XG4gIC8qKlxuICAgKiBDb250YWlucyBjb25maWd1cmF0aW9ucyB0byBvdmVycmlkZSBhIHByb21wdCB0ZW1wbGF0ZSBpbiBvbmUgcGFydCBvZiBhbiBhZ2VudCBzZXF1ZW5jZS5cbiAgICovXG4gIHJlYWRvbmx5IHByb21wdENvbmZpZ3VyYXRpb25zOiBQcm9tcHRDb25maWd1cmF0aW9uW107XG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBMYW1iZGEgZnVuY3Rpb24gdG8gdXNlIHdoZW4gcGFyc2luZyB0aGUgcmF3IGZvdW5kYXRpb25cbiAgICogbW9kZWwgb3V0cHV0IGluIHBhcnRzIG9mIHRoZSBhZ2VudCBzZXF1ZW5jZS4gSWYgeW91IHNwZWNpZnkgdGhpcyBmaWVsZCxcbiAgICogYXQgbGVhc3Qgb25lIG9mIHRoZSBwcm9tcHRDb25maWd1cmF0aW9ucyBtdXN0IGNvbnRhaW4gYSBwYXJzZXJNb2RlIHZhbHVlXG4gICAqIHRoYXQgaXMgc2V0IHRvIE9WRVJSSURERU4uXG4gICAqL1xuICByZWFkb25seSBvdmVycmlkZUxhbWJkYT86IHN0cmluZztcbn1cblxuLyoqXG4gKiBQcm9wZXJ0aWVzIGZvciBhIEJlZHJvY2sgQWdlbnQuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQWdlbnRQcm9wcyB7XG4gIC8qKlxuICAgKiBUaGUgQmVkcm9jayB0ZXh0IGZvdW5kYXRpb24gbW9kZWwgZm9yIHRoZSBhZ2VudCB0byB1c2UuXG4gICAqL1xuICByZWFkb25seSBmb3VuZGF0aW9uTW9kZWw6IElJbnZva2FibGU7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgYWdlbnQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gQSBuYW1lIGlzIGF1dG9tYXRpY2FsbHkgZ2VuZXJhdGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgbmFtZT86IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIGV4aXN0aW5nIElBTSBSb2xlIGZvciB0aGUgYWdlbnQgd2l0aCBhIHRydXN0IHBvbGljeSB0aGF0XG4gICAqIGFsbG93cyB0aGUgQmVkcm9jayBzZXJ2aWNlIHRvIGFzc3VtZSB0aGUgcm9sZS5cbiAgICovXG4gIHJlYWRvbmx5IGV4aXN0aW5nUm9sZT86IGlhbS5Sb2xlO1xuXG4gIC8qKlxuICAgKiBBIG5hcnJhdGl2ZSBpbnN0cnVjdGlvbiB0byBwcm92aWRlIHRoZSBhZ2VudCBhcyBjb250ZXh0LlxuICAgKi9cbiAgcmVhZG9ubHkgaW5zdHJ1Y3Rpb246IHN0cmluZztcbiAgLyoqXG4gICAqIEEgZGVzY3JpcHRpb24gb2YgdGhlIGFnZW50LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIE5vIGRlc2NyaXB0aW9uIGlzIHByb3ZpZGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBLbm93bGVkZ2UgQmFzZXMgdG8gbWFrZSBhdmFpbGFibGUgdG8gdGhlIGFnZW50LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIE5vIGtub3dsZWRnZSBiYXNlIGlzIHVzZWQuXG4gICAqL1xuICByZWFkb25seSBrbm93bGVkZ2VCYXNlcz86IEtub3dsZWRnZUJhc2VbXTtcbiAgLyoqXG4gICAqIEFnZW50QWN0aW9uR3JvdXAgdG8gbWFrZSBhdmFpbGFibGUgdG8gdGhlIGFnZW50LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIE5vIEFnZW50QWN0aW9uR3JvdXAgIGlzIHVzZWQuXG4gICAqL1xuICByZWFkb25seSBhY3Rpb25Hcm91cHM/OiBBZ2VudEFjdGlvbkdyb3VwW107XG5cbiAgLyoqIEd1YXJkcmFpbCBjb25maWd1cmF0aW9uXG4gICAqXG4gICAqIFdhcm5pbmc6IElmIHlvdSBwcm92aWRlIGEgZ3VhcmRyYWlsIGNvbmZpZ3VyYXRpb24gdGhyb3VnaCB0aGUgY29uc3RydWN0b3IsXG4gICAqIHlvdSB3aWxsIG5lZWQgdG8gcHJvdmlkZSB0aGUgY29ycmVjdCBwZXJtaXNzaW9ucyBmb3IgeW91ciBhZ2VudCB0byBhY2Nlc3NcbiAgICogdGhlIGd1YXJkcmFpbHMuIElmIHlvdSB3YW50IHRoZSBwZXJtaXNzaW9ucyB0byBiZSBjb25maWd1cmVkIG9uIHlvdXIgYmVoYWxmLFxuICAgKiB1c2UgdGhlIGFkZEd1YXJkcmFpbCBtZXRob2QuXG4gICAqIEBkZWZhdWx0IC0gTm8gZ3VhcmRyYWlscyBhc3NvY2lhdGVkIHRvIHRoZSBhZ2VudC5cbiAgICovXG4gIHJlYWRvbmx5IGd1YXJkcmFpbENvbmZpZ3VyYXRpb24/OiBHdWFyZHJhaWxDb25maWd1cmF0aW9uO1xuICAvKipcbiAgICogU2VsZWN0IHdoZXRoZXIgdGhlIGFnZW50IGNhbiBwcm9tcHQgYWRkaXRpb25hbFxuICAgKiBpbmZvcm1hdGlvbiBmcm9tIHRoZSB1c2VyIHdoZW4gaXQgZG9lcyBub3QgaGF2ZVxuICAgKiBlbm91Z2ggaW5mb3JtYXRpb24gdG8gcmVzcG9uZCB0byBhbiB1dHRlcmFuY2VcbiAgICpcbiAgICogQGRlZmF1bHQgLSBGYWxzZVxuICAgKi9cbiAgcmVhZG9ubHkgZW5hYmxlVXNlcklucHV0PzogYm9vbGVhbjtcblxuICAvKipcbiAgICogSG93IGxvbmcgc2Vzc2lvbnMgc2hvdWxkIGJlIGtlcHQgb3BlbiBmb3IgdGhlIGFnZW50LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIDEgaG91clxuICAgKi9cbiAgcmVhZG9ubHkgaWRsZVNlc3Npb25UVEw/OiBjZGsuRHVyYXRpb247XG4gIC8qKlxuICAgKiBLTVMgZW5jcnlwdGlvbiBrZXkgdG8gdXNlIGZvciB0aGUgYWdlbnQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gQW4gQVdTIG1hbmFnZWQga2V5IGlzIHVzZWQuXG4gICAqL1xuICByZWFkb25seSBlbmNyeXB0aW9uS2V5Pzoga21zLklLZXk7XG4gIC8qKlxuICAgKiBPdmVycmlkZXMgZm9yIHRoZSBhZ2VudC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBvdmVycmlkZXMgYXJlIHByb3ZpZGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgcHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uPzogUHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uO1xuICAvKipcbiAgICogTmFtZSBvZiB0aGUgYWxpYXMgZm9yIHRoZSBhZ2VudC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBhbGlhcyBpcyBjcmVhdGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgYWxpYXNOYW1lPzogc3RyaW5nO1xuICAvKipcbiAgICogV2hldGhlciB0byBwcmVwYXJlIHRoZSBhZ2VudCBmb3IgdXNlLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIGZhbHNlXG4gICAqL1xuICByZWFkb25seSBzaG91bGRQcmVwYXJlQWdlbnQ/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBPUFRJT05BTDogVGFnIChLRVktVkFMVUUpIGJlZHJvY2sgYWdlbnQgcmVzb3VyY2VcbiAgICpcbiAgICogQGRlZmF1bHQgLSBmYWxzZVxuICAgKi9cbiAgcmVhZG9ubHkgdGFncz86IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG59XG5cbi8qKlxuICogUHJvcGVydGllcyB0byBhZGQgYW4gQWxpYXMgdG8gYW4gQWdlbnRcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBZGRBZ2VudEFsaWFzUHJvcHMge1xuICAvKipcbiAgICogVGhlIG5hbWUgZm9yIHRoZSBhZ2VudCBhbGlhcy5cbiAgICovXG4gIHJlYWRvbmx5IGFsaWFzTmFtZTogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIHZlcnNpb24gb2YgdGhlIGFnZW50IHRvIGFzc29jaWF0ZSB3aXRoIHRoZSBhZ2VudCBhbGlhcy5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBDcmVhdGVzIGEgbmV3IHZlcnNpb24gb2YgdGhlIGFnZW50LlxuICAgKi9cbiAgcmVhZG9ubHkgYWdlbnRWZXJzaW9uPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBEZXNjcmlwdGlvbiBmb3IgdGhlIGFnZW50IGFsaWFzLlxuICAgKlxuICAgKi9cbiAgcmVhZG9ubHkgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogRGVwbG95IGEgQmVkcm9jayBBZ2VudC5cbiAqL1xuZXhwb3J0IGNsYXNzIEFnZW50IGV4dGVuZHMgQ29uc3RydWN0IHtcbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBuYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgSUFNIHJvbGUgZm9yIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSByb2xlOiBpYW0uUm9sZTtcbiAgLyoqXG4gICAqIFRoZSBtb2RlbCB1c2VkIGJ5IHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBmb3VuZGF0aW9uTW9kZWw6IElJbnZva2FibGU7XG4gIC8qKlxuICAgKiBUaGUgdW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGFnZW50SWQ6IHN0cmluZztcbiAgLyoqXG4gICAqIEluc3RhbmNlIG9mIEFnZW50XG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgYWdlbnRJbnN0YW5jZTogYmVkcm9jay5DZm5BZ2VudDtcbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGFnZW50QXJuOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgdW5pcXVlIGlkZW50aWZpZXIgb2YgdGhlIGFnZW50IGFsaWFzLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGFsaWFzSWQ/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBhZ2VudCBhbGlhcy5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBhbGlhc0Fybj86IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBuYW1lIGZvciB0aGUgYWdlbnQgYWxpYXMuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgYWxpYXNOYW1lPzogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIHZlcnNpb24gZm9yIHRoZSBhZ2VudFxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGFnZW50dmVyc2lvbjogc3RyaW5nO1xuICAvKipcbiAgICogQSBsaXN0IG9mIHZhbHVlcyB0byBpbmRpY2F0ZSBpZiBQcmVwYXJlQWdlbnQgb3IgYW4gQWxpYXMgbmVlZHMgdG8gYmUgdXBkYXRlZC5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHByaXZhdGUgcmVzb3VyY2VVcGRhdGVzOiBzdHJpbmdbXSA9IFtdO1xuXG4gIC8qKlxuICAgKiBBIGxpc3Qgb2YgYWN0aW9uIGdyb3VwcyBhc3NvY2lhdGVkIHdpdGggdGhlIGFnZW50XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBwdWJsaWMgYWN0aW9uR3JvdXBzOiBiZWRyb2NrLkNmbkFnZW50LkFnZW50QWN0aW9uR3JvdXBQcm9wZXJ0eVtdID0gW107XG4gIC8qKlxuICAgKiBBIGxpc3Qgb2YgS25vd2xlZGdlQmFzZXMgYXNzb2NpYXRlZCB3aXRoIHRoZSBhZ2VudC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBrbm93bGVkZ2UgYmFzZSBpcyB1c2VkLlxuICAgKi9cbiAgcHVibGljIGtub3dsZWRnZUJhc2VzOiBiZWRyb2NrLkNmbkFnZW50LkFnZW50S25vd2xlZGdlQmFzZVByb3BlcnR5W10gPSBbXTtcblxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogQWdlbnRQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG4gICAgdmFsaWRhdGVQcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb24ocHJvcHMucHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uKTtcblxuICAgIHRoaXMuZm91bmRhdGlvbk1vZGVsID0gcHJvcHMuZm91bmRhdGlvbk1vZGVsO1xuICAgIHRoaXMubmFtZSA9XG4gICAgICBwcm9wcy5uYW1lID8/IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIodGhpcywgJ2JlZHJvY2stYWdlbnQnLCB7IG1heExlbmd0aDogMzIsIGxvd2VyOiB0cnVlLCBzZXBhcmF0b3I6ICctJyB9KTtcblxuICAgIGlmIChwcm9wcy5leGlzdGluZ1JvbGUpIHtcbiAgICAgIHRoaXMucm9sZSA9IHByb3BzLmV4aXN0aW5nUm9sZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yb2xlID0gbmV3IGlhbS5Sb2xlKHRoaXMsICdSb2xlJywge1xuICAgICAgICBhc3N1bWVkQnk6IG5ldyBpYW0uU2VydmljZVByaW5jaXBhbCgnYmVkcm9jay5hbWF6b25hd3MuY29tJyksXG4gICAgICAgIHJvbGVOYW1lOiBnZW5lcmF0ZVBoeXNpY2FsTmFtZVYyKHRoaXMsICdBbWF6b25CZWRyb2NrRXhlY3V0aW9uUm9sZUZvckFnZW50c18nLCB7IG1heExlbmd0aDogNjQsIGxvd2VyOiBmYWxzZSB9KSxcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnJvbGUuYXNzdW1lUm9sZVBvbGljeSEuYWRkU3RhdGVtZW50cyhcbiAgICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICAgIGFjdGlvbnM6IFsnc3RzOkFzc3VtZVJvbGUnXSxcbiAgICAgICAgICBwcmluY2lwYWxzOiBbbmV3IGlhbS5TZXJ2aWNlUHJpbmNpcGFsKCdiZWRyb2NrLmFtYXpvbmF3cy5jb20nKV0sXG4gICAgICAgICAgY29uZGl0aW9uczoge1xuICAgICAgICAgICAgU3RyaW5nRXF1YWxzOiB7XG4gICAgICAgICAgICAgICdhd3M6U291cmNlQWNjb3VudCc6IGNkay5TdGFjay5vZih0aGlzKS5hY2NvdW50LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIEFybkxpa2U6IHtcbiAgICAgICAgICAgICAgJ2F3czpTb3VyY2VBcm4nOiBjZGsuU3RhY2sub2YodGhpcykuZm9ybWF0QXJuKHtcbiAgICAgICAgICAgICAgICBzZXJ2aWNlOiAnYmVkcm9jaycsXG4gICAgICAgICAgICAgICAgcmVzb3VyY2U6ICdhZ2VudCcsXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VOYW1lOiAnKicsXG4gICAgICAgICAgICAgICAgYXJuRm9ybWF0OiBjZGsuQXJuRm9ybWF0LlNMQVNIX1JFU09VUkNFX05BTUUsXG4gICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9LFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgdGhpcy5mb3VuZGF0aW9uTW9kZWwuZ3JhbnRJbnZva2UodGhpcy5yb2xlKTtcblxuICAgIGNvbnN0IGFnZW50ID0gbmV3IGJlZHJvY2suQ2ZuQWdlbnQodGhpcywgJ0FnZW50Jywge1xuICAgICAgYWdlbnROYW1lOiB0aGlzLm5hbWUsXG5cbiAgICAgIGZvdW5kYXRpb25Nb2RlbDogcHJvcHMuZm91bmRhdGlvbk1vZGVsLmludm9rYWJsZUFybixcbiAgICAgIGluc3RydWN0aW9uOiBwcm9wcy5pbnN0cnVjdGlvbixcbiAgICAgIGRlc2NyaXB0aW9uOiBwcm9wcy5kZXNjcmlwdGlvbixcbiAgICAgIGlkbGVTZXNzaW9uVHRsSW5TZWNvbmRzOiBwcm9wcy5pZGxlU2Vzc2lvblRUTD8udG9TZWNvbmRzKCksXG4gICAgICBhZ2VudFJlc291cmNlUm9sZUFybjogdGhpcy5yb2xlLnJvbGVBcm4sXG4gICAgICBjdXN0b21lckVuY3J5cHRpb25LZXlBcm46IHByb3BzLmVuY3J5cHRpb25LZXk/LmtleUFybixcbiAgICAgIHRhZ3M6IHByb3BzLnRhZ3MsXG4gICAgICBwcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb246IHByb3BzLnByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbixcbiAgICAgIGF1dG9QcmVwYXJlOiBwcm9wcy5zaG91bGRQcmVwYXJlQWdlbnQsXG4gICAgfSk7XG5cbiAgICB0aGlzLmFnZW50SW5zdGFuY2UgPSBhZ2VudDtcbiAgICB0aGlzLmFnZW50SWQgPSBhZ2VudC5hdHRyQWdlbnRJZDtcbiAgICB0aGlzLmFnZW50QXJuID0gYWdlbnQuYXR0ckFnZW50QXJuO1xuICAgIHRoaXMuYWdlbnR2ZXJzaW9uID0gYWdlbnQuYXR0ckFnZW50VmVyc2lvbjtcblxuICAgIGlmIChwcm9wcy5ndWFyZHJhaWxDb25maWd1cmF0aW9uKSB7XG4gICAgICB0aGlzLmFnZW50SW5zdGFuY2UuZ3VhcmRyYWlsQ29uZmlndXJhdGlvbiA9IHtcbiAgICAgICAgZ3VhcmRyYWlsSWRlbnRpZmllcjogcHJvcHMuZ3VhcmRyYWlsQ29uZmlndXJhdGlvbj8uZ3VhcmRyYWlsSWQsXG4gICAgICAgIGd1YXJkcmFpbFZlcnNpb246IHByb3BzLmd1YXJkcmFpbENvbmZpZ3VyYXRpb24/Lmd1YXJkcmFpbFZlcnNpb24sXG4gICAgICB9O1xuICAgIH1cblxuICAgIHRoaXMuX2FkZEFsaWFzRGVwZW5kZW5jeShhZ2VudC5hdHRyVXBkYXRlZEF0KTtcblxuICAgIGlmIChwcm9wcy5hbGlhc05hbWUpIHtcbiAgICAgIGNvbnN0IGFsaWFzID0gdGhpcy5hZGRBbGlhcyh7XG4gICAgICAgIGFsaWFzTmFtZTogcHJvcHMuYWxpYXNOYW1lLFxuICAgICAgfSk7XG4gICAgICB0aGlzLmFsaWFzSWQgPSBhbGlhcy5hbGlhc0lkO1xuICAgICAgdGhpcy5hbGlhc0FybiA9IGFsaWFzLmFsaWFzQXJuO1xuICAgICAgdGhpcy5hbGlhc05hbWUgPSBhbGlhcy5hbGlhc05hbWU7XG4gICAgfVxuXG4gICAgaWYgKHByb3BzLmtub3dsZWRnZUJhc2VzKSB7XG4gICAgICB0aGlzLmFkZEtub3dsZWRnZUJhc2VzKHByb3BzLmtub3dsZWRnZUJhc2VzKTtcbiAgICB9XG5cbiAgICBpZiAocHJvcHMuYWN0aW9uR3JvdXBzKSB7XG4gICAgICB0aGlzLmFkZEFjdGlvbkdyb3Vwcyhwcm9wcy5hY3Rpb25Hcm91cHMpO1xuICAgIH1cbiAgICAvLyBUbyBhbGxvdyB5b3VyIGFnZW50IHRvIHJlcXVlc3QgdGhlIHVzZXIgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbiAgICAvLyB3aGVuIHRyeWluZyB0byBjb21wbGV0ZSBhIHRhc2ssIGFkZCB0aGlzIGFjdGlvbiBncm91cFxuICAgIHRoaXMuYWRkQWN0aW9uR3JvdXAoXG4gICAgICBuZXcgQWdlbnRBY3Rpb25Hcm91cCh0aGlzLCAndXNlcklucHV0RW5hYmxlZEFjdGlvbkdyb3VwJywge1xuICAgICAgICBhY3Rpb25Hcm91cE5hbWU6ICdVc2VySW5wdXRBY3Rpb24nLFxuICAgICAgICBwYXJlbnRBY3Rpb25Hcm91cFNpZ25hdHVyZTogJ0FNQVpPTi5Vc2VySW5wdXQnLFxuICAgICAgICBhY3Rpb25Hcm91cFN0YXRlOiBwcm9wcy5lbmFibGVVc2VySW5wdXQgPyAnRU5BQkxFRCcgOiAnRElTQUJMRUQnLFxuICAgICAgfSksXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYW4gYWxpYXMgdG8gdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIGFkZEFsaWFzKHByb3BzOiBBZGRBZ2VudEFsaWFzUHJvcHMpOiBBZ2VudEFsaWFzIHtcbiAgICBjb25zdCBhbGlhcyA9IG5ldyBBZ2VudEFsaWFzKHRoaXMsIGBBZ2VudEFsaWFzLSR7cHJvcHMuYWxpYXNOYW1lfWAsIHtcbiAgICAgIGFnZW50SWQ6IHRoaXMuYWdlbnRJZCxcbiAgICAgIGFnZW50VmVyc2lvbjogcHJvcHMuYWdlbnRWZXJzaW9uLFxuICAgICAgcmVzb3VyY2VVcGRhdGVzOiBjZGsuTGF6eS5saXN0KHsgcHJvZHVjZTogKCkgPT4gdGhpcy5yZXNvdXJjZVVwZGF0ZXMgfSksXG4gICAgICBhbGlhc05hbWU6IHByb3BzLmFsaWFzTmFtZSxcbiAgICAgIGRlc2NyaXB0aW9uOiBwcm9wcy5kZXNjcmlwdGlvbixcbiAgICB9KTtcbiAgICByZXR1cm4gYWxpYXM7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGtub3dsZWRnZSBiYXNlcyB0byB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgYWRkS25vd2xlZGdlQmFzZXMoa25vd2xlZGdlQmFzZXM6IEtub3dsZWRnZUJhc2VbXSkge1xuICAgIGZvciAoY29uc3Qga2Igb2Yga25vd2xlZGdlQmFzZXMpIHtcbiAgICAgIHRoaXMuYWRkS25vd2xlZGdlQmFzZShrYik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBrbm93bGVkZ2UgYmFzZSB0byB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgYWRkS25vd2xlZGdlQmFzZShrbm93bGVkZ2VCYXNlOiBLbm93bGVkZ2VCYXNlKSB7XG4gICAgaWYgKCFrbm93bGVkZ2VCYXNlLmluc3RydWN0aW9uKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FnZW50IEtub3dsZWRnZSBCYXNlcyByZXF1aXJlIGluc3RydWN0aW9ucy4nKTtcbiAgICB9XG4gICAgbmV3IGlhbS5Qb2xpY3kodGhpcywgYEFnZW50S0JQb2xpY3ktJHtrbm93bGVkZ2VCYXNlLm5hbWV9YCwge1xuICAgICAgcm9sZXM6IFt0aGlzLnJvbGVdLFxuICAgICAgc3RhdGVtZW50czogW1xuICAgICAgICBuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgICAgYWN0aW9uczogWydiZWRyb2NrOlVwZGF0ZUtub3dsZWRnZUJhc2UnLCAnYmVkcm9jazpSZXRyaWV2ZSddLFxuICAgICAgICAgIHJlc291cmNlczogW2tub3dsZWRnZUJhc2Uua25vd2xlZGdlQmFzZUFybl0sXG4gICAgICAgIH0pLFxuICAgICAgXSxcbiAgICB9KTtcbiAgICBjb25zdCBhZ2VudEtub3dsZWRnZUJhc2VQcm9wZXJ0eTogYmVkcm9jay5DZm5BZ2VudC5BZ2VudEtub3dsZWRnZUJhc2VQcm9wZXJ0eSA9IHtcbiAgICAgIGRlc2NyaXB0aW9uOiBrbm93bGVkZ2VCYXNlLmluc3RydWN0aW9uLCAvLyBrbm93biBpc3N1ZTogd3JvbmcgcGFyYW1ldGVyIG1hcHBpbmcgaW4gQ2ZuLiBXb3JrYXJvdW5kOiBwYXNzIGluc3RydWN0aW9uIHRocm91Z2ggZGVzY3JpcHRpb25cbiAgICAgIGtub3dsZWRnZUJhc2VJZDoga25vd2xlZGdlQmFzZS5rbm93bGVkZ2VCYXNlSWQsXG4gICAgICBrbm93bGVkZ2VCYXNlU3RhdGU6IGtub3dsZWRnZUJhc2Uua25vd2xlZGdlQmFzZVN0YXRlLFxuICAgIH07XG5cbiAgICBpZiAoIXRoaXMuYWdlbnRJbnN0YW5jZS5rbm93bGVkZ2VCYXNlcyB8fCAhQXJyYXkuaXNBcnJheSh0aGlzLmFnZW50SW5zdGFuY2Uua25vd2xlZGdlQmFzZXMpKSB7XG4gICAgICB0aGlzLmFnZW50SW5zdGFuY2Uua25vd2xlZGdlQmFzZXMgPSBbYWdlbnRLbm93bGVkZ2VCYXNlUHJvcGVydHldO1xuICAgIH0gZWxzZSB7XG4gICAgICAodGhpcy5hZ2VudEluc3RhbmNlLmtub3dsZWRnZUJhc2VzIGFzIGFueSkucHVzaChhZ2VudEtub3dsZWRnZUJhc2VQcm9wZXJ0eSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhY3Rpb24gZ3JvdXAgdG8gdGhlIGFnZW50LlxuICAgKi9cbiAgcHVibGljIGFkZEFjdGlvbkdyb3VwKGFjdGlvbkdyb3VwOiBBZ2VudEFjdGlvbkdyb3VwKSB7XG4gICAgYWN0aW9uR3JvdXAuYWN0aW9uR3JvdXBFeGVjdXRvcj8ubGFtYmRhPy5hZGRQZXJtaXNzaW9uKCdBZ2VudExhbWJkYUludm9jYXRpb25Qb2xpY3knLCB7XG4gICAgICBwcmluY2lwYWw6IG5ldyBpYW0uU2VydmljZVByaW5jaXBhbCgnYmVkcm9jay5hbWF6b25hd3MuY29tJyksXG4gICAgICBzb3VyY2VBcm46IHRoaXMuYWdlbnRBcm4sXG4gICAgICBzb3VyY2VBY2NvdW50OiBjZGsuU3RhY2sub2YodGhpcykuYWNjb3VudCxcbiAgICB9KTtcblxuICAgIGlmICghdGhpcy5hZ2VudEluc3RhbmNlLmFjdGlvbkdyb3VwcyB8fCAhQXJyYXkuaXNBcnJheSh0aGlzLmFnZW50SW5zdGFuY2UuYWN0aW9uR3JvdXBzKSkge1xuICAgICAgdGhpcy5hZ2VudEluc3RhbmNlLmFjdGlvbkdyb3VwcyA9IFthY3Rpb25Hcm91cC5hY3Rpb25Hcm91cFByb3BlcnR5XTtcbiAgICB9IGVsc2Uge1xuICAgICAgKHRoaXMuYWdlbnRJbnN0YW5jZS5hY3Rpb25Hcm91cHMgYXMgYW55KS5wdXNoKGFjdGlvbkdyb3VwLmFjdGlvbkdyb3VwUHJvcGVydHkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYWN0aW9uIGdyb3VwcyB0byB0aGUgYWdlbnQuXG4gICAqL1xuICBwdWJsaWMgYWRkQWN0aW9uR3JvdXBzKGFjdGlvbkdyb3VwczogQWdlbnRBY3Rpb25Hcm91cFtdKSB7XG4gICAgZm9yIChjb25zdCBhY3Rpb25Hcm91cCBvZiBhY3Rpb25Hcm91cHMpIHtcbiAgICAgIHRoaXMuYWRkQWN0aW9uR3JvdXAoYWN0aW9uR3JvdXApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgZ3VhcmRyYWlsIHRvIHRoZSBhZ2VudC5cbiAgICovXG4gIHB1YmxpYyBhZGRHdWFyZHJhaWwoZ3VhcmRyYWlsOiBJR3VhcmRyYWlsKSB7XG4gICAgLy8gSGFuZGxlIHBlcm1pc3Npb25zXG4gICAgZ3VhcmRyYWlsLmdyYW50QXBwbHkodGhpcy5yb2xlKTtcbiAgICBndWFyZHJhaWwua21zS2V5Py5ncmFudERlY3J5cHQodGhpcy5yb2xlKTtcblxuICAgIC8vIEhhbmRsZSBDRk4gYWdlbnQgY29uZmlndXJhdGlvblxuICAgIHRoaXMuYWdlbnRJbnN0YW5jZS5ndWFyZHJhaWxDb25maWd1cmF0aW9uID0ge1xuICAgICAgZ3VhcmRyYWlsSWRlbnRpZmllcjogZ3VhcmRyYWlsLmd1YXJkcmFpbElkLFxuICAgICAgZ3VhcmRyYWlsVmVyc2lvbjogZ3VhcmRyYWlsLmd1YXJkcmFpbFZlcnNpb24sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RlciBhIGRlcGVuZGVuY3kgZm9yIGFsaWFzZXMuXG4gICAqXG4gICAqIEBwYXJhbSB1cGRhdGVkQXQgLSBUaGUgdXBkYXRlZEF0IG9mIHRoZSByZXNvdXJjZSB0aGF0IHdpbGwgYmUgcmVnaXN0ZXJlZCBhcyBhIGRlcGVuZGVuY3kuXG4gICAqXG4gICAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICAgKi9cbiAgcHVibGljIF9hZGRBbGlhc0RlcGVuZGVuY3kodXBkYXRlZEF0OiBzdHJpbmcpIHtcbiAgICBpZiAodXBkYXRlZEF0KSB7XG4gICAgICB0aGlzLnJlc291cmNlVXBkYXRlcy5wdXNoKHVwZGF0ZWRBdCk7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogVmFsaWRhdGUgdGhlIGluZmVyZW5jZUNvbmZpZ3VyYXRpb24gb2YgYSBwcm9tcHQgb3ZlcnJpZGUuXG4gKlxuICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZUluZmVyZW5jZUNvbmZpZ3VyYXRpb24oaW5mZXJlbmNlQ29uZmlndXJhdGlvbjogSW5mZXJlbmNlQ29uZmlndXJhdGlvbikge1xuICBpZiAoaW5mZXJlbmNlQ29uZmlndXJhdGlvbi50b3BLIDwgMCB8fCBpbmZlcmVuY2VDb25maWd1cmF0aW9uLnRvcEsgPiA1MDApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3RvcEsgbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDUwMCcpO1xuICB9XG5cbiAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGluZmVyZW5jZUNvbmZpZ3VyYXRpb24udG9wSykpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3RvcEsgbXVzdCBiZSBhbiBpbnRlZ2VyJyk7XG4gIH1cblxuICBpZiAoaW5mZXJlbmNlQ29uZmlndXJhdGlvbi5zdG9wU2VxdWVuY2VzLmxlbmd0aCA+IDQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ3N0b3BTZXF1ZW5jZXMgY2Fubm90IGNvbnRhaW4gbW9yZSB0aGFuIDQgZWxlbWVudHMnKTtcbiAgfVxuXG4gIGlmIChpbmZlcmVuY2VDb25maWd1cmF0aW9uLm1heGltdW1MZW5ndGggPCAwIHx8IGluZmVyZW5jZUNvbmZpZ3VyYXRpb24ubWF4aW11bUxlbmd0aCA+IDQwOTYpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ21heGltdW1MZW5ndGggbXVzdCBiZSBiZXR3ZWVuIDAgYW5kIDQwOTYnKTtcbiAgfVxuXG4gIGlmICghTnVtYmVyLmlzSW50ZWdlcihpbmZlcmVuY2VDb25maWd1cmF0aW9uLm1heGltdW1MZW5ndGgpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdtYXhpbXVtTGVuZ3RoIG11c3QgYmUgYW4gaW50ZWdlcicpO1xuICB9XG5cbiAgaWYgKGluZmVyZW5jZUNvbmZpZ3VyYXRpb24udG9wUCA8IDAgfHwgaW5mZXJlbmNlQ29uZmlndXJhdGlvbi50b3BQID4gMSkge1xuICAgIHRocm93IG5ldyBFcnJvcigndG9wUCBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMScpO1xuICB9XG5cbiAgaWYgKGluZmVyZW5jZUNvbmZpZ3VyYXRpb24udGVtcGVyYXR1cmUgPCAwIHx8IGluZmVyZW5jZUNvbmZpZ3VyYXRpb24udGVtcGVyYXR1cmUgPiAxKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCd0ZW1wZXJhdHVyZSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgMScpO1xuICB9XG59XG5cbi8qKlxuICogVmFsaWRhdGUgdGhlIHByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbi5cbiAqXG4gKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlUHJvbXB0T3ZlcnJpZGVDb25maWd1cmF0aW9uKFxuICBwcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb246IFByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbiB8IHVuZGVmaW5lZCxcbikge1xuICBpZiAoIXByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChcbiAgICBwcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb24ub3ZlcnJpZGVMYW1iZGEgJiZcbiAgICBwcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb24ucHJvbXB0Q29uZmlndXJhdGlvbnMuc29tZSgocGMpID0+IHBjLnBhcnNlck1vZGUgIT09IFBhcnNlck1vZGUuT1ZFUlJJRERFTilcbiAgKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgJ292ZXJyaWRlTGFtYmRhIGNhbiBvbmx5IGJlIHVzZWQgaWYgYWxsIHByb21wdENvbmZpZ3VyYXRpb25zIGhhdmUgYSBwYXJzZXJNb2RlIHZhbHVlIG9mIE9WRVJSSURERU4nLFxuICAgICk7XG4gIH1cblxuICBpZiAoXG4gICAgIXByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbi5vdmVycmlkZUxhbWJkYSAmJlxuICAgIHByb21wdE92ZXJyaWRlQ29uZmlndXJhdGlvbi5wcm9tcHRDb25maWd1cmF0aW9ucy5zb21lKChwYykgPT4gcGMucGFyc2VyTW9kZSA9PT0gUGFyc2VyTW9kZS5PVkVSUklEREVOKVxuICApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAnQXQgbGVhc3Qgb25lIHByb21wdENvbmZpZ3VyYXRpb24gaGFzIGEgcGFyc2VyTW9kZSB2YWx1ZSBvZiBPVkVSUklEREVOLCBidXQgbm8gb3ZlcnJpZGVMYW1iZGEgaXMgc3BlY2lmaWVkJyxcbiAgICApO1xuICB9XG5cbiAgLy8gY2hlY2sgaW5mZXJlbmNlQ29uZmlndXJhdGlvbiBudW1iZXIgdHlwZXNcbiAgT2JqZWN0LnZhbHVlcyhwcm9tcHRPdmVycmlkZUNvbmZpZ3VyYXRpb24ucHJvbXB0Q29uZmlndXJhdGlvbnMpLmZvckVhY2goKHBjKSA9PiB7XG4gICAgdmFsaWRhdGVJbmZlcmVuY2VDb25maWd1cmF0aW9uKHBjLmluZmVyZW5jZUNvbmZpZ3VyYXRpb24pO1xuICB9KTtcblxuICByZXR1cm47XG59XG4iXX0=