"use strict";
var _a, _b, _c;
Object.defineProperty(exports, "__esModule", { value: true });
exports.Prompt = exports.PromptBase = exports.PromptVariant = exports.PromptTemplateType = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_cdk_lib_1 = require("aws-cdk-lib");
const aws_iam_1 = require("aws-cdk-lib/aws-iam");
const helpers_internal_1 = require("aws-cdk-lib/core/lib/helpers-internal");
const constructs_1 = require("constructs");
var PromptTemplateType;
(function (PromptTemplateType) {
    PromptTemplateType["TEXT"] = "TEXT";
})(PromptTemplateType || (exports.PromptTemplateType = PromptTemplateType = {}));
/**
 * Variants are specific sets of inputs that guide FMs on Amazon Bedrock to
 * generate an appropriate response or output for a given task or instruction.
 * You can optimize the prompt for specific use cases and models.
 */
class PromptVariant {
    // ------------------------------------------------------
    // Static Methods
    // ------------------------------------------------------
    /**
     * Static method to create a text template
     */
    static text(props) {
        return {
            name: props.variantName,
            templateType: PromptTemplateType.TEXT,
            modelId: props.model.invokableArn,
            inferenceConfiguration: {
                text: { ...props.inferenceConfiguration },
            },
            templateConfiguration: {
                text: {
                    inputVariables: props.promptVariables.flatMap((variable) => {
                        return { name: variable };
                    }),
                    text: props.promptText,
                },
            },
        };
    }
    // ------------------------------------------------------
    // Constructor
    // ------------------------------------------------------
    constructor() { }
}
exports.PromptVariant = PromptVariant;
_a = JSII_RTTI_SYMBOL_1;
PromptVariant[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.PromptVariant", version: "0.1.285" };
/**
 * Abstract base class for a Prompt.
 * Contains methods and attributes valid for Promtps either created with CDK or imported.
 */
class PromptBase extends aws_cdk_lib_1.Resource {
    /**
     * Grant the given identity permissions to get the prompt.
     */
    grantGet(grantee) {
        return aws_iam_1.Grant.addToPrincipal({
            grantee,
            resourceArns: [this.promptArn],
            actions: ['bedrock:GetPrompt'],
            scope: this,
        });
    }
}
exports.PromptBase = PromptBase;
_b = JSII_RTTI_SYMBOL_1;
PromptBase[_b] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.PromptBase", version: "0.1.285" };
/******************************************************************************
 *                        NEW CONSTRUCT DEFINITION
 *****************************************************************************/
/**
 * Prompts are a specific set of inputs that guide FMs on Amazon Bedrock to
 * generate an appropriate response or output for a given task or instruction.
 * You can optimize the prompt for specific use cases and models.
 * @resource AWS::Bedrock::Prompt
 * @see https://docs.aws.amazon.com/bedrock/latest/userguide/prompt-management.html
 */
class Prompt extends constructs_1.Construct {
    // ------------------------------------------------------
    // Import Methods
    // ------------------------------------------------------
    static fromPromptAttributes(scope, id, attrs) {
        const formattedArn = aws_cdk_lib_1.Arn.split(attrs.promptArn, aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME);
        class Import extends PromptBase {
            constructor() {
                super(...arguments);
                this.promptArn = attrs.promptArn;
                this.promptId = formattedArn.resourceName;
                this.promptVersion = attrs.promptVersion ?? 'DRAFT';
                this.kmsKey = attrs.kmsKey;
            }
        }
        return new Import(scope, id);
    }
    // ------------------------------------------------------
    // Constructor
    // ------------------------------------------------------
    constructor(scope, id, props) {
        super(scope, id);
        // ------------------------------------------------------
        // Set properties or defaults
        // ------------------------------------------------------
        this.promptName = props.promptName;
        this.kmsKey = props.kmsKey;
        this.variants = props.variants ?? [];
        // ------------------------------------------------------
        // Validation
        // ------------------------------------------------------
        this.node.addValidation({ validate: () => this.validatePromptName() });
        this.node.addValidation({ validate: () => this.validatePromptVariants() });
        // ------------------------------------------------------
        // CFN Props - With Lazy support
        // ------------------------------------------------------
        let cfnProps = {
            customerEncryptionKeyArn: this.kmsKey?.keyArn,
            defaultVariant: props.defaultVariant?.name,
            description: props.description,
            name: props.promptName,
            variants: aws_cdk_lib_1.Lazy.any({
                produce: () => this.variants,
            }),
        };
        // Hash calculation useful for versioning of the guardrail
        this._hash = (0, helpers_internal_1.md5hash)(JSON.stringify(cfnProps));
        // ------------------------------------------------------
        // L1 Instantiation
        // ------------------------------------------------------
        this._resource = new aws_cdk_lib_1.aws_bedrock.CfnPrompt(this, 'Prompt', cfnProps);
        this.promptArn = this._resource.attrArn;
        this.promptId = this._resource.attrId;
        this.promptVersion = this._resource.attrVersion;
    }
    // ------------------------------------------------------
    // Validation Methods
    // ------------------------------------------------------
    /**
     * Validates whether the prompt name is valid according to the specification.
     * @see https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-bedrock-prompt.html#cfn-bedrock-prompt-name
     */
    validatePromptName() {
        const errors = [];
        const matchesPattern = /^([0-9a-zA-Z][_-]?){1,100}$/.test(this.promptName);
        if (!matchesPattern) {
            errors.push('Valid characters are a-z, A-Z, 0-9, _ (underscore) and - (hyphen). And must not begin with a hyphen');
        }
        if (errors.length > 0) {
            errors.unshift(`Invalid prompt name (value: ${this.promptName})`);
        }
        return errors;
    }
    /**
     * Validates whether the number of prompt variants is respected.
     */
    validatePromptVariants() {
        const errors = [];
        if (this.variants.length > 3) {
            errors.push(`Error: Too many variants specified. The maximum allowed is 3, but you have provided ${this.variants.length} variants.`);
        }
        return errors;
    }
    // ------------------------------------------------------
    // Helper Methods
    // ------------------------------------------------------
    /**
     * Creates a prompt version, a static snapshot of your prompt that can be
     * deployed to production.
     */
    createVersion(description) {
        const version = new aws_cdk_lib_1.aws_bedrock.CfnPromptVersion(this, `PromptVersion-${this._hash}`, {
            promptArn: this.promptArn,
            description,
        });
        this.promptVersion = version.attrVersion;
        return this.promptVersion;
    }
    /**
     * Adds a prompt variant.
     */
    addVariant(variant) {
        this.variants.push(variant);
    }
}
exports.Prompt = Prompt;
_c = JSII_RTTI_SYMBOL_1;
Prompt[_c] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.Prompt", version: "0.1.285" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvbXB0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2Nkay1saWIvYmVkcm9jay9wcm9tcHRzL3Byb21wdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBOzs7Ozs7Ozs7OztHQVdHO0FBRUgsNkNBQXFHO0FBQ3JHLGlEQUF3RDtBQUV4RCw0RUFBZ0U7QUFDaEUsMkNBQXVDO0FBR3ZDLElBQVksa0JBRVg7QUFGRCxXQUFZLGtCQUFrQjtJQUM1QixtQ0FBYSxDQUFBO0FBQ2YsQ0FBQyxFQUZXLGtCQUFrQixrQ0FBbEIsa0JBQWtCLFFBRTdCO0FBOEJEOzs7O0dBSUc7QUFDSCxNQUFzQixhQUFhO0lBQ2pDLHlEQUF5RDtJQUN6RCxpQkFBaUI7SUFDakIseURBQXlEO0lBQ3pEOztPQUVHO0lBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxLQUE2QjtRQUM5QyxPQUFPO1lBQ0wsSUFBSSxFQUFFLEtBQUssQ0FBQyxXQUFXO1lBQ3ZCLFlBQVksRUFBRSxrQkFBa0IsQ0FBQyxJQUFJO1lBQ3JDLE9BQU8sRUFBRSxLQUFLLENBQUMsS0FBSyxDQUFDLFlBQVk7WUFDakMsc0JBQXNCLEVBQUU7Z0JBQ3RCLElBQUksRUFBRSxFQUFFLEdBQUcsS0FBSyxDQUFDLHNCQUFzQixFQUFFO2FBQzFDO1lBQ0QscUJBQXFCLEVBQUU7Z0JBQ3JCLElBQUksRUFBRTtvQkFDSixjQUFjLEVBQUUsS0FBSyxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxRQUFnQixFQUFFLEVBQUU7d0JBQ2pFLE9BQU8sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLENBQUM7b0JBQzVCLENBQUMsQ0FBQztvQkFDRixJQUFJLEVBQUUsS0FBSyxDQUFDLFVBQVU7aUJBQ3ZCO2FBQ0Y7U0FDRixDQUFDO0lBQ0osQ0FBQztJQXlCRCx5REFBeUQ7SUFDekQsY0FBYztJQUNkLHlEQUF5RDtJQUN6RCxnQkFBeUIsQ0FBQzs7QUFwRDVCLHNDQXFEQzs7O0FB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V0FBb0I7UUFDdkMsTUFBTSxPQUFPLEdBQUcsSUFBSSx5QkFBTyxDQUFDLGdCQUFnQixDQUFDLElBQUksRUFBRSxpQkFBaUIsSUFBSSxDQUFDLEtBQUssRUFBRSxFQUFFO1lBQ2hGLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUztZQUN6QixXQUFXO1NBQ1osQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLGFBQWEsR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDO1FBQ3pDLE9BQU8sSUFBSSxDQUFDLGFBQWEsQ0FBQztJQUM1QixDQUFDO0lBRUQ7O09BRUc7SUFDSSxVQUFVLENBQUMsT0FBc0I7UUFDdEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDOUIsQ0FBQzs7QUExSkgsd0JBMkpDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiAgQ29weXJpZ2h0IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqICB3aXRoIHRoZSBMaWNlbnNlLiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICpcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogIG9yIGluIHRoZSAnbGljZW5zZScgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWQgb24gYW4gJ0FTIElTJyBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTXG4gKiAgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnNcbiAqICBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuaW1wb3J0IHsgQXJuLCBBcm5Gb3JtYXQsIGF3c19rbXMgYXMga21zLCBMYXp5LCBhd3NfYmVkcm9jayBhcyBiZWRyb2NrLCBSZXNvdXJjZSB9IGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCB7IEdyYW50LCBJR3JhbnRhYmxlIH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWlhbSc7XG5pbXBvcnQgeyBJS2V5IH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWttcyc7XG5pbXBvcnQgeyBtZDVoYXNoIH0gZnJvbSAnYXdzLWNkay1saWIvY29yZS9saWIvaGVscGVycy1pbnRlcm5hbCc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCB7IElJbnZva2FibGUgfSBmcm9tICcuLi9tb2RlbHMnO1xuXG5leHBvcnQgZW51bSBQcm9tcHRUZW1wbGF0ZVR5cGUge1xuICBURVhUID0gJ1RFWFQnLFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbW1vblByb21wdFZhcmlhbnRQcm9wcyB7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgcHJvbXB0IHZhcmlhbnQuXG4gICAqL1xuICByZWFkb25seSB2YXJpYW50TmFtZTogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIG1vZGVsIHdoaWNoIGlzIHVzZWQgdG8gcnVuIHRoZSBwcm9tcHQuIFRoZSBtb2RlbCBjb3VsZCBiZSBhIGZvdW5kYXRpb25cbiAgICogbW9kZWwsIGEgY3VzdG9tIG1vZGVsLCBvciBhIHByb3Zpc2lvbmVkIG1vZGVsLlxuICAgKi9cbiAgcmVhZG9ubHkgbW9kZWw6IElJbnZva2FibGU7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGV4dFByb21wdFZhcmlhbnRQcm9wcyBleHRlbmRzIENvbW1vblByb21wdFZhcmlhbnRQcm9wcyB7XG4gIC8qKlxuICAgKiBJbmZlcmVuY2UgY29uZmlndXJhdGlvbiBmb3IgdGhlIFRleHQgUHJvbXB0XG4gICAqL1xuICByZWFkb25seSBpbmZlcmVuY2VDb25maWd1cmF0aW9uPzogYmVkcm9jay5DZm5Qcm9tcHQuUHJvbXB0TW9kZWxJbmZlcmVuY2VDb25maWd1cmF0aW9uUHJvcGVydHk7XG4gIC8qKlxuICAgKiBUaGUgdmFyaWFibGVzIGluIHRoZSBwcm9tcHQgdGVtcGxhdGUgdGhhdCBjYW4gYmUgZmlsbGVkIGluIGF0IHJ1bnRpbWUuXG4gICAqL1xuICByZWFkb25seSBwcm9tcHRWYXJpYWJsZXM6IHN0cmluZ1tdO1xuICAvKipcbiAgICogVGhlIHRleHQgcHJvbXB0LiBWYXJpYWJsZXMgYXJlIHVzZWQgYnkgZW5jb2xzaW5nIGl0cyBuYW1lIHdpdGggZG91YmxlIGN1cmx5IGJyYWNlc1xuICAgKiBhcyBpbiBge3t2YXJpYWJsZV9uYW1lfX1gLlxuICAgKi9cbiAgcmVhZG9ubHkgcHJvbXB0VGV4dDogc3RyaW5nO1xufVxuXG4vKipcbiAqIFZhcmlhbnRzIGFyZSBzcGVjaWZpYyBzZXRzIG9mIGlucHV0cyB0aGF0IGd1aWRlIEZNcyBvbiBBbWF6b24gQmVkcm9jayB0b1xuICogZ2VuZXJhdGUgYW4gYXBwcm9wcmlhdGUgcmVzcG9uc2Ugb3Igb3V0cHV0IGZvciBhIGdpdmVuIHRhc2sgb3IgaW5zdHJ1Y3Rpb24uXG4gKiBZb3UgY2FuIG9wdGltaXplIHRoZSBwcm9tcHQgZm9yIHNwZWNpZmljIHVzZSBjYXNlcyBhbmQgbW9kZWxzLlxuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgUHJvbXB0VmFyaWFudCB7XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBTdGF0aWMgTWV0aG9kc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFN0YXRpYyBtZXRob2QgdG8gY3JlYXRlIGEgdGV4dCB0ZW1wbGF0ZVxuICAgKi9cbiAgcHVibGljIHN0YXRpYyB0ZXh0KHByb3BzOiBUZXh0UHJvbXB0VmFyaWFudFByb3BzKTogUHJvbXB0VmFyaWFudCB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IHByb3BzLnZhcmlhbnROYW1lLFxuICAgICAgdGVtcGxhdGVUeXBlOiBQcm9tcHRUZW1wbGF0ZVR5cGUuVEVYVCxcbiAgICAgIG1vZGVsSWQ6IHByb3BzLm1vZGVsLmludm9rYWJsZUFybixcbiAgICAgIGluZmVyZW5jZUNvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgdGV4dDogeyAuLi5wcm9wcy5pbmZlcmVuY2VDb25maWd1cmF0aW9uIH0sXG4gICAgICB9LFxuICAgICAgdGVtcGxhdGVDb25maWd1cmF0aW9uOiB7XG4gICAgICAgIHRleHQ6IHtcbiAgICAgICAgICBpbnB1dFZhcmlhYmxlczogcHJvcHMucHJvbXB0VmFyaWFibGVzLmZsYXRNYXAoKHZhcmlhYmxlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIHJldHVybiB7IG5hbWU6IHZhcmlhYmxlIH07XG4gICAgICAgICAgfSksXG4gICAgICAgICAgdGV4dDogcHJvcHMucHJvbXB0VGV4dCxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gUHJvcGVydGllc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBwcm9tcHQgdmFyaWFudC5cbiAgICovXG4gIHB1YmxpYyBhYnN0cmFjdCBuYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgdHlwZSBvZiBwcm9tcHQgdGVtcGxhdGUuXG4gICAqL1xuICBwdWJsaWMgYWJzdHJhY3QgdGVtcGxhdGVUeXBlOiBQcm9tcHRUZW1wbGF0ZVR5cGU7XG4gIC8qKlxuICAgKiBUaGUgaW5mZXJlbmNlIGNvbmZpZ3VyYXRpb24uXG4gICAqL1xuICBwdWJsaWMgYWJzdHJhY3QgaW5mZXJlbmNlQ29uZmlndXJhdGlvbj86IGJlZHJvY2suQ2ZuUHJvbXB0LlByb21wdEluZmVyZW5jZUNvbmZpZ3VyYXRpb25Qcm9wZXJ0eTtcbiAgLyoqXG4gICAqIFRoZSB1bmlxdWUgaWRlbnRpZmllciBvZiB0aGUgbW9kZWwgd2l0aCB3aGljaCB0byBydW4gaW5mZXJlbmNlIG9uIHRoZSBwcm9tcHQuXG4gICAqL1xuICBwdWJsaWMgYWJzdHJhY3QgbW9kZWxJZD86IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSB0ZW1wbGF0ZSBjb25maWd1cmF0aW9uLlxuICAgKi9cbiAgcHVibGljIGFic3RyYWN0IHRlbXBsYXRlQ29uZmlndXJhdGlvbjogYmVkcm9jay5DZm5Qcm9tcHQuUHJvbXB0VGVtcGxhdGVDb25maWd1cmF0aW9uUHJvcGVydHk7XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIENvbnN0cnVjdG9yXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBwcm90ZWN0ZWQgY29uc3RydWN0b3IoKSB7fVxufVxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENPTU1PTlxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqXG4gKiBSZXByZXNlbnRzIGEgUHJvbXB0LCBlaXRoZXIgY3JlYXRlZCB3aXRoIENESyBvciBpbXBvcnRlZC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJUHJvbXB0IHtcbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgdGhlIHByb21wdC5cbiAgICogQGV4YW1wbGUgXCJhcm46YXdzOmJlZHJvY2s6dXMtZWFzdC0xOjEyMzQ1Njc4OTAxMjpwcm9tcHQvUFJPTVBUMTIzNDVcIlxuICAgKi9cbiAgcmVhZG9ubHkgcHJvbXB0QXJuOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgSUQgb2YgdGhlIHByb21wdC5cbiAgICogQGV4YW1wbGUgXCJQUk9NUFQxMjM0NVwiXG4gICAqL1xuICByZWFkb25seSBwcm9tcHRJZDogc3RyaW5nO1xuICAvKipcbiAgICogT3B0aW9uYWwgS01TIGVuY3J5cHRpb24ga2V5IGFzc29jaWF0ZWQgd2l0aCB0aGlzIHByb21wdC5cbiAgICovXG4gIHJlYWRvbmx5IGttc0tleT86IElLZXk7XG4gIC8qKlxuICAgKiBUaGUgdmVyc2lvbiBvZiB0aGUgcHJvbXB0LlxuICAgKiBAZGVmYXVsdCAtIFwiRFJBRlRcIlxuICAgKi9cbiAgcHJvbXB0VmVyc2lvbjogc3RyaW5nO1xufVxuXG4vKipcbiAqIEFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIGEgUHJvbXB0LlxuICogQ29udGFpbnMgbWV0aG9kcyBhbmQgYXR0cmlidXRlcyB2YWxpZCBmb3IgUHJvbXRwcyBlaXRoZXIgY3JlYXRlZCB3aXRoIENESyBvciBpbXBvcnRlZC5cbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFByb21wdEJhc2UgZXh0ZW5kcyBSZXNvdXJjZSBpbXBsZW1lbnRzIElQcm9tcHQge1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkgcHJvbXB0QXJuOiBzdHJpbmc7XG4gIHB1YmxpYyBhYnN0cmFjdCByZWFkb25seSBwcm9tcHRJZDogc3RyaW5nO1xuICBwdWJsaWMgYWJzdHJhY3QgcmVhZG9ubHkga21zS2V5PzogSUtleTtcbiAgcHVibGljIGFic3RyYWN0IHByb21wdFZlcnNpb246IHN0cmluZztcblxuICAvKipcbiAgICogR3JhbnQgdGhlIGdpdmVuIGlkZW50aXR5IHBlcm1pc3Npb25zIHRvIGdldCB0aGUgcHJvbXB0LlxuICAgKi9cbiAgcHVibGljIGdyYW50R2V0KGdyYW50ZWU6IElHcmFudGFibGUpOiBHcmFudCB7XG4gICAgcmV0dXJuIEdyYW50LmFkZFRvUHJpbmNpcGFsKHtcbiAgICAgIGdyYW50ZWUsXG4gICAgICByZXNvdXJjZUFybnM6IFt0aGlzLnByb21wdEFybl0sXG4gICAgICBhY3Rpb25zOiBbJ2JlZHJvY2s6R2V0UHJvbXB0J10sXG4gICAgICBzY29wZTogdGhpcyxcbiAgICB9KTtcbiAgfVxufVxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiAgICAgICAgICAgICAgICAgICAgICAgIFBST1BTIEZPUiBORVcgQ09OU1RSVUNUXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJvbXB0UHJvcHMge1xuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIHByb21wdC5cbiAgICovXG4gIHJlYWRvbmx5IHByb21wdE5hbWU6IHN0cmluZztcbiAgLyoqXG4gICAqIEEgZGVzY3JpcHRpb24gb2Ygd2hhdCB0aGUgcHJvbXB0IGRvZXMuXG4gICAqIEBkZWZhdWx0IC0gTm8gZGVzY3JpcHRpb24gcHJvdmlkZWQuXG4gICAqL1xuICByZWFkb25seSBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSBLTVMga2V5IHRoYXQgdGhlIHByb21wdCBpcyBlbmNyeXB0ZWQgd2l0aC5cbiAgICogQGRlZmF1bHQgLSBBV1Mgb3duZWQgYW5kIG1hbmFnZWQga2V5LlxuICAgKi9cbiAgcmVhZG9ubHkga21zS2V5Pzoga21zLklLZXk7XG4gIC8qKlxuICAgKiBUaGUgUHJvbXB0IFZhcmlhbnQgdGhhdCB3aWxsIGJlIHVzZWQgYnkgZGVmYXVsdC5cbiAgICogQGRlZmF1bHQgLSBObyBkZWZhdWx0IHZhcmlhbnQgcHJvdmlkZWQuXG4gICAqL1xuICByZWFkb25seSBkZWZhdWx0VmFyaWFudD86IFByb21wdFZhcmlhbnQ7XG4gIC8qKlxuICAgKiBUaGUgdmFyaWFudHMgb2YgeW91ciBwcm9tcHQuIFZhcmlhbnRzIGNhbiB1c2UgZGlmZmVyZW50IG1lc3NhZ2VzLCBtb2RlbHMsXG4gICAqIG9yIGNvbmZpZ3VyYXRpb25zIHNvIHRoYXQgeW91IGNhbiBjb21wYXJlIHRoZWlyIG91dHB1dHMgdG8gZGVjaWRlIHRoZSBiZXN0XG4gICAqIHZhcmlhbnQgZm9yIHlvdXIgdXNlIGNhc2UuIE1heGltdW0gb2YgMyB2YXJpYW50cy5cbiAgICovXG4gIHJlYWRvbmx5IHZhcmlhbnRzPzogUHJvbXB0VmFyaWFudFtdO1xufVxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiAgICAgICAgICAgICAgICAgICAgICBBVFRSUyBGT1IgSU1QT1JURUQgQ09OU1RSVUNUXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5leHBvcnQgaW50ZXJmYWNlIFByb21wdEF0dHJpYnV0ZXMge1xuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUgcHJvbXB0LlxuICAgKiBAZXhhbXBsZSBcImFybjphd3M6YmVkcm9jazp1cy1lYXN0LTE6MTIzNDU2Nzg5MDEyOnByb21wdC9QUk9NUFQxMjM0NVwiXG4gICAqL1xuICByZWFkb25seSBwcm9tcHRBcm46IHN0cmluZztcbiAgLyoqXG4gICAqIE9wdGlvbmFsIEtNUyBlbmNyeXB0aW9uIGtleSBhc3NvY2lhdGVkIHdpdGggdGhpcyBwcm9tcHQuXG4gICAqL1xuICByZWFkb25seSBrbXNLZXk/OiBJS2V5O1xuICAvKipcbiAgICogVGhlIHZlcnNpb24gb2YgdGhlIHByb21wdC5cbiAgICogQGRlZmF1bHQgLSBcIkRSQUZUXCJcbiAgICovXG4gIHJlYWRvbmx5IHByb21wdFZlcnNpb24/OiBzdHJpbmc7XG59XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqICAgICAgICAgICAgICAgICAgICAgICAgTkVXIENPTlNUUlVDVCBERUZJTklUSU9OXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIFByb21wdHMgYXJlIGEgc3BlY2lmaWMgc2V0IG9mIGlucHV0cyB0aGF0IGd1aWRlIEZNcyBvbiBBbWF6b24gQmVkcm9jayB0b1xuICogZ2VuZXJhdGUgYW4gYXBwcm9wcmlhdGUgcmVzcG9uc2Ugb3Igb3V0cHV0IGZvciBhIGdpdmVuIHRhc2sgb3IgaW5zdHJ1Y3Rpb24uXG4gKiBZb3UgY2FuIG9wdGltaXplIHRoZSBwcm9tcHQgZm9yIHNwZWNpZmljIHVzZSBjYXNlcyBhbmQgbW9kZWxzLlxuICogQHJlc291cmNlIEFXUzo6QmVkcm9jazo6UHJvbXB0XG4gKiBAc2VlIGh0dHBzOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9iZWRyb2NrL2xhdGVzdC91c2VyZ3VpZGUvcHJvbXB0LW1hbmFnZW1lbnQuaHRtbFxuICovXG5leHBvcnQgY2xhc3MgUHJvbXB0IGV4dGVuZHMgQ29uc3RydWN0IGltcGxlbWVudHMgSVByb21wdCB7XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBJbXBvcnQgTWV0aG9kc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgcHVibGljIHN0YXRpYyBmcm9tUHJvbXB0QXR0cmlidXRlcyhzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBhdHRyczogUHJvbXB0QXR0cmlidXRlcyk6IElQcm9tcHQge1xuICAgIGNvbnN0IGZvcm1hdHRlZEFybiA9IEFybi5zcGxpdChhdHRycy5wcm9tcHRBcm4sIEFybkZvcm1hdC5TTEFTSF9SRVNPVVJDRV9OQU1FKTtcbiAgICBjbGFzcyBJbXBvcnQgZXh0ZW5kcyBQcm9tcHRCYXNlIHtcbiAgICAgIHB1YmxpYyByZWFkb25seSBwcm9tcHRBcm4gPSBhdHRycy5wcm9tcHRBcm47XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgcHJvbXB0SWQgPSBmb3JtYXR0ZWRBcm4ucmVzb3VyY2VOYW1lITtcbiAgICAgIHB1YmxpYyByZWFkb25seSBwcm9tcHRWZXJzaW9uID0gYXR0cnMucHJvbXB0VmVyc2lvbiA/PyAnRFJBRlQnO1xuICAgICAgcHVibGljIHJlYWRvbmx5IGttc0tleSA9IGF0dHJzLmttc0tleTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IEltcG9ydChzY29wZSwgaWQpO1xuICB9XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBBdHRyaWJ1dGVzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIHByb21wdC5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBwcm9tcHROYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgS01TIGtleSB0aGF0IHRoZSBwcm9tcHQgaXMgZW5jcnlwdGVkIHdpdGguXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkga21zS2V5PzogSUtleTtcbiAgLyoqXG4gICAqIFRoZSBBUk4gb2YgdGhlIHByb21wdC5cbiAgICogQGV4YW1wbGUgXCJhcm46YXdzOmJlZHJvY2s6dXMtZWFzdC0xOjEyMzQ1Njc4OTAxMjpwcm9tcHQvUFJPTVBUMTIzNDVcIlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHByb21wdEFybjogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIElEIG9mIHRoZSBwcm9tcHQuXG4gICAqIEBleGFtcGxlIFwiUFJPTVBUMTIzNDVcIlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHByb21wdElkOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgdmVyc2lvbiBvZiB0aGUgcHJvbXB0LlxuICAgKi9cbiAgcHVibGljIHByb21wdFZlcnNpb246IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSB2YXJpYW50cyBvZiB0aGUgcHJvbXB0LlxuICAgKi9cbiAgcmVhZG9ubHkgdmFyaWFudHM6IFByb21wdFZhcmlhbnRbXTtcbiAgLyoqXG4gICAqIFRoZSBjb21wdXRlZCBoYXNoIG9mIHRoZSBwcm9tcHQgcHJvcGVydGllcy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgX2hhc2g6IHN0cmluZztcbiAgLyoqXG4gICAqIEwxIHJlc291cmNlXG4gICAqL1xuICBwcml2YXRlIHJlYWRvbmx5IF9yZXNvdXJjZTogYmVkcm9jay5DZm5Qcm9tcHQ7XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIENvbnN0cnVjdG9yXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogUHJvbXB0UHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIFNldCBwcm9wZXJ0aWVzIG9yIGRlZmF1bHRzXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5wcm9tcHROYW1lID0gcHJvcHMucHJvbXB0TmFtZTtcbiAgICB0aGlzLmttc0tleSA9IHByb3BzLmttc0tleTtcbiAgICB0aGlzLnZhcmlhbnRzID0gcHJvcHMudmFyaWFudHMgPz8gW107XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBWYWxpZGF0aW9uXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5ub2RlLmFkZFZhbGlkYXRpb24oeyB2YWxpZGF0ZTogKCkgPT4gdGhpcy52YWxpZGF0ZVByb21wdE5hbWUoKSB9KTtcbiAgICB0aGlzLm5vZGUuYWRkVmFsaWRhdGlvbih7IHZhbGlkYXRlOiAoKSA9PiB0aGlzLnZhbGlkYXRlUHJvbXB0VmFyaWFudHMoKSB9KTtcblxuICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIENGTiBQcm9wcyAtIFdpdGggTGF6eSBzdXBwb3J0XG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgbGV0IGNmblByb3BzOiBiZWRyb2NrLkNmblByb21wdFByb3BzID0ge1xuICAgICAgY3VzdG9tZXJFbmNyeXB0aW9uS2V5QXJuOiB0aGlzLmttc0tleT8ua2V5QXJuLFxuICAgICAgZGVmYXVsdFZhcmlhbnQ6IHByb3BzLmRlZmF1bHRWYXJpYW50Py5uYW1lLFxuICAgICAgZGVzY3JpcHRpb246IHByb3BzLmRlc2NyaXB0aW9uLFxuICAgICAgbmFtZTogcHJvcHMucHJvbXB0TmFtZSxcbiAgICAgIHZhcmlhbnRzOiBMYXp5LmFueSh7XG4gICAgICAgIHByb2R1Y2U6ICgpID0+IHRoaXMudmFyaWFudHMsXG4gICAgICB9KSxcbiAgICB9O1xuXG4gICAgLy8gSGFzaCBjYWxjdWxhdGlvbiB1c2VmdWwgZm9yIHZlcnNpb25pbmcgb2YgdGhlIGd1YXJkcmFpbFxuICAgIHRoaXMuX2hhc2ggPSBtZDVoYXNoKEpTT04uc3RyaW5naWZ5KGNmblByb3BzKSk7XG5cbiAgICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBMMSBJbnN0YW50aWF0aW9uXG4gICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgdGhpcy5fcmVzb3VyY2UgPSBuZXcgYmVkcm9jay5DZm5Qcm9tcHQodGhpcywgJ1Byb21wdCcsIGNmblByb3BzKTtcblxuICAgIHRoaXMucHJvbXB0QXJuID0gdGhpcy5fcmVzb3VyY2UuYXR0ckFybjtcbiAgICB0aGlzLnByb21wdElkID0gdGhpcy5fcmVzb3VyY2UuYXR0cklkO1xuICAgIHRoaXMucHJvbXB0VmVyc2lvbiA9IHRoaXMuX3Jlc291cmNlLmF0dHJWZXJzaW9uO1xuICB9XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIFZhbGlkYXRpb24gTWV0aG9kc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLyoqXG4gICAqIFZhbGlkYXRlcyB3aGV0aGVyIHRoZSBwcm9tcHQgbmFtZSBpcyB2YWxpZCBhY2NvcmRpbmcgdG8gdGhlIHNwZWNpZmljYXRpb24uXG4gICAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL0FXU0Nsb3VkRm9ybWF0aW9uL2xhdGVzdC9Vc2VyR3VpZGUvYXdzLXJlc291cmNlLWJlZHJvY2stcHJvbXB0Lmh0bWwjY2ZuLWJlZHJvY2stcHJvbXB0LW5hbWVcbiAgICovXG4gIHByaXZhdGUgdmFsaWRhdGVQcm9tcHROYW1lKCkge1xuICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcblxuICAgIGNvbnN0IG1hdGNoZXNQYXR0ZXJuID0gL14oWzAtOWEtekEtWl1bXy1dPyl7MSwxMDB9JC8udGVzdCh0aGlzLnByb21wdE5hbWUpO1xuICAgIGlmICghbWF0Y2hlc1BhdHRlcm4pIHtcbiAgICAgIGVycm9ycy5wdXNoKFxuICAgICAgICAnVmFsaWQgY2hhcmFjdGVycyBhcmUgYS16LCBBLVosIDAtOSwgXyAodW5kZXJzY29yZSkgYW5kIC0gKGh5cGhlbikuIEFuZCBtdXN0IG5vdCBiZWdpbiB3aXRoIGEgaHlwaGVuJyxcbiAgICAgICk7XG4gICAgfVxuICAgIGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuICAgICAgZXJyb3JzLnVuc2hpZnQoYEludmFsaWQgcHJvbXB0IG5hbWUgKHZhbHVlOiAke3RoaXMucHJvbXB0TmFtZX0pYCk7XG4gICAgfVxuICAgIHJldHVybiBlcnJvcnM7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGVzIHdoZXRoZXIgdGhlIG51bWJlciBvZiBwcm9tcHQgdmFyaWFudHMgaXMgcmVzcGVjdGVkLlxuICAgKi9cbiAgcHJpdmF0ZSB2YWxpZGF0ZVByb21wdFZhcmlhbnRzKCkge1xuICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcbiAgICBpZiAodGhpcy52YXJpYW50cy5sZW5ndGggPiAzKSB7XG4gICAgICBlcnJvcnMucHVzaChcbiAgICAgICAgYEVycm9yOiBUb28gbWFueSB2YXJpYW50cyBzcGVjaWZpZWQuIFRoZSBtYXhpbXVtIGFsbG93ZWQgaXMgMywgYnV0IHlvdSBoYXZlIHByb3ZpZGVkICR7dGhpcy52YXJpYW50cy5sZW5ndGh9IHZhcmlhbnRzLmAsXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gZXJyb3JzO1xuICB9XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEhlbHBlciBNZXRob2RzXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvKipcbiAgICogQ3JlYXRlcyBhIHByb21wdCB2ZXJzaW9uLCBhIHN0YXRpYyBzbmFwc2hvdCBvZiB5b3VyIHByb21wdCB0aGF0IGNhbiBiZVxuICAgKiBkZXBsb3llZCB0byBwcm9kdWN0aW9uLlxuICAgKi9cbiAgcHVibGljIGNyZWF0ZVZlcnNpb24oZGVzY3JpcHRpb24/OiBzdHJpbmcpOiBzdHJpbmcge1xuICAgIGNvbnN0IHZlcnNpb24gPSBuZXcgYmVkcm9jay5DZm5Qcm9tcHRWZXJzaW9uKHRoaXMsIGBQcm9tcHRWZXJzaW9uLSR7dGhpcy5faGFzaH1gLCB7XG4gICAgICBwcm9tcHRBcm46IHRoaXMucHJvbXB0QXJuLFxuICAgICAgZGVzY3JpcHRpb24sXG4gICAgfSk7XG4gICAgdGhpcy5wcm9tcHRWZXJzaW9uID0gdmVyc2lvbi5hdHRyVmVyc2lvbjtcbiAgICByZXR1cm4gdGhpcy5wcm9tcHRWZXJzaW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYSBwcm9tcHQgdmFyaWFudC5cbiAgICovXG4gIHB1YmxpYyBhZGRWYXJpYW50KHZhcmlhbnQ6IFByb21wdFZhcmlhbnQpIHtcbiAgICB0aGlzLnZhcmlhbnRzLnB1c2godmFyaWFudCk7XG4gIH1cbn1cbiJdfQ==