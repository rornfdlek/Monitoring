"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.ApplicationInferenceProfile = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const aws_cdk_lib_1 = require("aws-cdk-lib");
const bedrock = require("aws-cdk-lib/aws-bedrock");
const aws_iam_1 = require("aws-cdk-lib/aws-iam");
const common_1 = require("./common");
/******************************************************************************
 *                        NEW CONSTRUCT DEFINITION
 *****************************************************************************/
/**
 * Class to create a ApplicationInferenceProfile with CDK.
 * These are inference profiles created by users (user defined).
 * This helps to track costs and model usage.
 * @resource AWS::Bedrock::ApplicationInferenceProfile
 * @see https://docs.aws.amazon.com/bedrock/latest/userguide/inference-profiles-create.html
 */
class ApplicationInferenceProfile extends common_1.InferenceProfileBase {
    /**
     * Import a ApplicationInferenceProfile given its attributes
     */
    static fromApplicationInferenceProfileAttributes(scope, id, attrs) {
        class Import extends common_1.InferenceProfileBase {
            constructor() {
                super(...arguments);
                this.inferenceProfileArn = attrs.inferenceProfileArn;
                this.inferenceProfileId = aws_cdk_lib_1.Arn.split(attrs.inferenceProfileArn, aws_cdk_lib_1.ArnFormat.SLASH_RESOURCE_NAME)
                    .resourceName;
                this.type = common_1.InferenceProfileType.APPLICATION;
            }
        }
        return new Import(scope, id);
    }
    /**
     * Import a low-level L1 Cfn ApplicationInferenceProfile
     */
    static fromCfnApplicationInferenceProfile(CfnApplicationInferenceProfile) {
        return new (class extends common_1.InferenceProfileBase {
            constructor() {
                super(...arguments);
                this.inferenceProfileArn = CfnApplicationInferenceProfile.attrInferenceProfileArn;
                this.inferenceProfileId = CfnApplicationInferenceProfile.attrInferenceProfileId;
                this.type = common_1.InferenceProfileType.APPLICATION;
            }
        })(CfnApplicationInferenceProfile, '@FromCfnApplicationInferenceProfile');
    }
    constructor(scope, id, props) {
        super(scope, id);
        this.inferenceProfileModel = props.modelSource;
        this.inferenceProfileName = props.inferenceProfileName;
        this.type = common_1.InferenceProfileType.APPLICATION;
        // L1 instantiation
        this._resource = new bedrock.CfnApplicationInferenceProfile(this, id, {
            description: props.description,
            inferenceProfileName: props.inferenceProfileName,
            modelSource: {
                copyFrom: props.modelSource.invokableArn,
            },
            tags: props.tags,
        });
        // build attributes
        this.inferenceProfileArn = this._resource.attrInferenceProfileArn;
        this.inferenceProfileId = this._resource.attrInferenceProfileId;
        this.status = this._resource.attrStatus;
        this.type = this._resource.attrType;
        this.createdAt = this._resource.attrCreatedAt;
        this.updatedAt = this._resource.attrUpdatedAt;
        // Needed to Implement IInvokable
        this.invokableArn = this.inferenceProfileArn;
    }
    /**
     * Gives the appropriate policies to invoke and use the application inference profile.
     */
    grantInvoke(grantee) {
        // This method ensures the appropriate permissions are given
        // to use either the inference profile or the vanilla FM
        this.inferenceProfileModel.grantInvoke(grantee);
        // plus we add permissions to now invoke the application inference profile itself.
        return this.grantProfileUsage(grantee);
    }
    /**
     * Grants appropriate permissions to use the application inference profile (AIP).
     * Does not grant permissions to use the model/cross-region profile in the AIP.
     */
    grantProfileUsage(grantee) {
        const grant = aws_iam_1.Grant.addToPrincipal({
            grantee: grantee,
            actions: ['bedrock:GetInferenceProfile', 'bedrock:InvokeModel'],
            resourceArns: [this.inferenceProfileArn],
        });
        return grant;
    }
}
exports.ApplicationInferenceProfile = ApplicationInferenceProfile;
_a = JSII_RTTI_SYMBOL_1;
ApplicationInferenceProfile[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.ApplicationInferenceProfile", version: "0.1.285" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwbGljYXRpb24taW5mZXJlbmNlLXByb2ZpbGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY2RrLWxpYi9iZWRyb2NrL2luZmVyZW5jZS1wcm9maWxlcy9hcHBsaWNhdGlvbi1pbmZlcmVuY2UtcHJvZmlsZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBOzs7Ozs7Ozs7OztHQVdHO0FBQ0gsNkNBQXFEO0FBQ3JELG1EQUFtRDtBQUNuRCxpREFBd0Q7QUFFeEQscUNBQXlGO0FBbUR6Rjs7K0VBRStFO0FBQy9FOzs7Ozs7R0FNRztBQUNILE1BQWEsMkJBQTRCLFNBQVEsNkJBQW9CO0lBQ25FOztPQUVHO0lBQ0ksTUFBTSxDQUFDLHlDQUF5QyxDQUNyRCxLQUFnQixFQUNoQixFQUFVLEVBQ1YsS0FBNEM7UUFFNUMsTUFBTSxNQUFPLFNBQVEsNkJBQW9CO1lBQXpDOztnQkFDa0Isd0JBQW1CLEdBQUcsS0FBSyxDQUFDLG1CQUFtQixDQUFDO2dCQUNoRCx1QkFBa0IsR0FBRyxpQkFBRyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsbUJBQW1CLEVBQUUsdUJBQVMsQ0FBQyxtQkFBbUIsQ0FBQztxQkFDckcsWUFBYSxDQUFDO2dCQUNELFNBQUksR0FBRyw2QkFBb0IsQ0FBQyxXQUFXLENBQUM7WUFDMUQsQ0FBQztTQUFBO1FBRUQsT0FBTyxJQUFJLE1BQU0sQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUNEOztPQUVHO0lBQ0ksTUFBTSxDQUFDLGtDQUFrQyxDQUM5Qyw4QkFBc0U7UUFFdEUsT0FBTyxJQUFJLENBQUMsS0FBTSxTQUFRLDZCQUFvQjtZQUFsQzs7Z0JBQ00sd0JBQW1CLEdBQUcsOEJBQThCLENBQUMsdUJBQXVCLENBQUM7Z0JBQzdFLHVCQUFrQixHQUFHLDhCQUE4QixDQUFDLHNCQUFzQixDQUFDO2dCQUMzRSxTQUFJLEdBQUcsNkJBQW9CLENBQUMsV0FBVyxDQUFDO1lBQzFELENBQUM7U0FBQSxDQUFDLENBQUMsOEJBQThCLEVBQUUscUNBQXFDLENBQUMsQ0FBQztJQUM1RSxDQUFDO0lBK0NELFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBdUM7UUFDL0UsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUVqQixJQUFJLENBQUMscUJBQXFCLEdBQUcsS0FBSyxDQUFDLFdBQVcsQ0FBQztRQUMvQyxJQUFJLENBQUMsb0JBQW9CLEdBQUcsS0FBSyxDQUFDLG9CQUFvQixDQUFDO1FBQ3ZELElBQUksQ0FBQyxJQUFJLEdBQUcsNkJBQW9CLENBQUMsV0FBVyxDQUFDO1FBRTdDLG1CQUFtQjtRQUNuQixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksT0FBTyxDQUFDLDhCQUE4QixDQUFDLElBQUksRUFBRSxFQUFFLEVBQUU7WUFDcEUsV0FBVyxFQUFFLEtBQUssQ0FBQyxXQUFXO1lBQzlCLG9CQUFvQixFQUFFLEtBQUssQ0FBQyxvQkFBb0I7WUFDaEQsV0FBVyxFQUFFO2dCQUNYLFFBQVEsRUFBRSxLQUFLLENBQUMsV0FBVyxDQUFDLFlBQVk7YUFDekM7WUFDRCxJQUFJLEVBQUUsS0FBSyxDQUFDLElBQUk7U0FDakIsQ0FBQyxDQUFDO1FBRUgsbUJBQW1CO1FBQ25CLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLHVCQUF1QixDQUFDO1FBQ2xFLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLHNCQUFzQixDQUFDO1FBQ2hFLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUM7UUFDeEMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQWdDLENBQUM7UUFDNUQsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQztRQUM5QyxJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDO1FBRTlDLGlDQUFpQztRQUNqQyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQztJQUMvQyxDQUFDO0lBRUQ7O09BRUc7SUFDSSxXQUFXLENBQUMsT0FBbUI7UUFDcEMsNERBQTREO1FBQzVELHdEQUF3RDtRQUN4RCxJQUFJLENBQUMscUJBQXFCLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRWhELGtGQUFrRjtRQUVsRixPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsaUJBQWlCLENBQUMsT0FBbUI7UUFDbkMsTUFBTSxLQUFLLEdBQUcsZUFBSyxDQUFDLGNBQWMsQ0FBQztZQUNqQyxPQUFPLEVBQUUsT0FBTztZQUNoQixPQUFPLEVBQUUsQ0FBQyw2QkFBNkIsRUFBRSxxQkFBcUIsQ0FBQztZQUMvRCxZQUFZLEVBQUUsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUM7U0FDekMsQ0FBQyxDQUFDO1FBQ0gsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDOztBQWpJSCxrRUFrSUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqICBDb3B5cmlnaHQgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS4gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogIHdpdGggdGhlIExpY2Vuc2UuIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiAgb3IgaW4gdGhlICdsaWNlbnNlJyBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAnQVMgSVMnIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVNcbiAqICBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xuICogIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuaW1wb3J0IHsgQ2ZuVGFnLCBBcm4sIEFybkZvcm1hdCB9IGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCAqIGFzIGJlZHJvY2sgZnJvbSAnYXdzLWNkay1saWIvYXdzLWJlZHJvY2snO1xuaW1wb3J0IHsgR3JhbnQsIElHcmFudGFibGUgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtaWFtJztcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0IHsgSUluZmVyZW5jZVByb2ZpbGUsIEluZmVyZW5jZVByb2ZpbGVCYXNlLCBJbmZlcmVuY2VQcm9maWxlVHlwZSB9IGZyb20gJy4vY29tbW9uJztcbmltcG9ydCB7IElJbnZva2FibGUgfSBmcm9tICcuLi9tb2RlbHMnO1xuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiAgICAgICAgICAgICAgICAgICAgICAgIFBST1BTIEZPUiBORVcgQ09OU1RSVUNUXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG4vKipcbiAqIFByb3BlcnRpZXMgZm9yIGNyZWF0aW5nIGEgQXBwbGljYXRpb25JbmZlcmVuY2VQcm9maWxlLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEFwcGxpY2F0aW9uSW5mZXJlbmNlUHJvZmlsZVByb3BzIHtcbiAgLyoqXG4gICAqIERlc2NyaXB0aW9uIG9mIHRoZSBpbmZlcmVuY2UgcHJvZmlsZS5cbiAgICogQHNlZSBodHRwOi8vZG9jcy5hd3MuYW1hem9uLmNvbS9BV1NDbG91ZEZvcm1hdGlvbi9sYXRlc3QvVXNlckd1aWRlL2F3cy1yZXNvdXJjZS1iZWRyb2NrLWFwcGxpY2F0aW9uaW5mZXJlbmNlcHJvZmlsZS5odG1sI2Nmbi1iZWRyb2NrLWFwcGxpY2F0aW9uaW5mZXJlbmNlcHJvZmlsZS1kZXNjcmlwdGlvblxuICAgKi9cbiAgcmVhZG9ubHkgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgaW5mZXJlbmNlIHByb2ZpbGUuXG4gICAqIEBzZWUgaHR0cDovL2RvY3MuYXdzLmFtYXpvbi5jb20vQVdTQ2xvdWRGb3JtYXRpb24vbGF0ZXN0L1VzZXJHdWlkZS9hd3MtcmVzb3VyY2UtYmVkcm9jay1hcHBsaWNhdGlvbmluZmVyZW5jZXByb2ZpbGUuaHRtbCNjZm4tYmVkcm9jay1hcHBsaWNhdGlvbmluZmVyZW5jZXByb2ZpbGUtaW5mZXJlbmNlcHJvZmlsZW5hbWVcbiAgICovXG4gIHJlYWRvbmx5IGluZmVyZW5jZVByb2ZpbGVOYW1lOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUbyBjcmVhdGUgYW4gYXBwbGljYXRpb24gaW5mZXJlbmNlIHByb2ZpbGUgZm9yIG9uZSBSZWdpb24sIHNwZWNpZnkgYSBmb3VuZGF0aW9uIG1vZGVsLlxuICAgKiBVc2FnZSBhbmQgY29zdHMgZm9yIHJlcXVlc3RzIG1hZGUgdG8gdGhhdCBSZWdpb24gd2l0aCB0aGF0IG1vZGVsIHdpbGwgYmUgdHJhY2tlZC5cbiAgICpcbiAgICogVG8gY3JlYXRlIGFuIGFwcGxpY2F0aW9uIGluZmVyZW5jZSBwcm9maWxlIGZvciBtdWx0aXBsZSBSZWdpb25zLFxuICAgKiBzcGVjaWZ5IGEgY3Jvc3MgcmVnaW9uIChzeXN0ZW0tZGVmaW5lZCkgaW5mZXJlbmNlIHByb2ZpbGUuXG4gICAqIFRoZSBpbmZlcmVuY2UgcHJvZmlsZSB3aWxsIHJvdXRlIHJlcXVlc3RzIHRvIHRoZSBSZWdpb25zIGRlZmluZWQgaW5cbiAgICogdGhlIGNyb3NzIHJlZ2lvbiAoc3lzdGVtLWRlZmluZWQpIGluZmVyZW5jZSBwcm9maWxlIHRoYXQgeW91IGNob29zZS5cbiAgICogVXNhZ2UgYW5kIGNvc3RzIGZvciByZXF1ZXN0cyBtYWRlIHRvIHRoZSBSZWdpb25zIGluIHRoZSBpbmZlcmVuY2UgcHJvZmlsZSB3aWxsIGJlIHRyYWNrZWQuXG4gICAqL1xuICByZWFkb25seSBtb2RlbFNvdXJjZTogSUludm9rYWJsZTtcbiAgLyoqXG4gICAqIEEgbGlzdCBvZiB0YWdzIGFzc29jaWF0ZWQgd2l0aCB0aGUgaW5mZXJlbmNlIHByb2ZpbGUuXG4gICAqICovXG4gIHJlYWRvbmx5IHRhZ3M/OiBBcnJheTxDZm5UYWc+O1xufVxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiAgICAgICAgICAgICAgICAgICAgICBBVFRSUyBGT1IgSU1QT1JURUQgQ09OU1RSVUNUXG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5leHBvcnQgaW50ZXJmYWNlIEFwcGxpY2F0aW9uSW5mZXJlbmNlUHJvZmlsZUF0dHJpYnV0ZXMge1xuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUgYXBwbGljYXRpb24gaW5mZXJlbmNlIHByb2ZpbGUuXG4gICAqL1xuICByZWFkb25seSBpbmZlcmVuY2VQcm9maWxlQXJuOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgSUQgb3IgQW1hem9uIFJlc291cmNlIE5hbWUgKEFSTikgb2YgdGhlIGluZmVyZW5jZSBwcm9maWxlLlxuICAgKi9cbiAgcmVhZG9ubHkgaW5mZXJlbmNlUHJvZmlsZUlkZW50aWZpZXI6IHN0cmluZztcbn1cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICogICAgICAgICAgICAgICAgICAgICAgICBORVcgQ09OU1RSVUNUIERFRklOSVRJT05cbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8qKlxuICogQ2xhc3MgdG8gY3JlYXRlIGEgQXBwbGljYXRpb25JbmZlcmVuY2VQcm9maWxlIHdpdGggQ0RLLlxuICogVGhlc2UgYXJlIGluZmVyZW5jZSBwcm9maWxlcyBjcmVhdGVkIGJ5IHVzZXJzICh1c2VyIGRlZmluZWQpLlxuICogVGhpcyBoZWxwcyB0byB0cmFjayBjb3N0cyBhbmQgbW9kZWwgdXNhZ2UuXG4gKiBAcmVzb3VyY2UgQVdTOjpCZWRyb2NrOjpBcHBsaWNhdGlvbkluZmVyZW5jZVByb2ZpbGVcbiAqIEBzZWUgaHR0cHM6Ly9kb2NzLmF3cy5hbWF6b24uY29tL2JlZHJvY2svbGF0ZXN0L3VzZXJndWlkZS9pbmZlcmVuY2UtcHJvZmlsZXMtY3JlYXRlLmh0bWxcbiAqL1xuZXhwb3J0IGNsYXNzIEFwcGxpY2F0aW9uSW5mZXJlbmNlUHJvZmlsZSBleHRlbmRzIEluZmVyZW5jZVByb2ZpbGVCYXNlIGltcGxlbWVudHMgSUludm9rYWJsZSB7XG4gIC8qKlxuICAgKiBJbXBvcnQgYSBBcHBsaWNhdGlvbkluZmVyZW5jZVByb2ZpbGUgZ2l2ZW4gaXRzIGF0dHJpYnV0ZXNcbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgZnJvbUFwcGxpY2F0aW9uSW5mZXJlbmNlUHJvZmlsZUF0dHJpYnV0ZXMoXG4gICAgc2NvcGU6IENvbnN0cnVjdCxcbiAgICBpZDogc3RyaW5nLFxuICAgIGF0dHJzOiBBcHBsaWNhdGlvbkluZmVyZW5jZVByb2ZpbGVBdHRyaWJ1dGVzLFxuICApOiBJSW5mZXJlbmNlUHJvZmlsZSB7XG4gICAgY2xhc3MgSW1wb3J0IGV4dGVuZHMgSW5mZXJlbmNlUHJvZmlsZUJhc2Uge1xuICAgICAgcHVibGljIHJlYWRvbmx5IGluZmVyZW5jZVByb2ZpbGVBcm4gPSBhdHRycy5pbmZlcmVuY2VQcm9maWxlQXJuO1xuICAgICAgcHVibGljIHJlYWRvbmx5IGluZmVyZW5jZVByb2ZpbGVJZCA9IEFybi5zcGxpdChhdHRycy5pbmZlcmVuY2VQcm9maWxlQXJuLCBBcm5Gb3JtYXQuU0xBU0hfUkVTT1VSQ0VfTkFNRSlcbiAgICAgICAgLnJlc291cmNlTmFtZSE7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgdHlwZSA9IEluZmVyZW5jZVByb2ZpbGVUeXBlLkFQUExJQ0FUSU9OO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgSW1wb3J0KHNjb3BlLCBpZCk7XG4gIH1cbiAgLyoqXG4gICAqIEltcG9ydCBhIGxvdy1sZXZlbCBMMSBDZm4gQXBwbGljYXRpb25JbmZlcmVuY2VQcm9maWxlXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGZyb21DZm5BcHBsaWNhdGlvbkluZmVyZW5jZVByb2ZpbGUoXG4gICAgQ2ZuQXBwbGljYXRpb25JbmZlcmVuY2VQcm9maWxlOiBiZWRyb2NrLkNmbkFwcGxpY2F0aW9uSW5mZXJlbmNlUHJvZmlsZSxcbiAgKTogSUluZmVyZW5jZVByb2ZpbGUge1xuICAgIHJldHVybiBuZXcgKGNsYXNzIGV4dGVuZHMgSW5mZXJlbmNlUHJvZmlsZUJhc2Uge1xuICAgICAgcHVibGljIHJlYWRvbmx5IGluZmVyZW5jZVByb2ZpbGVBcm4gPSBDZm5BcHBsaWNhdGlvbkluZmVyZW5jZVByb2ZpbGUuYXR0ckluZmVyZW5jZVByb2ZpbGVBcm47XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgaW5mZXJlbmNlUHJvZmlsZUlkID0gQ2ZuQXBwbGljYXRpb25JbmZlcmVuY2VQcm9maWxlLmF0dHJJbmZlcmVuY2VQcm9maWxlSWQ7XG4gICAgICBwdWJsaWMgcmVhZG9ubHkgdHlwZSA9IEluZmVyZW5jZVByb2ZpbGVUeXBlLkFQUExJQ0FUSU9OO1xuICAgIH0pKENmbkFwcGxpY2F0aW9uSW5mZXJlbmNlUHJvZmlsZSwgJ0BGcm9tQ2ZuQXBwbGljYXRpb25JbmZlcmVuY2VQcm9maWxlJyk7XG4gIH1cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBhcHBsaWNhdGlvbiBpbmZlcmVuY2UgcHJvZmlsZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBpbmZlcmVuY2VQcm9maWxlTmFtZTogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIEFSTiBvZiB0aGUgYXBwbGljYXRpb24gYXBwbGljYXRpb24gaW5mZXJlbmNlIHByb2ZpbGUuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgaW5mZXJlbmNlUHJvZmlsZUFybjogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIHVuaXF1ZSBpZGVudGlmaWVyIG9mIHRoZSBhcHBsaWNhdGlvbiBpbmZlcmVuY2UgcHJvZmlsZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBpbmZlcmVuY2VQcm9maWxlSWQ6IHN0cmluZztcbiAgLyoqXG4gICAqIFRoZSB1bmRlcmx5aW5nIG1vZGVsL2Nyb3NzLXJlZ2lvbiBtb2RlbCB1c2VkIGJ5IHRoZSBhcHBsaWNhdGlvbiBpbmZlcmVuY2UgcHJvZmlsZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBpbmZlcmVuY2VQcm9maWxlTW9kZWw6IElJbnZva2FibGU7XG4gIC8qKlxuICAgKiBUaGUgc3RhdHVzIG9mIHRoZSBhcHBsaWNhdGlvbiBpbmZlcmVuY2UgcHJvZmlsZS4gQUNUSVZFIG1lYW5zIHRoYXQgdGhlIGluZmVyZW5jZSBwcm9maWxlIGlzIHJlYWR5IHRvIGJlIHVzZWQuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgc3RhdHVzOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGUgdHlwZSBvZiB0aGUgaW5mZXJlbmNlIHByb2ZpbGUuIFRoZSBmb2xsb3dpbmcgdHlwZXMgYXJlIHBvc3NpYmxlOlxuICAgKiBTWVNURU1fREVGSU5FRCDigJMgVGhlIGluZmVyZW5jZSBwcm9maWxlIGlzIGRlZmluZWQgYnkgQW1hem9uIEJlZHJvY2suXG4gICAqIFlvdSBjYW4gcm91dGUgaW5mZXJlbmNlIHJlcXVlc3RzIGFjcm9zcyByZWdpb25zIHdpdGggdGhlc2UgaW5mZXJlbmNlIHByb2ZpbGVzLlxuICAgKiBBUFBMSUNBVElPTiDigJMgVGhlIGluZmVyZW5jZSBwcm9maWxlIHdhcyBjcmVhdGVkIGJ5IGEgdXNlci5cbiAgICogVGhpcyB0eXBlIG9mIGluZmVyZW5jZSBwcm9maWxlIGNhbiB0cmFjayBtZXRyaWNzIGFuZCBjb3N0cyB3aGVuIGludm9raW5nIHRoZSBtb2RlbCBpbiBpdC5cbiAgICogVGhlIGluZmVyZW5jZSBwcm9maWxlIG1heSByb3V0ZSByZXF1ZXN0cyB0byBvbmUgb3IgbXVsdGlwbGUgcmVnaW9ucy5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSB0eXBlOiBJbmZlcmVuY2VQcm9maWxlVHlwZTtcbiAgLyoqXG4gICAqIFRpbWUgU3RhbXAgZm9yIEFwcGxpY2F0aW9uSW5mZXJlbmNlUHJvZmlsZSBjcmVhdGlvbi5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBjcmVhdGVkQXQ6IHN0cmluZztcbiAgLyoqXG4gICAqIFRpbWUgU3RhbXAgZm9yIEFwcGxpY2F0aW9uSW5mZXJlbmNlUHJvZmlsZSB1cGRhdGUuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgdXBkYXRlZEF0OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBUaGlzIGVxdWFscyB0byB0aGUgaW5mZXJlbmNlUHJvZmlsZUFybiBwcm9wZXJ0eSwgdXNlZnVsIGp1c3QgdG8gaW1wbGVtZW50IElJbnZva2FibGUgaW50ZXJmYWNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGludm9rYWJsZUFybjogc3RyaW5nO1xuICAvKipcbiAgICogSW5zdGFuY2Ugb2YgQ2ZuQXBwbGljYXRpb25JbmZlcmVuY2VQcm9maWxlLlxuICAgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBfcmVzb3VyY2U6IGJlZHJvY2suQ2ZuQXBwbGljYXRpb25JbmZlcmVuY2VQcm9maWxlO1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBBcHBsaWNhdGlvbkluZmVyZW5jZVByb2ZpbGVQcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG5cbiAgICB0aGlzLmluZmVyZW5jZVByb2ZpbGVNb2RlbCA9IHByb3BzLm1vZGVsU291cmNlO1xuICAgIHRoaXMuaW5mZXJlbmNlUHJvZmlsZU5hbWUgPSBwcm9wcy5pbmZlcmVuY2VQcm9maWxlTmFtZTtcbiAgICB0aGlzLnR5cGUgPSBJbmZlcmVuY2VQcm9maWxlVHlwZS5BUFBMSUNBVElPTjtcblxuICAgIC8vIEwxIGluc3RhbnRpYXRpb25cbiAgICB0aGlzLl9yZXNvdXJjZSA9IG5ldyBiZWRyb2NrLkNmbkFwcGxpY2F0aW9uSW5mZXJlbmNlUHJvZmlsZSh0aGlzLCBpZCwge1xuICAgICAgZGVzY3JpcHRpb246IHByb3BzLmRlc2NyaXB0aW9uLFxuICAgICAgaW5mZXJlbmNlUHJvZmlsZU5hbWU6IHByb3BzLmluZmVyZW5jZVByb2ZpbGVOYW1lLFxuICAgICAgbW9kZWxTb3VyY2U6IHtcbiAgICAgICAgY29weUZyb206IHByb3BzLm1vZGVsU291cmNlLmludm9rYWJsZUFybixcbiAgICAgIH0sXG4gICAgICB0YWdzOiBwcm9wcy50YWdzLFxuICAgIH0pO1xuXG4gICAgLy8gYnVpbGQgYXR0cmlidXRlc1xuICAgIHRoaXMuaW5mZXJlbmNlUHJvZmlsZUFybiA9IHRoaXMuX3Jlc291cmNlLmF0dHJJbmZlcmVuY2VQcm9maWxlQXJuO1xuICAgIHRoaXMuaW5mZXJlbmNlUHJvZmlsZUlkID0gdGhpcy5fcmVzb3VyY2UuYXR0ckluZmVyZW5jZVByb2ZpbGVJZDtcbiAgICB0aGlzLnN0YXR1cyA9IHRoaXMuX3Jlc291cmNlLmF0dHJTdGF0dXM7XG4gICAgdGhpcy50eXBlID0gdGhpcy5fcmVzb3VyY2UuYXR0clR5cGUgYXMgSW5mZXJlbmNlUHJvZmlsZVR5cGU7XG4gICAgdGhpcy5jcmVhdGVkQXQgPSB0aGlzLl9yZXNvdXJjZS5hdHRyQ3JlYXRlZEF0O1xuICAgIHRoaXMudXBkYXRlZEF0ID0gdGhpcy5fcmVzb3VyY2UuYXR0clVwZGF0ZWRBdDtcblxuICAgIC8vIE5lZWRlZCB0byBJbXBsZW1lbnQgSUludm9rYWJsZVxuICAgIHRoaXMuaW52b2thYmxlQXJuID0gdGhpcy5pbmZlcmVuY2VQcm9maWxlQXJuO1xuICB9XG5cbiAgLyoqXG4gICAqIEdpdmVzIHRoZSBhcHByb3ByaWF0ZSBwb2xpY2llcyB0byBpbnZva2UgYW5kIHVzZSB0aGUgYXBwbGljYXRpb24gaW5mZXJlbmNlIHByb2ZpbGUuXG4gICAqL1xuICBwdWJsaWMgZ3JhbnRJbnZva2UoZ3JhbnRlZTogSUdyYW50YWJsZSk6IEdyYW50IHtcbiAgICAvLyBUaGlzIG1ldGhvZCBlbnN1cmVzIHRoZSBhcHByb3ByaWF0ZSBwZXJtaXNzaW9ucyBhcmUgZ2l2ZW5cbiAgICAvLyB0byB1c2UgZWl0aGVyIHRoZSBpbmZlcmVuY2UgcHJvZmlsZSBvciB0aGUgdmFuaWxsYSBGTVxuICAgIHRoaXMuaW5mZXJlbmNlUHJvZmlsZU1vZGVsLmdyYW50SW52b2tlKGdyYW50ZWUpO1xuXG4gICAgLy8gcGx1cyB3ZSBhZGQgcGVybWlzc2lvbnMgdG8gbm93IGludm9rZSB0aGUgYXBwbGljYXRpb24gaW5mZXJlbmNlIHByb2ZpbGUgaXRzZWxmLlxuXG4gICAgcmV0dXJuIHRoaXMuZ3JhbnRQcm9maWxlVXNhZ2UoZ3JhbnRlZSk7XG4gIH1cblxuICAvKipcbiAgICogR3JhbnRzIGFwcHJvcHJpYXRlIHBlcm1pc3Npb25zIHRvIHVzZSB0aGUgYXBwbGljYXRpb24gaW5mZXJlbmNlIHByb2ZpbGUgKEFJUCkuXG4gICAqIERvZXMgbm90IGdyYW50IHBlcm1pc3Npb25zIHRvIHVzZSB0aGUgbW9kZWwvY3Jvc3MtcmVnaW9uIHByb2ZpbGUgaW4gdGhlIEFJUC5cbiAgICovXG4gIGdyYW50UHJvZmlsZVVzYWdlKGdyYW50ZWU6IElHcmFudGFibGUpOiBHcmFudCB7XG4gICAgY29uc3QgZ3JhbnQgPSBHcmFudC5hZGRUb1ByaW5jaXBhbCh7XG4gICAgICBncmFudGVlOiBncmFudGVlLFxuICAgICAgYWN0aW9uczogWydiZWRyb2NrOkdldEluZmVyZW5jZVByb2ZpbGUnLCAnYmVkcm9jazpJbnZva2VNb2RlbCddLFxuICAgICAgcmVzb3VyY2VBcm5zOiBbdGhpcy5pbmZlcmVuY2VQcm9maWxlQXJuXSxcbiAgICB9KTtcbiAgICByZXR1cm4gZ3JhbnQ7XG4gIH1cbn1cbiJdfQ==